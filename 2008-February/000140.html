<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dzchart-svncheckins] r271 - utilities/dzLib/trunk/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dzchart-svncheckins/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:dzchart-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BDzchart-svncheckins%5D%20r271%20-%20utilities/dzLib/trunk/src&In-Reply-To=%3C200802050758.m157wTj5031545%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000139.html">
   <LINK REL="Next"  HREF="000141.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dzchart-svncheckins] r271 - utilities/dzLib/trunk/src</H1>
    <B>twm at mail.berlios.de</B> 
    <A HREF="mailto:dzchart-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BDzchart-svncheckins%5D%20r271%20-%20utilities/dzLib/trunk/src&In-Reply-To=%3C200802050758.m157wTj5031545%40sheep.berlios.de%3E"
       TITLE="[Dzchart-svncheckins] r271 - utilities/dzLib/trunk/src">twm at mail.berlios.de
       </A><BR>
    <I>Tue Feb  5 08:58:29 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000139.html">[Dzchart-svncheckins] r270 - utilities/dzLib/trunk/src
</A></li>
        <LI>Next message: <A HREF="000141.html">[Dzchart-svncheckins] r272 - utilities/dzLib/trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#140">[ date ]</a>
              <a href="thread.html#140">[ thread ]</a>
              <a href="subject.html#140">[ subject ]</a>
              <a href="author.html#140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: twm
Date: 2008-02-05 08:58:28 +0100 (Tue, 05 Feb 2008)
New Revision: 271

Modified:
   utilities/dzLib/trunk/src/u_dzStringUtils.pas
Log:
* changed some comments from PasDoc to XMLDoc
* TLineBuilder's decimal separator can now be configured
* The list separator is now also a property

Modified: utilities/dzLib/trunk/src/u_dzStringUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzStringUtils.pas	2008-02-05 07:51:13 UTC (rev 270)
+++ utilities/dzLib/trunk/src/u_dzStringUtils.pas	2008-02-05 07:58:28 UTC (rev 271)
@@ -117,7 +117,7 @@
   TrimStr: TTrimStr = TrimSpaces deprecated;
 
 /// &lt;summary&gt;
-/// Creates a string with Anz spaces.
+/// Creates a string with Cnt spaces.
 /// &lt;/summary&gt;
 function SpaceStr(_Cnt: integer): string;
 
@@ -261,31 +261,31 @@
 {: Returns the Nth character of S or ' ' if S has less than N charaters. }
 function nthCharOf(const _s: string; _n: integer): Char;
 
-{: Extract the first word of S using the given delimiters. The word is deleted
-   from S.
-   NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
-   into two words (which you would expect), but also 'abc'#9#9'def' is two words
-   (which you might not expect) }
+///&lt;summary&gt; Extract the first word of S using the given delimiters. The word is deleted
+///          from S.
+///          NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
+///          into two words (which you would expect), but also 'abc'#9#9'def' is two words
+///          (which you might not expect) &lt;/summary&gt;
 function ExtractFirstWord(var _s: string; const _Delimiter: string): string; overload;
-{: Extract the first word of S using the given delimiters. The word is deleted
-   from S.
-   NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
-   into two words (which you would expect), but also 'abc'#9#9'def' is two words
-   (which you might not expect) }
+///&lt;summary&gt; Extract the first word of S using the given delimiters. The word is deleted
+///          from S.
+///          NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
+///          into two words (which you would expect), but also 'abc'#9#9'def' is two words
+///          (which you might not expect) &lt;/summary&gt;
 function ExtractFirstWord(var _s: string; _Delimiter: TCharSet): string; overload;
-{: Extract the first word of S using the given delimiters. The word is deleted
-   from S.
-   NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
-   into two words (which you would expect), but also 'abc'#9#9'def' is two words
-   (which you might not expect)
-   @returns true, if a word could be extracted, false otherwise }
+///&lt;summary&gt; Extract the first word of S using the given delimiters. The word is deleted
+///          from S.
+///          NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
+///          into two words (which you would expect), but also 'abc'#9#9'def' is two words
+///          (which you might not expect)
+///          @returns true, if a word could be extracted, false otherwise &lt;/summary&gt;
 function ExtractFirstWord(var _s: string; const _Delimiter: string; out _FirstWord: string): boolean; overload;
-{: Extract the first word of S using the given delimiters. The word is deleted
-   from S.
-   NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
-   into two words (which you would expect), but also 'abc'#9#9'def' is two words
-   (which you might not expect)
-   @returns true, if a word could be extracted, false otherwise }
+///&lt;summary&gt; Extract the first word of S using the given delimiters. The word is deleted
+///          from S.
+///          NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
+///          into two words (which you would expect), but also 'abc'#9#9'def' is two words
+///          (which you might not expect)
+///          @returns true, if a word could be extracted, false otherwise &lt;/summary&gt;
 function ExtractFirstWord(var _s: string; _Delimiter: TCharSet; out _FirstWord: string): boolean; overload;
 
 {: extracts the first N characters of a string }
@@ -322,12 +322,15 @@
   {: Helper class for building a text line }
   TLineBuilder = class
   private
-    FSeparator: string;
+    FListSeparator: string;
     FContent: string;
+    FFormatSettings: TFormatSettings;
   public
     {: Creates a TLineBuilder instance with the given separator
-       @param Separator is the separator string to use, defaults to TAB (#9) }
-    constructor Create(const _Separator: string = #9);
+       @param ListSeparator is the separator string to use, defaults to TAB (#9)
+       @param DecimalSeparator is the decimal separator to use for floating point
+              values, defaults to a dot (.). }
+    constructor Create(const _ListSeparator: string = #9; const _DecimalSeparator: char = '.');
     {: Assigns the contents of another TLineBuilder instance }
     procedure Assign(_Source: TLineBuilder);
     {: Adds a string column }
@@ -350,6 +353,8 @@
     function ExtractFirst(out _Column: string): boolean;
     {: allows read access to the content that has been built }
     property Content: string read FContent;
+    property DecimalSeparator: char read FFormatSettings.DecimalSeparator write FFormatSettings.DecimalSeparator default '.';
+    property ListSeparator: string read FListSeparator write FListSeparator;
   end;
 
 implementation
@@ -1022,10 +1027,13 @@
 
 { TLineBuilder }
 
-constructor TLineBuilder.Create(const _Separator: string);
+constructor TLineBuilder.Create(const _ListSeparator: string = #9; const _DecimalSeparator: char = '.');
 begin
   inherited Create;
-  FSeparator := _Separator;
+  FListSeparator := _ListSeparator;
+  FFormatSettings := GetUserDefaultLocaleSettings;
+  FFormatSettings.DecimalSeparator := _DecimalSeparator;
+  FFormatSettings.ThousandSeparator := #0;
 end;
 
 procedure TLineBuilder.Add(_IntValue: integer);
@@ -1035,13 +1043,13 @@
 
 procedure TLineBuilder.Add(_FloatValue: extended; _Decimals: integer);
 begin
-  Add(Float2Str(_FloatValue, _Decimals));
+  Add(FloatToStrF(_FloatValue, ffFixed, 18, _Decimals, FFormatSettings));
 end;
 
 procedure TLineBuilder.Add(const _Column: string);
 begin
   if FContent &lt;&gt; '' then
-    FContent := FContent + FSeparator;
+    FContent := FContent + FListSeparator;
   FContent := FContent + _Column;
 end;
 
@@ -1071,7 +1079,7 @@
   if s = '' then
     exit;
   if FContent &lt;&gt; '' then
-    FContent := FContent + FSeparator + s
+    FContent := FContent + FListSeparator + s
   else
     FContent := s;
 end;
@@ -1090,7 +1098,7 @@
 var
   p: Integer;
 begin
-  p := Pos(FSeparator, FContent);
+  p := Pos(FListSeparator, FContent);
   Result := p &lt;&gt; 0;
   if Result then begin
     _Column := LeftStr(FContent, p - 1);
@@ -1106,7 +1114,7 @@
   if s = '' then
     exit;
   if FContent &lt;&gt; '' then
-    FContent := s + FSeparator + FContent
+    FContent := s + FListSeparator + FContent
   else
     FContent := s;
 end;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000139.html">[Dzchart-svncheckins] r270 - utilities/dzLib/trunk/src
</A></li>
	<LI>Next message: <A HREF="000141.html">[Dzchart-svncheckins] r272 - utilities/dzLib/trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#140">[ date ]</a>
              <a href="thread.html#140">[ thread ]</a>
              <a href="subject.html#140">[ subject ]</a>
              <a href="author.html#140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dzchart-svncheckins">More information about the dzchart-svncheckins
mailing list</a><br>
</body></html>
