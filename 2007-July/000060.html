<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dzchart-svncheckins] r186 - utilities/dzPrepBuild/trunk/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dzchart-svncheckins/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:dzchart-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BDzchart-svncheckins%5D%20r186%20-%20utilities/dzPrepBuild/trunk/src&In-Reply-To=%3C200707221456.l6MEu4wA025333%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000059.html">
   <LINK REL="Next"  HREF="000061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dzchart-svncheckins] r186 - utilities/dzPrepBuild/trunk/src</H1>
    <B>twm at mail.berlios.de</B> 
    <A HREF="mailto:dzchart-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BDzchart-svncheckins%5D%20r186%20-%20utilities/dzPrepBuild/trunk/src&In-Reply-To=%3C200707221456.l6MEu4wA025333%40sheep.berlios.de%3E"
       TITLE="[Dzchart-svncheckins] r186 - utilities/dzPrepBuild/trunk/src">twm at mail.berlios.de
       </A><BR>
    <I>Sun Jul 22 16:56:04 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000059.html">[Dzchart-svncheckins] r185 - utilities/dzLib/trunk/src
</A></li>
        <LI>Next message: <A HREF="000061.html">[Dzchart-svncheckins] r187 - utilities/dzPrepBuild/trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60">[ date ]</a>
              <a href="thread.html#60">[ thread ]</a>
              <a href="subject.html#60">[ subject ]</a>
              <a href="author.html#60">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: twm
Date: 2007-07-22 16:56:00 +0200 (Sun, 22 Jul 2007)
New Revision: 186

Removed:
   utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
Modified:
   utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Log:
* added _( ) for all translatable strings
* TCentralVersionInfo.Create now removes the project file extension before adding _Version.ini
* removed u_IncBuildNoMain, replaced by u_PrepBuildMain

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-22 14:56:00 UTC (rev 186)
@@ -6,7 +6,6 @@
   SysUtils,
   Forms,
   oxmldom,
-  u_IncBuildNoMain in 'u_IncBuildNoMain.pas',
   d_BdsProjVersionInfo in 'd_BdsProjVersionInfo.pas' {dm_BdsProjVersionInfo: TDataModule},
   i_VersionInfo in 'i_VersionInfo.pas',
   u_DofVersionInfo in 'u_DofVersionInfo.pas',

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-22 14:56:00 UTC (rev 186)
@@ -36,7 +36,7 @@
     &lt;Borland.Personality&gt;Delphi.Personality&lt;/Borland.Personality&gt;
     &lt;Borland.ProjectType /&gt;
     &lt;BorlandProject&gt;
-&lt;BorlandProject&gt;&lt;Delphi.Personality&gt;&lt;Parameters&gt;&lt;Parameters Name=&quot;RunParams&quot;&gt;--Readini=testdata\testproject --exec=test.cmd --writerc=testdata\testproject&lt;/Parameters&gt;&lt;Parameters Name=&quot;UseLauncher&quot;&gt;False&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadAllSymbols&quot;&gt;True&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadUnspecifiedSymbols&quot;&gt;False&lt;/Parameters&gt;&lt;/Parameters&gt;&lt;VersionInfo&gt;&lt;VersionInfo Name=&quot;IncludeVerInfo&quot;&gt;True&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;AutoIncBuild&quot;&gt;True&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MajorVer&quot;&gt;1&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MinorVer&quot;&gt;1&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Release&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Build&quot;&gt;56&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Debug&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;PreRelease&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Special&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Private&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;DLL&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Locale&quot;&gt;1033&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;CodePage&quot;&gt;1252&lt;/VersionInfo&gt;&lt;/VersionInfo&gt;&lt;VersionInfoKeys&gt;&lt;Ve!
 rsionInfoKeys Name=&quot;FileVersion&quot;&gt;1.1.0.56&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;ProductVersion&quot;&gt;1.0.0.0&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;CompanyName&quot;&gt;dummzeuch.de&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;FileDescription&quot;&gt;increment build number and create rc file&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;InternalName&quot;&gt;IncBuildNo&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;LegalCopyright&quot;&gt;copyright 2005-2006 by Thomas Mueller&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;LegalTrademarks&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;OriginalFilename&quot;&gt;IncBuildNo.exe&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;ProductName&quot;&gt;IncBuildNo&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;Comments&quot;&gt;this is the comment&lt;/VersionInfoKeys&gt;&lt;/VersionInfoKeys&gt;&lt;Excluded_Packages&gt;
+&lt;BorlandProject&gt;&lt;Delphi.Personality&gt;&lt;Parameters&gt;&lt;Parameters Name=&quot;RunParams&quot;&gt;--Readini=testdata\testproject --exec=test.cmd --writerc=testdata\testproject&lt;/Parameters&gt;&lt;Parameters Name=&quot;UseLauncher&quot;&gt;False&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadAllSymbols&quot;&gt;True&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadUnspecifiedSymbols&quot;&gt;False&lt;/Parameters&gt;&lt;/Parameters&gt;&lt;VersionInfo&gt;&lt;VersionInfo Name=&quot;IncludeVerInfo&quot;&gt;True&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;AutoIncBuild&quot;&gt;True&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MajorVer&quot;&gt;1&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MinorVer&quot;&gt;1&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Release&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Build&quot;&gt;57&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Debug&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;PreRelease&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Special&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Private&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;DLL&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Locale&quot;&gt;1033&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;CodePage&quot;&gt;1252&lt;/VersionInfo&gt;&lt;/VersionInfo&gt;&lt;VersionInfoKeys&gt;&lt;Ve!
 rsionInfoKeys Name=&quot;FileVersion&quot;&gt;1.1.0.57&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;ProductVersion&quot;&gt;1.0.0.0&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;CompanyName&quot;&gt;dummzeuch.de&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;FileDescription&quot;&gt;increment build number and create rc file&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;InternalName&quot;&gt;IncBuildNo&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;LegalCopyright&quot;&gt;copyright 2005-2006 by Thomas Mueller&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;LegalTrademarks&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;OriginalFilename&quot;&gt;IncBuildNo.exe&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;ProductName&quot;&gt;IncBuildNo&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;Comments&quot;&gt;this is the comment&lt;/VersionInfoKeys&gt;&lt;/VersionInfoKeys&gt;&lt;Excluded_Packages&gt;
       
       
       
@@ -73,7 +73,6 @@
     &lt;DCCReference Include=&quot;u_CentralIniVersionInfo.pas&quot; /&gt;
     &lt;DCCReference Include=&quot;u_DofVersionInfo.pas&quot; /&gt;
     &lt;DCCReference Include=&quot;u_DummyVersionInfo.pas&quot; /&gt;
-    &lt;DCCReference Include=&quot;u_IncBuildNoMain.pas&quot; /&gt;
     &lt;DCCReference Include=&quot;u_IniVersionInfo.pas&quot; /&gt;
     &lt;DCCReference Include=&quot;u_PrepBuildMain.pas&quot; /&gt;
   &lt;/ItemGroup&gt;

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -95,6 +95,10 @@
 
 {$R *.dfm}
 
+uses
+  StrUtils,
+  u_dzTranslator;
+
 { Tdm_BdsProjVersionInfo }
 
 procedure Tdm_BdsProjVersionInfo.Assign(const _VersionInfo: IVersionInfo);
@@ -176,7 +180,7 @@
   FVersionInfoKeys := DelphiPersonality.childNodes['VersionInfoKeys'];
 
   if not SameText(GetChildNodeContent(FVersionInfo, 'VersionInfo', 'IncludeVerInfo'), 'True') then
-    raise ENoVersionInfo.Create('.bdsproj file does not contain version information');
+    raise ENoVersionInfo.Create(_('.bdsproj file does not contain version information'));
 end;
 
 destructor Tdm_BdsProjVersionInfo.Destroy;
@@ -267,10 +271,7 @@
 
 procedure Tdm_BdsProjVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
 begin
-  if _AutoIncBuild then
-    SetVersionInfo('AutoIncBuild', 'True')
-  else
-    SetVersionInfo('AutoIncBuild', 'False')
+  SetVersionInfo('AutoIncBuild', IfThen(_AutoIncBuild, 'True', 'False'));
 end;
 
 procedure Tdm_BdsProjVersionInfo.SetBuild(_Build: integer);

Modified: utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -38,6 +38,7 @@
 implementation
 
 uses
+  SysUtils,
   IniFiles,
   u_dzStringUtils;
 
@@ -55,7 +56,7 @@
 
 class function TCentralVersionInfo.FilenameFor(const _ProjectName: string): string;
 begin
-  Result := _ProjectName + '_Version.ini';
+  Result := ChangeFileExt(_ProjectName, '') + '_Version.ini';
 end;
 
 function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;

Modified: utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -28,6 +28,9 @@
 
 implementation
 
+uses
+  u_dzTranslator;
+
 const
   VERSION_INFO_SECTION = 'Version Info';
   VERSION_INFO_KEYS_SECTION = 'Version Info Keys';
@@ -39,7 +42,7 @@
   FProjectName := _ProjectName;
   inherited Create(VerInfoFilename, VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
   if FIniFile.ReadInteger(VERSION_INFO_SECTION, 'IncludeVerInfo', 0) &lt;&gt; 1 then
-    raise ENoVersionInfo.Create('.dof file does not contain version info');
+    raise ENoVersionInfo.Create(_('.dof file does not contain version info'));
 end;
 
 class function TDofVersionInfo.FilenameFor(const _ProjectName: string): string;

Deleted: utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -1,226 +0,0 @@
-unit u_IncBuildNoMain;
-
-interface
-
-procedure Main;
-
-implementation
-
-uses
-  SysUtils,
-  IniFiles,
-  oxmldom,
-  XMLIntf,
-  XmlDoc,
-  Classes,
-  ActiveX,
-  i_VersionInfo,
-  u_DofVersionInfo,
-  d_BdsProjVersionInfo,
-  u_CentralIniVersionInfo;
-
-type
-  EHalt = class(EAbort)
-  public
-    ResultCode: integer;
-    constructor Create(_ResultCode: integer);
-  end;
-
-{ EHalt }
-
-constructor EHalt.Create(_ResultCode: integer);
-begin
-  inherited CreateFmt('Halt with result code %d', [_ResultCode]);
-  ResultCode := _ResultCode;
-end;
-
-procedure WriteRcFile(const _Project: string; _VersionInfo: IVersionInfo);
-var
-  t: TextFile;
-begin
-  Assignfile(t, _Project + '.rc');
-  Rewrite(t);
-
-  WriteLn(t, {    } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
-  WriteLn(t);
-  WriteLn(t, {    } '1 VERSIONINFO LOADONCALL MOVEABLE DISCARDABLE IMPURE');
-  WriteLn(t, Format('FILEVERSION %d, %d, %d, %d', [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, Format('PRODUCTVERSION %d, %d, %d, %d',
-    [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, {    } 'FILEFLAGSMASK VS_FFI_FILEFLAGSMASK');
-  WriteLn(t, {    } 'FILEOS VOS__WINDOWS32');
-  WriteLn(t, {    } 'FILETYPE VFT_APP');
-  WriteLn(t, {    } '{');
-  WriteLn(t, {    } ' BLOCK &quot;StringFileInfo&quot;');
-  WriteLn(t, {    } ' {');
-  WriteLn(t, {    } '  BLOCK &quot;040904E4&quot;');
-  WriteLn(t, {    } '  {');
-  WriteLn(t, Format('   VALUE &quot;CompanyName&quot;, &quot;%s\000&quot;', [_VersionInfo.CompanyName]));
-  WriteLn(t, Format('   VALUE &quot;FileDescription&quot;, &quot;%s\000&quot;', [_VersionInfo.FileDescription]));
-  WriteLn(t, Format('   VALUE &quot;FileVersion&quot;, &quot;%s\000&quot;', [_VersionInfo.FileVersion]));
-  WriteLn(t, Format('   VALUE &quot;InternalName&quot;, &quot;%s\000&quot;', [_VersionInfo.InternalName]));
-  WriteLn(t, Format('   VALUE &quot;LegalCopyright&quot;, &quot;%s\000&quot;', [_VersionInfo.LegalCopyright]));
-  WriteLn(t, Format('   VALUE &quot;LegalTrademarks&quot;, &quot;%s\000&quot;', [_VersionInfo.LegalTrademarks]));
-  WriteLn(t, Format('   VALUE &quot;OriginalFilename&quot;, &quot;%s\000&quot;', [_VersionInfo.OriginalFilename]));
-  WriteLn(t, Format('   VALUE &quot;ProductName&quot;, &quot;%s\000&quot;', [_VersionInfo.ProductName]));
-  WriteLn(t, Format('   VALUE &quot;ProductVersion&quot;, &quot;%s\000&quot;', [_VersionInfo.ProductVersion]));
-  WriteLn(t, Format('   VALUE &quot;Comments&quot;, &quot;%s\000&quot;', [_VersionInfo.Comments]));
-  WriteLn(t, {    } '  }');
-  WriteLn(t, {    } ' }');
-  WriteLn(t, {    } ' BLOCK &quot;VarFileInfo&quot;');
-  WriteLn(t, {    } ' {');
-  WriteLn(t, {    } '  VALUE &quot;Translation&quot;, 1033, 1252');
-  WriteLn(t, {    } ' }');
-  WriteLn(t, {    } '}');
-  if FileExists(_Project + '.ico') then begin
-    WriteLn(t);
-    WriteLn(t, {  } 'MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico');
-  end;
-  Close(t);
-end;
-
-procedure Usage;
-begin
-  WriteLn;
-  WriteLn('Usage: dzPrepBuild &lt;projectname&gt;');
-  WriteLn;
-  WriteLn('This Program tries to read version information from &lt;projectname&gt;.bdsproj');
-  WriteLn('and if that fails from &lt;projectname&gt;.dof');
-  WriteLn;
-  WriteLn('If AutoIncBuild = true, it will increment the build number and write it back.');
-  WriteLn('The information is then written to &lt;projectname&gt;.rc to be compiled with');
-  WriteLn('the brcc32 tool.');
-  WriteLn;
-  WriteLn('If &lt;projectname&gt;.ico exists, this file will be included as an icon resource.');
-  WriteLn;
-  WriteLn('If both, a .bdsproj and a .dof file exist, the .dof file will be updated');
-  WriteLn('with the information from the .bdsproj file.');
-  WriteLn;
-  WriteLn('Example:');
-  WriteLn('c:\myproject&gt; dzPrepBuild MyProject');
-  WriteLn('c:\myproject&gt; brcc32 MyProject.rc');
-  raise EHalt.Create(1);
-end;
-
-procedure Main;
-var
-  Projectname: string;
-  ResultCode: integer;
-  CentralVerInfo: IVersionInfo;
-  BdsVerInfo: IVersionInfo;
-  DelphiVerInfo: IVersionInfo;
-  OtherVerinfo: IVersionInfo;
-  VersionInfo: IVersionInfo;
-  AdditionalVersionInfos: TInterfaceList;
-  BuildNo: integer;
-  i: integer;
-begin
-  Resultcode := 0;
-  try
-    try
-      WriteLn('dzPrepBuild (c) 2007 by Thomas Mueller (www.dummzeuch.de)');
-      WriteLn('(previously called IncBuildNo)');
-      if ParamCount &lt;&gt; 1 then
-        Usage;
-      CoInitializeEx(nil, COINIT_APARTMENTTHREADED);
-      Projectname := ParamStr(1);
-
-      AdditionalVersionInfos := TInterfaceList.Create;
-      try
-        try
-          Write('Reading ', TCentralVersionInfo.FilenameFor(Projectname), ' ');
-          CentralVerInfo := TCentralVersionInfo.Create(Projectname);
-          WriteLn('OK');
-        except
-          WriteLn('FAIL');
-          CentralVerInfo := nil;
-        end;
-        try
-          Write('Reading ', Tdm_BdsProjVersionInfo.FilenameFor(Projectname), ' ');
-          BdsVerInfo := Tdm_BdsProjVersionInfo.Create(Projectname);
-          WriteLn('OK');
-        except
-          WriteLn('FAIL');
-          BdsVerInfo := nil;
-        end;
-
-        try
-          Write('Reading ', TDofVersionInfo.FilenameFor(Projectname), ' ');
-          DelphiVerInfo := TDofVersionInfo.Create(Projectname);
-          WriteLn('OK');
-        except
-          WriteLn('FAIL');
-          DelphiVerInfo := nil;
-        end;
-
-        if Assigned(CentralVerInfo) then begin
-          VersionInfo := CentralVerInfo;
-          if Assigned(BdsVerInfo) then
-            AdditionalVersionInfos.Add(BdsVerInfo);
-          if Assigned(DelphiVerInfo) then
-            AdditionalVersionInfos.Add(DelphiVerInfo);
-        end else if Assigned(BdsVerInfo) then begin
-          VersionInfo := BdsVerInfo;
-          if Assigned(DelphiVerInfo) then
-            AdditionalVersionInfos.Add(DelphiVerInfo);
-        end else if Assigned(DelphiVerInfo) then
-          VersionInfo := DelphiVerInfo
-        else begin
-          WriteLn('Error: Could not read either of the version info files.');
-          raise EHalt.Create(1);
-        end;
-
-        BuildNo := VersionInfo.Build;
-        WriteLn('BuildNo from ', VersionInfo.VerInfoFilename, ' is ', BuildNo);
-        for i := 0 to AdditionalVersionInfos.Count - 1 do begin
-          OtherVerinfo := AdditionalVersionInfos[i] as IVersionInfo;
-          if OtherVerinfo.Build &gt; BuildNo then begin
-            BuildNo := OtherVerinfo.Build;
-            Writeln('BuildNo from ', OtherVerinfo.VerInfoFilename, ' is higher, using ', BuildNo);
-          end;
-        end;
-
-        if VersionInfo.AutoIncBuild then begin
-          Write('Incrementing build number ');
-          VersionInfo.Build := BuildNo + 1;
-          VersionInfo.UpdateFile;
-          WriteLn('OK');
-          WriteLn('New version number is ', VersionInfo.MajorVer, '.', VersionInfo.MinorVer,
-            '.', VersionInfo.Release, ' build ', VersionInfo.Build);
-        end;
-
-        Write('Writing ', Projectname, '.rc file ');
-        WriteRcFile(Projectname, VersionInfo);
-        WriteLn('OK');
-
-        for i := 0 to AdditionalVersionInfos.Count - 1 do begin
-          OtherVerinfo := AdditionalVersionInfos[i] as IVersionInfo;
-          Write('Updating ', OtherVerinfo.VerInfoFilename, ' ');
-          OtherVerinfo.Assign(VersionInfo);
-          OtherVerinfo.UpdateFile;
-          WriteLn('OK');
-        end;
-      finally
-        AdditionalVersionInfos.Free;
-      end;
-    except
-      on e: EHalt do
-        ResultCode := e.ResultCode;
-      on e: Exception do begin
-        ResultCode := 1;
-        WriteLn(e.ClassName, ': ', e.Message);
-      end;
-    end;
-  finally
-{$IFOPT D+}
-    WriteLn;
-    WriteLn('press &lt;enter&gt;');
-    readln;
-{$ENDIF}
-  end;
-  if ResultCode &lt;&gt; 0 then
-    Halt(ResultCode);
-end;
-
-end.
-

Modified: utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -45,6 +45,9 @@
 
 implementation
 
+uses
+  u_dzTranslator;
+
 { TIniVersionInfo }
 
 constructor TIniVersionInfo.Create(const _FullFilename: string; const _InfoSection: string;
@@ -52,7 +55,7 @@
 begin
   inherited Create;
   if not FileExists(_FullFilename) then
-    raise ENoVersionInfo.CreateFmt('File %s does not exist.', [_FullFilename]);
+    raise ENoVersionInfo.CreateFmt(_('File %s does not exist.'), [_FullFilename]);
   FInfoSection := _InfoSection;
   FInfoKeysSection := _InfoKeysSection;
   FIniFile := TMemIniFile.Create(_FullFilename);

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -25,6 +25,7 @@
 implementation
 
 uses
+  u_dzTranslator,
   u_dzExecutor,
   u_dzShellApiUtils,
   u_DofVersionInfo,
@@ -164,13 +165,13 @@
 
   if FGetOpt.OptionPassed('ReadBdsProj', Project) then begin
     if Assigned(ParamVersionInfo) then
-      raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
+      raise Exception.Create(_('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni'));
     ParamVersionInfo := Tdm_BdsProjVersionInfo.Create(Project);
   end;
 
   if FGetOpt.OptionPassed('ReadIni', Project) then begin
     if Assigned(ParamVersionInfo) then
-      raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
+      raise Exception.Create(_('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni'));
     ParamVersionInfo := TCentralVersionInfo.Create(Project);
   end;
 
@@ -182,25 +183,25 @@
 
   if FGetOpt.OptionPassed('MajorVer', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to MajorVer must be a number');
+      raise Exception.Create(_('Parameter to MajorVer must be a number'));
     VersionInfo.MajorVer := IntValue;
   end;
 
   if FGetOpt.OptionPassed('MinorVer', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to MinorVer must be a number');
+      raise Exception.Create(_('Parameter to MinorVer must be a number'));
     VersionInfo.MinorVer := IntValue;
   end;
 
   if FGetOpt.OptionPassed('Release', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to Release must be a number');
+      raise Exception.Create(_('Parameter to Release must be a number'));
     VersionInfo.Release := IntValue;
   end;
 
   if FGetOpt.OptionPassed('Build', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to MinorVer must be a number');
+      raise Exception.Create(_('Parameter to MinorVer must be a number'));
     VersionInfo.MinorVer := IntValue;
   end;
 
@@ -267,29 +268,29 @@
 procedure TPrepBuildMain.InitCmdLineParser;
 begin
   inherited;
-  FGetOpt.RegisterOption('ReadDof', 'read a .dof file to get the version information', true);
-  FGetOpt.RegisterOption('ReadBdsproj', 'read a .bdsproj file to get the version information', true);
-  FGetOpt.RegisterOption('ReadIni', 'read a .ini file to get the version information', true);
-  FGetOpt.RegisterOption('Exec', 'execute the given program or script with extended environment', true);
-  FGetOpt.RegisterOption('UpdateDof', 'update a .dof file with the version information', true);
-  FGetOpt.RegisterOption('UpdateBdsproj', 'update a .bdsproj file with the version information', true);
-  FGetOpt.RegisterOption('UpdateIni', 'update a .ini file with the version information', true);
-  FGetOpt.RegisterOption('WriteRc', 'write version info to a .rc file', true);
-  FGetOpt.RegisterOption('Icon', 'Assign an icon file to add to the .rc file', true);
-  FGetOpt.RegisterOption('IncBuild', 'increment the build number', false);
-  FGetOpt.RegisterOption('MajorVer', 'set the major version number', true);
-  FGetOpt.RegisterOption('MinorVer', 'set the minor version number', true);
-  FGetOpt.RegisterOption('Release', 'set the release number', true);
-  FGetOpt.RegisterOption('Build', 'set the build number', true);
-  FGetOpt.RegisterOption('FileDesc', 'set the file description', true);
-  FGetOpt.RegisterOption('InternalName', 'set the internal name', true);
-  FGetOpt.RegisterOption('OriginalName', 'set the original file name', true);
-  FGetOpt.RegisterOption('Product', 'set the product name', true);
-  FGetOpt.RegisterOption('ProductVersion', 'set the product version', true);
-  FGetOpt.RegisterOption('Company', 'set the company name', true);
-  FGetOpt.RegisterOption('Copyright', 'set the legal copyright', true);
-  FGetOpt.RegisterOption('Trademark', 'set the legal trademark', true);
-  FGetOpt.RegisterOption('Comments', 'set the comments', true);
+  FGetOpt.RegisterOption('ReadDof', _('read a .dof file to get the version information'), true);
+  FGetOpt.RegisterOption('ReadBdsproj', _('read a .bdsproj file to get the version information'), true);
+  FGetOpt.RegisterOption('ReadIni', _('read a .ini file to get the version information'), true);
+  FGetOpt.RegisterOption('Exec', _('execute the given program or script with extended environment'), true);
+  FGetOpt.RegisterOption('UpdateDof', _('update a .dof file with the version information'), true);
+  FGetOpt.RegisterOption('UpdateBdsproj', _('update a .bdsproj file with the version information'), true);
+  FGetOpt.RegisterOption('UpdateIni', _('update a .ini file with the version information'), true);
+  FGetOpt.RegisterOption('WriteRc', _('write version info to a .rc file'), true);
+  FGetOpt.RegisterOption('Icon', _('Assign an icon file to add to the .rc file'), true);
+  FGetOpt.RegisterOption('IncBuild', _('increment the build number'), false);
+  FGetOpt.RegisterOption('MajorVer', _('set the major version number'), true);
+  FGetOpt.RegisterOption('MinorVer', _('set the minor version number'), true);
+  FGetOpt.RegisterOption('Release', _('set the release number'), true);
+  FGetOpt.RegisterOption('Build', _('set the build number'), true);
+  FGetOpt.RegisterOption('FileDesc', _('set the file description'), true);
+  FGetOpt.RegisterOption('InternalName', _('set the internal name'), true);
+  FGetOpt.RegisterOption('OriginalName', _('set the original file name'), true);
+  FGetOpt.RegisterOption('Product', _('set the product name'), true);
+  FGetOpt.RegisterOption('ProductVersion', _('set the product version'), true);
+  FGetOpt.RegisterOption('Company', _('set the company name'), true);
+  FGetOpt.RegisterOption('Copyright', _('set the legal copyright'), true);
+  FGetOpt.RegisterOption('Trademark', _('set the legal trademark'), true);
+  FGetOpt.RegisterOption('Comments', _('set the comments'), true);
 end;
 
 initialization


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000059.html">[Dzchart-svncheckins] r185 - utilities/dzLib/trunk/src
</A></li>
	<LI>Next message: <A HREF="000061.html">[Dzchart-svncheckins] r187 - utilities/dzPrepBuild/trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60">[ date ]</a>
              <a href="thread.html#60">[ thread ]</a>
              <a href="subject.html#60">[ subject ]</a>
              <a href="author.html#60">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dzchart-svncheckins">More information about the dzchart-svncheckins
mailing list</a><br>
</body></html>
