From twm at mail.berlios.de  Tue Jul 10 23:20:12 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Tue, 10 Jul 2007 23:20:12 +0200
Subject: [Dzchart-svncheckins] r155 - utilities/dzPrepBuild/trunk
Message-ID: <200707102120.l6ALKCRO025799@sheep.berlios.de>

Author: twm
Date: 2007-07-10 23:20:06 +0200 (Tue, 10 Jul 2007)
New Revision: 155

Added:
   utilities/dzPrepBuild/trunk/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas
Modified:
   utilities/dzPrepBuild/trunk/
   utilities/dzPrepBuild/trunk/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas
Log:
moved most of the .dof code to a more generic TIniVersionInfo class which will be the starting point for a centralized version management option


Property changes on: utilities/dzPrepBuild/trunk
___________________________________________________________________
Name: svn:ignore
   - __history
dcu
IncBuildNo.cfg
IncBuildNo.exe
IncBuildNo.res
PrepBuild.exe

   + __history
dcu
IncBuildNo.cfg
IncBuildNo.exe
IncBuildNo.res
PrepBuild.exe
PrepBuild.res
PrepBuild.dsk
testproject.rc


Modified: utilities/dzPrepBuild/trunk/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dpr	2007-06-03 14:04:17 UTC (rev 154)
+++ utilities/dzPrepBuild/trunk/PrepBuild.dpr	2007-07-10 21:20:06 UTC (rev 155)
@@ -8,7 +8,8 @@
   u_IncBuildNoMain in 'u_IncBuildNoMain.pas',
   d_BdsProjVersionInfo in 'd_BdsProjVersionInfo.pas' {dm_BdsProjVersionInfo: TDataModule},
   i_VersionInfo in 'i_VersionInfo.pas',
-  u_DofVersionInfo in 'u_DofVersionInfo.pas';
+  u_DofVersionInfo in 'u_DofVersionInfo.pas',
+  u_IniVersionInfo in 'u_IniVersionInfo.pas';
 
 {$R *.res}
 

Added: utilities/dzPrepBuild/trunk/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-06-03 14:04:17 UTC (rev 154)
+++ utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-07-10 21:20:06 UTC (rev 155)
@@ -0,0 +1,144 @@
+?<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+  <PropertyGroup>
+    <ProjectGuid>{209412ac-0ec2-4f63-b92a-e78853ff142a}</ProjectGuid>
+    <MainSource>PrepBuild.dpr</MainSource>
+    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
+    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
+    <DCC_DCCCompiler>DCC32</DCC_DCCCompiler>
+    <DCC_DependencyCheckOutputName>PrepBuild.exe</DCC_DependencyCheckOutputName>
+  </PropertyGroup>
+  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
+    <Version>7.0</Version>
+    <DCC_DebugInformation>False</DCC_DebugInformation>
+    <DCC_LocalDebugSymbols>False</DCC_LocalDebugSymbols>
+    <DCC_SymbolReferenceInfo>0</DCC_SymbolReferenceInfo>
+    <DCC_DcuOutput>dcu</DCC_DcuOutput>
+    <DCC_ObjOutput>dcu</DCC_ObjOutput>
+    <DCC_HppOutput>dcu</DCC_HppOutput>
+    <DCC_Define>RELEASE</DCC_Define>
+  </PropertyGroup>
+  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
+    <Version>7.0</Version>
+    <DCC_DcuOutput>dcu</DCC_DcuOutput>
+    <DCC_ObjOutput>dcu</DCC_ObjOutput>
+    <DCC_HppOutput>dcu</DCC_HppOutput>
+    <DCC_Define>DEBUG</DCC_Define>
+  </PropertyGroup>
+  <ProjectExtensions>
+    <Borland.Personality>Delphi.Personality</Borland.Personality>
+    <Borland.ProjectType />
+    <BorlandProject>
+<BorlandProject xmlns=""> <Delphi.Personality>   <Parameters>
+      <Parameters Name="RunParams">testproject</Parameters>
+      <Parameters Name="UseLauncher">False</Parameters>
+      <Parameters Name="LoadAllSymbols">True</Parameters>
+      <Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
+    </Parameters>
+    <VersionInfo>
+      <VersionInfo Name="IncludeVerInfo">True</VersionInfo>
+      <VersionInfo Name="AutoIncBuild">True</VersionInfo>
+      <VersionInfo Name="MajorVer">1</VersionInfo>
+      <VersionInfo Name="MinorVer">1</VersionInfo>
+      <VersionInfo Name="Release">0</VersionInfo>
+      <VersionInfo Name="Build">52</VersionInfo>
+      <VersionInfo Name="Debug">False</VersionInfo>
+      <VersionInfo Name="PreRelease">False</VersionInfo>
+      <VersionInfo Name="Special">False</VersionInfo>
+      <VersionInfo Name="Private">False</VersionInfo>
+      <VersionInfo Name="DLL">False</VersionInfo>
+      <VersionInfo Name="Locale">1033</VersionInfo>
+      <VersionInfo Name="CodePage">1252</VersionInfo>
+    </VersionInfo>
+    <VersionInfoKeys>
+      <VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKeys>
+      <VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
+      <VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys>
+      <VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys>
+      <VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys>
+      <VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys>
+      <VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
+      <VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys>
+      <VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys>
+      <VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys>
+    </VersionInfoKeys>
+    <Excluded_Packages>
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
+      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
+      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclIntraweb_80_100.bpl">Intraweb 8.0 Design Package for Borland Development Studio 2006</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclsoap100.bpl">Borland SOAP Components</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\bcbie100.bpl">Borland C++Builder Internet Explorer 5 Components Package</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcltee100.bpl">TeeChart Components</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcldbxcds100.bpl">Borland SimpleDataset Component (DBX)</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclie100.bpl">Internet Explorer Components</Excluded_Packages>
+    </Excluded_Packages>
+    <Source>
+      <Source Name="MainSource">PrepBuild.dpr</Source>
+    </Source>
+  </Delphi.Personality> </BorlandProject></BorlandProject>
+  </ProjectExtensions>
+  <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
+  <ItemGroup>
+    <DelphiCompile Include="PrepBuild.dpr">
+      <MainSource>MainSource</MainSource>
+    </DelphiCompile>
+    <DCCReference Include="d_BdsProjVersionInfo.pas">
+      <Form>dm_BdsProjVersionInfo</Form>
+    </DCCReference>
+    <DCCReference Include="i_VersionInfo.pas" />
+    <DCCReference Include="u_DofVersionInfo.pas" />
+    <DCCReference Include="u_IncBuildNoMain.pas" />
+    <DCCReference Include="u_IniVersionInfo.pas" />
+  </ItemGroup>
+</Project>
\ No newline at end of file

Modified: utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas	2007-06-03 14:04:17 UTC (rev 154)
+++ utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas	2007-07-10 21:20:06 UTC (rev 155)
@@ -5,68 +5,16 @@
 uses
   SysUtils,
   IniFiles,
-  i_VersionInfo;
+  i_VersionInfo,
+  u_IniVersionInfo;
 
 type
   {: Tries to read a <projectname>.dof file, succeeds, if it exists and IncludeVerInfo is <> 0
      @param Project is the project name (*.dpr file without extension)
      @param VersionInfo is a TVersionInfoRec record which will be filled with the version info }
-  TDofVersionInfo = class(TInterfacedObject, IVersionInfo)
-  protected
-    FDofFile: TMemIniFile;
-  protected // implementation of IVersionInfo
-    function GetBuild: integer;
-    procedure SetBuild(_Build: integer);
-    function GetMajorVer: integer;
-    procedure SetMajorVer(_MajorVer: integer);
-    function GetMinorVer: integer;
-    procedure SetMinorVer(_MinorVer: integer);
-    function GetRelease: integer;
-    procedure SetRelease(_Release: integer);
-    function GetCompanyName: string;
-    procedure SetCompanyName(_CompanyName: string);
-    function GetFileDescription: string;
-    procedure SetFileDescription(_FileDescription: string);
-    function GetFileVersion: string;
-    procedure SetFileVersion(_FileVersion: string);
-    function GetInternalName: string;
-    procedure SetInternalName(_InternalName: string);
-    function GetLegalCopyright: string;
-    procedure SetLegalCopyright(_LegalCopyright: string);
-    function GetLegalTrademarks: string;
-    procedure SetLegalTrademarks(_LegalTrademarks: string);
-    function GetOriginalFilename: string;
-    procedure SetOriginalFilename(_OriginalFilename: string);
-    function GetProductName: string;
-    procedure SetProductName(_ProductName: string);
-    function GetProductVersion: string;
-    procedure SetProductVersion(_ProductVersion: string);
-    function GetAutoIncBuild: boolean;
-    procedure SetAutoIncBuild(_AutoIncBuild: boolean);
-    function GetComments: string;
-    procedure SetComments(const _Comments: string);
-  //
-    procedure Assign(const _VersionInfo: IVersionInfo);
-    procedure UpdateFile;
-  //
-    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
-    property Build: integer read GetBuild write SetBuild;
-    property Comments: string read GetComments write SetComments;
-    property CompanyName: string read GetCompanyName write SetCompanyName;
-    property FileDescription: string read GetFileDescription write SetFileDescription;
-    property FileVersion: string read GetFileVersion write SetFileVersion;
-    property InternalName: string read GetInternalName write SetInternalName;
-    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
-    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
-    property MajorVer: integer read GetMajorVer write SetMajorVer;
-    property MinorVer: integer read GetMinorVer write SetMinorVer;
-    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
-    property ProductName: string read GetProductName write SetProductName;
-    property ProductVersion: string read GetProductVersion write SetProductVersion;
-    property Release: integer read GetRelease write SetRelease;
+  TDofVersionInfo = class(TIniVersionInfo, IVersionInfo)
   public
-    constructor Create(const _Project: string);
-    destructor Destroy; override;
+    constructor Create(const _ProjectName: string);
   end;
 
 implementation
@@ -77,193 +25,12 @@
 
 { TDofVersionInfo }
 
-procedure TDofVersionInfo.Assign(const _VersionInfo: IVersionInfo);
+constructor TDofVersionInfo.Create(const _ProjectName: string);
 begin
-  AutoIncBuild := _VersionInfo.AutoIncBuild;
-  Build := _VersionInfo.Build;
-  Comments := _VersionInfo.Comments;
-  CompanyName := _VersionInfo.CompanyName;
-  FileDescription := _VersionInfo.FileDescription;
-  FileVersion := _VersionInfo.FileVersion;
-  InternalName := _VersionInfo.InternalName;
-  LegalCopyright := _VersionInfo.LegalCopyright;
-  LegalTrademarks := _VersionInfo.LegalTrademarks;
-  MajorVer := _VersionInfo.MajorVer;
-  MinorVer := _VersionInfo.MinorVer;
-  OriginalFilename := _VersionInfo.OriginalFilename;
-  ProductName := _VersionInfo.ProductName;
-  ProductVersion := _VersionInfo.ProductVersion;
-  Release := _VersionInfo.Release;
-end;
-
-constructor TDofVersionInfo.Create(const _Project: string);
-begin
-  inherited Create;
-  FDofFile := TMemIniFile.Create(_Project + '.dof');
-  if FDofFile.ReadInteger(VERSION_INFO_SECTION, 'IncludeVerInfo', 0) <> 1 then
+  inherited Create(_ProjectName + '.dof', VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
+  if FIniFile.ReadInteger(VERSION_INFO_SECTION, 'IncludeVerInfo', 0) <> 1 then
     raise ENoVersionInfo.Create('.dof file does not contain version info');
 end;
 
-destructor TDofVersionInfo.Destroy;
-begin
-  FDofFile.Free;
-  inherited;
-end;
-
-function TDofVersionInfo.GetAutoIncBuild: boolean;
-begin
-  Result := FDofFile.ReadInteger(VERSION_INFO_SECTION, 'AutoIncBuild', 0) <> 0;
-end;
-
-function TDofVersionInfo.GetBuild: integer;
-begin
-  Result := FDofFile.ReadInteger(VERSION_INFO_SECTION, 'Build', 0);
-end;
-
-function TDofVersionInfo.GetComments: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'Comments', '');
-end;
-
-function TDofVersionInfo.GetCompanyName: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'CompanyName', '');
-end;
-
-function TDofVersionInfo.GetFileDescription: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'FileDescription', '');
-end;
-
-function TDofVersionInfo.GetFileVersion: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'FileVersion', '');
-end;
-
-function TDofVersionInfo.GetInternalName: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'InternalName', '');
-end;
-
-function TDofVersionInfo.GetLegalCopyright: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'LegalCopyright', '');
-end;
-
-function TDofVersionInfo.GetLegalTrademarks: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'LegalTrademarks', '');
-end;
-
-function TDofVersionInfo.GetMajorVer: integer;
-begin
-  Result := FDofFile.ReadInteger(VERSION_INFO_SECTION, 'MajorVer', 0);
-end;
-
-function TDofVersionInfo.GetMinorVer: integer;
-begin
-  Result := FDofFile.ReadInteger(VERSION_INFO_SECTION, 'MinorVer', 0);
-end;
-
-function TDofVersionInfo.GetOriginalFilename: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'OriginalFilename', '');
-end;
-
-function TDofVersionInfo.GetProductName: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'ProductName', '');
-end;
-
-function TDofVersionInfo.GetProductVersion: string;
-begin
-  Result := FDofFile.ReadString(VERSION_INFO_KEYS_SECTION, 'ProductVersion', '');
-end;
-
-function TDofVersionInfo.GetRelease: integer;
-begin
-  Result := FDofFile.ReadInteger(VERSION_INFO_SECTION, 'Release', 0);
-end;
-
-procedure TDofVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
-begin
-  FDofFile.WriteBool(VERSION_INFO_SECTION, 'AutoIncBuild', _AutoIncBuild);
-end;
-
-procedure TDofVersionInfo.SetBuild(_Build: integer);
-begin
-  FDofFile.WriteInteger(VERSION_INFO_SECTION, 'Build', _Build);
-end;
-
-procedure TDofVersionInfo.SetComments(const _Comments: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'Comments', _Comments);
-end;
-
-procedure TDofVersionInfo.SetCompanyName(_CompanyName: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'CompanyName', _CompanyName);
-end;
-
-procedure TDofVersionInfo.SetFileDescription(_FileDescription: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'FileDescription', _FileDescription);
-end;
-
-procedure TDofVersionInfo.SetFileVersion(_FileVersion: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'FileVersion', _FileVersion);
-end;
-
-procedure TDofVersionInfo.SetInternalName(_InternalName: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'InternalName', _InternalName);
-end;
-
-procedure TDofVersionInfo.SetLegalCopyright(_LegalCopyright: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'LegalCopyright', _LegalCopyright);
-end;
-
-procedure TDofVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'LegalTrademarks', _LegalTrademarks);
-end;
-
-procedure TDofVersionInfo.SetMajorVer(_MajorVer: integer);
-begin
-  FDofFile.WriteInteger(VERSION_INFO_SECTION, 'MajorVer', _MajorVer);
-end;
-
-procedure TDofVersionInfo.SetMinorVer(_MinorVer: integer);
-begin
-  FDofFile.WriteInteger(VERSION_INFO_SECTION, 'MinorVer', _MinorVer);
-end;
-
-procedure TDofVersionInfo.SetOriginalFilename(_OriginalFilename: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'OriginalFilename', _OriginalFilename);
-end;
-
-procedure TDofVersionInfo.SetProductName(_ProductName: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'ProductName', _ProductName);
-end;
-
-procedure TDofVersionInfo.SetProductVersion(_ProductVersion: string);
-begin
-  FDofFile.WriteString(VERSION_INFO_KEYS_SECTION, 'ProductVersion', _ProductVersion);
-end;
-
-procedure TDofVersionInfo.SetRelease(_Release: integer);
-begin
-  FDofFile.WriteInteger(VERSION_INFO_SECTION, 'Release', _Release);
-end;
-
-procedure TDofVersionInfo.UpdateFile;
-begin
-  FDofFile.UpdateFile;
-end;
-
 end.
 

Added: utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas	2007-06-03 14:04:17 UTC (rev 154)
+++ utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas	2007-07-10 21:20:06 UTC (rev 155)
@@ -0,0 +1,269 @@
+unit u_IniVersionInfo;
+
+interface
+
+uses
+  SysUtils,
+  IniFiles,
+  i_VersionInfo;
+
+type
+  {: Tries to read a <projectname>.ini file, succeeds, if it exists
+     @param Project is the project name (*.dpr file without extension)
+     @param VersionInfo is a TVersionInfoRec record which will be filled with the version info }
+  TIniVersionInfo = class(TInterfacedObject, IVersionInfo)
+  protected
+    FIniFile: TMemIniFile;
+    FInfoSection: string;
+    FInfoKeysSection: string;
+  protected // implementation of IVersionInfo
+    function GetBuild: integer;
+    procedure SetBuild(_Build: integer);
+    function GetMajorVer: integer;
+    procedure SetMajorVer(_MajorVer: integer);
+    function GetMinorVer: integer;
+    procedure SetMinorVer(_MinorVer: integer);
+    function GetRelease: integer;
+    procedure SetRelease(_Release: integer);
+    function GetCompanyName: string;
+    procedure SetCompanyName(_CompanyName: string);
+    function GetFileDescription: string;
+    procedure SetFileDescription(_FileDescription: string);
+    function GetFileVersion: string;
+    procedure SetFileVersion(_FileVersion: string);
+    function GetInternalName: string;
+    procedure SetInternalName(_InternalName: string);
+    function GetLegalCopyright: string;
+    procedure SetLegalCopyright(_LegalCopyright: string);
+    function GetLegalTrademarks: string;
+    procedure SetLegalTrademarks(_LegalTrademarks: string);
+    function GetOriginalFilename: string;
+    procedure SetOriginalFilename(_OriginalFilename: string);
+    function GetProductName: string;
+    procedure SetProductName(_ProductName: string);
+    function GetProductVersion: string;
+    procedure SetProductVersion(_ProductVersion: string);
+    function GetAutoIncBuild: boolean;
+    procedure SetAutoIncBuild(_AutoIncBuild: boolean);
+    function GetComments: string;
+    procedure SetComments(const _Comments: string);
+  //
+    procedure Assign(const _VersionInfo: IVersionInfo);
+    procedure UpdateFile;
+  //
+    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
+    property Build: integer read GetBuild write SetBuild;
+    property Comments: string read GetComments write SetComments;
+    property CompanyName: string read GetCompanyName write SetCompanyName;
+    property FileDescription: string read GetFileDescription write SetFileDescription;
+    property FileVersion: string read GetFileVersion write SetFileVersion;
+    property InternalName: string read GetInternalName write SetInternalName;
+    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
+    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
+    property MajorVer: integer read GetMajorVer write SetMajorVer;
+    property MinorVer: integer read GetMinorVer write SetMinorVer;
+    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
+    property ProductName: string read GetProductName write SetProductName;
+    property ProductVersion: string read GetProductVersion write SetProductVersion;
+    property Release: integer read GetRelease write SetRelease;
+  public
+    constructor Create(const _FullFilename: string; const _InfoSection: string;
+      const _InfoKeysSection: string);
+    destructor Destroy; override;
+  end;
+
+implementation
+
+{ TIniVersionInfo }
+
+constructor TIniVersionInfo.Create(const _FullFilename: string; const _InfoSection: string;
+  const _InfoKeysSection: string);
+begin
+  inherited Create;
+  FInfoSection := _InfoSection;
+  FInfoKeysSection := _InfoKeysSection;
+  FIniFile := TMemIniFile.Create(_FullFilename);
+end;
+
+destructor TIniVersionInfo.Destroy;
+begin
+  FIniFile.Free;
+  inherited;
+end;
+
+procedure TIniVersionInfo.Assign(const _VersionInfo: IVersionInfo);
+begin
+  AutoIncBuild := _VersionInfo.AutoIncBuild;
+  Build := _VersionInfo.Build;
+  Comments := _VersionInfo.Comments;
+  CompanyName := _VersionInfo.CompanyName;
+  FileDescription := _VersionInfo.FileDescription;
+  FileVersion := _VersionInfo.FileVersion;
+  InternalName := _VersionInfo.InternalName;
+  LegalCopyright := _VersionInfo.LegalCopyright;
+  LegalTrademarks := _VersionInfo.LegalTrademarks;
+  MajorVer := _VersionInfo.MajorVer;
+  MinorVer := _VersionInfo.MinorVer;
+  OriginalFilename := _VersionInfo.OriginalFilename;
+  ProductName := _VersionInfo.ProductName;
+  ProductVersion := _VersionInfo.ProductVersion;
+  Release := _VersionInfo.Release;
+end;
+
+function TIniVersionInfo.GetAutoIncBuild: boolean;
+begin
+  Result := FIniFile.ReadInteger(FInfoSection, 'AutoIncBuild', 0) <> 0;
+end;
+
+function TIniVersionInfo.GetBuild: integer;
+begin
+  Result := FIniFile.ReadInteger(FInfoSection, 'Build', 0);
+end;
+
+function TIniVersionInfo.GetComments: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'Comments', '');
+end;
+
+function TIniVersionInfo.GetCompanyName: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'CompanyName', '');
+end;
+
+function TIniVersionInfo.GetFileDescription: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'FileDescription', '');
+end;
+
+function TIniVersionInfo.GetFileVersion: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'FileVersion', '');
+end;
+
+function TIniVersionInfo.GetInternalName: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'InternalName', '');
+end;
+
+function TIniVersionInfo.GetLegalCopyright: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'LegalCopyright', '');
+end;
+
+function TIniVersionInfo.GetLegalTrademarks: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'LegalTrademarks', '');
+end;
+
+function TIniVersionInfo.GetMajorVer: integer;
+begin
+  Result := FIniFile.ReadInteger(FInfoSection, 'MajorVer', 0);
+end;
+
+function TIniVersionInfo.GetMinorVer: integer;
+begin
+  Result := FIniFile.ReadInteger(FInfoSection, 'MinorVer', 0);
+end;
+
+function TIniVersionInfo.GetOriginalFilename: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'OriginalFilename', '');
+end;
+
+function TIniVersionInfo.GetProductName: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'ProductName', '');
+end;
+
+function TIniVersionInfo.GetProductVersion: string;
+begin
+  Result := FIniFile.ReadString(FInfoKeysSection, 'ProductVersion', '');
+end;
+
+function TIniVersionInfo.GetRelease: integer;
+begin
+  Result := FIniFile.ReadInteger(FInfoSection, 'Release', 0);
+end;
+
+procedure TIniVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
+begin
+  FIniFile.WriteBool(FInfoSection, 'AutoIncBuild', _AutoIncBuild);
+end;
+
+procedure TIniVersionInfo.SetBuild(_Build: integer);
+begin
+  FIniFile.WriteInteger(FInfoSection, 'Build', _Build);
+end;
+
+procedure TIniVersionInfo.SetComments(const _Comments: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'Comments', _Comments);
+end;
+
+procedure TIniVersionInfo.SetCompanyName(_CompanyName: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'CompanyName', _CompanyName);
+end;
+
+procedure TIniVersionInfo.SetFileDescription(_FileDescription: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'FileDescription', _FileDescription);
+end;
+
+procedure TIniVersionInfo.SetFileVersion(_FileVersion: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'FileVersion', _FileVersion);
+end;
+
+procedure TIniVersionInfo.SetInternalName(_InternalName: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'InternalName', _InternalName);
+end;
+
+procedure TIniVersionInfo.SetLegalCopyright(_LegalCopyright: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'LegalCopyright', _LegalCopyright);
+end;
+
+procedure TIniVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'LegalTrademarks', _LegalTrademarks);
+end;
+
+procedure TIniVersionInfo.SetMajorVer(_MajorVer: integer);
+begin
+  FIniFile.WriteInteger(FInfoSection, 'MajorVer', _MajorVer);
+end;
+
+procedure TIniVersionInfo.SetMinorVer(_MinorVer: integer);
+begin
+  FIniFile.WriteInteger(FInfoSection, 'MinorVer', _MinorVer);
+end;
+
+procedure TIniVersionInfo.SetOriginalFilename(_OriginalFilename: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'OriginalFilename', _OriginalFilename);
+end;
+
+procedure TIniVersionInfo.SetProductName(_ProductName: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'ProductName', _ProductName);
+end;
+
+procedure TIniVersionInfo.SetProductVersion(_ProductVersion: string);
+begin
+  FIniFile.WriteString(FInfoKeysSection, 'ProductVersion', _ProductVersion);
+end;
+
+procedure TIniVersionInfo.SetRelease(_Release: integer);
+begin
+  FIniFile.WriteInteger(FInfoSection, 'Release', _Release);
+end;
+
+procedure TIniVersionInfo.UpdateFile;
+begin
+  FIniFile.UpdateFile;
+end;
+
+end.
+



From twm at mail.berlios.de  Wed Jul 11 22:39:50 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Wed, 11 Jul 2007 22:39:50 +0200
Subject: [Dzchart-svncheckins] r156 - utilities/dzPrepBuild/trunk
Message-ID: <200707112039.l6BKdoqM017648@sheep.berlios.de>

Author: twm
Date: 2007-07-11 22:39:46 +0200 (Wed, 11 Jul 2007)
New Revision: 156

Added:
   utilities/dzPrepBuild/trunk/src/
   utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas
Modified:
   utilities/dzPrepBuild/trunk/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas
Log:
virtualized TIniVersionInfo Read/Write functions so they can be overridden by TCentralIniVersionInfo

Modified: utilities/dzPrepBuild/trunk/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dpr	2007-07-10 21:20:06 UTC (rev 155)
+++ utilities/dzPrepBuild/trunk/PrepBuild.dpr	2007-07-11 20:39:46 UTC (rev 156)
@@ -9,7 +9,8 @@
   d_BdsProjVersionInfo in 'd_BdsProjVersionInfo.pas' {dm_BdsProjVersionInfo: TDataModule},
   i_VersionInfo in 'i_VersionInfo.pas',
   u_DofVersionInfo in 'u_DofVersionInfo.pas',
-  u_IniVersionInfo in 'u_IniVersionInfo.pas';
+  u_IniVersionInfo in 'u_IniVersionInfo.pas',
+  u_CentralIniVersionInfo in 'u_CentralIniVersionInfo.pas';
 
 {$R *.res}
 

Modified: utilities/dzPrepBuild/trunk/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-07-10 21:20:06 UTC (rev 155)
+++ utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-07-11 20:39:46 UTC (rev 156)
@@ -28,90 +28,7 @@
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject xmlns=""> <Delphi.Personality>   <Parameters>
-      <Parameters Name="RunParams">testproject</Parameters>
-      <Parameters Name="UseLauncher">False</Parameters>
-      <Parameters Name="LoadAllSymbols">True</Parameters>
-      <Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
-    </Parameters>
-    <VersionInfo>
-      <VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-      <VersionInfo Name="AutoIncBuild">True</VersionInfo>
-      <VersionInfo Name="MajorVer">1</VersionInfo>
-      <VersionInfo Name="MinorVer">1</VersionInfo>
-      <VersionInfo Name="Release">0</VersionInfo>
-      <VersionInfo Name="Build">52</VersionInfo>
-      <VersionInfo Name="Debug">False</VersionInfo>
-      <VersionInfo Name="PreRelease">False</VersionInfo>
-      <VersionInfo Name="Special">False</VersionInfo>
-      <VersionInfo Name="Private">False</VersionInfo>
-      <VersionInfo Name="DLL">False</VersionInfo>
-      <VersionInfo Name="Locale">1033</VersionInfo>
-      <VersionInfo Name="CodePage">1252</VersionInfo>
-    </VersionInfo>
-    <VersionInfoKeys>
-      <VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKeys>
-      <VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-      <VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys>
-      <VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys>
-      <VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys>
-      <VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys>
-      <VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-      <VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys>
-      <VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys>
-      <VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys>
-    </VersionInfoKeys>
-    <Excluded_Packages>
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">52</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKeys><Versio!
 nInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
@@ -122,11 +39,7 @@
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcltee100.bpl">TeeChart Components</Excluded_Packages>
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcldbxcds100.bpl">Borland SimpleDataset Component (DBX)</Excluded_Packages>
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclie100.bpl">Internet Explorer Components</Excluded_Packages>
-    </Excluded_Packages>
-    <Source>
-      <Source Name="MainSource">PrepBuild.dpr</Source>
-    </Source>
-  </Delphi.Personality> </BorlandProject></BorlandProject>
+    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source></Delphi.Personality></BorlandProject></BorlandProject>
   </ProjectExtensions>
   <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
   <ItemGroup>
@@ -137,6 +50,7 @@
       <Form>dm_BdsProjVersionInfo</Form>
     </DCCReference>
     <DCCReference Include="i_VersionInfo.pas" />
+    <DCCReference Include="u_CentralIniVersionInfo.pas" />
     <DCCReference Include="u_DofVersionInfo.pas" />
     <DCCReference Include="u_IncBuildNoMain.pas" />
     <DCCReference Include="u_IniVersionInfo.pas" />

Added: utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas	2007-07-10 21:20:06 UTC (rev 155)
+++ utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
@@ -0,0 +1,65 @@
+unit u_CentralIniVersionInfo;
+
+interface
+
+uses
+  i_VersionInfo,
+  u_IniVersionInfo;
+
+type
+  {: This is a specialized descendant of TIniVersionInfo which
+     allows any entry of the file to redirect to a different file.
+     This can be done for single entries or for a whole section.
+     For redirecting a single entry, the value must contain a string
+     REDIRECT:<filename>,<section><entry>
+     For redirecting a section it must contain only one entry
+     redirect=<filename>,<section>
+     These redirections will be used for reading and writing, that is it can be
+     used to maintain/increment a central build number for several branches of
+     a project where the files have different version numbers but the build
+     number should be increased for a build of any of these versions. }
+  TCentralVersionInfo = class(TIniVersionInfo, IVersionInfo)
+  private
+  protected
+    function ReadString(const _Section, _Ident: string; _Default: string): string; override;
+    procedure WriteString(const _Section, _Ident: string; _Value: string); override;
+  public
+    {: Creates a TCentralVersionInfo instance
+       @param ProjectName is the name of the project (.dpr file without extension)
+                          The constructor appends "_Version.ini" to this
+                          name and tries to open the file }
+    constructor Create(const _ProjectName: string);
+  end;
+
+implementation
+
+uses
+  IniFiles;
+
+{ TCentralVersionInfo }
+
+constructor TCentralVersionInfo.Create(const _ProjectName: string);
+begin
+  inherited Create(_ProjectName + '_Version.ini');
+end;
+
+function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
+var
+  Redir: string;
+  IniFile: TMemIniFile;
+begin
+  Redir := FIniFile.ReadString(_Section, 'redirect', '');
+  if Redir = '' then
+    IniFile := FIniFile
+  else begin
+
+  end;
+end;
+
+procedure TCentralVersionInfo.WriteString(const _Section, _Ident: string; _Value: string);
+begin
+
+end;
+
+end.
+

Modified: utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas	2007-07-10 21:20:06 UTC (rev 155)
+++ utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
@@ -9,11 +9,15 @@
   u_IniVersionInfo;
 
 type
-  {: Tries to read a <projectname>.dof file, succeeds, if it exists and IncludeVerInfo is <> 0
-     @param Project is the project name (*.dpr file without extension)
-     @param VersionInfo is a TVersionInfoRec record which will be filled with the version info }
+  {: This is a specialized versoin of TIniVersionInfo which readds a
+     <projectname>.dof file, that was used by Delphi up to version 7. }
   TDofVersionInfo = class(TIniVersionInfo, IVersionInfo)
   public
+    {: Creates a TDofVersionInfo instance. Succeeds, if the file exists
+       and IncludeVerInfo is <> 0
+       @param _Projectname is the project name (*.dpr file without extension)
+       @raises ENoVersionInfo if the file does not exist or
+                              the value of [Version Info] IncludeVerInfo is not 1 }
     constructor Create(const _ProjectName: string);
   end;
 

Modified: utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas	2007-07-10 21:20:06 UTC (rev 155)
+++ utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
@@ -16,6 +16,12 @@
     FIniFile: TMemIniFile;
     FInfoSection: string;
     FInfoKeysSection: string;
+    function ReadInteger(const _Section, _Ident: string; _Default: integer): integer; virtual;
+    procedure WriteInteger(const _Section, _Ident: string; _Value: integer); virtual;
+    function ReadString(const _Section, _Ident: string; _Default: string): string; virtual;
+    procedure WriteString(const _Section, _Ident: string; _Value: string); virtual;
+    function ReadBool(const _Section, _Ident: string; _Default: boolean): boolean; virtual;
+    procedure WriteBool(const _Section, _Ident: string; _Value: boolean); virtual;
   protected // implementation of IVersionInfo
     function GetBuild: integer;
     procedure SetBuild(_Build: integer);
@@ -67,6 +73,15 @@
     property ProductVersion: string read GetProductVersion write SetProductVersion;
     property Release: integer read GetRelease write SetRelease;
   public
+    {: Creates a TIniVersionInfo instance.
+       @param FullFilename is the full filename including path and extension of
+                           file to use
+       @param InfoSection is the name of the section that contains the general
+                          version info like Major/Minor version, Release etc.
+                          In a Delphi .dof file this section is called [Version Info]
+       @param InfoKeySection is the name of the section that contains the additional
+                             strings of the version information
+                             In a Delphi .dof file this section is called [Version Info Keys] }
     constructor Create(const _FullFilename: string; const _InfoSection: string;
       const _InfoKeysSection: string);
     destructor Destroy; override;
@@ -91,6 +106,40 @@
   inherited;
 end;
 
+function TIniVersionInfo.ReadBool(const _Section, _Ident: string; _Default: boolean): boolean;
+begin
+  Result := 0 <> ReadInteger(_Section, _Ident, Ord(_Default));
+end;
+
+function TIniVersionInfo.ReadInteger(const _Section, _Ident: string; _Default: integer): integer;
+var
+  s: string;
+begin
+  s := ReadString(_Section, _Ident, IntToStr(_Default));
+  if not TryStrToInt(s, Result) then
+    Result := _Default;
+end;
+
+function TIniVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
+begin
+  Result := FIniFile.ReadString(_Section, _Ident, _Default);
+end;
+
+procedure TIniVersionInfo.WriteBool(const _Section, _Ident: string; _Value: boolean);
+begin
+  WriteInteger(_Section, _Ident, Ord(_Value));
+end;
+
+procedure TIniVersionInfo.WriteInteger(const _Section, _Ident: string; _Value: integer);
+begin
+  WriteString(_Section, _Ident, IntToStr(_Value));
+end;
+
+procedure TIniVersionInfo.WriteString(const _Section, _Ident: string; _Value: string);
+begin
+  FIniFile.WriteString(_Section, _Ident, _Value);
+end;
+
 procedure TIniVersionInfo.Assign(const _VersionInfo: IVersionInfo);
 begin
   AutoIncBuild := _VersionInfo.AutoIncBuild;
@@ -112,152 +161,152 @@
 
 function TIniVersionInfo.GetAutoIncBuild: boolean;
 begin
-  Result := FIniFile.ReadInteger(FInfoSection, 'AutoIncBuild', 0) <> 0;
+  Result := ReadInteger(FInfoSection, 'AutoIncBuild', 0) <> 0;
 end;
 
 function TIniVersionInfo.GetBuild: integer;
 begin
-  Result := FIniFile.ReadInteger(FInfoSection, 'Build', 0);
+  Result := ReadInteger(FInfoSection, 'Build', 0);
 end;
 
 function TIniVersionInfo.GetComments: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'Comments', '');
+  Result := ReadString(FInfoKeysSection, 'Comments', '');
 end;
 
 function TIniVersionInfo.GetCompanyName: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'CompanyName', '');
+  Result := ReadString(FInfoKeysSection, 'CompanyName', '');
 end;
 
 function TIniVersionInfo.GetFileDescription: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'FileDescription', '');
+  Result := ReadString(FInfoKeysSection, 'FileDescription', '');
 end;
 
 function TIniVersionInfo.GetFileVersion: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'FileVersion', '');
+  Result := ReadString(FInfoKeysSection, 'FileVersion', '');
 end;
 
 function TIniVersionInfo.GetInternalName: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'InternalName', '');
+  Result := ReadString(FInfoKeysSection, 'InternalName', '');
 end;
 
 function TIniVersionInfo.GetLegalCopyright: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'LegalCopyright', '');
+  Result := ReadString(FInfoKeysSection, 'LegalCopyright', '');
 end;
 
 function TIniVersionInfo.GetLegalTrademarks: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'LegalTrademarks', '');
+  Result := ReadString(FInfoKeysSection, 'LegalTrademarks', '');
 end;
 
 function TIniVersionInfo.GetMajorVer: integer;
 begin
-  Result := FIniFile.ReadInteger(FInfoSection, 'MajorVer', 0);
+  Result := ReadInteger(FInfoSection, 'MajorVer', 0);
 end;
 
 function TIniVersionInfo.GetMinorVer: integer;
 begin
-  Result := FIniFile.ReadInteger(FInfoSection, 'MinorVer', 0);
+  Result := ReadInteger(FInfoSection, 'MinorVer', 0);
 end;
 
 function TIniVersionInfo.GetOriginalFilename: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'OriginalFilename', '');
+  Result := ReadString(FInfoKeysSection, 'OriginalFilename', '');
 end;
 
 function TIniVersionInfo.GetProductName: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'ProductName', '');
+  Result := ReadString(FInfoKeysSection, 'ProductName', '');
 end;
 
 function TIniVersionInfo.GetProductVersion: string;
 begin
-  Result := FIniFile.ReadString(FInfoKeysSection, 'ProductVersion', '');
+  Result := ReadString(FInfoKeysSection, 'ProductVersion', '');
 end;
 
 function TIniVersionInfo.GetRelease: integer;
 begin
-  Result := FIniFile.ReadInteger(FInfoSection, 'Release', 0);
+  Result := ReadInteger(FInfoSection, 'Release', 0);
 end;
 
 procedure TIniVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
 begin
-  FIniFile.WriteBool(FInfoSection, 'AutoIncBuild', _AutoIncBuild);
+  WriteBool(FInfoSection, 'AutoIncBuild', _AutoIncBuild);
 end;
 
 procedure TIniVersionInfo.SetBuild(_Build: integer);
 begin
-  FIniFile.WriteInteger(FInfoSection, 'Build', _Build);
+  WriteInteger(FInfoSection, 'Build', _Build);
 end;
 
 procedure TIniVersionInfo.SetComments(const _Comments: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'Comments', _Comments);
+  WriteString(FInfoKeysSection, 'Comments', _Comments);
 end;
 
 procedure TIniVersionInfo.SetCompanyName(_CompanyName: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'CompanyName', _CompanyName);
+  WriteString(FInfoKeysSection, 'CompanyName', _CompanyName);
 end;
 
 procedure TIniVersionInfo.SetFileDescription(_FileDescription: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'FileDescription', _FileDescription);
+  WriteString(FInfoKeysSection, 'FileDescription', _FileDescription);
 end;
 
 procedure TIniVersionInfo.SetFileVersion(_FileVersion: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'FileVersion', _FileVersion);
+  WriteString(FInfoKeysSection, 'FileVersion', _FileVersion);
 end;
 
 procedure TIniVersionInfo.SetInternalName(_InternalName: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'InternalName', _InternalName);
+  WriteString(FInfoKeysSection, 'InternalName', _InternalName);
 end;
 
 procedure TIniVersionInfo.SetLegalCopyright(_LegalCopyright: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'LegalCopyright', _LegalCopyright);
+  WriteString(FInfoKeysSection, 'LegalCopyright', _LegalCopyright);
 end;
 
 procedure TIniVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'LegalTrademarks', _LegalTrademarks);
+  WriteString(FInfoKeysSection, 'LegalTrademarks', _LegalTrademarks);
 end;
 
 procedure TIniVersionInfo.SetMajorVer(_MajorVer: integer);
 begin
-  FIniFile.WriteInteger(FInfoSection, 'MajorVer', _MajorVer);
+  WriteInteger(FInfoSection, 'MajorVer', _MajorVer);
 end;
 
 procedure TIniVersionInfo.SetMinorVer(_MinorVer: integer);
 begin
-  FIniFile.WriteInteger(FInfoSection, 'MinorVer', _MinorVer);
+  WriteInteger(FInfoSection, 'MinorVer', _MinorVer);
 end;
 
 procedure TIniVersionInfo.SetOriginalFilename(_OriginalFilename: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'OriginalFilename', _OriginalFilename);
+  WriteString(FInfoKeysSection, 'OriginalFilename', _OriginalFilename);
 end;
 
 procedure TIniVersionInfo.SetProductName(_ProductName: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'ProductName', _ProductName);
+  WriteString(FInfoKeysSection, 'ProductName', _ProductName);
 end;
 
 procedure TIniVersionInfo.SetProductVersion(_ProductVersion: string);
 begin
-  FIniFile.WriteString(FInfoKeysSection, 'ProductVersion', _ProductVersion);
+  WriteString(FInfoKeysSection, 'ProductVersion', _ProductVersion);
 end;
 
 procedure TIniVersionInfo.SetRelease(_Release: integer);
 begin
-  FIniFile.WriteInteger(FInfoSection, 'Release', _Release);
+  WriteInteger(FInfoSection, 'Release', _Release);
 end;
 
 procedure TIniVersionInfo.UpdateFile;



From twm at mail.berlios.de  Wed Jul 11 22:43:38 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Wed, 11 Jul 2007 22:43:38 +0200
Subject: [Dzchart-svncheckins] r157 - in utilities/dzPrepBuild/trunk: . src
	testdata
Message-ID: <200707112043.l6BKhcfr017873@sheep.berlios.de>

Author: twm
Date: 2007-07-11 22:43:22 +0200 (Wed, 11 Jul 2007)
New Revision: 157

Added:
   utilities/dzPrepBuild/trunk/src/PrepBuild.bdsproj
   utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.dfm
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
   utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
   utilities/dzPrepBuild/trunk/testdata/
   utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj
   utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.dof
   utilities/dzPrepBuild/trunk/testdata/Testproject.bdsproj
   utilities/dzPrepBuild/trunk/testdata/Testproject.dof
   utilities/dzPrepBuild/trunk/testdata/copyback.cmd
Removed:
   utilities/dzPrepBuild/trunk/OriginalTestproject.bdsproj
   utilities/dzPrepBuild/trunk/OriginalTestproject.dof
   utilities/dzPrepBuild/trunk/PrepBuild.bdsproj
   utilities/dzPrepBuild/trunk/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/Testproject.bdsproj
   utilities/dzPrepBuild/trunk/Testproject.dof
   utilities/dzPrepBuild/trunk/copyback.cmd
   utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.dfm
   utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/i_VersionInfo.pas
   utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/u_IncBuildNoMain.pas
   utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas
Log:
* moved sources to subdir src and adjusted paths
* moved test data to subdir testdata

Deleted: utilities/dzPrepBuild/trunk/OriginalTestproject.bdsproj
===================================================================
--- utilities/dzPrepBuild/trunk/OriginalTestproject.bdsproj	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/OriginalTestproject.bdsproj	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,176 +0,0 @@
-?<?xml version="1.0" encoding="utf-8"?>
-<BorlandProject>
-	<PersonalityInfo>
-		<Option>
-			<Option Name="Personality">Delphi.Personality</Option>
-			<Option Name="ProjectType"></Option>
-			<Option Name="Version">1.0</Option>
-			<Option Name="GUID">{209412AC-0EC2-4F63-B92A-E78853FF142A}</Option>
-		</Option>
-	</PersonalityInfo>
-	<Delphi.Personality>
-		<Source>
-			<Source Name="MainSource">IncBuildNo.dpr</Source>
-		</Source>
-		<FileVersion>
-			<FileVersion Name="Version">7.0</FileVersion>
-		</FileVersion>
-		<Compiler>
-			<Compiler Name="A">8</Compiler>
-			<Compiler Name="B">0</Compiler>
-			<Compiler Name="C">1</Compiler>
-			<Compiler Name="D">0</Compiler>
-			<Compiler Name="E">0</Compiler>
-			<Compiler Name="F">0</Compiler>
-			<Compiler Name="G">1</Compiler>
-			<Compiler Name="H">1</Compiler>
-			<Compiler Name="I">1</Compiler>
-			<Compiler Name="J">0</Compiler>
-			<Compiler Name="K">0</Compiler>
-			<Compiler Name="L">1</Compiler>
-			<Compiler Name="M">0</Compiler>
-			<Compiler Name="N">1</Compiler>
-			<Compiler Name="O">1</Compiler>
-			<Compiler Name="P">1</Compiler>
-			<Compiler Name="Q">0</Compiler>
-			<Compiler Name="R">0</Compiler>
-			<Compiler Name="S">0</Compiler>
-			<Compiler Name="T">0</Compiler>
-			<Compiler Name="U">0</Compiler>
-			<Compiler Name="V">1</Compiler>
-			<Compiler Name="W">0</Compiler>
-			<Compiler Name="X">1</Compiler>
-			<Compiler Name="Y">1</Compiler>
-			<Compiler Name="Z">1</Compiler>
-			<Compiler Name="ShowHints">True</Compiler>
-			<Compiler Name="ShowWarnings">True</Compiler>
-			<Compiler Name="UnitAliases">WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;</Compiler>
-			<Compiler Name="NamespacePrefix"></Compiler>
-			<Compiler Name="GenerateDocumentation">False</Compiler>
-			<Compiler Name="DefaultNamespace"></Compiler>
-			<Compiler Name="SymbolDeprecated">True</Compiler>
-			<Compiler Name="SymbolLibrary">True</Compiler>
-			<Compiler Name="SymbolPlatform">True</Compiler>
-			<Compiler Name="SymbolExperimental">True</Compiler>
-			<Compiler Name="UnitLibrary">True</Compiler>
-			<Compiler Name="UnitPlatform">True</Compiler>
-			<Compiler Name="UnitDeprecated">True</Compiler>
-			<Compiler Name="UnitExperimental">True</Compiler>
-			<Compiler Name="HResultCompat">True</Compiler>
-			<Compiler Name="HidingMember">True</Compiler>
-			<Compiler Name="HiddenVirtual">True</Compiler>
-			<Compiler Name="Garbage">True</Compiler>
-			<Compiler Name="BoundsError">True</Compiler>
-			<Compiler Name="ZeroNilCompat">True</Compiler>
-			<Compiler Name="StringConstTruncated">True</Compiler>
-			<Compiler Name="ForLoopVarVarPar">True</Compiler>
-			<Compiler Name="TypedConstVarPar">True</Compiler>
-			<Compiler Name="AsgToTypedConst">True</Compiler>
-			<Compiler Name="CaseLabelRange">True</Compiler>
-			<Compiler Name="ForVariable">True</Compiler>
-			<Compiler Name="ConstructingAbstract">True</Compiler>
-			<Compiler Name="ComparisonFalse">True</Compiler>
-			<Compiler Name="ComparisonTrue">True</Compiler>
-			<Compiler Name="ComparingSignedUnsigned">True</Compiler>
-			<Compiler Name="CombiningSignedUnsigned">True</Compiler>
-			<Compiler Name="UnsupportedConstruct">True</Compiler>
-			<Compiler Name="FileOpen">True</Compiler>
-			<Compiler Name="FileOpenUnitSrc">True</Compiler>
-			<Compiler Name="BadGlobalSymbol">True</Compiler>
-			<Compiler Name="DuplicateConstructorDestructor">True</Compiler>
-			<Compiler Name="InvalidDirective">True</Compiler>
-			<Compiler Name="PackageNoLink">True</Compiler>
-			<Compiler Name="PackageThreadVar">True</Compiler>
-			<Compiler Name="ImplicitImport">True</Compiler>
-			<Compiler Name="HPPEMITIgnored">True</Compiler>
-			<Compiler Name="NoRetVal">True</Compiler>
-			<Compiler Name="UseBeforeDef">True</Compiler>
-			<Compiler Name="ForLoopVarUndef">True</Compiler>
-			<Compiler Name="UnitNameMismatch">True</Compiler>
-			<Compiler Name="NoCFGFileFound">True</Compiler>
-			<Compiler Name="MessageDirective">True</Compiler>
-			<Compiler Name="ImplicitVariants">True</Compiler>
-			<Compiler Name="UnicodeToLocale">True</Compiler>
-			<Compiler Name="LocaleToUnicode">True</Compiler>
-			<Compiler Name="ImagebaseMultiple">True</Compiler>
-			<Compiler Name="SuspiciousTypecast">True</Compiler>
-			<Compiler Name="PrivatePropAccessor">True</Compiler>
-			<Compiler Name="UnsafeType">False</Compiler>
-			<Compiler Name="UnsafeCode">False</Compiler>
-			<Compiler Name="UnsafeCast">False</Compiler>
-			<Compiler Name="OptionTruncated">True</Compiler>
-			<Compiler Name="WideCharReduced">True</Compiler>
-			<Compiler Name="DuplicatesIgnored">True</Compiler>  <Compiler Name="UnitInitSeq">True</Compiler>
-      <Compiler Name="LocalPInvoke">True</Compiler>
-      <Compiler Name="CodePage"></Compiler>
-    </Compiler>
-		<Linker>
-			<Linker Name="MapFile">0</Linker>
-			<Linker Name="OutputObjs">0</Linker>
-			<Linker Name="ConsoleApp">1</Linker>
-			<Linker Name="DebugInfo">False</Linker>
-			<Linker Name="RemoteSymbols">False</Linker>
-			<Linker Name="GenerateDRC">False</Linker>
-			<Linker Name="MinStackSize">16384</Linker>
-			<Linker Name="MaxStackSize">1048576</Linker>
-			<Linker Name="ImageBase">4194304</Linker>
-			<Linker Name="ExeDescription"></Linker>  <Linker Name="GenerateHpps">False</Linker>
-    </Linker>
-		<Directories>
-			<Directories Name="OutputDir"></Directories>
-			<Directories Name="UnitOutputDir"></Directories>
-			<Directories Name="PackageDLLOutputDir"></Directories>
-			<Directories Name="PackageDCPOutputDir"></Directories>
-			<Directories Name="SearchPath"></Directories>
-			<Directories Name="Packages">rtl;vcl;vcldb;dbrtl;vclx;dbxcds;dbexpress;IndySystem;IndyCore;VclSmp;IndyProtocols;dsnap;adortl;vclactnband;vclshlctrls;JvCustomD9R;JvSystemD9R;JvCoreD9R;DJcl;JvStdCtrlsD9R;dzConfigd9;PerlRegExD2005;SynEdit_R2005;SynUni_D2005;JvAppFrmD9R;JvBandsD9R;JvBDED9R;JvCmpD9R;JvCryptD9R;JvCtrlsD9R;JvDlgsD9R;JvDockingD9R;JvDotNetCtrlsD9R;JvEDID9R;JvGlobusD9R;JvHMID9R;JvInspectorD9R;JvInterpreterD9R;JvJansD9R;JvManagedThreadsD9R;JvMMD9R;JvNetD9R;JvPageCompsD9R;JvPluginD9R;JvPrintPreviewD9R;JvTimeFrameworkD9R;JvUIBD9R;JvValidatorsD9R;JvWizardD9R;JvXPCtrlsD9R</Directories>
-			<Directories Name="Conditionals"></Directories>
-			<Directories Name="DebugSourceDirs"></Directories>
-			<Directories Name="UsePackages">False</Directories>
-		</Directories>
-		<Parameters>
-			<Parameters Name="RunParams"></Parameters>
-			<Parameters Name="HostApplication"></Parameters>
-			<Parameters Name="Launcher"></Parameters>
-			<Parameters Name="UseLauncher">False</Parameters>
-			<Parameters Name="DebugCWD"></Parameters>
-			<Parameters Name="RemoteHost"></Parameters>
-			<Parameters Name="RemotePath"></Parameters>
-			<Parameters Name="RemoteLauncher"></Parameters>
-			<Parameters Name="RemoteCWD"></Parameters>
-			<Parameters Name="RemoteDebug">False</Parameters>  <Parameters Name="Debug Symbols Search Path"></Parameters>
-      <Parameters Name="LoadAllSymbols">True</Parameters>
-      <Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
-    </Parameters>
-		<VersionInfo>
-			<VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-			<VersionInfo Name="AutoIncBuild">False</VersionInfo>
-			<VersionInfo Name="MajorVer">1</VersionInfo>
-			<VersionInfo Name="MinorVer">1</VersionInfo>
-			<VersionInfo Name="Release">0</VersionInfo>
-			<VersionInfo Name="Build">0</VersionInfo>
-			<VersionInfo Name="Debug">False</VersionInfo>
-			<VersionInfo Name="PreRelease">False</VersionInfo>
-			<VersionInfo Name="Special">False</VersionInfo>
-			<VersionInfo Name="Private">False</VersionInfo>
-			<VersionInfo Name="DLL">False</VersionInfo>
-			<VersionInfo Name="Locale">1033</VersionInfo>
-			<VersionInfo Name="CodePage">1252</VersionInfo>
-		</VersionInfo>
-		<VersionInfoKeys>
-			<VersionInfoKeys Name="FileVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys>
-			<VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys>
-			<VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalCopyright">copyright 2005 by Thomas Mueller</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-			<VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys>
-			<VersionInfoKeys Name="Comments"></VersionInfoKeys>
-		</VersionInfoKeys>  <Language>
-      <Language Name="ActiveLang"></Language>
-      <Language Name="ProjectLang">$00000000</Language>
-      <Language Name="RootDir"></Language>
-    </Language>
-  </Delphi.Personality>
-</BorlandProject>

Deleted: utilities/dzPrepBuild/trunk/OriginalTestproject.dof
===================================================================
--- utilities/dzPrepBuild/trunk/OriginalTestproject.dof	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/OriginalTestproject.dof	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,191 +0,0 @@
-[FileVersion]
-Version=7.0
-[Compiler]
-A=8
-B=0
-C=1
-D=1
-E=0
-F=0
-G=1
-H=1
-I=1
-J=0
-K=0
-L=1
-M=0
-N=1
-O=1
-P=1
-Q=0
-R=0
-S=0
-T=0
-U=0
-V=1
-W=0
-X=1
-Y=1
-Z=1
-ShowHints=1
-ShowWarnings=1
-UnitAliases=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
-NamespacePrefix=
-SymbolDeprecated=1
-SymbolLibrary=1
-SymbolPlatform=0
-UnitLibrary=1
-UnitPlatform=0
-UnitDeprecated=1
-HResultCompat=1
-HidingMember=1
-HiddenVirtual=1
-Garbage=1
-BoundsError=1
-ZeroNilCompat=1
-StringConstTruncated=1
-ForLoopVarVarPar=1
-TypedConstVarPar=1
-AsgToTypedConst=1
-CaseLabelRange=1
-ForVariable=1
-ConstructingAbstract=1
-ComparisonFalse=1
-ComparisonTrue=1
-ComparingSignedUnsigned=1
-CombiningSignedUnsigned=1
-UnsupportedConstruct=1
-FileOpen=1
-FileOpenUnitSrc=1
-BadGlobalSymbol=1
-DuplicateConstructorDestructor=1
-InvalidDirective=1
-PackageNoLink=1
-PackageThreadVar=1
-ImplicitImport=1
-HPPEMITIgnored=1
-NoRetVal=1
-UseBeforeDef=1
-ForLoopVarUndef=1
-UnitNameMismatch=1
-NoCFGFileFound=1
-MessageDirective=1
-ImplicitVariants=1
-UnicodeToLocale=1
-LocaleToUnicode=1
-ImagebaseMultiple=1
-SuspiciousTypecast=1
-PrivatePropAccessor=1
-UnsafeType=0
-UnsafeCode=0
-UnsafeCast=0
-[Linker]
-MapFile=0
-OutputObjs=0
-ConsoleApp=1
-DebugInfo=0
-RemoteSymbols=0
-MinStackSize=16384
-MaxStackSize=1048576
-ImageBase=4194304
-ExeDescription=
-[Directories]
-OutputDir=q:\Dof2Rc
-UnitOutputDir=q:\Dof2Rc\dcu
-PackageDLLOutputDir=
-PackageDCPOutputDir=
-SearchPath=.\libs\headwork\units;.\libs\3rd\tregexpr\source
-Packages=vcl;rtl;vclx;vclshlctrls;visualclx;indy
-Conditionals=englisch;debug
-DebugSourceDirs=
-UsePackages=0
-[Parameters]
-RunParams=--comment="internal use only" --product="%s DEMO" --build s:\utils\dof2rc\Dof2Rc.dpr
-HostApplication=
-Launcher=
-UseLauncher=0
-DebugCWD=
-[Version Info]
-IncludeVerInfo=1
-AutoIncBuild=1
-MajorVer=1
-MinorVer=0
-Release=0
-Build=21
-Debug=0
-PreRelease=0
-Special=0
-Private=0
-DLL=0
-Locale=1033
-CodePage=1252
-[Version Info Keys]
-CompanyName=iCD. GmbH
-FileDescription=Dof2Rc Tool
-FileVersion=1.0.0.21
-InternalName=dof2rc
-LegalCopyright=Copyright 2002-2005 by iCD. GmbH
-LegalTrademarks=
-OriginalFilename=dof2rc.exe
-ProductName=Dof2Rc
-ProductVersion=1.0.0.0
-Comments=internal use only
-[Excluded Packages]
-q:\bpl\UnicodeConvDelphi7.bpl=Unicode Converter Library (UCL)
-c:\program files\borland\delphi7\Bin\dclite70.bpl=Borland Integrated Translation Environment
-c:\program files\borland\delphi7\Bin\dclnet70.bpl=Borland Internet Components
-c:\program files\borland\delphi7\Bin\dclsoap70.bpl=Borland SOAP Components
-c:\program files\borland\delphi7\Bin\dclocx70.bpl=Borland Sample Imported ActiveX Controls
-c:\program files\borland\delphi7\Bin\dcldbx70.bpl=Borland dbExpress Components
-c:\program files\borland\delphi7\Bin\dcldbxcds70.bpl=Borland SimpleDataset Component (DBX)
-c:\program files\borland\delphi7\Bin\DBWEBXPRT.BPL=Borland Web Wizard Package
-c:\program files\borland\delphi7\Bin\dclie70.bpl=Internet Explorer Components
-c:\program files\borland\delphi7\Bin\dclbde70.bpl=Borland BDE DB Components
-c:\program files\borland\delphi7\Bin\dcltee70.bpl=TeeChart Components
-c:\program files\borland\delphi7\Bin\dclib70.bpl=InterBase Data Access Components
-c:\program files\borland\delphi7\Bin\dclclxdb70.bpl=Borland CLX Database Components
-c:\program files\borland\delphi7\Bin\dclclxstd70.bpl=Borland CLX Standard Components
-c:\program files\borland\delphi7\Bin\dclmid70.bpl=Borland MyBase DataAccess Components
-C:\WINNT\System32\ibevnt70.bpl=Borland Interbase Event Alerter Component
-c:\program files\borland\delphi7\Bin\dclIntraweb_50_70.bpl=Intraweb 5.0 Design Package for Delphi 7
-Q:\bpl\CompBAR7.bpl=Component Bar Expert 1.0.2
-Q:\bpl\dcldummzeuchchart.bpl=dummzeuch.de Charts - designtime package
-Q:\bpl\dclrxbd7.bpl=RX Library BDE Database Components
-Q:\bpl\olectra.bpl=Olectra Chart Components (Active X)
-Q:\bpl\dclRBC77.bpl=ReportBuilder TeeChart 4.04 Components
-c:\program files\borland\delphi7\bin\dclRave70.bpl=Rave Reports BE 5.0 Package
-c:\program files\borland\delphi7\Bin\dclaxserver70.bpl=Microsoft Office 97 Sample Automation Server Wrapper Components
-Q:\bpl\JclDebugIde70.bpl=JCL Debug IDE extension for Delphi 7
-C:\Program Files\Castalia Free for Delphi\JacobsLadder7.bpl=Castalia for Delphi 7
-C:\Program Files\CompDiff\Delphi7\CompDiff.bpl=Component Diff Tool for Delphi
-C:\Program Files\Castalia for Delphi Trial\LadderFlyout7.bpl=Castalia Flyout Bar for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderForms7.bpl=Castalia Form Designer for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderStat7.bpl=Castalia Statistics for Delphi 7
-[HistoryLists\hlConditionals]
-Count=2
-Item0=englisch;debug
-Item1=englisch
-[HistoryLists\hlUnitAliases]
-Count=1
-Item0=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
-[HistoryLists\hlSearchPath]
-Count=9
-Item0=.\libs\headwork\units;.\libs\3rd\tregexpr\source
-Item1=.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item2=S:\3rd\xml\ucl;.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item3=S:\3rd\xml\ucl;libs\headwork\units;.\libs\3rd\regexpr\source
-Item4=S:\3rd\xml\ucl;.\libs\headwork;.\libs\3rd\regexpr\source
-Item5=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork
-Item6=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork\components
-Item7=S:\3rd\regexpr;S:\3rd\xml\ucl
-Item8=S:\3rd\regexpr
-[HistoryLists\hlUnitOutputDirectory]
-Count=3
-Item0=q:\Dof2Rc\dcu
-Item1=Q:\test\dcu
-Item2=Q:\
-[HistoryLists\hlOutputDirectorry]
-Count=3
-Item0=q:\Dof2Rc
-Item1=Q:\test
-Item2=Q:\

Deleted: utilities/dzPrepBuild/trunk/PrepBuild.bdsproj
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.bdsproj	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/PrepBuild.bdsproj	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,191 +0,0 @@
-?<?xml version="1.0" encoding="utf-8"?>
-<BorlandProject>
-	<PersonalityInfo>
-		<Option>
-			<Option Name="Personality">Delphi.Personality</Option>
-			<Option Name="ProjectType"></Option>
-			<Option Name="Version">1.0</Option>
-			<Option Name="GUID">{209412AC-0EC2-4F63-B92A-E78853FF142A}</Option>
-		</Option>
-	</PersonalityInfo>
-	<Delphi.Personality>
-		<Source>
-			<Source Name="MainSource">PrepBuild.dpr</Source>
-		</Source>
-		<FileVersion>
-			<FileVersion Name="Version">7.0</FileVersion>
-		</FileVersion>
-		<Compiler>
-			<Compiler Name="A">8</Compiler>
-			<Compiler Name="B">0</Compiler>
-			<Compiler Name="C">1</Compiler>
-			<Compiler Name="D">1</Compiler>
-			<Compiler Name="E">0</Compiler>
-			<Compiler Name="F">0</Compiler>
-			<Compiler Name="G">1</Compiler>
-			<Compiler Name="H">1</Compiler>
-			<Compiler Name="I">1</Compiler>
-			<Compiler Name="J">0</Compiler>
-			<Compiler Name="K">0</Compiler>
-			<Compiler Name="L">1</Compiler>
-			<Compiler Name="M">0</Compiler>
-			<Compiler Name="N">1</Compiler>
-			<Compiler Name="O">1</Compiler>
-			<Compiler Name="P">1</Compiler>
-			<Compiler Name="Q">0</Compiler>
-			<Compiler Name="R">0</Compiler>
-			<Compiler Name="S">0</Compiler>
-			<Compiler Name="T">0</Compiler>
-			<Compiler Name="U">0</Compiler>
-			<Compiler Name="V">1</Compiler>
-			<Compiler Name="W">0</Compiler>
-			<Compiler Name="X">1</Compiler>
-			<Compiler Name="Y">1</Compiler>
-			<Compiler Name="Z">1</Compiler>
-			<Compiler Name="ShowHints">True</Compiler>
-			<Compiler Name="ShowWarnings">True</Compiler>
-			<Compiler Name="UnitAliases">WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;</Compiler>
-			<Compiler Name="NamespacePrefix"></Compiler>
-			<Compiler Name="GenerateDocumentation">False</Compiler>
-			<Compiler Name="DefaultNamespace"></Compiler>
-			<Compiler Name="SymbolDeprecated">True</Compiler>
-			<Compiler Name="SymbolLibrary">True</Compiler>
-			<Compiler Name="SymbolPlatform">True</Compiler>
-			<Compiler Name="SymbolExperimental">True</Compiler>
-			<Compiler Name="UnitLibrary">True</Compiler>
-			<Compiler Name="UnitPlatform">True</Compiler>
-			<Compiler Name="UnitDeprecated">True</Compiler>
-			<Compiler Name="UnitExperimental">True</Compiler>
-			<Compiler Name="HResultCompat">True</Compiler>
-			<Compiler Name="HidingMember">True</Compiler>
-			<Compiler Name="HiddenVirtual">True</Compiler>
-			<Compiler Name="Garbage">True</Compiler>
-			<Compiler Name="BoundsError">True</Compiler>
-			<Compiler Name="ZeroNilCompat">True</Compiler>
-			<Compiler Name="StringConstTruncated">True</Compiler>
-			<Compiler Name="ForLoopVarVarPar">True</Compiler>
-			<Compiler Name="TypedConstVarPar">True</Compiler>
-			<Compiler Name="AsgToTypedConst">True</Compiler>
-			<Compiler Name="CaseLabelRange">True</Compiler>
-			<Compiler Name="ForVariable">True</Compiler>
-			<Compiler Name="ConstructingAbstract">True</Compiler>
-			<Compiler Name="ComparisonFalse">True</Compiler>
-			<Compiler Name="ComparisonTrue">True</Compiler>
-			<Compiler Name="ComparingSignedUnsigned">True</Compiler>
-			<Compiler Name="CombiningSignedUnsigned">True</Compiler>
-			<Compiler Name="UnsupportedConstruct">True</Compiler>
-			<Compiler Name="FileOpen">True</Compiler>
-			<Compiler Name="FileOpenUnitSrc">True</Compiler>
-			<Compiler Name="BadGlobalSymbol">True</Compiler>
-			<Compiler Name="DuplicateConstructorDestructor">True</Compiler>
-			<Compiler Name="InvalidDirective">True</Compiler>
-			<Compiler Name="PackageNoLink">True</Compiler>
-			<Compiler Name="PackageThreadVar">True</Compiler>
-			<Compiler Name="ImplicitImport">True</Compiler>
-			<Compiler Name="HPPEMITIgnored">True</Compiler>
-			<Compiler Name="NoRetVal">True</Compiler>
-			<Compiler Name="UseBeforeDef">True</Compiler>
-			<Compiler Name="ForLoopVarUndef">True</Compiler>
-			<Compiler Name="UnitNameMismatch">True</Compiler>
-			<Compiler Name="NoCFGFileFound">True</Compiler>
-			<Compiler Name="MessageDirective">True</Compiler>
-			<Compiler Name="ImplicitVariants">True</Compiler>
-			<Compiler Name="UnicodeToLocale">True</Compiler>
-			<Compiler Name="LocaleToUnicode">True</Compiler>
-			<Compiler Name="ImagebaseMultiple">True</Compiler>
-			<Compiler Name="SuspiciousTypecast">True</Compiler>
-			<Compiler Name="PrivatePropAccessor">True</Compiler>
-			<Compiler Name="UnsafeType">False</Compiler>
-			<Compiler Name="UnsafeCode">False</Compiler>
-			<Compiler Name="UnsafeCast">False</Compiler>
-			<Compiler Name="OptionTruncated">True</Compiler>
-			<Compiler Name="WideCharReduced">True</Compiler>
-			<Compiler Name="DuplicatesIgnored">True</Compiler>
-			<Compiler Name="UnitInitSeq">True</Compiler>
-			<Compiler Name="LocalPInvoke">True</Compiler>
-			<Compiler Name="CodePage"></Compiler>
-		</Compiler>
-		<Linker>
-			<Linker Name="MapFile">0</Linker>
-			<Linker Name="OutputObjs">0</Linker>
-			<Linker Name="ConsoleApp">1</Linker>
-			<Linker Name="DebugInfo">False</Linker>
-			<Linker Name="RemoteSymbols">False</Linker>
-			<Linker Name="GenerateDRC">False</Linker>
-			<Linker Name="MinStackSize">16384</Linker>
-			<Linker Name="MaxStackSize">1048576</Linker>
-			<Linker Name="ImageBase">4194304</Linker>
-			<Linker Name="ExeDescription"></Linker>
-			<Linker Name="GenerateHpps">False</Linker>
-		</Linker>
-		<Directories>
-			<Directories Name="OutputDir"></Directories>
-			<Directories Name="UnitOutputDir">dcu</Directories>
-			<Directories Name="PackageDLLOutputDir"></Directories>
-			<Directories Name="PackageDCPOutputDir"></Directories>
-			<Directories Name="SearchPath"></Directories>
-			<Directories Name="Packages">rtl;vcl;vcldb;dbrtl;vclx;dbxcds;dbexpress;IndySystem;IndyCore;VclSmp;IndyProtocols;dsnap;adortl;vclactnband;vclshlctrls;JvCustomD9R;JvSystemD9R;JvCoreD9R;DJcl;JvStdCtrlsD9R;dzConfigd9;PerlRegExD2005;SynEdit_R2005;SynUni_D2005;JvAppFrmD9R;JvBandsD9R;JvBDED9R;JvCmpD9R;JvCryptD9R;JvCtrlsD9R;JvDlgsD9R;JvDockingD9R;JvDotNetCtrlsD9R;JvEDID9R;JvGlobusD9R;JvHMID9R;JvInspectorD9R;JvInterpreterD9R;JvJansD9R;JvManagedThreadsD9R;JvMMD9R;JvNetD9R;JvPageCompsD9R;JvPluginD9R;JvPrintPreviewD9R;JvTimeFrameworkD9R;JvUIBD9R;JvValidatorsD9R;JvWizardD9R;JvXPCtrlsD9R</Directories>
-			<Directories Name="Conditionals"></Directories>
-			<Directories Name="DebugSourceDirs"></Directories>
-			<Directories Name="UsePackages">False</Directories>
-		</Directories>
-		<Parameters>
-			<Parameters Name="RunParams">testproject</Parameters>
-			<Parameters Name="HostApplication"></Parameters>
-			<Parameters Name="Launcher"></Parameters>
-			<Parameters Name="UseLauncher">False</Parameters>
-			<Parameters Name="DebugCWD"></Parameters>
-			<Parameters Name="RemoteHost"></Parameters>
-			<Parameters Name="RemotePath"></Parameters>
-			<Parameters Name="RemoteLauncher"></Parameters>
-			<Parameters Name="RemoteCWD"></Parameters>
-			<Parameters Name="RemoteDebug">False</Parameters>
-			<Parameters Name="Debug Symbols Search Path"></Parameters>
-			<Parameters Name="LoadAllSymbols">True</Parameters>
-			<Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
-		</Parameters>
-		<VersionInfo>
-			<VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-			<VersionInfo Name="AutoIncBuild">True</VersionInfo>
-			<VersionInfo Name="MajorVer">1</VersionInfo>
-			<VersionInfo Name="MinorVer">1</VersionInfo>
-			<VersionInfo Name="Release">0</VersionInfo>
-			<VersionInfo Name="Build">51</VersionInfo>
-			<VersionInfo Name="Debug">False</VersionInfo>
-			<VersionInfo Name="PreRelease">False</VersionInfo>
-			<VersionInfo Name="Special">False</VersionInfo>
-			<VersionInfo Name="Private">False</VersionInfo>
-			<VersionInfo Name="DLL">False</VersionInfo>
-			<VersionInfo Name="Locale">1033</VersionInfo>
-			<VersionInfo Name="CodePage">1252</VersionInfo>
-		</VersionInfo>
-		<VersionInfoKeys>
-			<VersionInfoKeys Name="FileVersion">1.1.0.50</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys>
-			<VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys>
-			<VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-			<VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys>
-			<VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys>
-		</VersionInfoKeys>
-		<Language>
-			<Language Name="ActiveLang"></Language>
-			<Language Name="ProjectLang">$00000000</Language>
-			<Language Name="RootDir"></Language>
-		</Language>  <Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
-      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
-      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclIntraweb_80_100.bpl">Intraweb 8.0 Design Package for Borland Development Studio 2006</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclsoap100.bpl">Borland SOAP Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\bcbie100.bpl">Borland C++Builder Internet Explorer 5 Components Package</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcltee100.bpl">TeeChart Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcldbxcds100.bpl">Borland SimpleDataset Component (DBX)</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclie100.bpl">Internet Explorer Components</Excluded_Packages>
-    </Excluded_Packages>
-  </Delphi.Personality>
-</BorlandProject>

Deleted: utilities/dzPrepBuild/trunk/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dpr	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/PrepBuild.dpr	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,19 +0,0 @@
-program PrepBuild;
-
-{$APPTYPE CONSOLE}
-
-uses
-  SysUtils,
-  oxmldom,
-  u_IncBuildNoMain in 'u_IncBuildNoMain.pas',
-  d_BdsProjVersionInfo in 'd_BdsProjVersionInfo.pas' {dm_BdsProjVersionInfo: TDataModule},
-  i_VersionInfo in 'i_VersionInfo.pas',
-  u_DofVersionInfo in 'u_DofVersionInfo.pas',
-  u_IniVersionInfo in 'u_IniVersionInfo.pas',
-  u_CentralIniVersionInfo in 'u_CentralIniVersionInfo.pas';
-
-{$R *.res}
-
-begin
-  Main;
-end.

Deleted: utilities/dzPrepBuild/trunk/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,58 +0,0 @@
-?<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
-  <PropertyGroup>
-    <ProjectGuid>{209412ac-0ec2-4f63-b92a-e78853ff142a}</ProjectGuid>
-    <MainSource>PrepBuild.dpr</MainSource>
-    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
-    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
-    <DCC_DCCCompiler>DCC32</DCC_DCCCompiler>
-    <DCC_DependencyCheckOutputName>PrepBuild.exe</DCC_DependencyCheckOutputName>
-  </PropertyGroup>
-  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
-    <Version>7.0</Version>
-    <DCC_DebugInformation>False</DCC_DebugInformation>
-    <DCC_LocalDebugSymbols>False</DCC_LocalDebugSymbols>
-    <DCC_SymbolReferenceInfo>0</DCC_SymbolReferenceInfo>
-    <DCC_DcuOutput>dcu</DCC_DcuOutput>
-    <DCC_ObjOutput>dcu</DCC_ObjOutput>
-    <DCC_HppOutput>dcu</DCC_HppOutput>
-    <DCC_Define>RELEASE</DCC_Define>
-  </PropertyGroup>
-  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
-    <Version>7.0</Version>
-    <DCC_DcuOutput>dcu</DCC_DcuOutput>
-    <DCC_ObjOutput>dcu</DCC_ObjOutput>
-    <DCC_HppOutput>dcu</DCC_HppOutput>
-    <DCC_Define>DEBUG</DCC_Define>
-  </PropertyGroup>
-  <ProjectExtensions>
-    <Borland.Personality>Delphi.Personality</Borland.Personality>
-    <Borland.ProjectType />
-    <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">52</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKeys><Versio!
 nInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
-      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
-      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclIntraweb_80_100.bpl">Intraweb 8.0 Design Package for Borland Development Studio 2006</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclsoap100.bpl">Borland SOAP Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\bcbie100.bpl">Borland C++Builder Internet Explorer 5 Components Package</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcltee100.bpl">TeeChart Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcldbxcds100.bpl">Borland SimpleDataset Component (DBX)</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclie100.bpl">Internet Explorer Components</Excluded_Packages>
-    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source></Delphi.Personality></BorlandProject></BorlandProject>
-  </ProjectExtensions>
-  <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
-  <ItemGroup>
-    <DelphiCompile Include="PrepBuild.dpr">
-      <MainSource>MainSource</MainSource>
-    </DelphiCompile>
-    <DCCReference Include="d_BdsProjVersionInfo.pas">
-      <Form>dm_BdsProjVersionInfo</Form>
-    </DCCReference>
-    <DCCReference Include="i_VersionInfo.pas" />
-    <DCCReference Include="u_CentralIniVersionInfo.pas" />
-    <DCCReference Include="u_DofVersionInfo.pas" />
-    <DCCReference Include="u_IncBuildNoMain.pas" />
-    <DCCReference Include="u_IniVersionInfo.pas" />
-  </ItemGroup>
-</Project>
\ No newline at end of file

Deleted: utilities/dzPrepBuild/trunk/Testproject.bdsproj
===================================================================
--- utilities/dzPrepBuild/trunk/Testproject.bdsproj	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/Testproject.bdsproj	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,180 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<BorlandProject>
-	<PersonalityInfo>
-		<Option>
-			<Option Name="Personality">Delphi.Personality</Option>
-			<Option Name="ProjectType"></Option>
-			<Option Name="Version">1.0</Option>
-			<Option Name="GUID">{209412AC-0EC2-4F63-B92A-E78853FF142A}</Option>
-		</Option>
-	</PersonalityInfo>
-	<Delphi.Personality>
-		<Source>
-			<Source Name="MainSource">IncBuildNo.dpr</Source>
-		</Source>
-		<FileVersion>
-			<FileVersion Name="Version">7.0</FileVersion>
-		</FileVersion>
-		<Compiler>
-			<Compiler Name="A">8</Compiler>
-			<Compiler Name="B">0</Compiler>
-			<Compiler Name="C">1</Compiler>
-			<Compiler Name="D">0</Compiler>
-			<Compiler Name="E">0</Compiler>
-			<Compiler Name="F">0</Compiler>
-			<Compiler Name="G">1</Compiler>
-			<Compiler Name="H">1</Compiler>
-			<Compiler Name="I">1</Compiler>
-			<Compiler Name="J">0</Compiler>
-			<Compiler Name="K">0</Compiler>
-			<Compiler Name="L">1</Compiler>
-			<Compiler Name="M">0</Compiler>
-			<Compiler Name="N">1</Compiler>
-			<Compiler Name="O">1</Compiler>
-			<Compiler Name="P">1</Compiler>
-			<Compiler Name="Q">0</Compiler>
-			<Compiler Name="R">0</Compiler>
-			<Compiler Name="S">0</Compiler>
-			<Compiler Name="T">0</Compiler>
-			<Compiler Name="U">0</Compiler>
-			<Compiler Name="V">1</Compiler>
-			<Compiler Name="W">0</Compiler>
-			<Compiler Name="X">1</Compiler>
-			<Compiler Name="Y">1</Compiler>
-			<Compiler Name="Z">1</Compiler>
-			<Compiler Name="ShowHints">True</Compiler>
-			<Compiler Name="ShowWarnings">True</Compiler>
-			<Compiler Name="UnitAliases">WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;</Compiler>
-			<Compiler Name="NamespacePrefix"></Compiler>
-			<Compiler Name="GenerateDocumentation">False</Compiler>
-			<Compiler Name="DefaultNamespace"></Compiler>
-			<Compiler Name="SymbolDeprecated">True</Compiler>
-			<Compiler Name="SymbolLibrary">True</Compiler>
-			<Compiler Name="SymbolPlatform">True</Compiler>
-			<Compiler Name="SymbolExperimental">True</Compiler>
-			<Compiler Name="UnitLibrary">True</Compiler>
-			<Compiler Name="UnitPlatform">True</Compiler>
-			<Compiler Name="UnitDeprecated">True</Compiler>
-			<Compiler Name="UnitExperimental">True</Compiler>
-			<Compiler Name="HResultCompat">True</Compiler>
-			<Compiler Name="HidingMember">True</Compiler>
-			<Compiler Name="HiddenVirtual">True</Compiler>
-			<Compiler Name="Garbage">True</Compiler>
-			<Compiler Name="BoundsError">True</Compiler>
-			<Compiler Name="ZeroNilCompat">True</Compiler>
-			<Compiler Name="StringConstTruncated">True</Compiler>
-			<Compiler Name="ForLoopVarVarPar">True</Compiler>
-			<Compiler Name="TypedConstVarPar">True</Compiler>
-			<Compiler Name="AsgToTypedConst">True</Compiler>
-			<Compiler Name="CaseLabelRange">True</Compiler>
-			<Compiler Name="ForVariable">True</Compiler>
-			<Compiler Name="ConstructingAbstract">True</Compiler>
-			<Compiler Name="ComparisonFalse">True</Compiler>
-			<Compiler Name="ComparisonTrue">True</Compiler>
-			<Compiler Name="ComparingSignedUnsigned">True</Compiler>
-			<Compiler Name="CombiningSignedUnsigned">True</Compiler>
-			<Compiler Name="UnsupportedConstruct">True</Compiler>
-			<Compiler Name="FileOpen">True</Compiler>
-			<Compiler Name="FileOpenUnitSrc">True</Compiler>
-			<Compiler Name="BadGlobalSymbol">True</Compiler>
-			<Compiler Name="DuplicateConstructorDestructor">True</Compiler>
-			<Compiler Name="InvalidDirective">True</Compiler>
-			<Compiler Name="PackageNoLink">True</Compiler>
-			<Compiler Name="PackageThreadVar">True</Compiler>
-			<Compiler Name="ImplicitImport">True</Compiler>
-			<Compiler Name="HPPEMITIgnored">True</Compiler>
-			<Compiler Name="NoRetVal">True</Compiler>
-			<Compiler Name="UseBeforeDef">True</Compiler>
-			<Compiler Name="ForLoopVarUndef">True</Compiler>
-			<Compiler Name="UnitNameMismatch">True</Compiler>
-			<Compiler Name="NoCFGFileFound">True</Compiler>
-			<Compiler Name="MessageDirective">True</Compiler>
-			<Compiler Name="ImplicitVariants">True</Compiler>
-			<Compiler Name="UnicodeToLocale">True</Compiler>
-			<Compiler Name="LocaleToUnicode">True</Compiler>
-			<Compiler Name="ImagebaseMultiple">True</Compiler>
-			<Compiler Name="SuspiciousTypecast">True</Compiler>
-			<Compiler Name="PrivatePropAccessor">True</Compiler>
-			<Compiler Name="UnsafeType">False</Compiler>
-			<Compiler Name="UnsafeCode">False</Compiler>
-			<Compiler Name="UnsafeCast">False</Compiler>
-			<Compiler Name="OptionTruncated">True</Compiler>
-			<Compiler Name="WideCharReduced">True</Compiler>
-			<Compiler Name="DuplicatesIgnored">True</Compiler>
-			<Compiler Name="UnitInitSeq">True</Compiler>
-			<Compiler Name="LocalPInvoke">True</Compiler>
-			<Compiler Name="CodePage"></Compiler>
-		</Compiler>
-		<Linker>
-			<Linker Name="MapFile">0</Linker>
-			<Linker Name="OutputObjs">0</Linker>
-			<Linker Name="ConsoleApp">1</Linker>
-			<Linker Name="DebugInfo">False</Linker>
-			<Linker Name="RemoteSymbols">False</Linker>
-			<Linker Name="GenerateDRC">False</Linker>
-			<Linker Name="MinStackSize">16384</Linker>
-			<Linker Name="MaxStackSize">1048576</Linker>
-			<Linker Name="ImageBase">4194304</Linker>
-			<Linker Name="ExeDescription"></Linker>
-			<Linker Name="GenerateHpps">False</Linker>
-		</Linker>
-		<Directories>
-			<Directories Name="OutputDir"></Directories>
-			<Directories Name="UnitOutputDir"></Directories>
-			<Directories Name="PackageDLLOutputDir"></Directories>
-			<Directories Name="PackageDCPOutputDir"></Directories>
-			<Directories Name="SearchPath"></Directories>
-			<Directories Name="Packages">rtl;vcl;vcldb;dbrtl;vclx;dbxcds;dbexpress;IndySystem;IndyCore;VclSmp;IndyProtocols;dsnap;adortl;vclactnband;vclshlctrls;JvCustomD9R;JvSystemD9R;JvCoreD9R;DJcl;JvStdCtrlsD9R;dzConfigd9;PerlRegExD2005;SynEdit_R2005;SynUni_D2005;JvAppFrmD9R;JvBandsD9R;JvBDED9R;JvCmpD9R;JvCryptD9R;JvCtrlsD9R;JvDlgsD9R;JvDockingD9R;JvDotNetCtrlsD9R;JvEDID9R;JvGlobusD9R;JvHMID9R;JvInspectorD9R;JvInterpreterD9R;JvJansD9R;JvManagedThreadsD9R;JvMMD9R;JvNetD9R;JvPageCompsD9R;JvPluginD9R;JvPrintPreviewD9R;JvTimeFrameworkD9R;JvUIBD9R;JvValidatorsD9R;JvWizardD9R;JvXPCtrlsD9R</Directories>
-			<Directories Name="Conditionals"></Directories>
-			<Directories Name="DebugSourceDirs"></Directories>
-			<Directories Name="UsePackages">False</Directories>
-		</Directories>
-		<Parameters>
-			<Parameters Name="RunParams"></Parameters>
-			<Parameters Name="HostApplication"></Parameters>
-			<Parameters Name="Launcher"></Parameters>
-			<Parameters Name="UseLauncher">False</Parameters>
-			<Parameters Name="DebugCWD"></Parameters>
-			<Parameters Name="RemoteHost"></Parameters>
-			<Parameters Name="RemotePath"></Parameters>
-			<Parameters Name="RemoteLauncher"></Parameters>
-			<Parameters Name="RemoteCWD"></Parameters>
-			<Parameters Name="RemoteDebug">False</Parameters>
-			<Parameters Name="Debug Symbols Search Path"></Parameters>
-			<Parameters Name="LoadAllSymbols">True</Parameters>
-			<Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
-		</Parameters>
-		<VersionInfo>
-			<VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-			<VersionInfo Name="AutoIncBuild">True</VersionInfo>
-			<VersionInfo Name="MajorVer">1</VersionInfo>
-			<VersionInfo Name="MinorVer">0</VersionInfo>
-			<VersionInfo Name="Release">0</VersionInfo>
-			<VersionInfo Name="Build">22</VersionInfo>
-			<VersionInfo Name="Debug">False</VersionInfo>
-			<VersionInfo Name="PreRelease">False</VersionInfo>
-			<VersionInfo Name="Special">False</VersionInfo>
-			<VersionInfo Name="Private">False</VersionInfo>
-			<VersionInfo Name="DLL">False</VersionInfo>
-			<VersionInfo Name="Locale">1033</VersionInfo>
-			<VersionInfo Name="CodePage">1252</VersionInfo>
-		</VersionInfo>
-		<VersionInfoKeys>
-			<VersionInfoKeys Name="FileVersion">1.0.0.21</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="CompanyName">iCD. GmbH</VersionInfoKeys>
-			<VersionInfoKeys Name="FileDescription">Dof2Rc Tool</VersionInfoKeys>
-			<VersionInfoKeys Name="InternalName">dof2rc</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalCopyright">Copyright 2002-2005 by iCD. GmbH</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-			<VersionInfoKeys Name="OriginalFilename">dof2rc.exe</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductName">Dof2Rc</VersionInfoKeys>
-			<VersionInfoKeys Name="Comments">internal use only</VersionInfoKeys>
-		</VersionInfoKeys>
-		<Language>
-			<Language Name="ActiveLang"></Language>
-			<Language Name="ProjectLang">$00000000</Language>
-			<Language Name="RootDir"></Language>
-		</Language>
-	</Delphi.Personality>
-</BorlandProject>

Deleted: utilities/dzPrepBuild/trunk/Testproject.dof
===================================================================
--- utilities/dzPrepBuild/trunk/Testproject.dof	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/Testproject.dof	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,204 +0,0 @@
-[FileVersion]
-Version=7.0
-
-[Compiler]
-A=8
-B=0
-C=1
-D=1
-E=0
-F=0
-G=1
-H=1
-I=1
-J=0
-K=0
-L=1
-M=0
-N=1
-O=1
-P=1
-Q=0
-R=0
-S=0
-T=0
-U=0
-V=1
-W=0
-X=1
-Y=1
-Z=1
-ShowHints=1
-ShowWarnings=1
-UnitAliases=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
-NamespacePrefix=
-SymbolDeprecated=1
-SymbolLibrary=1
-SymbolPlatform=0
-UnitLibrary=1
-UnitPlatform=0
-UnitDeprecated=1
-HResultCompat=1
-HidingMember=1
-HiddenVirtual=1
-Garbage=1
-BoundsError=1
-ZeroNilCompat=1
-StringConstTruncated=1
-ForLoopVarVarPar=1
-TypedConstVarPar=1
-AsgToTypedConst=1
-CaseLabelRange=1
-ForVariable=1
-ConstructingAbstract=1
-ComparisonFalse=1
-ComparisonTrue=1
-ComparingSignedUnsigned=1
-CombiningSignedUnsigned=1
-UnsupportedConstruct=1
-FileOpen=1
-FileOpenUnitSrc=1
-BadGlobalSymbol=1
-DuplicateConstructorDestructor=1
-InvalidDirective=1
-PackageNoLink=1
-PackageThreadVar=1
-ImplicitImport=1
-HPPEMITIgnored=1
-NoRetVal=1
-UseBeforeDef=1
-ForLoopVarUndef=1
-UnitNameMismatch=1
-NoCFGFileFound=1
-MessageDirective=1
-ImplicitVariants=1
-UnicodeToLocale=1
-LocaleToUnicode=1
-ImagebaseMultiple=1
-SuspiciousTypecast=1
-PrivatePropAccessor=1
-UnsafeType=0
-UnsafeCode=0
-UnsafeCast=0
-
-[Linker]
-MapFile=0
-OutputObjs=0
-ConsoleApp=1
-DebugInfo=0
-RemoteSymbols=0
-MinStackSize=16384
-MaxStackSize=1048576
-ImageBase=4194304
-ExeDescription=
-
-[Directories]
-OutputDir=q:\Dof2Rc
-UnitOutputDir=q:\Dof2Rc\dcu
-PackageDLLOutputDir=
-PackageDCPOutputDir=
-SearchPath=.\libs\headwork\units;.\libs\3rd\tregexpr\source
-Packages=vcl;rtl;vclx;vclshlctrls;visualclx;indy
-Conditionals=englisch;debug
-DebugSourceDirs=
-UsePackages=0
-
-[Parameters]
-RunParams=--comment="internal use only" --product="%s DEMO" --build s:\utils\dof2rc\Dof2Rc.dpr
-HostApplication=
-Launcher=
-UseLauncher=0
-DebugCWD=
-
-[Version Info]
-IncludeVerInfo=1
-AutoIncBuild=1
-MajorVer=1
-MinorVer=0
-Release=0
-Build=22
-Debug=0
-PreRelease=0
-Special=0
-Private=0
-DLL=0
-Locale=1033
-CodePage=1252
-
-[Version Info Keys]
-CompanyName=iCD. GmbH
-FileDescription=Dof2Rc Tool
-FileVersion=1.0.0.21
-InternalName=dof2rc
-LegalCopyright=Copyright 2002-2005 by iCD. GmbH
-LegalTrademarks=
-OriginalFilename=dof2rc.exe
-ProductName=Dof2Rc
-ProductVersion=1.0.0.0
-Comments=internal use only
-
-[Excluded Packages]
-q:\bpl\UnicodeConvDelphi7.bpl=Unicode Converter Library (UCL)
-c:\program files\borland\delphi7\Bin\dclite70.bpl=Borland Integrated Translation Environment
-c:\program files\borland\delphi7\Bin\dclnet70.bpl=Borland Internet Components
-c:\program files\borland\delphi7\Bin\dclsoap70.bpl=Borland SOAP Components
-c:\program files\borland\delphi7\Bin\dclocx70.bpl=Borland Sample Imported ActiveX Controls
-c:\program files\borland\delphi7\Bin\dcldbx70.bpl=Borland dbExpress Components
-c:\program files\borland\delphi7\Bin\dcldbxcds70.bpl=Borland SimpleDataset Component (DBX)
-c:\program files\borland\delphi7\Bin\DBWEBXPRT.BPL=Borland Web Wizard Package
-c:\program files\borland\delphi7\Bin\dclie70.bpl=Internet Explorer Components
-c:\program files\borland\delphi7\Bin\dclbde70.bpl=Borland BDE DB Components
-c:\program files\borland\delphi7\Bin\dcltee70.bpl=TeeChart Components
-c:\program files\borland\delphi7\Bin\dclib70.bpl=InterBase Data Access Components
-c:\program files\borland\delphi7\Bin\dclclxdb70.bpl=Borland CLX Database Components
-c:\program files\borland\delphi7\Bin\dclclxstd70.bpl=Borland CLX Standard Components
-c:\program files\borland\delphi7\Bin\dclmid70.bpl=Borland MyBase DataAccess Components
-C:\WINNT\System32\ibevnt70.bpl=Borland Interbase Event Alerter Component
-c:\program files\borland\delphi7\Bin\dclIntraweb_50_70.bpl=Intraweb 5.0 Design Package for Delphi 7
-Q:\bpl\CompBAR7.bpl=Component Bar Expert 1.0.2
-Q:\bpl\dcldummzeuchchart.bpl=dummzeuch.de Charts - designtime package
-Q:\bpl\dclrxbd7.bpl=RX Library BDE Database Components
-Q:\bpl\olectra.bpl=Olectra Chart Components (Active X)
-Q:\bpl\dclRBC77.bpl=ReportBuilder TeeChart 4.04 Components
-c:\program files\borland\delphi7\bin\dclRave70.bpl=Rave Reports BE 5.0 Package
-c:\program files\borland\delphi7\Bin\dclaxserver70.bpl=Microsoft Office 97 Sample Automation Server Wrapper Components
-Q:\bpl\JclDebugIde70.bpl=JCL Debug IDE extension for Delphi 7
-C:\Program Files\Castalia Free for Delphi\JacobsLadder7.bpl=Castalia for Delphi 7
-C:\Program Files\CompDiff\Delphi7\CompDiff.bpl=Component Diff Tool for Delphi
-C:\Program Files\Castalia for Delphi Trial\LadderFlyout7.bpl=Castalia Flyout Bar for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderForms7.bpl=Castalia Form Designer for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderStat7.bpl=Castalia Statistics for Delphi 7
-
-[HistoryLists\hlConditionals]
-Count=2
-Item0=englisch;debug
-Item1=englisch
-
-[HistoryLists\hlUnitAliases]
-Count=1
-Item0=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
-
-[HistoryLists\hlSearchPath]
-Count=9
-Item0=.\libs\headwork\units;.\libs\3rd\tregexpr\source
-Item1=.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item2=S:\3rd\xml\ucl;.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item3=S:\3rd\xml\ucl;libs\headwork\units;.\libs\3rd\regexpr\source
-Item4=S:\3rd\xml\ucl;.\libs\headwork;.\libs\3rd\regexpr\source
-Item5=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork
-Item6=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork\components
-Item7=S:\3rd\regexpr;S:\3rd\xml\ucl
-Item8=S:\3rd\regexpr
-
-[HistoryLists\hlUnitOutputDirectory]
-Count=3
-Item0=q:\Dof2Rc\dcu
-Item1=Q:\test\dcu
-Item2=Q:\
-
-[HistoryLists\hlOutputDirectorry]
-Count=3
-Item0=q:\Dof2Rc
-Item1=Q:\test
-Item2=Q:\
-

Deleted: utilities/dzPrepBuild/trunk/copyback.cmd
===================================================================
--- utilities/dzPrepBuild/trunk/copyback.cmd	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/copyback.cmd	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,2 +0,0 @@
-copy OriginalTestproject.dof Testproject.dof
-copy OriginalTestproject.bdsproj Testproject.bdsproj

Deleted: utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.dfm
===================================================================
--- utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.dfm	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.dfm	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,13 +0,0 @@
-object dm_BdsProjVersionInfo: Tdm_BdsProjVersionInfo
-  OldCreateOrder = False
-  Left = 400
-  Top = 48
-  Height = 150
-  Width = 215
-  object ProjDoc: TXMLDocument
-    FileName = 'D:\source\incbuildno\test.bdsproj'
-    Left = 64
-    Top = 40
-    DOMVendorDesc = 'MSXML'
-  end
-end

Deleted: utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,374 +0,0 @@
-unit d_BdsProjVersionInfo;
-
-interface
-
-uses
-  Windows,
-  SysUtils,
-  Classes,
-  xmldom,
-  XMLIntf,
-  msxmldom,
-  XMLDoc,
-  i_VersionInfo;
-
-type
-  Tdm_BdsProjVersionInfo = class(TDataModule, IVersionInfo)
-    ProjDoc: TXMLDocument;
-  private
-    function GetChildNodeContent(_Parent: IXMLNode; const _NodeName, _AttrName: string): string;
-    function GetVersionInfo(const _Name: string): string;
-    function GetVersionInfoKey(const _Name: string): string;
-    procedure SetChildNodeContent(_Parent: IXMLNode; const _NodeName, _AttrName, _Value: string);
-    procedure SetVersionInfo(const _Name, _Value: string);
-    procedure SetVersionInfoKey(const _Name, _Value: string);
-  protected // IInterface
-    FRefCount: integer;
-    function QueryInterface(const IID: TGUID; out Obj): HResult; override; stdcall;
-    function _AddRef: integer; stdcall;
-    function _Release: integer; stdcall;
-  protected
-  protected // implementation of IVersionInfo
-    function GetBuild: integer;
-    procedure SetBuild(_Build: integer);
-    function GetMajorVer: integer;
-    procedure SetMajorVer(_MajorVer: integer);
-    function GetMinorVer: integer;
-    procedure SetMinorVer(_MinorVer: integer);
-    function GetRelease: integer;
-    procedure SetRelease(_Release: integer);
-    function GetCompanyName: string;
-    procedure SetCompanyName(_CompanyName: string);
-    function GetFileDescription: string;
-    procedure SetFileDescription(_FileDescription: string);
-    function GetFileVersion: string;
-    procedure SetFileVersion(_FileVersion: string);
-    function GetInternalName: string;
-    procedure SetInternalName(_InternalName: string);
-    function GetLegalCopyright: string;
-    procedure SetLegalCopyright(_LegalCopyright: string);
-    function GetLegalTrademarks: string;
-    procedure SetLegalTrademarks(_LegalTrademarks: string);
-    function GetOriginalFilename: string;
-    procedure SetOriginalFilename(_OriginalFilename: string);
-    function GetProductName: string;
-    procedure SetProductName(_ProductName: string);
-    function GetProductVersion: string;
-    procedure SetProductVersion(_ProductVersion: string);
-    function GetAutoIncBuild: boolean;
-    procedure SetAutoIncBuild(_AutoIncBuild: boolean);
-    function GetComments: string;
-    procedure SetComments(const _Comments: string);
-  //
-    procedure Assign(const _VersionInfo: IVersionInfo); reintroduce;
-    procedure UpdateFile;
-  //
-    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
-    property Build: integer read GetBuild write SetBuild;
-    property Comments: string read GetComments write SetComments;
-    property CompanyName: string read GetCompanyName write SetCompanyName;
-    property FileDescription: string read GetFileDescription write SetFileDescription;
-    property FileVersion: string read GetFileVersion write SetFileVersion;
-    property InternalName: string read GetInternalName write SetInternalName;
-    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
-    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
-    property MajorVer: integer read GetMajorVer write SetMajorVer;
-    property MinorVer: integer read GetMinorVer write SetMinorVer;
-    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
-    property ProductName: string read GetProductName write SetProductName;
-    property ProductVersion: string read GetProductVersion write SetProductVersion;
-    property Release: integer read GetRelease write SetRelease;
-  protected
-    FBdsProjFile: string;
-    FVersionInfo: IXMLNode;
-    FVersionInfoKeys: IXMLNode;
-  public
-    constructor Create(const _Project: string); reintroduce;
-    destructor Destroy; override;
-  end;
-
-implementation
-
-{$R *.dfm}
-
-{ Tdm_BdsProjVersionInfo }
-
-procedure Tdm_BdsProjVersionInfo.Assign(const _VersionInfo: IVersionInfo);
-begin
-  AutoIncBuild := _VersionInfo.AutoIncBuild;
-  Build := _VersionInfo.Build;
-  Comments := _VersionInfo.Comments;
-  CompanyName := _VersionInfo.CompanyName;
-  FileDescription := _VersionInfo.FileDescription;
-  FileVersion := _VersionInfo.FileVersion;
-  InternalName := _VersionInfo.InternalName;
-  LegalCopyright := _VersionInfo.LegalCopyright;
-  LegalTrademarks := _VersionInfo.LegalTrademarks;
-  MajorVer := _VersionInfo.MajorVer;
-  MinorVer := _VersionInfo.MinorVer;
-  OriginalFilename := _VersionInfo.OriginalFilename;
-  ProductName := _VersionInfo.ProductName;
-  ProductVersion := _VersionInfo.ProductVersion;
-  Release := _VersionInfo.Release;
-end;
-
-function Tdm_BdsProjVersionInfo.GetChildNodeContent(_Parent: IXMLNode; const _NodeName, _AttrName: string): string;
-var
-  Node: IXMLNode;
-begin
-  // <VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-  Node := _Parent.ChildNodes.First;
-  while Assigned(Node) do begin
-    if Node.nodeName = _NodeName then begin
-      if SameText(Node.Attributes['Name'], _AttrName) then begin
-        Result := Node.Text;
-        exit;
-      end;
-    end;
-    Node := Node.nextSibling;
-  end;
-end;
-
-function Tdm_BdsProjVersionInfo.GetVersionInfo(const _Name: string): string;
-begin
-  Result := GetChildNodeContent(FVersionInfo, 'VersionInfo', _Name);
-end;
-
-function Tdm_BdsProjVersionInfo.GetVersionInfoKey(const _Name: string): string;
-begin
-  Result := GetChildNodeContent(FVersionInfoKeys, 'VersionInfoKeys', _Name);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetChildNodeContent(_Parent: IXMLNode; const _NodeName, _AttrName, _Value: string);
-var
-  Node: IXMLNode;
-begin
-  // <*NodeName* Name="*AttrName*">*Value*</VersionInfo>
-  Node := _Parent.ChildNodes.First;
-  while Assigned(Node) do begin
-    if Node.nodeName = _NodeName then begin
-      if SameText(Node.Attributes['Name'], _AttrName) then begin
-        Node.Text := _Value;
-        exit;
-      end;
-    end;
-    Node := Node.nextSibling;
-  end;
-end;
-
-constructor Tdm_BdsProjVersionInfo.Create(const _Project: string);
-var
-  BorlandProject: IXMLNode;
-  DelphiPersonality: IXMLNode;
-begin
-  inherited Create(nil);
-  FBdsProjFile := _Project + '.bdsproj';
-  ProjDoc.FileName := FBdsProjFile;
-  ProjDoc.Active := True;
-  BorlandProject := ProjDoc.DocumentElement;
-  DelphiPersonality := BorlandProject.childNodes['Delphi.Personality'];
-  FVersionInfo := DelphiPersonality.childNodes['VersionInfo'];
-  FVersionInfoKeys := DelphiPersonality.childNodes['VersionInfoKeys'];
-
-  if not SameText(GetChildNodeContent(FVersionInfo, 'VersionInfo', 'IncludeVerInfo'), 'True') then
-    raise ENoVersionInfo.Create('.bdsproj file does not contain version information');
-end;
-
-destructor Tdm_BdsProjVersionInfo.Destroy;
-begin
-  FVersionInfo := nil;
-  inherited;
-end;
-
-function Tdm_BdsProjVersionInfo.GetAutoIncBuild: boolean;
-begin
-  Result := SameText(GetVersionInfo('AutoIncBuild'), 'True');
-end;
-
-function Tdm_BdsProjVersionInfo.GetBuild: integer;
-begin
-  Result := StrToIntDef(GetVersionInfo('Build'), 0);
-end;
-
-function Tdm_BdsProjVersionInfo.GetComments: string;
-begin
-  Result := GetVersionInfoKey('Comments');
-end;
-
-function Tdm_BdsProjVersionInfo.GetCompanyName: string;
-begin
-  Result := GetVersionInfoKey('CompanyName');
-end;
-
-function Tdm_BdsProjVersionInfo.GetFileDescription: string;
-begin
-  Result := GetVersionInfoKey('FileDescription');
-end;
-
-function Tdm_BdsProjVersionInfo.GetFileVersion: string;
-begin
-  Result := GetVersionInfoKey('FileVersion');
-end;
-
-function Tdm_BdsProjVersionInfo.GetInternalName: string;
-begin
-  Result := GetVersionInfoKey('InternalName');
-end;
-
-function Tdm_BdsProjVersionInfo.GetLegalCopyright: string;
-begin
-  Result := GetVersionInfoKey('LegalCopyright');
-end;
-
-function Tdm_BdsProjVersionInfo.GetLegalTrademarks: string;
-begin
-  Result := GetVersionInfoKey('LegalTrademarks');
-end;
-
-function Tdm_BdsProjVersionInfo.GetMajorVer: integer;
-begin
-  Result := StrToIntDef(GetVersionInfo('MajorVer'), 0);
-end;
-
-function Tdm_BdsProjVersionInfo.GetMinorVer: integer;
-begin
-  Result := StrToIntDef(GetVersionInfo('MinorVer'), 0);
-end;
-
-function Tdm_BdsProjVersionInfo.GetOriginalFilename: string;
-begin
-  Result := GetVersionInfoKey('OriginalFilename');
-end;
-
-function Tdm_BdsProjVersionInfo.GetProductName: string;
-begin
-  Result := GetVersionInfoKey('ProductName');
-end;
-
-function Tdm_BdsProjVersionInfo.GetProductVersion: string;
-begin
-  Result := GetVersionInfoKey('ProductVersion');
-end;
-
-function Tdm_BdsProjVersionInfo.GetRelease: integer;
-begin
-  Result := StrToIntDef(GetVersionInfo('Release'), 0);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
-begin
-  if _AutoIncBuild then
-    SetVersionInfo('AutoIncBuild', 'True')
-  else
-    SetVersionInfo('AutoIncBuild', 'Frue')
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetBuild(_Build: integer);
-begin
-  SetVersionInfo('Build', IntToStr(_Build));
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetComments(const _Comments: string);
-begin
-  SetVersionInfoKey('Comments', _Comments);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetCompanyName(_CompanyName: string);
-begin
-  SetVersionInfoKey('CompanyName', _CompanyName);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetFileDescription(_FileDescription: string);
-begin
-  SetVersionInfoKey('FileDescription', _FileDescription);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetFileVersion(_FileVersion: string);
-begin
-  SetVersionInfoKey('FileVersion', _FileVersion);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetInternalName(_InternalName: string);
-begin
-  SetVersionInfoKey('InternalName', _InternalName);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetLegalCopyright(_LegalCopyright: string);
-begin
-  SetVersionInfoKey('LegalCopyright', _LegalCopyright);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
-begin
-  SetVersionInfoKey('LegalTrademarks', _LegalTrademarks);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetMajorVer(_MajorVer: integer);
-begin
-  SetVersionInfo('MajorVer', IntToStr(_MajorVer));
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetMinorVer(_MinorVer: integer);
-begin
-  SetVersionInfo('MinorVer', IntToStr(_MinorVer));
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetOriginalFilename(_OriginalFilename: string);
-begin
-  SetVersionInfoKey('OriginalFilename', _OriginalFilename);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetProductName(_ProductName: string);
-begin
-  SetVersionInfoKey('ProductName', _ProductName);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetProductVersion(_ProductVersion: string);
-begin
-  SetVersionInfoKey('ProductVersion', _ProductVersion);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetRelease(_Release: integer);
-begin
-  SetVersionInfo('Release', IntToStr(_Release));
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetVersionInfo(const _Name, _Value: string);
-begin
-  SetChildNodeContent(FVersionInfo, 'VersionInfo', _Name, _Value);
-end;
-
-procedure Tdm_BdsProjVersionInfo.SetVersionInfoKey(const _Name, _Value: string);
-begin
-  SetChildNodeContent(FVersionInfoKeys, 'VersionInfoKeys', _Name, _Value);
-end;
-
-procedure Tdm_BdsProjVersionInfo.UpdateFile;
-begin
-  ProjDoc.SaveToFile(FBdsProjFile);
-end;
-
-// standard TInterfacedObject implementation of IInterface
-
-function Tdm_BdsProjVersionInfo.QueryInterface(const IID: TGUID; out Obj): HResult;
-begin
-  if GetInterface(IID, Obj) then
-    Result := S_OK
-  else
-    Result := E_NOINTERFACE
-end;
-
-function Tdm_BdsProjVersionInfo._AddRef: integer;
-begin
-  Result := InterlockedIncrement(FRefCount);
-end;
-
-function Tdm_BdsProjVersionInfo._Release: integer;
-begin
-  Result := InterlockedDecrement(FRefCount);
-  if Result = 0 then
-    Destroy;
-end;
-
-end.
-

Deleted: utilities/dzPrepBuild/trunk/i_VersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/i_VersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/i_VersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,67 +0,0 @@
-unit i_VersionInfo;
-
-interface
-
-uses
-  SysUtils;
-
-type
-  ENoVersionInfo = class(Exception);
-
-type
-  IVersionInfo = interface
-    function GetBuild: integer;
-    procedure SetBuild(_Build: integer);
-    function GetMajorVer: integer;
-    procedure SetMajorVer(_MajorVer: integer);
-    function GetMinorVer: integer;
-    procedure SetMinorVer(_MinorVer: integer);
-    function GetRelease: integer;
-    procedure SetRelease(_Release: integer);
-    function GetCompanyName: string;
-    procedure SetCompanyName(_CompanyName: string);
-    function GetFileDescription: string;
-    procedure SetFileDescription(_FileDescription: string);
-    function GetFileVersion: string;
-    procedure SetFileVersion(_FileVersion: string);
-    function GetInternalName: string;
-    procedure SetInternalName(_InternalName: string);
-    function GetLegalCopyright: string;
-    procedure SetLegalCopyright(_LegalCopyright: string);
-    function GetLegalTrademarks: string;
-    procedure SetLegalTrademarks(_LegalTrademarks: string);
-    function GetOriginalFilename: string;
-    procedure SetOriginalFilename(_OriginalFilename: string);
-    function GetProductName: string;
-    procedure SetProductName(_ProductName: string);
-    function GetProductVersion: string;
-    procedure SetProductVersion(_ProductVersion: string);
-    function GetAutoIncBuild: boolean;
-    procedure SetAutoIncBuild(_AutoIncBuild: boolean);
-    function GetComments: string;
-    procedure SetComments(const _Comments: string);
-  //
-    procedure Assign(const _VersionInfo: IVersionInfo);
-    procedure UpdateFile;
-  //
-    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
-    property Build: integer read GetBuild write SetBuild;
-    property Comments: string read GetComments write SetComments;
-    property CompanyName: string read GetCompanyName write SetCompanyName;
-    property FileDescription: string read GetFileDescription write SetFileDescription;
-    property FileVersion: string read GetFileVersion write SetFileVersion;
-    property InternalName: string read GetInternalName write SetInternalName;
-    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
-    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
-    property MajorVer: integer read GetMajorVer write SetMajorVer;
-    property MinorVer: integer read GetMinorVer write SetMinorVer;
-    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
-    property ProductName: string read GetProductName write SetProductName;
-    property ProductVersion: string read GetProductVersion write SetProductVersion;
-    property Release: integer read GetRelease write SetRelease;
-  end;
-
-implementation
-
-end.
-

Copied: utilities/dzPrepBuild/trunk/src/PrepBuild.bdsproj (from rev 154, utilities/dzPrepBuild/trunk/PrepBuild.bdsproj)

Copied: utilities/dzPrepBuild/trunk/src/PrepBuild.dpr (from rev 156, utilities/dzPrepBuild/trunk/PrepBuild.dpr)

Copied: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj (from rev 156, utilities/dzPrepBuild/trunk/PrepBuild.dproj)
===================================================================
--- utilities/dzPrepBuild/trunk/PrepBuild.dproj	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-11 20:43:22 UTC (rev 157)
@@ -0,0 +1,69 @@
+?<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+  <PropertyGroup>
+    <ProjectGuid>{209412ac-0ec2-4f63-b92a-e78853ff142a}</ProjectGuid>
+    <MainSource>PrepBuild.dpr</MainSource>
+    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
+    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
+    <DCC_DCCCompiler>DCC32</DCC_DCCCompiler>
+    <DCC_DependencyCheckOutputName>..\PrepBuild.exe</DCC_DependencyCheckOutputName>
+  </PropertyGroup>
+  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
+    <Version>7.0</Version>
+    <DCC_DebugInformation>False</DCC_DebugInformation>
+    <DCC_LocalDebugSymbols>False</DCC_LocalDebugSymbols>
+    <DCC_SymbolReferenceInfo>0</DCC_SymbolReferenceInfo>
+    <DCC_DcuOutput>dcu</DCC_DcuOutput>
+    <DCC_ObjOutput>dcu</DCC_ObjOutput>
+    <DCC_HppOutput>dcu</DCC_HppOutput>
+    <DCC_Define>RELEASE</DCC_Define>
+  </PropertyGroup>
+  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
+    <Version>7.0</Version>
+    <DCC_DcuOutput>..\dcu</DCC_DcuOutput>
+    <DCC_ObjOutput>..\dcu</DCC_ObjOutput>
+    <DCC_HppOutput>..\dcu</DCC_HppOutput>
+    <DCC_Define>DEBUG</DCC_Define>
+    <DCC_ExeOutput>..</DCC_ExeOutput>
+  </PropertyGroup>
+  <ProjectExtensions>
+    <Borland.Personality>Delphi.Personality</Borland.Personality>
+    <Borland.ProjectType />
+    <BorlandProject>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">52</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKeys><Versio!
 nInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
+      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
+      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclIntraweb_80_100.bpl">Intraweb 8.0 Design Package for Borland Development Studio 2006</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclsoap100.bpl">Borland SOAP Components</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\bcbie100.bpl">Borland C++Builder Internet Explorer 5 Components Package</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcltee100.bpl">TeeChart Components</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcldbxcds100.bpl">Borland SimpleDataset Component (DBX)</Excluded_Packages>
+      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclie100.bpl">Internet Explorer Components</Excluded_Packages>
+    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source></Delphi.Personality></BorlandProject></BorlandProject>
+  </ProjectExtensions>
+  <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
+  <ItemGroup>
+    <DelphiCompile Include="PrepBuild.dpr">
+      <MainSource>MainSource</MainSource>
+    </DelphiCompile>
+    <DCCReference Include="d_BdsProjVersionInfo.pas">
+      <Form>dm_BdsProjVersionInfo</Form>
+    </DCCReference>
+    <DCCReference Include="i_VersionInfo.pas" />
+    <DCCReference Include="u_CentralIniVersionInfo.pas" />
+    <DCCReference Include="u_DofVersionInfo.pas" />
+    <DCCReference Include="u_IncBuildNoMain.pas" />
+    <DCCReference Include="u_IniVersionInfo.pas" />
+  </ItemGroup>
+</Project>
\ No newline at end of file

Copied: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.dfm (from rev 154, utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.dfm)

Copied: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas (from rev 154, utilities/dzPrepBuild/trunk/d_BdsProjVersionInfo.pas)

Copied: utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas (from rev 154, utilities/dzPrepBuild/trunk/i_VersionInfo.pas)

Copied: utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas (from rev 156, utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas)
===================================================================
--- utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -0,0 +1,69 @@
+unit u_CentralIniVersionInfo;
+
+interface
+
+uses
+  i_VersionInfo,
+  u_IniVersionInfo;
+
+type
+  {: This is a specialized descendant of TIniVersionInfo which
+     allows any entry of the file to redirect to a different file.
+     This can be done for single entries or for a whole section.
+     For redirecting a single entry, the value must contain a string
+     REDIRECT:<filename>,<section><entry>
+     For redirecting a section it must contain only one entry
+     redirect=<filename>,<section>
+     These redirections will be used for reading and writing, that is it can be
+     used to maintain/increment a central build number for several branches of
+     a project where the files have different version numbers but the build
+     number should be increased for a build of any of these versions. }
+  TCentralVersionInfo = class(TIniVersionInfo, IVersionInfo)
+  private
+  protected
+    function ReadString(const _Section, _Ident: string; _Default: string): string; override;
+    procedure WriteString(const _Section, _Ident: string; _Value: string); override;
+  public
+    {: Creates a TCentralVersionInfo instance
+       @param ProjectName is the name of the project (.dpr file without extension)
+                          The constructor appends "_Version.ini" to this
+                          name and tries to open the file }
+    constructor Create(const _ProjectName: string);
+  end;
+
+implementation
+
+uses
+  IniFiles;
+
+const
+  VERSION_INFO_SECTION = 'Version Info';
+  VERSION_INFO_KEYS_SECTION = 'Version Info Keys';
+
+{ TCentralVersionInfo }
+
+constructor TCentralVersionInfo.Create(const _ProjectName: string);
+begin
+  inherited Create(_ProjectName + '_Version.ini', VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
+end;
+
+function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
+var
+  Redir: string;
+  IniFile: TMemIniFile;
+begin
+  Redir := FIniFile.ReadString(_Section, 'redirect', '');
+  if Redir = '' then
+    IniFile := FIniFile
+  else begin
+
+  end;
+end;
+
+procedure TCentralVersionInfo.WriteString(const _Section, _Ident: string; _Value: string);
+begin
+
+end;
+
+end.
+

Copied: utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas (from rev 156, utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas)

Copied: utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas (from rev 154, utilities/dzPrepBuild/trunk/u_IncBuildNoMain.pas)

Copied: utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas (from rev 156, utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas)

Copied: utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj (from rev 154, utilities/dzPrepBuild/trunk/OriginalTestproject.bdsproj)

Copied: utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.dof (from rev 154, utilities/dzPrepBuild/trunk/OriginalTestproject.dof)

Copied: utilities/dzPrepBuild/trunk/testdata/Testproject.bdsproj (from rev 154, utilities/dzPrepBuild/trunk/Testproject.bdsproj)

Copied: utilities/dzPrepBuild/trunk/testdata/Testproject.dof (from rev 154, utilities/dzPrepBuild/trunk/Testproject.dof)

Copied: utilities/dzPrepBuild/trunk/testdata/copyback.cmd (from rev 154, utilities/dzPrepBuild/trunk/copyback.cmd)

Deleted: utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/u_CentralIniVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,65 +0,0 @@
-unit u_CentralIniVersionInfo;
-
-interface
-
-uses
-  i_VersionInfo,
-  u_IniVersionInfo;
-
-type
-  {: This is a specialized descendant of TIniVersionInfo which
-     allows any entry of the file to redirect to a different file.
-     This can be done for single entries or for a whole section.
-     For redirecting a single entry, the value must contain a string
-     REDIRECT:<filename>,<section><entry>
-     For redirecting a section it must contain only one entry
-     redirect=<filename>,<section>
-     These redirections will be used for reading and writing, that is it can be
-     used to maintain/increment a central build number for several branches of
-     a project where the files have different version numbers but the build
-     number should be increased for a build of any of these versions. }
-  TCentralVersionInfo = class(TIniVersionInfo, IVersionInfo)
-  private
-  protected
-    function ReadString(const _Section, _Ident: string; _Default: string): string; override;
-    procedure WriteString(const _Section, _Ident: string; _Value: string); override;
-  public
-    {: Creates a TCentralVersionInfo instance
-       @param ProjectName is the name of the project (.dpr file without extension)
-                          The constructor appends "_Version.ini" to this
-                          name and tries to open the file }
-    constructor Create(const _ProjectName: string);
-  end;
-
-implementation
-
-uses
-  IniFiles;
-
-{ TCentralVersionInfo }
-
-constructor TCentralVersionInfo.Create(const _ProjectName: string);
-begin
-  inherited Create(_ProjectName + '_Version.ini');
-end;
-
-function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
-var
-  Redir: string;
-  IniFile: TMemIniFile;
-begin
-  Redir := FIniFile.ReadString(_Section, 'redirect', '');
-  if Redir = '' then
-    IniFile := FIniFile
-  else begin
-
-  end;
-end;
-
-procedure TCentralVersionInfo.WriteString(const _Section, _Ident: string; _Value: string);
-begin
-
-end;
-
-end.
-

Deleted: utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/u_DofVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,40 +0,0 @@
-unit u_DofVersionInfo;
-
-interface
-
-uses
-  SysUtils,
-  IniFiles,
-  i_VersionInfo,
-  u_IniVersionInfo;
-
-type
-  {: This is a specialized versoin of TIniVersionInfo which readds a
-     <projectname>.dof file, that was used by Delphi up to version 7. }
-  TDofVersionInfo = class(TIniVersionInfo, IVersionInfo)
-  public
-    {: Creates a TDofVersionInfo instance. Succeeds, if the file exists
-       and IncludeVerInfo is <> 0
-       @param _Projectname is the project name (*.dpr file without extension)
-       @raises ENoVersionInfo if the file does not exist or
-                              the value of [Version Info] IncludeVerInfo is not 1 }
-    constructor Create(const _ProjectName: string);
-  end;
-
-implementation
-
-const
-  VERSION_INFO_SECTION = 'Version Info';
-  VERSION_INFO_KEYS_SECTION = 'Version Info Keys';
-
-{ TDofVersionInfo }
-
-constructor TDofVersionInfo.Create(const _ProjectName: string);
-begin
-  inherited Create(_ProjectName + '.dof', VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
-  if FIniFile.ReadInteger(VERSION_INFO_SECTION, 'IncludeVerInfo', 0) <> 1 then
-    raise ENoVersionInfo.Create('.dof file does not contain version info');
-end;
-
-end.
-

Deleted: utilities/dzPrepBuild/trunk/u_IncBuildNoMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_IncBuildNoMain.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/u_IncBuildNoMain.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,192 +0,0 @@
-unit u_IncBuildNoMain;
-
-interface
-
-procedure Main;
-
-implementation
-
-uses
-  SysUtils,
-  IniFiles,
-  oxmldom,
-  XMLIntf,
-  XmlDoc,
-  Classes,
-  ActiveX,
-  i_VersionInfo,
-  u_DofVersionInfo,
-  d_BdsProjVersionInfo;
-
-type
-  EHalt = class(EAbort)
-  public
-    ResultCode: integer;
-    constructor Create(_ResultCode: integer);
-  end;
-
-{ EHalt }
-
-constructor EHalt.Create(_ResultCode: integer);
-begin
-  inherited CreateFmt('Halt with result code %d', [_ResultCode]);
-  ResultCode := _ResultCode;
-end;
-
-procedure WriteRcFile(const _Project: string; _VersionInfo: IVersionInfo);
-var
-  t: TextFile;
-begin
-  Assignfile(t, _Project + '.rc');
-  Rewrite(t);
-
-  WriteLn(t, {     } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
-  WriteLn(t);
-  WriteLn(t, {     } '1 VERSIONINFO LOADONCALL MOVEABLE DISCARDABLE IMPURE');
-  WriteLn(t, Format('FILEVERSION %d, %d, %d, %d', [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, Format('PRODUCTVERSION %d, %d, %d, %d',
-    [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, {     } 'FILEFLAGSMASK VS_FFI_FILEFLAGSMASK');
-  WriteLn(t, {     } 'FILEOS VOS__WINDOWS32');
-  WriteLn(t, {     } 'FILETYPE VFT_APP');
-  WriteLn(t, {     } '{');
-  WriteLn(t, {     } ' BLOCK "StringFileInfo"');
-  WriteLn(t, {     } ' {');
-  WriteLn(t, {     } '  BLOCK "040904E4"');
-  WriteLn(t, {     } '  {');
-  WriteLn(t, Format('   VALUE "CompanyName", "%s\000"', [_VersionInfo.CompanyName]));
-  WriteLn(t, Format('   VALUE "FileDescription", "%s\000"', [_VersionInfo.FileDescription]));
-  WriteLn(t, Format('   VALUE "FileVersion", "%s\000"', [_VersionInfo.FileVersion]));
-  WriteLn(t, Format('   VALUE "InternalName", "%s\000"', [_VersionInfo.InternalName]));
-  WriteLn(t, Format('   VALUE "LegalCopyright", "%s\000"', [_VersionInfo.LegalCopyright]));
-  WriteLn(t, Format('   VALUE "LegalTrademarks", "%s\000"', [_VersionInfo.LegalTrademarks]));
-  WriteLn(t, Format('   VALUE "OriginalFilename", "%s\000"', [_VersionInfo.OriginalFilename]));
-  WriteLn(t, Format('   VALUE "ProductName", "%s\000"', [_VersionInfo.ProductName]));
-  WriteLn(t, Format('   VALUE "ProductVersion", "%s\000"', [_VersionInfo.ProductVersion]));
-  WriteLn(t, Format('   VALUE "Comments", "%s\000"', [_VersionInfo.Comments]));
-  WriteLn(t, {     } '  }');
-  WriteLn(t, {     } ' }');
-  WriteLn(t, {     } ' BLOCK "VarFileInfo"');
-  WriteLn(t, {     } ' {');
-  WriteLn(t, {     } '  VALUE "Translation", 1033, 1252');
-  WriteLn(t, {     } ' }');
-  WriteLn(t, {     } '}');
-  if FileExists(_Project + '.ico') then begin
-    WriteLn(t);
-    WriteLn(t, {     } 'MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico');
-  end;
-  Close(t);
-end;
-
-procedure Usage;
-begin
-  WriteLn;
-  WriteLn('Usage: IncBuildNo <projectname>');
-  WriteLn;
-  WriteLn('This Program tries to read version information from <projectname>.bdsproj');
-  WriteLn('and if that fails from <projectname>.dof');
-  WriteLn('If AutoIncBuild = true, it will increment the build number and write it back.');
-  WriteLn('The information is then written to <projectname>.rc to be compiled with');
-  WriteLn('the brcc32 tool.');
-  WriteLn('If <projectname>.ico exists, this file will be included as an icon resource.');
-  WriteLn;
-  WriteLn('Example:');
-  WriteLn('c:\myproject> IncBuildNo MyProject');
-  WriteLn('c:\myproject> brcc32 MyProject.rc');
-  raise EHalt.Create(1);
-end;
-
-procedure Main;
-var
-  Projectname: string;
-  ResultCode: integer;
-  BdsVerInfo: IVersionInfo;
-  DelphiVerInfo: IVersionInfo;
-  OtherVerinfo: IVersionInfo;
-  VersionInfo: IVersionInfo;
-begin
-  Resultcode := 0;
-  try
-    try
-      WriteLn('IncBuildNo (c) 2005 by Thomas Mueller (www.dummzeuch.de)');
-      if ParamCount <> 1 then
-        Usage;
-      CoInitializeEx(nil, COINIT_APARTMENTTHREADED);
-      Projectname := ParamStr(1);
-
-      try
-        Write('Reading ', Projectname, '.bdsproj ');
-        BdsVerInfo := Tdm_BdsProjVersionInfo.Create(Projectname);
-        WriteLn('OK');
-      except
-        WriteLn('FAIL');
-        BdsVerInfo := nil;
-      end;
-
-      try
-        Write('Reading ', Projectname, '.dof ');
-        DelphiVerInfo := TDofVersionInfo.Create(Projectname);
-        WriteLn('OK');
-      except
-        WriteLn('FAIL');
-        DelphiVerInfo := nil;
-      end;
-
-      if not Assigned(BdsVerInfo) then begin
-        VersionInfo := DelphiVerInfo;
-      end else if not Assigned(DelphiVerInfo) then
-        VersionInfo := BdsVerInfo
-      else begin
-        if DelphiVerInfo.Build > BdsVerInfo.Build then begin
-          VersionInfo := DelphiVerInfo;
-          OtherVerinfo := BdsVerInfo;
-        end else begin
-          VersionInfo := BdsVerInfo;
-          OtherVerinfo := DelphiVerInfo;
-        end;
-      end;
-
-      if not Assigned(VersionInfo) then begin
-        WriteLn(Format('Error: Could not read either %:0s.bdsproj or %:0s.dof', [Projectname]));
-        raise EHalt.Create(1);
-      end;
-
-      if VersionInfo.AutoIncBuild then begin
-        Write('Incrementing build number ');
-        VersionInfo.Build := VersionInfo.Build + 1;
-        VersionInfo.UpdateFile;
-        WriteLn('OK');
-      end;
-
-      Write('Writing ', Projectname, '.rc file ');
-      WriteRcFile(Projectname, VersionInfo);
-      WriteLn('OK');
-
-      if Assigned(OtherVerinfo) then begin
-        Write('Updating other version info file ');
-        OtherVerinfo.Assign(VersionInfo);
-        OtherVerinfo.UpdateFile;
-        WriteLn('OK');
-      end;
-
-    except
-      on e: EHalt do
-        ResultCode := e.ResultCode;
-      on e: Exception do begin
-        ResultCode := 1;
-        WriteLn(e.ClassName, ': ', e.Message);
-      end;
-    end;
-  finally
-{$IFOPT D+}
-    WriteLn;
-    WriteLn('press <enter>');
-    readln;
-{$ENDIF}
-  end;
-  if ResultCode <> 0 then
-    Halt(ResultCode);
-end;
-
-end.
-

Deleted: utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas	2007-07-11 20:39:46 UTC (rev 156)
+++ utilities/dzPrepBuild/trunk/u_IniVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
@@ -1,318 +0,0 @@
-unit u_IniVersionInfo;
-
-interface
-
-uses
-  SysUtils,
-  IniFiles,
-  i_VersionInfo;
-
-type
-  {: Tries to read a <projectname>.ini file, succeeds, if it exists
-     @param Project is the project name (*.dpr file without extension)
-     @param VersionInfo is a TVersionInfoRec record which will be filled with the version info }
-  TIniVersionInfo = class(TInterfacedObject, IVersionInfo)
-  protected
-    FIniFile: TMemIniFile;
-    FInfoSection: string;
-    FInfoKeysSection: string;
-    function ReadInteger(const _Section, _Ident: string; _Default: integer): integer; virtual;
-    procedure WriteInteger(const _Section, _Ident: string; _Value: integer); virtual;
-    function ReadString(const _Section, _Ident: string; _Default: string): string; virtual;
-    procedure WriteString(const _Section, _Ident: string; _Value: string); virtual;
-    function ReadBool(const _Section, _Ident: string; _Default: boolean): boolean; virtual;
-    procedure WriteBool(const _Section, _Ident: string; _Value: boolean); virtual;
-  protected // implementation of IVersionInfo
-    function GetBuild: integer;
-    procedure SetBuild(_Build: integer);
-    function GetMajorVer: integer;
-    procedure SetMajorVer(_MajorVer: integer);
-    function GetMinorVer: integer;
-    procedure SetMinorVer(_MinorVer: integer);
-    function GetRelease: integer;
-    procedure SetRelease(_Release: integer);
-    function GetCompanyName: string;
-    procedure SetCompanyName(_CompanyName: string);
-    function GetFileDescription: string;
-    procedure SetFileDescription(_FileDescription: string);
-    function GetFileVersion: string;
-    procedure SetFileVersion(_FileVersion: string);
-    function GetInternalName: string;
-    procedure SetInternalName(_InternalName: string);
-    function GetLegalCopyright: string;
-    procedure SetLegalCopyright(_LegalCopyright: string);
-    function GetLegalTrademarks: string;
-    procedure SetLegalTrademarks(_LegalTrademarks: string);
-    function GetOriginalFilename: string;
-    procedure SetOriginalFilename(_OriginalFilename: string);
-    function GetProductName: string;
-    procedure SetProductName(_ProductName: string);
-    function GetProductVersion: string;
-    procedure SetProductVersion(_ProductVersion: string);
-    function GetAutoIncBuild: boolean;
-    procedure SetAutoIncBuild(_AutoIncBuild: boolean);
-    function GetComments: string;
-    procedure SetComments(const _Comments: string);
-  //
-    procedure Assign(const _VersionInfo: IVersionInfo);
-    procedure UpdateFile;
-  //
-    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
-    property Build: integer read GetBuild write SetBuild;
-    property Comments: string read GetComments write SetComments;
-    property CompanyName: string read GetCompanyName write SetCompanyName;
-    property FileDescription: string read GetFileDescription write SetFileDescription;
-    property FileVersion: string read GetFileVersion write SetFileVersion;
-    property InternalName: string read GetInternalName write SetInternalName;
-    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
-    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
-    property MajorVer: integer read GetMajorVer write SetMajorVer;
-    property MinorVer: integer read GetMinorVer write SetMinorVer;
-    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
-    property ProductName: string read GetProductName write SetProductName;
-    property ProductVersion: string read GetProductVersion write SetProductVersion;
-    property Release: integer read GetRelease write SetRelease;
-  public
-    {: Creates a TIniVersionInfo instance.
-       @param FullFilename is the full filename including path and extension of
-                           file to use
-       @param InfoSection is the name of the section that contains the general
-                          version info like Major/Minor version, Release etc.
-                          In a Delphi .dof file this section is called [Version Info]
-       @param InfoKeySection is the name of the section that contains the additional
-                             strings of the version information
-                             In a Delphi .dof file this section is called [Version Info Keys] }
-    constructor Create(const _FullFilename: string; const _InfoSection: string;
-      const _InfoKeysSection: string);
-    destructor Destroy; override;
-  end;
-
-implementation
-
-{ TIniVersionInfo }
-
-constructor TIniVersionInfo.Create(const _FullFilename: string; const _InfoSection: string;
-  const _InfoKeysSection: string);
-begin
-  inherited Create;
-  FInfoSection := _InfoSection;
-  FInfoKeysSection := _InfoKeysSection;
-  FIniFile := TMemIniFile.Create(_FullFilename);
-end;
-
-destructor TIniVersionInfo.Destroy;
-begin
-  FIniFile.Free;
-  inherited;
-end;
-
-function TIniVersionInfo.ReadBool(const _Section, _Ident: string; _Default: boolean): boolean;
-begin
-  Result := 0 <> ReadInteger(_Section, _Ident, Ord(_Default));
-end;
-
-function TIniVersionInfo.ReadInteger(const _Section, _Ident: string; _Default: integer): integer;
-var
-  s: string;
-begin
-  s := ReadString(_Section, _Ident, IntToStr(_Default));
-  if not TryStrToInt(s, Result) then
-    Result := _Default;
-end;
-
-function TIniVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
-begin
-  Result := FIniFile.ReadString(_Section, _Ident, _Default);
-end;
-
-procedure TIniVersionInfo.WriteBool(const _Section, _Ident: string; _Value: boolean);
-begin
-  WriteInteger(_Section, _Ident, Ord(_Value));
-end;
-
-procedure TIniVersionInfo.WriteInteger(const _Section, _Ident: string; _Value: integer);
-begin
-  WriteString(_Section, _Ident, IntToStr(_Value));
-end;
-
-procedure TIniVersionInfo.WriteString(const _Section, _Ident: string; _Value: string);
-begin
-  FIniFile.WriteString(_Section, _Ident, _Value);
-end;
-
-procedure TIniVersionInfo.Assign(const _VersionInfo: IVersionInfo);
-begin
-  AutoIncBuild := _VersionInfo.AutoIncBuild;
-  Build := _VersionInfo.Build;
-  Comments := _VersionInfo.Comments;
-  CompanyName := _VersionInfo.CompanyName;
-  FileDescription := _VersionInfo.FileDescription;
-  FileVersion := _VersionInfo.FileVersion;
-  InternalName := _VersionInfo.InternalName;
-  LegalCopyright := _VersionInfo.LegalCopyright;
-  LegalTrademarks := _VersionInfo.LegalTrademarks;
-  MajorVer := _VersionInfo.MajorVer;
-  MinorVer := _VersionInfo.MinorVer;
-  OriginalFilename := _VersionInfo.OriginalFilename;
-  ProductName := _VersionInfo.ProductName;
-  ProductVersion := _VersionInfo.ProductVersion;
-  Release := _VersionInfo.Release;
-end;
-
-function TIniVersionInfo.GetAutoIncBuild: boolean;
-begin
-  Result := ReadInteger(FInfoSection, 'AutoIncBuild', 0) <> 0;
-end;
-
-function TIniVersionInfo.GetBuild: integer;
-begin
-  Result := ReadInteger(FInfoSection, 'Build', 0);
-end;
-
-function TIniVersionInfo.GetComments: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'Comments', '');
-end;
-
-function TIniVersionInfo.GetCompanyName: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'CompanyName', '');
-end;
-
-function TIniVersionInfo.GetFileDescription: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'FileDescription', '');
-end;
-
-function TIniVersionInfo.GetFileVersion: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'FileVersion', '');
-end;
-
-function TIniVersionInfo.GetInternalName: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'InternalName', '');
-end;
-
-function TIniVersionInfo.GetLegalCopyright: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'LegalCopyright', '');
-end;
-
-function TIniVersionInfo.GetLegalTrademarks: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'LegalTrademarks', '');
-end;
-
-function TIniVersionInfo.GetMajorVer: integer;
-begin
-  Result := ReadInteger(FInfoSection, 'MajorVer', 0);
-end;
-
-function TIniVersionInfo.GetMinorVer: integer;
-begin
-  Result := ReadInteger(FInfoSection, 'MinorVer', 0);
-end;
-
-function TIniVersionInfo.GetOriginalFilename: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'OriginalFilename', '');
-end;
-
-function TIniVersionInfo.GetProductName: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'ProductName', '');
-end;
-
-function TIniVersionInfo.GetProductVersion: string;
-begin
-  Result := ReadString(FInfoKeysSection, 'ProductVersion', '');
-end;
-
-function TIniVersionInfo.GetRelease: integer;
-begin
-  Result := ReadInteger(FInfoSection, 'Release', 0);
-end;
-
-procedure TIniVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
-begin
-  WriteBool(FInfoSection, 'AutoIncBuild', _AutoIncBuild);
-end;
-
-procedure TIniVersionInfo.SetBuild(_Build: integer);
-begin
-  WriteInteger(FInfoSection, 'Build', _Build);
-end;
-
-procedure TIniVersionInfo.SetComments(const _Comments: string);
-begin
-  WriteString(FInfoKeysSection, 'Comments', _Comments);
-end;
-
-procedure TIniVersionInfo.SetCompanyName(_CompanyName: string);
-begin
-  WriteString(FInfoKeysSection, 'CompanyName', _CompanyName);
-end;
-
-procedure TIniVersionInfo.SetFileDescription(_FileDescription: string);
-begin
-  WriteString(FInfoKeysSection, 'FileDescription', _FileDescription);
-end;
-
-procedure TIniVersionInfo.SetFileVersion(_FileVersion: string);
-begin
-  WriteString(FInfoKeysSection, 'FileVersion', _FileVersion);
-end;
-
-procedure TIniVersionInfo.SetInternalName(_InternalName: string);
-begin
-  WriteString(FInfoKeysSection, 'InternalName', _InternalName);
-end;
-
-procedure TIniVersionInfo.SetLegalCopyright(_LegalCopyright: string);
-begin
-  WriteString(FInfoKeysSection, 'LegalCopyright', _LegalCopyright);
-end;
-
-procedure TIniVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
-begin
-  WriteString(FInfoKeysSection, 'LegalTrademarks', _LegalTrademarks);
-end;
-
-procedure TIniVersionInfo.SetMajorVer(_MajorVer: integer);
-begin
-  WriteInteger(FInfoSection, 'MajorVer', _MajorVer);
-end;
-
-procedure TIniVersionInfo.SetMinorVer(_MinorVer: integer);
-begin
-  WriteInteger(FInfoSection, 'MinorVer', _MinorVer);
-end;
-
-procedure TIniVersionInfo.SetOriginalFilename(_OriginalFilename: string);
-begin
-  WriteString(FInfoKeysSection, 'OriginalFilename', _OriginalFilename);
-end;
-
-procedure TIniVersionInfo.SetProductName(_ProductName: string);
-begin
-  WriteString(FInfoKeysSection, 'ProductName', _ProductName);
-end;
-
-procedure TIniVersionInfo.SetProductVersion(_ProductVersion: string);
-begin
-  WriteString(FInfoKeysSection, 'ProductVersion', _ProductVersion);
-end;
-
-procedure TIniVersionInfo.SetRelease(_Release: integer);
-begin
-  WriteInteger(FInfoSection, 'Release', _Release);
-end;
-
-procedure TIniVersionInfo.UpdateFile;
-begin
-  FIniFile.UpdateFile;
-end;
-
-end.
-



From twm at mail.berlios.de  Wed Jul 11 23:58:55 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Wed, 11 Jul 2007 23:58:55 +0200
Subject: [Dzchart-svncheckins] r158 - in utilities/dzPrepBuild/trunk: . src
	testdata
Message-ID: <200707112158.l6BLwtoO023369@sheep.berlios.de>

Author: twm
Date: 2007-07-11 23:58:48 +0200 (Wed, 11 Jul 2007)
New Revision: 158

Added:
   utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini
Modified:
   utilities/dzPrepBuild/trunk/
   utilities/dzPrepBuild/trunk/src/
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.dfm
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
   utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
   utilities/dzPrepBuild/trunk/testdata/
Log:
added handling of a TCentralVersionInfo instance


Property changes on: utilities/dzPrepBuild/trunk
___________________________________________________________________
Name: svn:externals
   + libs\dzlib https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzLib/trunk



Property changes on: utilities/dzPrepBuild/trunk/src
___________________________________________________________________
Name: svn:ignore
   + PrepBuild.dsk
PrepBuild.res


Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-11 21:58:48 UTC (rev 158)
@@ -1,4 +1,5 @@
-?<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+?<?xml version="1.0" encoding="utf-8"?>
+<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
   <PropertyGroup>
     <ProjectGuid>{209412ac-0ec2-4f63-b92a-e78853ff142a}</ProjectGuid>
     <MainSource>PrepBuild.dpr</MainSource>
@@ -22,14 +23,18 @@
     <DCC_DcuOutput>..\dcu</DCC_DcuOutput>
     <DCC_ObjOutput>..\dcu</DCC_ObjOutput>
     <DCC_HppOutput>..\dcu</DCC_HppOutput>
-    <DCC_Define>DEBUG</DCC_Define>
+    <DCC_Define>DEBUG;no_translation</DCC_Define>
     <DCC_ExeOutput>..</DCC_ExeOutput>
+    <DCC_UnitSearchPath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_UnitSearchPath>
+    <DCC_ResourcePath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_ResourcePath>
+    <DCC_ObjPath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_ObjPath>
+    <DCC_IncludePath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_IncludePath>
   </PropertyGroup>
   <ProjectExtensions>
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">52</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKeys><Versio!
 nInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">testdata\testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">52</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKey!
 s><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
       
       
       
@@ -40,6 +45,46 @@
       
       
       
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.dfm
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.dfm	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.dfm	2007-07-11 21:58:48 UTC (rev 158)
@@ -1,7 +1,5 @@
 object dm_BdsProjVersionInfo: Tdm_BdsProjVersionInfo
   OldCreateOrder = False
-  Left = 400
-  Top = 48
   Height = 150
   Width = 215
   object ProjDoc: TXMLDocument

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-11 21:58:48 UTC (rev 158)
@@ -16,6 +16,7 @@
   Tdm_BdsProjVersionInfo = class(TDataModule, IVersionInfo)
     ProjDoc: TXMLDocument;
   private
+    FProjectName: string;
     function GetChildNodeContent(_Parent: IXMLNode; const _NodeName, _AttrName: string): string;
     function GetVersionInfo(const _Name: string): string;
     function GetVersionInfoKey(const _Name: string): string;
@@ -62,6 +63,7 @@
   //
     procedure Assign(const _VersionInfo: IVersionInfo); reintroduce;
     procedure UpdateFile;
+    function VerInfoFilename: string;
   //
     property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
     property Build: integer read GetBuild write SetBuild;
@@ -85,6 +87,8 @@
   public
     constructor Create(const _Project: string); reintroduce;
     destructor Destroy; override;
+    class function FilenameFor(const _Project: string): string;
+
   end;
 
 implementation
@@ -162,7 +166,8 @@
   DelphiPersonality: IXMLNode;
 begin
   inherited Create(nil);
-  FBdsProjFile := _Project + '.bdsproj';
+  FProjectName := _Project;
+  FBdsProjFile := VerInfoFilename;
   ProjDoc.FileName := FBdsProjFile;
   ProjDoc.Active := True;
   BorlandProject := ProjDoc.DocumentElement;
@@ -180,6 +185,11 @@
   inherited;
 end;
 
+class function Tdm_BdsProjVersionInfo.FilenameFor(const _Project: string): string;
+begin
+  Result := _Project + '.bdsproj';
+end;
+
 function Tdm_BdsProjVersionInfo.GetAutoIncBuild: boolean;
 begin
   Result := SameText(GetVersionInfo('AutoIncBuild'), 'True');
@@ -348,6 +358,11 @@
   ProjDoc.SaveToFile(FBdsProjFile);
 end;
 
+function Tdm_BdsProjVersionInfo.VerInfoFilename: string;
+begin
+  Result := FilenameFor(FProjectName);
+end;
+
 // standard TInterfacedObject implementation of IInterface
 
 function Tdm_BdsProjVersionInfo.QueryInterface(const IID: TGUID; out Obj): HResult;

Modified: utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas	2007-07-11 21:58:48 UTC (rev 158)
@@ -9,7 +9,7 @@
   ENoVersionInfo = class(Exception);
 
 type
-  IVersionInfo = interface
+  IVersionInfo = interface ['{C228DED6-C3B2-43C0-B061-28EA5D2EB93C}']
     function GetBuild: integer;
     procedure SetBuild(_Build: integer);
     function GetMajorVer: integer;
@@ -44,6 +44,8 @@
     procedure Assign(const _VersionInfo: IVersionInfo);
     procedure UpdateFile;
   //
+    function VerInfoFilename: string;
+  //
     property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
     property Build: integer read GetBuild write SetBuild;
     property Comments: string read GetComments write SetComments;

Modified: utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-11 21:58:48 UTC (rev 158)
@@ -20,7 +20,10 @@
      number should be increased for a build of any of these versions. }
   TCentralVersionInfo = class(TIniVersionInfo, IVersionInfo)
   private
+    FProjectName: string;
   protected
+    function VerInfoFilename: string;
+    //
     function ReadString(const _Section, _Ident: string; _Default: string): string; override;
     procedure WriteString(const _Section, _Ident: string; _Value: string); override;
   public
@@ -29,12 +32,14 @@
                           The constructor appends "_Version.ini" to this
                           name and tries to open the file }
     constructor Create(const _ProjectName: string);
+    class function FilenameFor(const _ProjectName: string): string;
   end;
 
 implementation
 
 uses
-  IniFiles;
+  IniFiles,
+  u_dzStringUtils;
 
 const
   VERSION_INFO_SECTION = 'Version Info';
@@ -44,25 +49,84 @@
 
 constructor TCentralVersionInfo.Create(const _ProjectName: string);
 begin
-  inherited Create(_ProjectName + '_Version.ini', VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
+  FProjectName := _ProjectName;
+  inherited Create(VerInfoFilename, VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
 end;
 
+class function TCentralVersionInfo.FilenameFor(const _ProjectName: string): string;
+begin
+  Result := _ProjectName + '_Version.ini';
+end;
+
 function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
 var
   Redir: string;
   IniFile: TMemIniFile;
+  Filename: string;
+  Section: string;
 begin
   Redir := FIniFile.ReadString(_Section, 'redirect', '');
-  if Redir = '' then
-    IniFile := FIniFile
-  else begin
-
+  if Redir = '' then begin
+    Result := FIniFile.ReadString(_Section, _Ident, _Default);
+    if UStartsWith('redirect:', Result) then begin
+      Redir := Result;
+      Filename := GetDelStr(Redir, ',');
+      Section := GetDelStr(Redir, ',');
+      IniFile := TMemIniFile.Create(Filename);
+      try
+        Result := IniFile.ReadString(Section, Redir, _Default);
+      finally
+        IniFile.Free;
+      end;
+    end;
+  end else begin
+    Filename := GetDelStr(Redir, ',');
+    Section := Redir;
+    IniFile := TMemIniFile.Create(Filename);
+    try
+      Result := IniFile.ReadString(Section, _Ident, _Default);
+    finally
+      IniFile.Free;
+    end;
   end;
 end;
 
+function TCentralVersionInfo.VerInfoFilename: string;
+begin
+  Result := FilenameFor(FProjectName);
+end;
+
 procedure TCentralVersionInfo.WriteString(const _Section, _Ident: string; _Value: string);
+var
+  Redir: string;
+  IniFile: TMemIniFile;
+  Filename: string;
+  Section: string;
 begin
-
+  Redir := FIniFile.ReadString(_Section, 'redirect', '');
+  if Redir = '' then begin
+    Redir := FIniFile.ReadString(_Section, _Ident, '');
+    if UStartsWith('redirect:', Redir) then begin
+      Filename := GetDelStr(Redir, ',');
+      Section := GetDelStr(Redir, ',');
+      IniFile := TMemIniFile.Create(Filename);
+      try
+        IniFile.WriteString(Section, Redir, _Value);
+      finally
+        IniFile.Free;
+      end;
+    end else
+      FIniFile.WriteString(_Section, _Ident, _Value);
+  end else begin
+    Filename := GetDelStr(Redir, ',');
+    Section := Redir;
+    IniFile := TMemIniFile.Create(Filename);
+    try
+      IniFile.WriteString(Section, _Ident, _Value);
+    finally
+      IniFile.Free;
+    end;
+  end;
 end;
 
 end.

Modified: utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-11 21:58:48 UTC (rev 158)
@@ -12,6 +12,10 @@
   {: This is a specialized versoin of TIniVersionInfo which readds a
      <projectname>.dof file, that was used by Delphi up to version 7. }
   TDofVersionInfo = class(TIniVersionInfo, IVersionInfo)
+  private
+    FProjectName: string;
+  protected
+    function VerInfoFilename: string;
   public
     {: Creates a TDofVersionInfo instance. Succeeds, if the file exists
        and IncludeVerInfo is <> 0
@@ -19,6 +23,7 @@
        @raises ENoVersionInfo if the file does not exist or
                               the value of [Version Info] IncludeVerInfo is not 1 }
     constructor Create(const _ProjectName: string);
+    class function FilenameFor(const _ProjectName: string): string;
   end;
 
 implementation
@@ -31,10 +36,21 @@
 
 constructor TDofVersionInfo.Create(const _ProjectName: string);
 begin
-  inherited Create(_ProjectName + '.dof', VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
+  FProjectName := _ProjectName;
+  inherited Create(VerInfoFilename, VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
   if FIniFile.ReadInteger(VERSION_INFO_SECTION, 'IncludeVerInfo', 0) <> 1 then
     raise ENoVersionInfo.Create('.dof file does not contain version info');
 end;
 
+class function TDofVersionInfo.FilenameFor(const _ProjectName: string): string;
+begin
+  Result := _ProjectName + '.dof';
+end;
+
+function TDofVersionInfo.VerInfoFilename: string;
+begin
+  Result := FilenameFor(FProjectName);
+end;
+
 end.
 

Modified: utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas	2007-07-11 21:58:48 UTC (rev 158)
@@ -16,7 +16,8 @@
   ActiveX,
   i_VersionInfo,
   u_DofVersionInfo,
-  d_BdsProjVersionInfo;
+  d_BdsProjVersionInfo,
+  u_CentralIniVersionInfo;
 
 type
   EHalt = class(EAbort)
@@ -40,20 +41,20 @@
   Assignfile(t, _Project + '.rc');
   Rewrite(t);
 
-  WriteLn(t, {     } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
+  WriteLn(t, {    } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
   WriteLn(t);
-  WriteLn(t, {     } '1 VERSIONINFO LOADONCALL MOVEABLE DISCARDABLE IMPURE');
+  WriteLn(t, {    } '1 VERSIONINFO LOADONCALL MOVEABLE DISCARDABLE IMPURE');
   WriteLn(t, Format('FILEVERSION %d, %d, %d, %d', [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
   WriteLn(t, Format('PRODUCTVERSION %d, %d, %d, %d',
     [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, {     } 'FILEFLAGSMASK VS_FFI_FILEFLAGSMASK');
-  WriteLn(t, {     } 'FILEOS VOS__WINDOWS32');
-  WriteLn(t, {     } 'FILETYPE VFT_APP');
-  WriteLn(t, {     } '{');
-  WriteLn(t, {     } ' BLOCK "StringFileInfo"');
-  WriteLn(t, {     } ' {');
-  WriteLn(t, {     } '  BLOCK "040904E4"');
-  WriteLn(t, {     } '  {');
+  WriteLn(t, {    } 'FILEFLAGSMASK VS_FFI_FILEFLAGSMASK');
+  WriteLn(t, {    } 'FILEOS VOS__WINDOWS32');
+  WriteLn(t, {    } 'FILETYPE VFT_APP');
+  WriteLn(t, {    } '{');
+  WriteLn(t, {    } ' BLOCK "StringFileInfo"');
+  WriteLn(t, {    } ' {');
+  WriteLn(t, {    } '  BLOCK "040904E4"');
+  WriteLn(t, {    } '  {');
   WriteLn(t, Format('   VALUE "CompanyName", "%s\000"', [_VersionInfo.CompanyName]));
   WriteLn(t, Format('   VALUE "FileDescription", "%s\000"', [_VersionInfo.FileDescription]));
   WriteLn(t, Format('   VALUE "FileVersion", "%s\000"', [_VersionInfo.FileVersion]));
@@ -64,16 +65,16 @@
   WriteLn(t, Format('   VALUE "ProductName", "%s\000"', [_VersionInfo.ProductName]));
   WriteLn(t, Format('   VALUE "ProductVersion", "%s\000"', [_VersionInfo.ProductVersion]));
   WriteLn(t, Format('   VALUE "Comments", "%s\000"', [_VersionInfo.Comments]));
-  WriteLn(t, {     } '  }');
-  WriteLn(t, {     } ' }');
-  WriteLn(t, {     } ' BLOCK "VarFileInfo"');
-  WriteLn(t, {     } ' {');
-  WriteLn(t, {     } '  VALUE "Translation", 1033, 1252');
-  WriteLn(t, {     } ' }');
-  WriteLn(t, {     } '}');
+  WriteLn(t, {    } '  }');
+  WriteLn(t, {    } ' }');
+  WriteLn(t, {    } ' BLOCK "VarFileInfo"');
+  WriteLn(t, {    } ' {');
+  WriteLn(t, {    } '  VALUE "Translation", 1033, 1252');
+  WriteLn(t, {    } ' }');
+  WriteLn(t, {    } '}');
   if FileExists(_Project + '.ico') then begin
     WriteLn(t);
-    WriteLn(t, {     } 'MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico');
+    WriteLn(t, {  } 'MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico');
   end;
   Close(t);
 end;
@@ -81,17 +82,22 @@
 procedure Usage;
 begin
   WriteLn;
-  WriteLn('Usage: IncBuildNo <projectname>');
+  WriteLn('Usage: dzPrepBuild <projectname>');
   WriteLn;
   WriteLn('This Program tries to read version information from <projectname>.bdsproj');
   WriteLn('and if that fails from <projectname>.dof');
+  WriteLn;
   WriteLn('If AutoIncBuild = true, it will increment the build number and write it back.');
   WriteLn('The information is then written to <projectname>.rc to be compiled with');
   WriteLn('the brcc32 tool.');
+  WriteLn;
   WriteLn('If <projectname>.ico exists, this file will be included as an icon resource.');
   WriteLn;
+  WriteLn('If both, a .bdsproj and a .dof file exist, the .dof file will be updated');
+  WriteLn('with the information from the .bdsproj file.');
+  WriteLn;
   WriteLn('Example:');
-  WriteLn('c:\myproject> IncBuildNo MyProject');
+  WriteLn('c:\myproject> dzPrepBuild MyProject');
   WriteLn('c:\myproject> brcc32 MyProject.rc');
   raise EHalt.Create(1);
 end;
@@ -100,75 +106,103 @@
 var
   Projectname: string;
   ResultCode: integer;
+  CentralVerInfo: IVersionInfo;
   BdsVerInfo: IVersionInfo;
   DelphiVerInfo: IVersionInfo;
   OtherVerinfo: IVersionInfo;
   VersionInfo: IVersionInfo;
+  AdditionalVersionInfos: TInterfaceList;
+  BuildNo: integer;
+  i: integer;
 begin
   Resultcode := 0;
   try
     try
-      WriteLn('IncBuildNo (c) 2005 by Thomas Mueller (www.dummzeuch.de)');
+      WriteLn('dzPrepBuild (c) 2007 by Thomas Mueller (www.dummzeuch.de)');
+      WriteLn('(previously called IncBuildNo)');
       if ParamCount <> 1 then
         Usage;
       CoInitializeEx(nil, COINIT_APARTMENTTHREADED);
       Projectname := ParamStr(1);
 
+      AdditionalVersionInfos := TInterfaceList.Create;
       try
-        Write('Reading ', Projectname, '.bdsproj ');
-        BdsVerInfo := Tdm_BdsProjVersionInfo.Create(Projectname);
-        WriteLn('OK');
-      except
-        WriteLn('FAIL');
-        BdsVerInfo := nil;
-      end;
+        try
+          Write('Reading ', TCentralVersionInfo.FilenameFor(Projectname), ' ');
+          CentralVerInfo := TCentralVersionInfo.Create(Projectname);
+          WriteLn('OK');
+        except
+          WriteLn('FAIL');
+          CentralVerInfo := nil;
+        end;
+        try
+          Write('Reading ', Tdm_BdsProjVersionInfo.FilenameFor(Projectname), ' ');
+          BdsVerInfo := Tdm_BdsProjVersionInfo.Create(Projectname);
+          WriteLn('OK');
+        except
+          WriteLn('FAIL');
+          BdsVerInfo := nil;
+        end;
 
-      try
-        Write('Reading ', Projectname, '.dof ');
-        DelphiVerInfo := TDofVersionInfo.Create(Projectname);
-        WriteLn('OK');
-      except
-        WriteLn('FAIL');
-        DelphiVerInfo := nil;
-      end;
+        try
+          Write('Reading ', TDofVersionInfo.FilenameFor(Projectname), ' ');
+          DelphiVerInfo := TDofVersionInfo.Create(Projectname);
+          WriteLn('OK');
+        except
+          WriteLn('FAIL');
+          DelphiVerInfo := nil;
+        end;
 
-      if not Assigned(BdsVerInfo) then begin
-        VersionInfo := DelphiVerInfo;
-      end else if not Assigned(DelphiVerInfo) then
-        VersionInfo := BdsVerInfo
-      else begin
-        if DelphiVerInfo.Build > BdsVerInfo.Build then begin
-          VersionInfo := DelphiVerInfo;
-          OtherVerinfo := BdsVerInfo;
-        end else begin
+        if Assigned(CentralVerInfo) then begin
+          VersionInfo := CentralVerInfo;
+          if Assigned(BdsVerInfo) then
+            AdditionalVersionInfos.Add(BdsVerInfo);
+          if Assigned(DelphiVerInfo) then
+            AdditionalVersionInfos.Add(DelphiVerInfo);
+        end else if Assigned(BdsVerInfo) then begin
           VersionInfo := BdsVerInfo;
-          OtherVerinfo := DelphiVerInfo;
+          if Assigned(DelphiVerInfo) then
+            AdditionalVersionInfos.Add(DelphiVerInfo);
+        end else if Assigned(DelphiVerInfo) then
+          VersionInfo := DelphiVerInfo
+        else begin
+          WriteLn('Error: Could not read either of the version info files.');
+          raise EHalt.Create(1);
         end;
-      end;
 
-      if not Assigned(VersionInfo) then begin
-        WriteLn(Format('Error: Could not read either %:0s.bdsproj or %:0s.dof', [Projectname]));
-        raise EHalt.Create(1);
-      end;
+        BuildNo := VersionInfo.Build;
+        WriteLn('BuildNo from ', VersionInfo.VerInfoFilename, ' is ', BuildNo);
+        for i := 0 to AdditionalVersionInfos.Count - 1 do begin
+          OtherVerinfo := AdditionalVersionInfos[i] as IVersionInfo;
+          if OtherVerinfo.Build > BuildNo then begin
+            BuildNo := OtherVerinfo.Build;
+            Writeln('BuildNo from ', OtherVerinfo.VerInfoFilename, ' is higher, using ', BuildNo);
+          end;
+        end;
 
-      if VersionInfo.AutoIncBuild then begin
-        Write('Incrementing build number ');
-        VersionInfo.Build := VersionInfo.Build + 1;
-        VersionInfo.UpdateFile;
+        if VersionInfo.AutoIncBuild then begin
+          Write('Incrementing build number ');
+          VersionInfo.Build := BuildNo + 1;
+          VersionInfo.UpdateFile;
+          WriteLn('OK');
+          WriteLn('New version number is ', VersionInfo.MajorVer, '.', VersionInfo.MinorVer,
+            '.', VersionInfo.Release, ' build ', VersionInfo.Build);
+        end;
+
+        Write('Writing ', Projectname, '.rc file ');
+        WriteRcFile(Projectname, VersionInfo);
         WriteLn('OK');
-      end;
 
-      Write('Writing ', Projectname, '.rc file ');
-      WriteRcFile(Projectname, VersionInfo);
-      WriteLn('OK');
-
-      if Assigned(OtherVerinfo) then begin
-        Write('Updating other version info file ');
-        OtherVerinfo.Assign(VersionInfo);
-        OtherVerinfo.UpdateFile;
-        WriteLn('OK');
+        for i := 0 to AdditionalVersionInfos.Count - 1 do begin
+          OtherVerinfo := AdditionalVersionInfos[i] as IVersionInfo;
+          Write('Updating ', OtherVerinfo.VerInfoFilename, ' ');
+          OtherVerinfo.Assign(VersionInfo);
+          OtherVerinfo.UpdateFile;
+          WriteLn('OK');
+        end;
+      finally
+        AdditionalVersionInfos.Free;
       end;
-
     except
       on e: EHalt do
         ResultCode := e.ResultCode;

Modified: utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-11 21:58:48 UTC (rev 158)
@@ -11,7 +11,7 @@
   {: Tries to read a <projectname>.ini file, succeeds, if it exists
      @param Project is the project name (*.dpr file without extension)
      @param VersionInfo is a TVersionInfoRec record which will be filled with the version info }
-  TIniVersionInfo = class(TInterfacedObject, IVersionInfo)
+  TIniVersionInfo = class(TInterfacedObject)
   protected
     FIniFile: TMemIniFile;
     FInfoSection: string;
@@ -22,6 +22,24 @@
     procedure WriteString(const _Section, _Ident: string; _Value: string); virtual;
     function ReadBool(const _Section, _Ident: string; _Default: boolean): boolean; virtual;
     procedure WriteBool(const _Section, _Ident: string; _Value: boolean); virtual;
+    procedure ReadValues;
+    procedure WriteValues;
+  private
+    FFileVersion: string;
+    FProductVersion: string;
+    FProductName: string;
+    FMinorVer: integer;
+    FLegalTrademarks: string;
+    FRelease: integer;
+    FLegalCopyright: string;
+    FMajorVer: integer;
+    FCompanyName: string;
+    FAutoIncBuild: boolean;
+    FFileDescription: string;
+    FBuild: integer;
+    FInternalName: string;
+    FOriginalFilename: string;
+    FComments: string;
   protected // implementation of IVersionInfo
     function GetBuild: integer;
     procedure SetBuild(_Build: integer);
@@ -95,9 +113,12 @@
   const _InfoKeysSection: string);
 begin
   inherited Create;
+  if not FileExists(_FullFilename) then
+    raise ENoVersionInfo.CreateFmt('File %s does not exist.', [_FullFilename]);
   FInfoSection := _InfoSection;
   FInfoKeysSection := _InfoKeysSection;
   FIniFile := TMemIniFile.Create(_FullFilename);
+  ReadValues;
 end;
 
 destructor TIniVersionInfo.Destroy;
@@ -159,158 +180,197 @@
   Release := _VersionInfo.Release;
 end;
 
+procedure TIniVersionInfo.ReadValues;
+begin
+  FAutoIncBuild := ReadBool(FInfoSection, 'AutoIncBuild', False);
+  FBuild := ReadInteger(FInfoSection, 'Build', 0);
+  FComments := ReadString(FInfoKeysSection, 'Comments', '');
+  FCompanyName := ReadString(FInfoKeysSection, 'CompanyName', '');
+  FFileDescription := ReadString(FInfoKeysSection, 'FileDescription', '');
+  FFileVersion := ReadString(FInfoKeysSection, 'FileVersion', '');
+  FInternalName := ReadString(FInfoKeysSection, 'InternalName', '');
+  FLegalCopyright := ReadString(FInfoKeysSection, 'LegalCopyright', '');
+  FLegalTrademarks := ReadString(FInfoKeysSection, 'LegalTrademarks', '');
+  FMajorVer := ReadInteger(FInfoSection, 'MajorVer', 0);
+  FMinorVer := ReadInteger(FInfoSection, 'MinorVer', 0);
+  FOriginalFilename := ReadString(FInfoKeysSection, 'OriginalFilename', '');
+  FProductName := ReadString(FInfoKeysSection, 'ProductName', '');
+  FProductVersion := ReadString(FInfoKeysSection, 'ProductVersion', '');
+  FRelease := ReadInteger(FInfoSection, 'Release', 0);
+end;
+
+procedure TIniVersionInfo.WriteValues;
+begin
+  WriteBool(FInfoSection, 'AutoIncBuild', FAutoIncBuild);
+  WriteInteger(FInfoSection, 'Build', FBuild);
+  WriteString(FInfoKeysSection, 'Comments', FComments);
+  WriteString(FInfoKeysSection, 'CompanyName', FCompanyName);
+  WriteString(FInfoKeysSection, 'FileDescription', FFileDescription);
+  WriteString(FInfoKeysSection, 'FileVersion', FFileVersion);
+  WriteString(FInfoKeysSection, 'InternalName', FInternalName);
+  WriteString(FInfoKeysSection, 'LegalCopyright', FLegalCopyright);
+  WriteString(FInfoKeysSection, 'LegalTrademarks', FLegalTrademarks);
+  WriteInteger(FInfoSection, 'MajorVer', FMajorVer);
+  WriteInteger(FInfoSection, 'MinorVer', FMinorVer);
+  WriteString(FInfoKeysSection, 'OriginalFilename', FOriginalFilename);
+  WriteString(FInfoKeysSection, 'ProductName', FProductName);
+  WriteString(FInfoKeysSection, 'ProductVersion', FProductVersion);
+  WriteInteger(FInfoSection, 'Release', FRelease);
+end;
+
 function TIniVersionInfo.GetAutoIncBuild: boolean;
 begin
-  Result := ReadInteger(FInfoSection, 'AutoIncBuild', 0) <> 0;
+  Result := FAutoIncBuild;
 end;
 
 function TIniVersionInfo.GetBuild: integer;
 begin
-  Result := ReadInteger(FInfoSection, 'Build', 0);
+  Result := FBuild;
 end;
 
 function TIniVersionInfo.GetComments: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'Comments', '');
+  Result := FComments;
 end;
 
 function TIniVersionInfo.GetCompanyName: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'CompanyName', '');
+  Result := FCompanyName;
 end;
 
 function TIniVersionInfo.GetFileDescription: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'FileDescription', '');
+  Result := FFileDescription;
 end;
 
 function TIniVersionInfo.GetFileVersion: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'FileVersion', '');
+  Result := FFileVersion;
 end;
 
 function TIniVersionInfo.GetInternalName: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'InternalName', '');
+  Result := FInternalName;
 end;
 
 function TIniVersionInfo.GetLegalCopyright: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'LegalCopyright', '');
+  Result := FLegalCopyright;
 end;
 
 function TIniVersionInfo.GetLegalTrademarks: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'LegalTrademarks', '');
+  Result := FLegalTrademarks;
 end;
 
 function TIniVersionInfo.GetMajorVer: integer;
 begin
-  Result := ReadInteger(FInfoSection, 'MajorVer', 0);
+  Result := FMajorVer;
 end;
 
 function TIniVersionInfo.GetMinorVer: integer;
 begin
-  Result := ReadInteger(FInfoSection, 'MinorVer', 0);
+  Result := FMinorVer;
 end;
 
 function TIniVersionInfo.GetOriginalFilename: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'OriginalFilename', '');
+  Result := FOriginalFilename;
 end;
 
 function TIniVersionInfo.GetProductName: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'ProductName', '');
+  Result := FProductName;
 end;
 
 function TIniVersionInfo.GetProductVersion: string;
 begin
-  Result := ReadString(FInfoKeysSection, 'ProductVersion', '');
+  Result := FProductVersion;
 end;
 
 function TIniVersionInfo.GetRelease: integer;
 begin
-  Result := ReadInteger(FInfoSection, 'Release', 0);
+  Result := FRelease;
 end;
 
 procedure TIniVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
 begin
-  WriteBool(FInfoSection, 'AutoIncBuild', _AutoIncBuild);
+  FAutoIncBuild := _AutoIncBuild;
 end;
 
 procedure TIniVersionInfo.SetBuild(_Build: integer);
 begin
-  WriteInteger(FInfoSection, 'Build', _Build);
+  FBuild := _Build;
 end;
 
 procedure TIniVersionInfo.SetComments(const _Comments: string);
 begin
-  WriteString(FInfoKeysSection, 'Comments', _Comments);
+  FComments := _Comments;
 end;
 
 procedure TIniVersionInfo.SetCompanyName(_CompanyName: string);
 begin
-  WriteString(FInfoKeysSection, 'CompanyName', _CompanyName);
+  FCompanyName := _CompanyName;
 end;
 
 procedure TIniVersionInfo.SetFileDescription(_FileDescription: string);
 begin
-  WriteString(FInfoKeysSection, 'FileDescription', _FileDescription);
+  FFileDescription := _FileDescription;
 end;
 
 procedure TIniVersionInfo.SetFileVersion(_FileVersion: string);
 begin
-  WriteString(FInfoKeysSection, 'FileVersion', _FileVersion);
+  FFileVersion := _FileVersion;
 end;
 
 procedure TIniVersionInfo.SetInternalName(_InternalName: string);
 begin
-  WriteString(FInfoKeysSection, 'InternalName', _InternalName);
+  FInternalName := _InternalName;
 end;
 
 procedure TIniVersionInfo.SetLegalCopyright(_LegalCopyright: string);
 begin
-  WriteString(FInfoKeysSection, 'LegalCopyright', _LegalCopyright);
+  FLegalCopyright := _LegalCopyright;
 end;
 
 procedure TIniVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
 begin
-  WriteString(FInfoKeysSection, 'LegalTrademarks', _LegalTrademarks);
+  FLegalTrademarks := _LegalTrademarks;
 end;
 
 procedure TIniVersionInfo.SetMajorVer(_MajorVer: integer);
 begin
-  WriteInteger(FInfoSection, 'MajorVer', _MajorVer);
+  FMajorVer := _MajorVer;
 end;
 
 procedure TIniVersionInfo.SetMinorVer(_MinorVer: integer);
 begin
-  WriteInteger(FInfoSection, 'MinorVer', _MinorVer);
+  FMinorVer := _MinorVer;
 end;
 
 procedure TIniVersionInfo.SetOriginalFilename(_OriginalFilename: string);
 begin
-  WriteString(FInfoKeysSection, 'OriginalFilename', _OriginalFilename);
+  FOriginalFilename := _OriginalFilename;
 end;
 
 procedure TIniVersionInfo.SetProductName(_ProductName: string);
 begin
-  WriteString(FInfoKeysSection, 'ProductName', _ProductName);
+  FProductName := _ProductName;
 end;
 
 procedure TIniVersionInfo.SetProductVersion(_ProductVersion: string);
 begin
-  WriteString(FInfoKeysSection, 'ProductVersion', _ProductVersion);
+  FProductVersion := _ProductVersion;
 end;
 
 procedure TIniVersionInfo.SetRelease(_Release: integer);
 begin
-  WriteInteger(FInfoSection, 'Release', _Release);
+  FRelease := _Release;
 end;
 
 procedure TIniVersionInfo.UpdateFile;
 begin
+  WriteValues;
   FIniFile.UpdateFile;
 end;
 


Property changes on: utilities/dzPrepBuild/trunk/testdata
___________________________________________________________________
Name: svn:ignore
   + testproject.rc


Added: utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini	2007-07-11 20:43:22 UTC (rev 157)
+++ utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini	2007-07-11 21:58:48 UTC (rev 158)
@@ -0,0 +1,27 @@
+[Version Info]
+IncludeVerInfo=1
+AutoIncBuild=1
+MajorVer=1
+MinorVer=0
+Release=0
+Build=31
+Debug=0
+PreRelease=0
+Special=0
+Private=0
+DLL=0
+Locale=1033
+CodePage=1252
+
+[Version Info Keys]
+CompanyName=iCD. GmbH
+FileDescription=Dof2Rc Tool
+FileVersion=1.0.0.21
+InternalName=dof2rc
+LegalCopyright=Copyright 2002-2005 by iCD. GmbH
+LegalTrademarks=
+OriginalFilename=dof2rc.exe
+ProductName=Dof2Rc
+ProductVersion=1.0.0.0
+Comments=internal use only
+



From twm at mail.berlios.de  Sat Jul 14 12:49:22 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:49:22 +0200
Subject: [Dzchart-svncheckins] r159 - utilities/dzLib/trunk/src
Message-ID: <200707141049.l6EAnMHY014441@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:49:19 +0200 (Sat, 14 Jul 2007)
New Revision: 159

Modified:
   utilities/dzLib/trunk/src/u_dzConvertUtils.pas
Log:
additional overloaded versions of Float2Str

Modified: utilities/dzLib/trunk/src/u_dzConvertUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzConvertUtils.pas	2007-07-11 21:58:48 UTC (rev 158)
+++ utilities/dzLib/trunk/src/u_dzConvertUtils.pas	2007-07-14 10:49:19 UTC (rev 159)
@@ -167,8 +167,24 @@
    @param(flt is an extended floating point value)
    @param(DecSeparator is the decimal separator to use)
    @returns(a string representation of the floating point value) }
-function Float2Str(_flt: extended; _DecSeparator: char = '.'): string;
+function Float2Str(_flt: extended; _DecSeparator: char = '.'): string; overload;
 
+{: Converts a floating point number to a string using the given with, number of decimals
+   and a '.' as decimal separator, if width is too small the smallest representation possible
+   will be used (eg. Float2Str(5.24, 3, 2, '.') = '5.24')
+   @param flt is an extended floating point value
+   @param Width is the total number of digits (including the decimal separator
+   @param Decimals is the number of decimals to use
+   @returns a string representation of the floating point value }
+function Float2Str(_flt: extended; _Width, _Decimals: integer): string; overload;
+
+{: Converts a floating point number to a string using the given number of decimals
+   and a '.' as decimal separator.
+   @param flt is an extended floating point value
+   @param Decimals is the number of decimals to use
+   @returns a string representation of the floating point value }
+function Float2Str(_flt: extended; _Decimals: integer): string; overload;
+
 implementation
 
 uses
@@ -398,6 +414,16 @@
   Result := SysUtils.FloatToStr(_Flt, FormatSettings);
 end;
 
+function Float2Str(_flt: extended; _Width, _Decimals: integer): string;
+begin
+  Str(_flt: _Width: _Decimals, Result);
+end;
+
+function Float2Str(_flt: extended; _Decimals: integer): string;
+begin
+  Str(_Flt: 0: _Decimals, Result);
+end;
+
 function Str2Int(_s: string; _Default: integer): integer;
 var
   e: integer;



From twm at mail.berlios.de  Sat Jul 14 12:49:56 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:49:56 +0200
Subject: [Dzchart-svncheckins] r160 - utilities/dzLib/trunk/src
Message-ID: <200707141049.l6EAnuCg015195@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:49:52 +0200 (Sat, 14 Jul 2007)
New Revision: 160

Added:
   utilities/dzLib/trunk/src/u_dzClassUtils.pas
Log:
contains functions that work on classes but are not methods

Added: utilities/dzLib/trunk/src/u_dzClassUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzClassUtils.pas	2007-07-14 10:49:19 UTC (rev 159)
+++ utilities/dzLib/trunk/src/u_dzClassUtils.pas	2007-07-14 10:49:52 UTC (rev 160)
@@ -0,0 +1,229 @@
+{GXFormatter.config=twm}
+{: Implements functions which work on classes but are not methods.
+   @autor(twm) }
+unit u_dzClassUtils;
+
+interface
+
+uses
+  SysUtils,
+  Classes;
+
+// NOTE: The naming convention is <extended-class>_<Methodname>
+
+type
+  {: raised by StringByObj if no matching entry was found }
+  EObjectNotFound = class(Exception);
+
+  {: Removes trailing spaces from all lines in Strings as well as empty lines
+     from the end of Strings, returns true if at least one string was shortened
+     or an empty string was removed.
+     @param Strings is the TStrings class to work on.
+     @returns true, if something was changed, false otherwise }
+function TStrings_RemoveTrailingSpaces(_Strings: TStrings): boolean;
+
+{: Free a TStrings object including all it's Object[n]s }
+procedure TStrings_FreeWithObjects(_Strings: TStrings);
+
+{: Frees all objects stored in the TStrings intance and returns the instance,
+   meant to be called like
+   @code( TStrings_FreeAllObjects(sl).Free; ) or
+   @code( TStrings_FreeAllObjects(sl).Clear; ) }
+function TStrings_FreeAllObjects(_Strings: TStrings): TStrings;
+
+{: frees the object and delets the entry from the list }
+procedure TStrings_DeleteAndFreeObject(_Strings: TStrings; _Idx: integer);
+
+{: Free a TList object an all TObjects it contains
+   NOTE: this function is obsolete, use contnrs.TObjectList instead! }
+procedure TList_FreeWithItems(var _List: TList); deprecated; // use contnrs.TObjectList
+
+{: Write a string to the stream
+   @param Stream is the TStream to write to.
+   @param s is the string to write
+   @returns the number of bytes written. }
+function TStream_WriteString(_Stream: TStream; const _s: string): integer;
+
+{: Write a string to the stream appending CRLF
+   @param Stream is the TStream to write to.
+   @param s is the string to write
+   @returns the number of bytes written. }
+function TStream_WriteStringLn(_Stream: TStream; const _s: string): integer;
+
+{: Read a line from a stream, that is, a string ending in CRLF
+   @param Stream is the TStream to read from.
+   @param s returns the read string.
+   @returns the number of bytes read. }
+function TStream_ReadStringLn(_Stream: TStream; out _s: string): integer;
+
+{: Write formatted data to the stream appending CRLF
+   @param Stream is the TStream to write to.
+   @param Format is a format string as used in sysutils.format
+   @param Args is an array of const as used in sysutils.format
+   @returns the number of bytes written. }
+function TStream_WriteFmtLn(_Stream: TStream; const _Format: string; _Args: array of const): integer;
+
+{: returns the string which has the given value as Object
+   @param Strings is the TStrings to search
+   @param Obj is a pointer to match
+   @param RaiseException is a boolean that controls whether an exception should
+          be raised (if true) if the Obj cannot be found or an empty strin should
+          be returned (if false), Default = true
+   @returns the string whose object matches Obj or an empty string, if none
+            was found and RaiseExeption was false
+   @raises EObjectNotFound if a matching object was not found and RaiseException
+                           is true. }
+function TStrings_StringByObj(_Strings: TStrings; _Obj: pointer; _RaiseException: boolean = true): string;
+
+{: determines the string which has the given value as Object
+   @param Strings is the TStrings to search
+   @param Obj is a pointer to match
+   @param Value is the string whose object matches Obj, only valid if result is true
+   @returns true, if a matching object was found, false otherwise }
+function TStrings_TryStringByObj(_Strings: TStrings; _Obj: pointer; out _Value: string): boolean;
+
+implementation
+
+uses
+  StrUtils,
+  u_dzStringUtils;
+
+procedure TList_FreeWithItems(var _List: TList);
+var
+  i: integer;
+begin
+  if Assigned(_List) then begin
+    for i := 0 to _List.Count - 1 do
+      TObject(_List[i]).Free;
+    _List.Free;
+    _List := nil;
+  end;
+end;
+
+function TStrings_RemoveTrailingSpaces(_Strings: tStrings): boolean;
+var
+  i: integer;
+  s: string;
+  Trailing: boolean;
+  p: integer;
+  Len: integer;
+begin
+  Result := false;
+  Trailing := true;
+  for i := _Strings.Count - 1 downto 0 do begin
+    s := _Strings[i];
+    Len := Length(s);
+    p := Len;
+    while (p > 0) and (s[p] = ' ') do
+      Dec(p);
+    if Len <> p then begin
+      Result := true;
+      s := LeftStr(s, p);
+    end;
+    if Trailing and (s = '') then begin
+      Result := true;
+      _Strings.Delete(i);
+    end else begin
+      Trailing := false;
+      _Strings[i] := s;
+    end;
+  end;
+end;
+
+function TStrings_FreeAllObjects(_Strings: TStrings): TStrings;
+var
+  i: Integer;
+begin
+  for i := 0 to _Strings.Count - 1 do
+    _Strings.Objects[i].Free;
+  Result := _Strings;
+end;
+
+procedure TStrings_FreeWithObjects(_Strings: TStrings);
+begin
+  TStrings_FreeAllObjects(_Strings).Free;
+end;
+
+procedure TStrings_DeleteAndFreeObject(_Strings: TStrings; _Idx: integer);
+begin
+  _Strings.Objects[_Idx].Free;
+  _Strings.Delete(_Idx);
+end;
+
+function TStream_WriteString(_Stream: TStream; const _s: string): integer;
+begin
+  Result := _Stream.Write(pChar(_s)^, Length(_s));
+end;
+
+function TStream_WriteStringLn(_Stream: TStream; const _s: string): integer;
+begin
+  Result := TStream_WriteString(_Stream, _s);
+  Result := Result + TStream_WriteString(_Stream, #13#10);
+end;
+
+function TStream_WriteFmtLn(_Stream: TStream; const _Format: string; _Args: array of const): integer;
+begin
+  Result := TStream_WriteStringLn(_Stream, Format(_Format, _Args));
+end;
+
+function TStream_ReadStringLn(_Stream: TStream; out _s: string): integer;
+var
+  OldPos: integer;
+  EndString: integer;
+  NewPos: integer;
+  c: char;
+begin
+  // twm: this is not really efficient, because it reads single bytes, if it becomes a problem, optimize it ;-)
+  OldPos := _Stream.Position;
+  Assert(SizeOf(c) = 1, 'This works only with one byte characters!');
+  EndString := OldPos;
+  NewPos := OldPos;
+  while true do begin
+    if _Stream.Read(c, 1) = 0 then begin // end of file
+      EndString := _Stream.Position;
+      NewPos := EndString;
+      break;
+    end else if c = #13 then begin
+      EndString := _Stream.Position - 1;
+      if _Stream.Read(c, 1) = 0 then
+        NewPos := _Stream.Position
+      else if c = #10 then
+        NewPos := _Stream.Position
+      else
+        NewPos := _Stream.Position - 1;
+      break;
+    end;
+  end;
+  Result := EndString - OldPos;
+  SetLength(_s, Result);
+  if Result <> 0 then begin
+    _Stream.Position := OldPos;
+    _Stream.Read(_s[1], Length(_s));
+  end;
+  _Stream.Position := NewPos;
+end;
+
+function TStrings_TryStringByObj(_Strings: TStrings; _Obj: pointer; out _Value: string): boolean;
+var
+  i: integer;
+begin
+  for i := 0 to _Strings.Count - 1 do
+    if _Strings.Objects[i] = _Obj then begin
+      _Value := _Strings[i];
+      Result := true;
+      exit;
+    end;
+  Result := false;
+end;
+
+function TStrings_StringByObj(_Strings: TStrings; _Obj: pointer; _RaiseException: boolean = true): string;
+begin
+  if not TStrings_TryStringByObj(_Strings, _Obj, Result) then begin
+    if _RaiseException then
+      raise EObjectNotFound.Create('no matching object found');
+    Result := '';
+  end;
+end;
+
+end.
+



From twm at mail.berlios.de  Sat Jul 14 12:50:45 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:50:45 +0200
Subject: [Dzchart-svncheckins] r161 - utilities/dzLib/trunk/src
Message-ID: <200707141050.l6EAojGW016092@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:50:41 +0200 (Sat, 14 Jul 2007)
New Revision: 161

Added:
   utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas
Log:
extended TestCase class for unit tests

Added: utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas	2007-07-14 10:49:52 UTC (rev 160)
+++ utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas	2007-07-14 10:50:41 UTC (rev 161)
@@ -0,0 +1,186 @@
+unit u_dzUnitTestUtils;
+
+interface
+
+uses
+  SysUtils,
+  Classes,
+  TestFramework;
+
+{$M+}
+type
+  {: implements some additional CheckXxx procedures, for now mainly for checking variants }
+  TdzTestCase = class(TTestcase)
+  protected
+  public
+    {: Checks whether the value is a variant of a floating point type (includes integer) }
+    procedure CheckVariantIsFloat(_Value: variant; _Msg: string);
+    {: Checks whether the value is a variant of an (signed) integer type (excludes LongWord and Int64) }
+    procedure CheckVariantIsInteger(_Value: variant; _Msg: string);
+    {: Checks whether the value is a variant of an (signed) int64 type (includes LongWord and Int64) }
+    procedure CheckVariantIsInt64(_Value: variant; _Msg: string);
+    {: Checks whether the value is a variant of an (unsigned) integer type (excludes all signed integer types) }
+    procedure CheckVariantIsLongWord(_Value: variant; _Msg: string);
+    {: Checks whether the value is a non Null variant }
+    procedure CheckVariantIsNotNull(_Value: variant; _Msg: string); overload;
+    {: Checks whether the value is a Null variant }
+    procedure CheckVariantIsNull(_Value: variant; _Msg: string); overload;
+    {: Checks whether the value is a variant of a string type }
+    procedure CheckVariantIsString(_Value: variant; _Msg: string); overload;
+    {: Called by the CheckVAriantIsXxxx functions to show errors }
+    procedure FailNotVarType(const _Expected, _Actual, _Msg: string; _ErrorAddr: pointer);
+    {: Called by the FailNotVarType function to generate the error message }
+    function NotVarTypeErrorMessage(const _Expected: string; const _Actual: string; _Msg: string): string;
+    {: Checks whether the date part of two TDateTime values is equal }
+    procedure CheckEqualsDate(_Expected, _Actual: TDateTime; const _Message: string);
+    {: Checks whether two TDateTime values are equal }
+    procedure CheckEqualsDateTime(_Expected, _Actual: TDateTime; const _Message: string);
+    {: Checks whether the time part of two TDateTime values is equal }
+    procedure CheckEqualsTime(_Expected, _Actual: TDateTime; const _Message: string);
+    {: Checks multiline strings for equality }
+    procedure CheckEqualsMultiline(_Expected, _Actual: string; const _Message: string = '');
+    {: Checks a multiline string against the content of a file }
+    procedure CheckEqualsFile(const _Filename: string; _Actual: string; const _Message: string = '');
+    {: checks whether two files have got the same contents, content is treated as a multiline string }
+    procedure CheckEqualsFiles(const _ExpectedFile, _ActualFile: string; const _Message: string = '');
+  end;
+
+implementation
+
+uses
+  Variants,
+  DateUtils,
+  u_dzVariantUtils;
+
+resourcestring
+  StrSexpectedVariantT = '%sexpected variant type: <%s> but was: <%s>';
+
+  { TdzTestCase }
+
+procedure TdzTestCase.CheckVariantIsInt64(_Value: variant; _Msg: string);
+begin
+  if not VarIsInt64(_Value) then
+    FailNotVarType('int64', VarTypeAsText(VarType(_Value)), _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckVariantIsInteger(_Value: variant; _Msg: string);
+begin
+  if not VarIsInteger(_Value) then
+    FailNotVarType('integer', VarTypeAsText(VarType(_Value)), _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckVariantIsLongWord(_Value: variant; _Msg: string);
+begin
+  if not VarIsLongWord(_Value) then
+    FailNotVarType('longword', VarTypeAsText(VarType(_Value)), _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckEqualsDate(_Expected, _Actual: TDateTime; const _Message: string);
+begin
+  if not DateUtils.SameDate(_Expected, _Actual) then
+    FailNotEquals(FloatToStr(_Expected), FloatToStr(_Actual), _Message, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckEqualsDateTime(_Expected, _Actual: TDateTime;
+  const _Message: string);
+begin
+  if not DateUtils.SameDateTime(_Expected, _Actual) then
+    FailNotEquals(FloatToStr(_Expected), FloatToStr(_Actual), _Message, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckEqualsFile(const _Filename: string; _Actual: string; const _Message: string);
+var
+  sl: TStringList;
+begin
+  sl := TStringList.Create;
+  try
+    sl.LoadFromFile(_Filename);
+    CheckEqualsMultiline(sl.Text, _Actual, _Message);
+  finally
+    sl.Free;
+  end;
+end;
+
+procedure TdzTestCase.CheckEqualsFiles(const _ExpectedFile, _ActualFile, _Message: string);
+var
+  sl: TStringList;
+  Soll: string;
+begin
+  sl := TStringList.Create;
+  try
+    sl.LoadFromFile(_ExpectedFile);
+    Soll := sl.Text;
+    sl.Clear;
+    sl.LoadFromFile(_ActualFile);
+    CheckEqualsMultiline(Soll, sl.Text);
+  finally
+    sl.Free;
+  end;
+end;
+
+procedure TdzTestCase.CheckEqualsMultiline(_Expected, _Actual: string; const _Message: string = '');
+var
+  ExpStrings: TStringList;
+  ActStrings: TStringList;
+  i: Integer;
+begin
+  ActStrings := nil;
+  ExpStrings := TStringList.Create;
+  try
+    ActStrings := TStringList.Create;
+    ExpStrings.Text := _Expected;
+    ActStrings.Text := _Actual;
+    CheckEquals(ExpStrings.Count, ActStrings.Count, _Message + ' (no of lines does not match)');
+    for i := 0 to ExpStrings.Count - 1 do
+      CheckEquals(ExpStrings[i], ActStrings[i], _Message + Format(' (line %d does not match)', [i]));
+  finally
+    ActStrings.Free;
+    ExpStrings.Free;
+  end;
+end;
+
+procedure TdzTestCase.CheckEqualsTime(_Expected, _Actual: TDateTime;
+  const _Message: string);
+begin
+  if not DateUtils.SameTime(_Expected, _Actual) then
+    FailNotEquals(FloatToStr(_Expected), FloatToStr(_Actual), _Message, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckVariantIsFloat(_Value: variant; _Msg: string);
+begin
+  if not VarIsFloat(_Value) then
+    FailNotVarType('float', VarTypeAsText(VarType(_Value)), _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckVariantIsNotNull(_Value: variant; _Msg: string);
+begin
+  if VarIsNull(_Value) then
+    FailNotVarType('not null', 'null', _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckVariantIsNull(_Value: variant; _Msg: string);
+begin
+  if not VarIsNull(_Value) then
+    FailNotVarType('null', VarTypeAsText(VarType(_Value)), _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.CheckVariantIsString(_Value: variant; _Msg: string);
+begin
+  if not VarIsStr(_Value) then
+    FailNotVarType('string', VarTypeAsText(VarType(_Value)), _Msg, CallerAddr);
+end;
+
+procedure TdzTestCase.FailNotVarType(const _Expected, _Actual, _Msg: string; _ErrorAddr: pointer);
+begin
+  Fail(NotVarTypeErrorMessage(_Expected, _Actual, _Msg), _ErrorAddr);
+end;
+
+function TdzTestCase.NotVarTypeErrorMessage(const _Expected: string; const _Actual: string; _Msg: string): string;
+begin
+  if (_Msg <> '') then
+    _Msg := _Msg + ', ';
+  Result := Format(StrSexpectedVariantT, [_Msg, _Expected, _Actual])
+end;
+
+end.
+



From twm at mail.berlios.de  Sat Jul 14 12:52:09 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:52:09 +0200
Subject: [Dzchart-svncheckins] r162 - utilities/dzLib/trunk/src
Message-ID: <200707141052.l6EAq9an016426@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:51:57 +0200 (Sat, 14 Jul 2007)
New Revision: 162

Modified:
   utilities/dzLib/trunk/src/u_dzVclUtils.pas
Log:
net procedure TCheckBox_SetCheckedNoOnClick

Modified: utilities/dzLib/trunk/src/u_dzVclUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzVclUtils.pas	2007-07-14 10:50:41 UTC (rev 161)
+++ utilities/dzLib/trunk/src/u_dzVclUtils.pas	2007-07-14 10:51:57 UTC (rev 162)
@@ -265,7 +265,7 @@
    @param Obj is the value of the object pointer of the selected item, only valid
           if the function returns true
    @returns true, if these values are valid }
-function TRadioGroup_GetSelectedObject(_rg: TCustomRadioGroup;out _Idx: integer; out _Obj: pointer): boolean;
+function TRadioGroup_GetSelectedObject(_rg: TCustomRadioGroup; out _Idx: integer; out _Obj: pointer): boolean;
 
 {: Writes a TPicture object to a String. The Format is
    <pictureformat>#26<picturedata> }
@@ -319,6 +319,9 @@
 {: Center the child on the parent}
 procedure TControl_Center(_Child: TControl; _Parent: TControl);
 
+{: sets the Checked property without firing an OnClick event }
+procedure TCheckBox_SetCheckedNoOnClick(_Chk: TCustomCheckBox; _Checked: boolean);
+
 {: switches off "Windows Ghosting" in Win 2000 and XP
   This is a workaround for the bug that modal forms sometimes aren't modal in W2K and XP.
   Call in application startup. }
@@ -860,7 +863,7 @@
     _Caption := StripHotKey(Hack.Items[_Idx]);
 end;
 
-function TRadioGroup_GetSelectedObject(_rg: TCustomRadioGroup;out _Idx: integer; out _Obj: pointer): boolean;
+function TRadioGroup_GetSelectedObject(_rg: TCustomRadioGroup; out _Idx: integer; out _Obj: pointer): boolean;
 var
   Hack: TRadioGroupHack;
 begin
@@ -1042,6 +1045,23 @@
   _child.top := (_parent.height - _child.height) div 2;
 end;
 
+type
+  TCheckBox = class(TCustomCheckBox)
+  end;
+
+procedure TCheckBox_SetCheckedNoOnClick(_Chk: TCustomCheckBox; _Checked: boolean);
+var
+  Chk: TCheckBox;
+begin
+  Chk := TCheckBox(_Chk);
+  Chk.ClicksDisabled := true;
+  try
+    Chk.Checked := _Checked;
+  finally
+    Chk.ClicksDisabled := false;
+  end;
+end;
+
 procedure DisableProcessWindowsGhosting;
 var
   DisableProcessWindowsGhostingProc: procedure;
@@ -1206,13 +1226,12 @@
 end;
 
 procedure TMemo_ScrollToEnd(_Memo: TMemo);
-Var
+var
   cnt: Integer;
-Begin
+begin
   cnt := SendMessage(_Memo.Handle, EM_GETLINECOUNT, 0, 0);
   SendMessage(_Memo.Handle, EM_LINESCROLL, 0, cnt);
-End;
+end;
 
-
 end.
 



From twm at mail.berlios.de  Sat Jul 14 12:52:59 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:52:59 +0200
Subject: [Dzchart-svncheckins] r163 - utilities/dzLib/trunk/src
Message-ID: <200707141052.l6EAqx2b016490@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:52:57 +0200 (Sat, 14 Jul 2007)
New Revision: 163

Modified:
   utilities/dzLib/trunk/src/u_dzVariantUtils.pas
Log:
* changed implementation of VarIsXxxx functions
* added Var2DateStr function

Modified: utilities/dzLib/trunk/src/u_dzVariantUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzVariantUtils.pas	2007-07-14 10:51:57 UTC (rev 162)
+++ utilities/dzLib/trunk/src/u_dzVariantUtils.pas	2007-07-14 10:52:57 UTC (rev 163)
@@ -120,6 +120,12 @@
    @returns(an ISO format DateTime string of v or NullValue if v can not be converted) }
 function Var2DateTimeStr(const _v: variant; const _NullValue: string = '*NULL*'): string;
 
+{: Converts a variant to an ISO format Date string (yyyy-mm-dd)
+   @param(v Variant value to convert)
+   @param(NullValue String value to return if v is empty or null)
+   @returns(an ISO format Date string of v or NullValue if v can not be converted) }
+function Var2DateStr(const _v: variant; const _NullValue: string = '*NULL*'): string;
+
 {: Converts a variant to a string
    If v is null or empty, it returns false.
    @param(v Variant value to convert)
@@ -199,19 +205,17 @@
 
 function VarIsInteger(_v: variant): boolean;
 begin
-  Result := FindVarData(_V)^.VType in [varSmallInt, varInteger, varShortInt,
-    varByte, varWord];
+  Result := VarIsType(_V, [varSmallInt, varInteger, varShortInt, varByte, varWord]);
 end;
 
 function VarIsLongWord(_v: variant): boolean;
 begin
-  Result := FindVarData(_V)^.VType in [varByte, varWord, varLongWord];
+  Result := VarIsType(_V, [varByte, varWord, varLongWord]);
 end;
 
 function VarIsInt64(_v: variant): boolean;
 begin
-  Result := FindVarData(_V)^.VType in [varSmallInt, varInteger, varShortInt,
-    varByte, varWord, varLongWord, varInt64];
+  Result := VarIsType(_V, [varSmallInt, varInteger, varShortInt, varByte, varWord, varLongWord, varInt64]);
 end;
 
 function TryVar2Int(const _v: variant; out _Value: integer): boolean;
@@ -285,6 +289,21 @@
     end;
 end;
 
+function Var2DateStr(const _v: variant; const _NullValue: string = '*NULL*'): string;
+var
+  Value: TDateTime;
+begin
+  if VarIsNull(_v) or VarIsEmpty(_v) then
+    Result := _NullValue
+  else
+    try
+      Value := _v;
+      Result := FormatDateTime('yyyy-mm-dd', Value);
+    except
+      Result := _NullValue;
+    end;
+end;
+
 function TryVar2Dbl(const _v: variant; out _Value: double): boolean;
 begin
   Result := not VarIsNull(_v) and not VarIsEmpty(_v);



From twm at mail.berlios.de  Sat Jul 14 12:53:33 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:53:33 +0200
Subject: [Dzchart-svncheckins] r164 - utilities/dzLib/trunk/src
Message-ID: <200707141053.l6EArXn9016555@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:53:28 +0200 (Sat, 14 Jul 2007)
New Revision: 164

Modified:
   utilities/dzLib/trunk/src/u_dzStringUtils.pas
Log:
new function ExtractFirstN


Modified: utilities/dzLib/trunk/src/u_dzStringUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzStringUtils.pas	2007-07-14 10:52:57 UTC (rev 163)
+++ utilities/dzLib/trunk/src/u_dzStringUtils.pas	2007-07-14 10:53:28 UTC (rev 164)
@@ -4,7 +4,7 @@
    @author   twm }
 unit u_dzStringUtils;
 
-{$i jedi.inc}
+{$I jedi.inc}
 
 interface
 
@@ -225,6 +225,9 @@
    @returns true, if a word could be extracted, false otherwise }
 function ExtractFirstWord(var _s: string; _Delimiter: TCharSet; out _FirstWord: string): boolean; overload;
 
+{: extracts the first N characters of a string }
+function ExtractFirstN(var _s: string; _N: integer): string;
+
 {: Split string s into the list of substrings delimited by delimter
    NOTE: duplicate delimiters are ignored, so 'abc  def' will be split
    into two words (which you would expect), but also 'abc'#9#9'def' is two words
@@ -393,6 +396,12 @@
   end;
 end;
 
+function ExtractFirstN(var _s: string; _N: integer): string;
+begin
+  Result := Copy(_s, 1, _N);
+  _s := Copy(_s, _N + 1);
+end;
+
 function SplitString(_sl: TStrings; _s: string; const _Delimiter: string): TStrings;
 var
   s: string;



From twm at mail.berlios.de  Sat Jul 14 12:54:16 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 12:54:16 +0200
Subject: [Dzchart-svncheckins] r165 - utilities/dzLib/trunk/src
Message-ID: <200707141054.l6EAsGY7016697@sheep.berlios.de>

Author: twm
Date: 2007-07-14 12:54:03 +0200 (Sat, 14 Jul 2007)
New Revision: 165

Modified:
   utilities/dzLib/trunk/src/u_dzFileUtils.pas
Log:
new function TFileSystem.DiskFree

Modified: utilities/dzLib/trunk/src/u_dzFileUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzFileUtils.pas	2007-07-14 10:53:28 UTC (rev 164)
+++ utilities/dzLib/trunk/src/u_dzFileUtils.pas	2007-07-14 10:54:03 UTC (rev 165)
@@ -399,6 +399,8 @@
                         the same directory as the original file is used }
     class procedure BackupFile(const _Filename: string; _BackupDir: string = '');
     class function GetFileInfo(const _Filename: string): TFileInfoRec;
+    {: Returns the free space (in bytes) on the disk with the given drive letter }
+    class function DiskFree(_DriveLetter: char): Int64;
   end;
 
 type
@@ -686,6 +688,29 @@
   end;
 end;
 
+class function TFileSystem.DiskFree(_DriveLetter: char): Int64;
+var
+  ErrorMode: Cardinal;
+begin
+  if _DriveLetter in ['a'..'z'] then
+    _DriveLetter := chr(Ord(_DriveLetter) - Ord('a') + Ord('A'));
+
+  if not (_DriveLetter in ['A'..'Z']) then
+    Result := -1
+  else begin
+    ErrorMode := SetErrorMode(SEM_FAILCRITICALERRORS);
+    try
+      try
+        Result := SysUtils.DiskFree(Ord(_DriveLetter) - Ord('A') + 1);
+      except
+        Result := -1;
+      end;
+    finally
+      SetErrorMode(ErrorMode);
+    end;
+  end;
+end;
+
 class function TFileSystem.GetShortPathname(const _LongName: string): string;
 var
   Res: integer;



From twm at mail.berlios.de  Sat Jul 14 13:47:36 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 13:47:36 +0200
Subject: [Dzchart-svncheckins] r166 - utilities/dzCmdLineParser/trunk
Message-ID: <200707141147.l6EBlaFg032316@sheep.berlios.de>

Author: twm
Date: 2007-07-14 13:47:33 +0200 (Sat, 14 Jul 2007)
New Revision: 166

Modified:
   utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas
   utilities/dzCmdLineParser/trunk/u_dzOptionDescList.pas
Log:
Bugfix: Params and Options were switched around in the call to EvaluateCmdLine
Bugfix: TOptionDesc.AssertValidOptionName did not allow for -? option

Modified: utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas
===================================================================
--- utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas	2007-07-14 10:54:03 UTC (rev 165)
+++ utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas	2007-07-14 11:47:33 UTC (rev 166)
@@ -324,7 +324,7 @@
     TCmdLineParser.Execute(System.CmdLine, Options, Params);
     // delete the first "parameter", it is the executable name
     Params.Delete(0);
-    EvaluateCmdLine(Params, Options);
+    EvaluateCmdLine(Options, Params);
   finally
     Options.Free;
     Params.Free;

Modified: utilities/dzCmdLineParser/trunk/u_dzOptionDescList.pas
===================================================================
--- utilities/dzCmdLineParser/trunk/u_dzOptionDescList.pas	2007-07-14 10:54:03 UTC (rev 165)
+++ utilities/dzCmdLineParser/trunk/u_dzOptionDescList.pas	2007-07-14 11:47:33 UTC (rev 166)
@@ -100,7 +100,7 @@
   if _Name = '' then
     raise EOptionName.Create('Option name cannot be empty.');
   { TODO -otwm : Maybe '$', '#' and some other chars should be allowed }
-  if not (_Name[1] in ['a'..'z', 'A'..'Z', '0'..'9']) then
+  if not (_Name[1] in ['a'..'z', 'A'..'Z', '0'..'9', '?']) then
     raise EOptionName.Create('Option name must start with an alphanumeric character.');
   for i := 2 to Length(_Name) do
     if not (_Name[i] in ['a'..'z', 'A'..'Z', '0'..'9', '-', '_']) then



From twm at mail.berlios.de  Sat Jul 14 13:48:46 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 13:48:46 +0200
Subject: [Dzchart-svncheckins] r167 - utilities/dzLib/trunk/src
Message-ID: <200707141148.l6EBmkh6032355@sheep.berlios.de>

Author: twm
Date: 2007-07-14 13:48:45 +0200 (Sat, 14 Jul 2007)
New Revision: 167

Modified:
   utilities/dzLib/trunk/src/u_dzDefaultMain.pas
Log:
now uses TGetOpt rather than the raw TCmdLineParser class

Modified: utilities/dzLib/trunk/src/u_dzDefaultMain.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzDefaultMain.pas	2007-07-14 11:47:33 UTC (rev 166)
+++ utilities/dzLib/trunk/src/u_dzDefaultMain.pas	2007-07-14 11:48:45 UTC (rev 167)
@@ -7,7 +7,7 @@
 
 uses
   u_dzTranslator,
-  u_dzCmdLineParser;
+  u_dzGetOpt;
 
 type
   {: An "application" class for console programs.
@@ -29,7 +29,7 @@
     {: stores the exit code }
     FExitCode: integer;
     {: Created in InitCmdLineParser, allows reading the parameters }
-    FCmdLineParser: TCmdlineParser;
+    FGetOpt: TGetOpt;
     {: Initializes FCmdLineParser with a Parser, should be overridden }
     procedure InitCmdLineParser; virtual;
     {: Zeigt eine vom FCmdLineParser generierte Kurzhilfe zum Programm an und
@@ -95,7 +95,7 @@
 
 destructor TDefaultMain.Destroy;
 begin
-  FreeAndNil(FCmdLineParser);
+  FreeAndNil(FGetOpt);
   LogInfo('Program finished.');
   inherited;
 end;
@@ -114,46 +114,35 @@
     s := Format(_('Error: %s') + #13#10#13#10, [_Error]);
     LogError(_Error);
   end;
-//  MessageDlg(s + Format(
-//    _('Synopsis: %s') + #13#10#13#10 +
-//    _('Parameters:') + #13#10 +
-//    '%s'#13#10#13#10 +
-//    _('Options:') + #13#10 +
-//    '%s',
-//    [fCmdLineParser.GetCmdLineDesc, fCmdLineParser.GetParamHelp, fCmdLineParser.GetOptionHelp]),
-//    mtError, [mbOK], 0);
+  MessageDlg(s + Format(
+    _('Synopsis: %s %s') + #13#10#13#10 +
+    _('Parameters:') + #13#10 +
+    '%s'#13#10#13#10 +
+    _('Options:') + #13#10 +
+    '%s',
+    [FGetOpt.ProgName, FGetOpt.GetCmdLineDesc, FGetOpt.GetParamHelp, FGetOpt.GetOptionHelp]),
+    mtError, [mbOK], 0);
   FExitCode := 1;
   SysUtils.Abort;
 end;
 
 procedure TDefaultMain.InitCmdLineParser;
 begin
-  FCmdLineParser := TCmdLineParser.Create();
-//  FCmdLineParser.RegisterHelpOptions;
+  FGetOpt := TGetOpt.Create();
+  FGetOpt.RegisterHelpOptions;
 end;
 
 procedure TDefaultMain.ParseCmdLine;
-var
-  Options: TStringList;
-  Params: TStringList;
 begin
-  Params := nil;
-  Options := TStringList.Create;
+  LogDebug('Cmdline: ' + System.CmdLine);
   try
-    Params := TStringList.Create;
-    LogDebug('Cmdline: ' + System.CmdLine);
-    try
-      FCmdLineParser.Execute(Options, Params);
-    except
-      on e: exception do
-        Usage(e.Message);
-    end;
-//    if FCmdLineParser.HelpOptionFound then
-//      Usage;
-  finally
-    Params.Free;
-    Options.Free;
+    FGetOpt.Parse;
+  except
+    on e: exception do
+      Usage(e.Message);
   end;
+  if FGetOpt.HelpOptionFound then
+    Usage;
 end;
 
 function TDefaultMain.Execute: integer;
@@ -192,7 +181,7 @@
     // Exception handling findet im MainObj statt, was bis hierher kommt,
     // kann man eh nicht mehr behandeln - aber evt. Loggen ? AS
     on e: Exception do begin
-      LogError('Exception in function Main: '+e.Message+' '+e.ClassName);
+      LogError('Exception in function Main: ' + e.Message + ' ' + e.ClassName);
     end;
   end;
 end;



From twm at mail.berlios.de  Sat Jul 14 14:43:41 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 14:43:41 +0200
Subject: [Dzchart-svncheckins] r168 - utilities/dzLib/trunk/src
Message-ID: <200707141243.l6EChfrF002823@sheep.berlios.de>

Author: twm
Date: 2007-07-14 14:43:40 +0200 (Sat, 14 Jul 2007)
New Revision: 168

Modified:
   utilities/dzLib/trunk/src/u_dzDefaultMain.pas
Log:
if running in the debugger at the end the exit code is displayed and the program waits for Enter

Modified: utilities/dzLib/trunk/src/u_dzDefaultMain.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzDefaultMain.pas	2007-07-14 11:48:45 UTC (rev 167)
+++ utilities/dzLib/trunk/src/u_dzDefaultMain.pas	2007-07-14 12:43:40 UTC (rev 168)
@@ -30,51 +30,52 @@
     FExitCode: integer;
     {: Created in InitCmdLineParser, allows reading the parameters }
     FGetOpt: TGetOpt;
-    {: Initializes FCmdLineParser with a Parser, should be overridden }
+    {: Initializes FGetOptr with a Parser, should be overridden, but make
+       sure you call inherited }
     procedure InitCmdLineParser; virtual;
-    {: Zeigt eine vom FCmdLineParser generierte Kurzhilfe zum Programm an und
-       beendet das Programm durch Aufruf von SysUtils.Abort.
-       @param Error ist eine optionale Fehlermeldung, wenn nicht leer, wird sie ausgegeben }
+    {: Shows a short help generated by the TGetOpt and exits the program by calling
+       SysUtils.Abort.
+       @param Error is an optional error message, which is displayed if not empty }
     procedure Usage(const _Error: string = ''); virtual;
-    {: Ruft die Execute-Methode des Commandline-Parsers auf, danach stehen die
-       Parameter zur Verfuegung. Falls beim Parsen ein Fehler auftritt, so wird
-       automatisch Usage mit der entsprechenden Fehlermeldung aufgerufen. }
+    {: Calls the Parse method of the commandline parser. Afterwards the parameters
+       and options can be accessed using the perser's methods and properties.
+       If there is an error during parsing it automatically calls Usage with
+       the error message. If a help option (-?, -h or -Help) is found, usage
+       will be called without an error message. }
     procedure ParseCmdLine; virtual;
-    {: Diese Methode sollte ueberschrieben werden und die eigentliche Programmfunktion
-       ausfuehren. Sie wird nach dem Parsen der Commandline aufgerufen, so dass
-       zu diesem Zeitpunkt sichergestellt ist, dass die Parameter OK sind.
-       @returns den Exit-Code fuer das Programm }
+    {: This method should be overridden to implement the actual program functionality.
+       It is called after the commandline has ben parsed so you can be sure that
+       the parameters are OK.
+       @returns the exit code for the program }
     function doExecute: integer; virtual;
   public
-    {: Erzeugt eine TDefaultMain-Instanz, setzt den Exit-Code auf 1 (=Fehler)
-       und initialisiert das Logging. }
+    {: Creates a TDefaultMain instance, sets the exit code to 1 (=error) and
+       initializes logging }
     constructor Create; virtual;
-    {: Gibt eine TDefaultMain-Instanz frei und schreibt das
-       Programmende ins Log. }
+    {: Frees a TDefaultMain instance and writes the progrem end into the log }
     destructor Destroy; override;
-    {: Diese Methode sollte aufgerufen werden. Sie initialisiert den Commandline-Parser,
-       fuehrt ihn aus und ruft dann doExecute innerhalb eines Try-Except-Blocks auf
-       Falls in doExecute eine Exception geraised wird, so wird sie hier abgefangen,
-       eine Fehlermeldung auf die Konsole ausgegeben und der Exit-Code auf 1 (=Fehler) gesetzt
-       Falls doExecute ganz normal beendet wird, so wird dessen Ergebnis als
-       Exit-Code verwendet.
-       @returns den Exit-Code des Programms }
+    {: This method should be called after the instance of TDefaultMain has been
+       created. It initialzies the commandline parser, executes it on the given
+       commandline and calls doExecute within a try..except block.
+       If doExecute raises an exception it will write an error message to the
+       console and set the exit code to 1 (=error). If doExecute exits normally
+       it uses the result as exit code.
+       @returns the exit code for the program }
     function Execute: integer;
   end;
 
 type
-  {: Class-Type fuer die globale Variable MainClass }
+  {: Class-Type for the global variable MainClass }
   TMainClass = class of TDefaultMain;
 
 var
-  {: Globale Variable, die auf die Main-Klasse zeigt. Diese
-     Variable wird innerhalb der Funktion @link(Main) verwendet,
-     um eine Klasse zu erzeugen und auszufuehren }
+  {: global variable that points to the main class. This variable is used in
+     @link(Main) to create a TDefaultMain descendant and exeute it. }
   MainClass: TMainClass = TDefaultMain;
 
-  {: Erzeugt eine Instanz von MainClass, ruft deren Execute-Methode auf und liefert
-     den Exit-Code zurueck
-     @returns den Exit-Code des Programms }
+  {: Creates an instance of MainClass, calls its execute method and returns
+     the exit code.
+     @returns the exit code for the program }
 function Main: integer;
 
 implementation
@@ -89,7 +90,7 @@
 constructor TDefaultMain.Create;
 begin
   inherited;
-  // default: Fehler
+  // default: error
   FExitCode := 1;
 end;
 
@@ -178,12 +179,17 @@
       MainObj.Free;
     end;
   except
-    // Exception handling findet im MainObj statt, was bis hierher kommt,
-    // kann man eh nicht mehr behandeln - aber evt. Loggen ? AS
+    // Exception handling is done within the MainObj. If something gets here
+    // it cannot be handled anyway.
+    // - but maybe log it? -- AS
     on e: Exception do begin
       LogError('Exception in function Main: ' + e.Message + ' ' + e.ClassName);
     end;
   end;
+  if DebugHook <> 0 then begin
+    Write('Exit Code: ', Result, ' -- press Enter');
+    Readln;
+  end;
 end;
 
 end.



From twm at mail.berlios.de  Sat Jul 14 14:44:52 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 14:44:52 +0200
Subject: [Dzchart-svncheckins] r169 - in utilities/dzPrepBuild/trunk: . src
Message-ID: <200707141244.l6ECipdp002896@sheep.berlios.de>

Author: twm
Date: 2007-07-14 14:44:49 +0200 (Sat, 14 Jul 2007)
New Revision: 169

Added:
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Modified:
   utilities/dzPrepBuild/trunk/
Log:
started new concept: Read .dof/.bdsproj/.ini and call a script which then does the rest using environment variables.


Property changes on: utilities/dzPrepBuild/trunk
___________________________________________________________________
Name: svn:externals
   - libs\dzlib https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzLib/trunk

   + libs\dzlib https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzLib/trunk
libs\dzCmdLineParser https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzCmdLineParser/trunk
libs\dzTemplates https://svn.berlios.de/svnroot/repos/dztemplates/trunk


Added: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-14 12:43:40 UTC (rev 168)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-14 12:44:49 UTC (rev 169)
@@ -0,0 +1,57 @@
+unit u_PrepBuildMain;
+
+interface
+
+uses
+  u_dzDefaultMain,
+  u_dzGetOpt;
+
+type
+  TPrepBuildMain = class(TDefaultMain)
+  private
+  protected
+    procedure InitCmdLineParser; override;
+    function doExecute: integer; override;
+  public
+
+  end;
+
+implementation
+
+{ TPrepBuildMain }
+
+function TPrepBuildMain.doExecute: integer;
+begin
+  Result := inherited doExecute;
+end;
+
+procedure TPrepBuildMain.InitCmdLineParser;
+begin
+  inherited;
+  FGetOpt.RegisterOption('ReadDof', 'read a .dof file to get the version information', true);
+  FGetOpt.RegisterOption('ReadBdsproj', 'read a .bdsproj file to get the version information', true);
+  FGetOpt.RegisterOption('ReadIni', 'read a .ini file to get the version information', true);
+  FGetOpt.RegisterOption('Exec', 'execute the given program or script with extended environment', true);
+  FGetOpt.RegisterOption('UpdateDof', 'update a .dof file with the version information', true);
+  FGetOpt.RegisterOption('UpdateBdsproj', 'update a .bdsproj file with the version information', true);
+  FGetOpt.RegisterOption('UpdateIni', 'update a .ini file with the version information', true);
+  FGetOpt.RegisterOption('IncBuild', 'increment the build number', false);
+  FGetOpt.RegisterOption('MajorVer', 'set the major version number', true);
+  FGetOpt.RegisterOption('MinorVer', 'set the minor version number', true);
+  FGetOpt.RegisterOption('Revision', 'set the revision number', true);
+  FGetOpt.RegisterOption('Build', 'set the build number', true);
+  FGetOpt.RegisterOption('FileDesc', 'set the file description', true);
+  FGetOpt.RegisterOption('InternalName', 'set the internal name', true);
+  FGetOpt.RegisterOption('OriginalName', 'set the original file name', true);
+  FGetOpt.RegisterOption('Product', 'set the product name', true);
+  FGetOpt.RegisterOption('ProductVersion', 'set the product version', true);
+  FGetOpt.RegisterOption('Company', 'set the company name', true);
+  FGetOpt.RegisterOption('Copyright', 'set the legal copyright', true);
+  FGetOpt.RegisterOption('Trademark', 'set the legal trademark', true);
+  FGetOpt.RegisterOption('Comments', 'set the comments', true);
+end;
+
+initialization
+  MainClass := TPrepBuildMain;
+end.
+



From twm at mail.berlios.de  Sat Jul 14 15:11:35 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 15:11:35 +0200
Subject: [Dzchart-svncheckins] r170 - /
Message-ID: <200707141311.l6EDBZRO004113@sheep.berlios.de>

Author: twm
Date: 2007-07-14 15:11:35 +0200 (Sat, 14 Jul 2007)
New Revision: 170

Added:
   3rd/
Log:
Created folder remotely



From twm at mail.berlios.de  Sat Jul 14 15:11:54 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 15:11:54 +0200
Subject: [Dzchart-svncheckins] r171 - 3rd
Message-ID: <200707141311.l6EDBsUn004128@sheep.berlios.de>

Author: twm
Date: 2007-07-14 15:11:49 +0200 (Sat, 14 Jul 2007)
New Revision: 171

Added:
   3rd/jcl/
Log:
Created folder remotely



From twm at mail.berlios.de  Sat Jul 14 15:12:05 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 15:12:05 +0200
Subject: [Dzchart-svncheckins] r172 - 3rd/jcl
Message-ID: <200707141312.l6EDC54D004143@sheep.berlios.de>

Author: twm
Date: 2007-07-14 15:12:04 +0200 (Sat, 14 Jul 2007)
New Revision: 172

Added:
   3rd/jcl/1.99/
Log:
Created folder remotely



From twm at mail.berlios.de  Sat Jul 14 15:26:08 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 15:26:08 +0200
Subject: [Dzchart-svncheckins] r174 - 3rd/jcl/1.99
Message-ID: <200707141326.l6EDQ8k2005263@sheep.berlios.de>

Author: twm
Date: 2007-07-14 15:26:05 +0200 (Sat, 14 Jul 2007)
New Revision: 174

Added:
   3rd/jcl/1.99/tags/
Log:
Created folder remotely



From twm at mail.berlios.de  Sat Jul 14 15:26:46 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 15:26:46 +0200
Subject: [Dzchart-svncheckins] r175 - in 3rd/jcl/1.99/tags: . 1/source/common
Message-ID: <200707141326.l6EDQkKQ005313@sheep.berlios.de>

Author: twm
Date: 2007-07-14 15:26:45 +0200 (Sat, 14 Jul 2007)
New Revision: 175

Added:
   3rd/jcl/1.99/tags/1/
Modified:
   3rd/jcl/1.99/tags/1/source/common/JclSysInfo.pas
Log:
used internally

Copied: 3rd/jcl/1.99/tags/1 (from rev 173, 3rd/jcl/1.99/trunk)

Modified: 3rd/jcl/1.99/tags/1/source/common/JclSysInfo.pas
===================================================================
--- 3rd/jcl/1.99/trunk/source/common/JclSysInfo.pas	2007-07-14 13:12:30 UTC (rev 173)
+++ 3rd/jcl/1.99/tags/1/source/common/JclSysInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
@@ -200,9 +200,7 @@
 {$ENDIF ~CLR}
 {$ENDIF MSWINDOWS}
 function GetIPAddress(const HostName: string): string;
-{$IFDEF UNIX}
 procedure GetIpAddresses(Results: TStrings);
-{$ENDIF UNIX}
 function GetLocalComputerName: string;
 {$IFNDEF CLR}
 function GetLocalUserName: string;
@@ -2132,6 +2130,43 @@
 end;
 {$ENDIF ~CLR}
 
+{ TODO -cDoc: Donator: twm }
+
+{$IFDEF MSWINDOWS}
+procedure GetIpAddresses(Results: TStrings);
+type
+  TaPInAddr = array[0..10] of PInAddr;
+  PaPInAddr = ^TaPInAddr;
+var
+  R: Integer;
+  HostEnt: PHostEnt;
+  pptr: PaPInAddr;
+  Host: string;
+  i: Integer;
+  WSAData: TWSAData;
+begin
+  //need a socket for ioctl()
+  R := WSAStartup(MakeWord(1, 1), WSAData);
+  if R = 0 then begin
+    try
+      SetLength(Host, MAX_PATH);
+      GetHostName(PChar(Host), MAX_PATH);
+      HostEnt := GetHostByName(PChar(Host));
+      if HostEnt <> nil then begin
+        pPtr := PaPInAddr(HostEnt^.h_addr_list);
+        i := 0;
+        while pPtr^[I] <> nil do begin
+          Results.Add(inet_ntoa(pptr^[i]^));
+          Inc(i);
+        end;
+      end;
+    finally
+      WSACleanup;
+    end;
+  end;
+end;
+{$ENDIF MSWINDOWS}
+
 {$IFDEF UNIX}
 
 { TODO -cDoc: Donator: twm, Contributor rrossmair }



From twm at mail.berlios.de  Sat Jul 14 16:49:04 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 16:49:04 +0200
Subject: [Dzchart-svncheckins] r176 - in utilities/dzPrepBuild/trunk: . src
Message-ID: <200707141449.l6EEn4T2008747@sheep.berlios.de>

Author: twm
Date: 2007-07-14 16:48:54 +0200 (Sat, 14 Jul 2007)
New Revision: 176

Added:
   utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_DummyVersionInfo.pas
   utilities/dzPrepBuild/trunk/test.cmd
Modified:
   utilities/dzPrepBuild/trunk/
   utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Log:
kind of works now, but needs some more work


Property changes on: utilities/dzPrepBuild/trunk
___________________________________________________________________
Name: svn:externals
   - libs\dzlib https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzLib/trunk
libs\dzCmdLineParser https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzCmdLineParser/trunk
libs\dzTemplates https://svn.berlios.de/svnroot/repos/dztemplates/trunk

   + libs\dzlib https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzLib/trunk
libs\dzCmdLineParser https://svn.berlios.de/svnroot/repos/dzchart/utilities/dzCmdLineParser/trunk
libs\dzTemplates https://svn.berlios.de/svnroot/repos/dztemplates/trunk
libs\jcl https://svn.berlios.de/svnroot/repos/dzchart/3rd/jcl/1.99/tags/1


Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-14 14:48:54 UTC (rev 176)
@@ -4,16 +4,25 @@
 
 uses
   SysUtils,
+  Forms,
   oxmldom,
   u_IncBuildNoMain in 'u_IncBuildNoMain.pas',
   d_BdsProjVersionInfo in 'd_BdsProjVersionInfo.pas' {dm_BdsProjVersionInfo: TDataModule},
   i_VersionInfo in 'i_VersionInfo.pas',
   u_DofVersionInfo in 'u_DofVersionInfo.pas',
   u_IniVersionInfo in 'u_IniVersionInfo.pas',
-  u_CentralIniVersionInfo in 'u_CentralIniVersionInfo.pas';
+  u_CentralIniVersionInfo in 'u_CentralIniVersionInfo.pas',
+  u_dzDefaultMain in '..\libs\dzlib\src\u_dzDefaultMain.pas',
+  u_PrepBuildMain in 'u_PrepBuildMain.pas',
+  u_DummyVersionInfo in 'u_DummyVersionInfo.pas',
+  u_AbstractVersionInfo in 'u_AbstractVersionInfo.pas';
 
 {$R *.res}
 
 begin
-  Main;
+  Application.Initialize;
+  Application.Title := 'PrepBuild';
+  MainClass := TPrepBuildMain;
+  System.ExitCode := Main;
 end.
+

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-14 14:48:54 UTC (rev 176)
@@ -25,16 +25,18 @@
     <DCC_HppOutput>..\dcu</DCC_HppOutput>
     <DCC_Define>DEBUG;no_translation</DCC_Define>
     <DCC_ExeOutput>..</DCC_ExeOutput>
-    <DCC_UnitSearchPath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_UnitSearchPath>
-    <DCC_ResourcePath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_ResourcePath>
-    <DCC_ObjPath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_ObjPath>
-    <DCC_IncludePath>..\libs\dzlib\src;..\libs\dzlib\inc</DCC_IncludePath>
+    <DCC_UnitSearchPath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_UnitSearchPath>
+    <DCC_ResourcePath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ResourcePath>
+    <DCC_ObjPath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ObjPath>
+    <DCC_IncludePath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_IncludePath>
+    <DCC_SYMBOL_PLATFORM>False</DCC_SYMBOL_PLATFORM>
+    <DCC_UNIT_PLATFORM>False</DCC_UNIT_PLATFORM>
   </PropertyGroup>
   <ProjectExtensions>
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">testdata\testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">52</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion">1.1.0.52</VersionInfoKey!
 s><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">--Readini=testdata\testproject --exec=test.cmd</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">56</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion!
 ">1.1.0.56</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
       
       
       
@@ -85,6 +87,236 @@
       
       
       
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
+      
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
@@ -102,13 +334,17 @@
     <DelphiCompile Include="PrepBuild.dpr">
       <MainSource>MainSource</MainSource>
     </DelphiCompile>
+    <DCCReference Include="..\libs\dzlib\src\u_dzDefaultMain.pas" />
     <DCCReference Include="d_BdsProjVersionInfo.pas">
       <Form>dm_BdsProjVersionInfo</Form>
     </DCCReference>
     <DCCReference Include="i_VersionInfo.pas" />
+    <DCCReference Include="u_AbstractVersionInfo.pas" />
     <DCCReference Include="u_CentralIniVersionInfo.pas" />
     <DCCReference Include="u_DofVersionInfo.pas" />
+    <DCCReference Include="u_DummyVersionInfo.pas" />
     <DCCReference Include="u_IncBuildNoMain.pas" />
     <DCCReference Include="u_IniVersionInfo.pas" />
+    <DCCReference Include="u_PrepBuildMain.pas" />
   </ItemGroup>
 </Project>
\ No newline at end of file

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -187,7 +187,7 @@
 
 class function Tdm_BdsProjVersionInfo.FilenameFor(const _Project: string): string;
 begin
-  Result := _Project + '.bdsproj';
+  Result := ChangeFileExt(_Project, '.bdsproj');
 end;
 
 function Tdm_BdsProjVersionInfo.GetAutoIncBuild: boolean;

Added: utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -0,0 +1,250 @@
+unit u_AbstractVersionInfo;
+
+interface
+
+uses
+  i_VersionInfo;
+
+type
+  TAbstractVersionInfo = class(TInterfacedObject)
+  private
+    FFileVersion: string;
+    FProductVersion: string;
+    FProductName: string;
+    FMinorVer: integer;
+    FLegalTrademarks: string;
+    FRelease: integer;
+    FLegalCopyright: string;
+    FMajorVer: integer;
+    FCompanyName: string;
+    FAutoIncBuild: boolean;
+    FFileDescription: string;
+    FBuild: integer;
+    FInternalName: string;
+    FOriginalFilename: string;
+    FComments: string;
+  protected
+    procedure Assign(const _VersionInfo: IVersionInfo); virtual;
+    function GetAutoIncBuild: Boolean; virtual;
+    function GetBuild: Integer; virtual;
+    function GetComments: string; virtual;
+    function GetCompanyName: string; virtual;
+    function GetFileDescription: string; virtual;
+    function GetFileVersion: string; virtual;
+    function GetInternalName: string; virtual;
+    function GetLegalCopyright: string; virtual;
+    function GetLegalTrademarks: string; virtual;
+    function GetMajorVer: Integer; virtual;
+    function GetMinorVer: Integer; virtual;
+    function GetOriginalFilename: string;
+    function GetProductName: string; virtual;
+    function GetProductVersion: string; virtual;
+    function GetRelease: Integer; virtual;
+    procedure SetAutoIncBuild(_AutoIncBuild: Boolean); virtual;
+    procedure SetBuild(_Build: Integer); virtual;
+    procedure SetComments(const _Comments: string); virtual;
+    procedure SetCompanyName(_CompanyName: string); virtual;
+    procedure SetFileDescription(_FileDescription: string); virtual;
+    procedure SetFileVersion(_FileVersion: string); virtual;
+    procedure SetInternalName(_InternalName: string); virtual;
+    procedure SetLegalCopyright(_LegalCopyright: string); virtual;
+    procedure SetLegalTrademarks(_LegalTrademarks: string); virtual;
+    procedure SetMajorVer(_MajorVer: Integer); virtual;
+    procedure SetMinorVer(_MinorVer: Integer); virtual;
+    procedure SetOriginalFilename(_OriginalFilename: string); virtual;
+    procedure SetProductName(_ProductName: string); virtual;
+    procedure SetProductVersion(_ProductVersion: string); virtual;
+    procedure SetRelease(_Release: Integer); virtual;
+    procedure UpdateFile; virtual; abstract;
+    function VerInfoFilename: string; virtual; abstract;
+    //
+    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
+    property Build: integer read GetBuild write SetBuild;
+    property Comments: string read GetComments write SetComments;
+    property CompanyName: string read GetCompanyName write SetCompanyName;
+    property FileDescription: string read GetFileDescription write SetFileDescription;
+    property FileVersion: string read GetFileVersion write SetFileVersion;
+    property InternalName: string read GetInternalName write SetInternalName;
+    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
+    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
+    property MajorVer: integer read GetMajorVer write SetMajorVer;
+    property MinorVer: integer read GetMinorVer write SetMinorVer;
+    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
+    property ProductName: string read GetProductName write SetProductName;
+    property ProductVersion: string read GetProductVersion write SetProductVersion;
+    property Release: integer read GetRelease write SetRelease;
+  end;
+
+implementation
+
+procedure TAbstractVersionInfo.Assign(const _VersionInfo: IVersionInfo);
+begin
+  AutoIncBuild := _VersionInfo.AutoIncBuild;
+  Build := _VersionInfo.Build;
+  Comments := _VersionInfo.Comments;
+  CompanyName := _VersionInfo.CompanyName;
+  FileDescription := _VersionInfo.FileDescription;
+  FileVersion := _VersionInfo.FileVersion;
+  InternalName := _VersionInfo.InternalName;
+  LegalCopyright := _VersionInfo.LegalCopyright;
+  LegalTrademarks := _VersionInfo.LegalTrademarks;
+  MajorVer := _VersionInfo.MajorVer;
+  MinorVer := _VersionInfo.MinorVer;
+  OriginalFilename := _VersionInfo.OriginalFilename;
+  ProductName := _VersionInfo.ProductName;
+  ProductVersion := _VersionInfo.ProductVersion;
+  Release := _VersionInfo.Release;
+end;
+
+function TAbstractVersionInfo.GetAutoIncBuild: boolean;
+begin
+  Result := FAutoIncBuild;
+end;
+
+function TAbstractVersionInfo.GetBuild: integer;
+begin
+  Result := FBuild;
+end;
+
+function TAbstractVersionInfo.GetComments: string;
+begin
+  Result := FComments;
+end;
+
+function TAbstractVersionInfo.GetCompanyName: string;
+begin
+  Result := FCompanyName;
+end;
+
+function TAbstractVersionInfo.GetFileDescription: string;
+begin
+  Result := FFileDescription;
+end;
+
+function TAbstractVersionInfo.GetFileVersion: string;
+begin
+  Result := FFileVersion;
+end;
+
+function TAbstractVersionInfo.GetInternalName: string;
+begin
+  Result := FInternalName;
+end;
+
+function TAbstractVersionInfo.GetLegalCopyright: string;
+begin
+  Result := FLegalCopyright;
+end;
+
+function TAbstractVersionInfo.GetLegalTrademarks: string;
+begin
+  Result := FLegalTrademarks;
+end;
+
+function TAbstractVersionInfo.GetMajorVer: integer;
+begin
+  Result := FMajorVer;
+end;
+
+function TAbstractVersionInfo.GetMinorVer: integer;
+begin
+  Result := FMinorVer;
+end;
+
+function TAbstractVersionInfo.GetOriginalFilename: string;
+begin
+  Result := FOriginalFilename;
+end;
+
+function TAbstractVersionInfo.GetProductName: string;
+begin
+  Result := FProductName;
+end;
+
+function TAbstractVersionInfo.GetProductVersion: string;
+begin
+  Result := FProductVersion;
+end;
+
+function TAbstractVersionInfo.GetRelease: integer;
+begin
+  Result := FRelease;
+end;
+
+procedure TAbstractVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
+begin
+  FAutoIncBuild := _AutoIncBuild;
+end;
+
+procedure TAbstractVersionInfo.SetBuild(_Build: integer);
+begin
+  FBuild := _Build;
+end;
+
+procedure TAbstractVersionInfo.SetComments(const _Comments: string);
+begin
+  FComments := _Comments;
+end;
+
+procedure TAbstractVersionInfo.SetCompanyName(_CompanyName: string);
+begin
+  FCompanyName := _CompanyName;
+end;
+
+procedure TAbstractVersionInfo.SetFileDescription(_FileDescription: string);
+begin
+  FFileDescription := _FileDescription;
+end;
+
+procedure TAbstractVersionInfo.SetFileVersion(_FileVersion: string);
+begin
+  FFileVersion := _FileVersion;
+end;
+
+procedure TAbstractVersionInfo.SetInternalName(_InternalName: string);
+begin
+  FInternalName := _InternalName;
+end;
+
+procedure TAbstractVersionInfo.SetLegalCopyright(_LegalCopyright: string);
+begin
+  FLegalCopyright := _LegalCopyright;
+end;
+
+procedure TAbstractVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
+begin
+  FLegalTrademarks := _LegalTrademarks;
+end;
+
+procedure TAbstractVersionInfo.SetMajorVer(_MajorVer: integer);
+begin
+  FMajorVer := _MajorVer;
+end;
+
+procedure TAbstractVersionInfo.SetMinorVer(_MinorVer: integer);
+begin
+  FMinorVer := _MinorVer;
+end;
+
+procedure TAbstractVersionInfo.SetOriginalFilename(_OriginalFilename: string);
+begin
+  FOriginalFilename := _OriginalFilename;
+end;
+
+procedure TAbstractVersionInfo.SetProductName(_ProductName: string);
+begin
+  FProductName := _ProductName;
+end;
+
+procedure TAbstractVersionInfo.SetProductVersion(_ProductVersion: string);
+begin
+  FProductVersion := _ProductVersion;
+end;
+
+procedure TAbstractVersionInfo.SetRelease(_Release: integer);
+begin
+  FRelease := _Release;
+end;
+
+end.
+

Modified: utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -22,7 +22,7 @@
   private
     FProjectName: string;
   protected
-    function VerInfoFilename: string;
+    function VerInfoFilename: string; override;
     //
     function ReadString(const _Section, _Ident: string; _Default: string): string; override;
     procedure WriteString(const _Section, _Ident: string; _Value: string); override;

Modified: utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -15,7 +15,7 @@
   private
     FProjectName: string;
   protected
-    function VerInfoFilename: string;
+    function VerInfoFilename: string; override;
   public
     {: Creates a TDofVersionInfo instance. Succeeds, if the file exists
        and IncludeVerInfo is <> 0
@@ -44,7 +44,7 @@
 
 class function TDofVersionInfo.FilenameFor(const _ProjectName: string): string;
 begin
-  Result := _ProjectName + '.dof';
+  Result := ChangeFileExt(_ProjectName, '.dof');
 end;
 
 function TDofVersionInfo.VerInfoFilename: string;

Added: utilities/dzPrepBuild/trunk/src/u_DummyVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_DummyVersionInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/u_DummyVersionInfo.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -0,0 +1,31 @@
+unit u_DummyVersionInfo;
+
+interface
+
+uses
+  i_VersionInfo,
+  u_AbstractVersionInfo;
+
+type
+  TDummyVersionInfo = class(TAbstractVersionInfo, IVersionInfo)
+  protected
+    procedure UpdateFile; override;
+    function VerInfoFilename: string; override;
+  end;
+
+implementation
+
+{ TDummyVersionInfo }
+
+procedure TDummyVersionInfo.UpdateFile;
+begin
+  // ignore
+end;
+
+function TDummyVersionInfo.VerInfoFilename: string;
+begin
+  Result := '';
+end;
+
+end.
+

Modified: utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -5,13 +5,14 @@
 uses
   SysUtils,
   IniFiles,
-  i_VersionInfo;
+  i_VersionInfo,
+  u_AbstractVersionInfo;
 
 type
   {: Tries to read a <projectname>.ini file, succeeds, if it exists
      @param Project is the project name (*.dpr file without extension)
      @param VersionInfo is a TVersionInfoRec record which will be filled with the version info }
-  TIniVersionInfo = class(TInterfacedObject)
+  TIniVersionInfo = class(TAbstractVersionInfo)
   protected
     FIniFile: TMemIniFile;
     FInfoSection: string;
@@ -25,71 +26,8 @@
     procedure ReadValues;
     procedure WriteValues;
   private
-    FFileVersion: string;
-    FProductVersion: string;
-    FProductName: string;
-    FMinorVer: integer;
-    FLegalTrademarks: string;
-    FRelease: integer;
-    FLegalCopyright: string;
-    FMajorVer: integer;
-    FCompanyName: string;
-    FAutoIncBuild: boolean;
-    FFileDescription: string;
-    FBuild: integer;
-    FInternalName: string;
-    FOriginalFilename: string;
-    FComments: string;
   protected // implementation of IVersionInfo
-    function GetBuild: integer;
-    procedure SetBuild(_Build: integer);
-    function GetMajorVer: integer;
-    procedure SetMajorVer(_MajorVer: integer);
-    function GetMinorVer: integer;
-    procedure SetMinorVer(_MinorVer: integer);
-    function GetRelease: integer;
-    procedure SetRelease(_Release: integer);
-    function GetCompanyName: string;
-    procedure SetCompanyName(_CompanyName: string);
-    function GetFileDescription: string;
-    procedure SetFileDescription(_FileDescription: string);
-    function GetFileVersion: string;
-    procedure SetFileVersion(_FileVersion: string);
-    function GetInternalName: string;
-    procedure SetInternalName(_InternalName: string);
-    function GetLegalCopyright: string;
-    procedure SetLegalCopyright(_LegalCopyright: string);
-    function GetLegalTrademarks: string;
-    procedure SetLegalTrademarks(_LegalTrademarks: string);
-    function GetOriginalFilename: string;
-    procedure SetOriginalFilename(_OriginalFilename: string);
-    function GetProductName: string;
-    procedure SetProductName(_ProductName: string);
-    function GetProductVersion: string;
-    procedure SetProductVersion(_ProductVersion: string);
-    function GetAutoIncBuild: boolean;
-    procedure SetAutoIncBuild(_AutoIncBuild: boolean);
-    function GetComments: string;
-    procedure SetComments(const _Comments: string);
-  //
-    procedure Assign(const _VersionInfo: IVersionInfo);
-    procedure UpdateFile;
-  //
-    property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
-    property Build: integer read GetBuild write SetBuild;
-    property Comments: string read GetComments write SetComments;
-    property CompanyName: string read GetCompanyName write SetCompanyName;
-    property FileDescription: string read GetFileDescription write SetFileDescription;
-    property FileVersion: string read GetFileVersion write SetFileVersion;
-    property InternalName: string read GetInternalName write SetInternalName;
-    property LegalCopyright: string read GetLegalCopyright write SetLegalCopyright;
-    property LegalTrademarks: string read GetLegalTrademarks write SetLegalTrademarks;
-    property MajorVer: integer read GetMajorVer write SetMajorVer;
-    property MinorVer: integer read GetMinorVer write SetMinorVer;
-    property OriginalFilename: string read GetOriginalFilename write SetOriginalFilename;
-    property ProductName: string read GetProductName write SetProductName;
-    property ProductVersion: string read GetProductVersion write SetProductVersion;
-    property Release: integer read GetRelease write SetRelease;
+    procedure UpdateFile; override;
   public
     {: Creates a TIniVersionInfo instance.
        @param FullFilename is the full filename including path and extension of
@@ -161,213 +99,44 @@
   FIniFile.WriteString(_Section, _Ident, _Value);
 end;
 
-procedure TIniVersionInfo.Assign(const _VersionInfo: IVersionInfo);
-begin
-  AutoIncBuild := _VersionInfo.AutoIncBuild;
-  Build := _VersionInfo.Build;
-  Comments := _VersionInfo.Comments;
-  CompanyName := _VersionInfo.CompanyName;
-  FileDescription := _VersionInfo.FileDescription;
-  FileVersion := _VersionInfo.FileVersion;
-  InternalName := _VersionInfo.InternalName;
-  LegalCopyright := _VersionInfo.LegalCopyright;
-  LegalTrademarks := _VersionInfo.LegalTrademarks;
-  MajorVer := _VersionInfo.MajorVer;
-  MinorVer := _VersionInfo.MinorVer;
-  OriginalFilename := _VersionInfo.OriginalFilename;
-  ProductName := _VersionInfo.ProductName;
-  ProductVersion := _VersionInfo.ProductVersion;
-  Release := _VersionInfo.Release;
-end;
-
 procedure TIniVersionInfo.ReadValues;
 begin
-  FAutoIncBuild := ReadBool(FInfoSection, 'AutoIncBuild', False);
-  FBuild := ReadInteger(FInfoSection, 'Build', 0);
-  FComments := ReadString(FInfoKeysSection, 'Comments', '');
-  FCompanyName := ReadString(FInfoKeysSection, 'CompanyName', '');
-  FFileDescription := ReadString(FInfoKeysSection, 'FileDescription', '');
-  FFileVersion := ReadString(FInfoKeysSection, 'FileVersion', '');
-  FInternalName := ReadString(FInfoKeysSection, 'InternalName', '');
-  FLegalCopyright := ReadString(FInfoKeysSection, 'LegalCopyright', '');
-  FLegalTrademarks := ReadString(FInfoKeysSection, 'LegalTrademarks', '');
-  FMajorVer := ReadInteger(FInfoSection, 'MajorVer', 0);
-  FMinorVer := ReadInteger(FInfoSection, 'MinorVer', 0);
-  FOriginalFilename := ReadString(FInfoKeysSection, 'OriginalFilename', '');
-  FProductName := ReadString(FInfoKeysSection, 'ProductName', '');
-  FProductVersion := ReadString(FInfoKeysSection, 'ProductVersion', '');
-  FRelease := ReadInteger(FInfoSection, 'Release', 0);
+  AutoIncBuild := ReadBool(FInfoSection, 'AutoIncBuild', False);
+  Build := ReadInteger(FInfoSection, 'Build', 0);
+  Comments := ReadString(FInfoKeysSection, 'Comments', '');
+  CompanyName := ReadString(FInfoKeysSection, 'CompanyName', '');
+  FileDescription := ReadString(FInfoKeysSection, 'FileDescription', '');
+  FileVersion := ReadString(FInfoKeysSection, 'FileVersion', '');
+  InternalName := ReadString(FInfoKeysSection, 'InternalName', '');
+  LegalCopyright := ReadString(FInfoKeysSection, 'LegalCopyright', '');
+  LegalTrademarks := ReadString(FInfoKeysSection, 'LegalTrademarks', '');
+  MajorVer := ReadInteger(FInfoSection, 'MajorVer', 0);
+  MinorVer := ReadInteger(FInfoSection, 'MinorVer', 0);
+  OriginalFilename := ReadString(FInfoKeysSection, 'OriginalFilename', '');
+  ProductName := ReadString(FInfoKeysSection, 'ProductName', '');
+  ProductVersion := ReadString(FInfoKeysSection, 'ProductVersion', '');
+  Release := ReadInteger(FInfoSection, 'Release', 0);
 end;
 
 procedure TIniVersionInfo.WriteValues;
 begin
-  WriteBool(FInfoSection, 'AutoIncBuild', FAutoIncBuild);
-  WriteInteger(FInfoSection, 'Build', FBuild);
-  WriteString(FInfoKeysSection, 'Comments', FComments);
-  WriteString(FInfoKeysSection, 'CompanyName', FCompanyName);
-  WriteString(FInfoKeysSection, 'FileDescription', FFileDescription);
-  WriteString(FInfoKeysSection, 'FileVersion', FFileVersion);
-  WriteString(FInfoKeysSection, 'InternalName', FInternalName);
-  WriteString(FInfoKeysSection, 'LegalCopyright', FLegalCopyright);
-  WriteString(FInfoKeysSection, 'LegalTrademarks', FLegalTrademarks);
-  WriteInteger(FInfoSection, 'MajorVer', FMajorVer);
-  WriteInteger(FInfoSection, 'MinorVer', FMinorVer);
-  WriteString(FInfoKeysSection, 'OriginalFilename', FOriginalFilename);
-  WriteString(FInfoKeysSection, 'ProductName', FProductName);
-  WriteString(FInfoKeysSection, 'ProductVersion', FProductVersion);
-  WriteInteger(FInfoSection, 'Release', FRelease);
+  WriteBool(FInfoSection, 'AutoIncBuild', AutoIncBuild);
+  WriteInteger(FInfoSection, 'Build', Build);
+  WriteString(FInfoKeysSection, 'Comments', Comments);
+  WriteString(FInfoKeysSection, 'CompanyName', CompanyName);
+  WriteString(FInfoKeysSection, 'FileDescription', FileDescription);
+  WriteString(FInfoKeysSection, 'FileVersion', FileVersion);
+  WriteString(FInfoKeysSection, 'InternalName', InternalName);
+  WriteString(FInfoKeysSection, 'LegalCopyright', LegalCopyright);
+  WriteString(FInfoKeysSection, 'LegalTrademarks', LegalTrademarks);
+  WriteInteger(FInfoSection, 'MajorVer', MajorVer);
+  WriteInteger(FInfoSection, 'MinorVer', MinorVer);
+  WriteString(FInfoKeysSection, 'OriginalFilename', OriginalFilename);
+  WriteString(FInfoKeysSection, 'ProductName', ProductName);
+  WriteString(FInfoKeysSection, 'ProductVersion', ProductVersion);
+  WriteInteger(FInfoSection, 'Release', Release);
 end;
 
-function TIniVersionInfo.GetAutoIncBuild: boolean;
-begin
-  Result := FAutoIncBuild;
-end;
-
-function TIniVersionInfo.GetBuild: integer;
-begin
-  Result := FBuild;
-end;
-
-function TIniVersionInfo.GetComments: string;
-begin
-  Result := FComments;
-end;
-
-function TIniVersionInfo.GetCompanyName: string;
-begin
-  Result := FCompanyName;
-end;
-
-function TIniVersionInfo.GetFileDescription: string;
-begin
-  Result := FFileDescription;
-end;
-
-function TIniVersionInfo.GetFileVersion: string;
-begin
-  Result := FFileVersion;
-end;
-
-function TIniVersionInfo.GetInternalName: string;
-begin
-  Result := FInternalName;
-end;
-
-function TIniVersionInfo.GetLegalCopyright: string;
-begin
-  Result := FLegalCopyright;
-end;
-
-function TIniVersionInfo.GetLegalTrademarks: string;
-begin
-  Result := FLegalTrademarks;
-end;
-
-function TIniVersionInfo.GetMajorVer: integer;
-begin
-  Result := FMajorVer;
-end;
-
-function TIniVersionInfo.GetMinorVer: integer;
-begin
-  Result := FMinorVer;
-end;
-
-function TIniVersionInfo.GetOriginalFilename: string;
-begin
-  Result := FOriginalFilename;
-end;
-
-function TIniVersionInfo.GetProductName: string;
-begin
-  Result := FProductName;
-end;
-
-function TIniVersionInfo.GetProductVersion: string;
-begin
-  Result := FProductVersion;
-end;
-
-function TIniVersionInfo.GetRelease: integer;
-begin
-  Result := FRelease;
-end;
-
-procedure TIniVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
-begin
-  FAutoIncBuild := _AutoIncBuild;
-end;
-
-procedure TIniVersionInfo.SetBuild(_Build: integer);
-begin
-  FBuild := _Build;
-end;
-
-procedure TIniVersionInfo.SetComments(const _Comments: string);
-begin
-  FComments := _Comments;
-end;
-
-procedure TIniVersionInfo.SetCompanyName(_CompanyName: string);
-begin
-  FCompanyName := _CompanyName;
-end;
-
-procedure TIniVersionInfo.SetFileDescription(_FileDescription: string);
-begin
-  FFileDescription := _FileDescription;
-end;
-
-procedure TIniVersionInfo.SetFileVersion(_FileVersion: string);
-begin
-  FFileVersion := _FileVersion;
-end;
-
-procedure TIniVersionInfo.SetInternalName(_InternalName: string);
-begin
-  FInternalName := _InternalName;
-end;
-
-procedure TIniVersionInfo.SetLegalCopyright(_LegalCopyright: string);
-begin
-  FLegalCopyright := _LegalCopyright;
-end;
-
-procedure TIniVersionInfo.SetLegalTrademarks(_LegalTrademarks: string);
-begin
-  FLegalTrademarks := _LegalTrademarks;
-end;
-
-procedure TIniVersionInfo.SetMajorVer(_MajorVer: integer);
-begin
-  FMajorVer := _MajorVer;
-end;
-
-procedure TIniVersionInfo.SetMinorVer(_MinorVer: integer);
-begin
-  FMinorVer := _MinorVer;
-end;
-
-procedure TIniVersionInfo.SetOriginalFilename(_OriginalFilename: string);
-begin
-  FOriginalFilename := _OriginalFilename;
-end;
-
-procedure TIniVersionInfo.SetProductName(_ProductName: string);
-begin
-  FProductName := _ProductName;
-end;
-
-procedure TIniVersionInfo.SetProductVersion(_ProductVersion: string);
-begin
-  FProductVersion := _ProductVersion;
-end;
-
-procedure TIniVersionInfo.SetRelease(_Release: integer);
-begin
-  FRelease := _Release;
-end;
-
 procedure TIniVersionInfo.UpdateFile;
 begin
   WriteValues;

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-14 14:48:54 UTC (rev 176)
@@ -3,12 +3,16 @@
 interface
 
 uses
+  Windows,
+  SysUtils,
   u_dzDefaultMain,
-  u_dzGetOpt;
+  u_dzGetOpt,
+  i_VersionInfo;
 
 type
   TPrepBuildMain = class(TDefaultMain)
   private
+    function HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo): integer;
   protected
     procedure InitCmdLineParser; override;
     function doExecute: integer; override;
@@ -18,11 +22,181 @@
 
 implementation
 
+uses
+  u_dzExecutor,
+  u_dzShellApiUtils,
+  u_DofVersionInfo,
+  d_BdsProjVersionInfo,
+  u_CentralIniVersionInfo,
+  u_DummyVersionInfo;
+
 { TPrepBuildMain }
 
+function DateTimeToString(const _Format: string; _dt: TDateTime): string;
+begin
+  SysUtils.DateTimeToString(Result, _Format, _dt);
+end;
+
+function TPrepBuildMain.HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo): integer;
+const
+  DZ_MY_DOCUMENTS = 'dzMyDocuments';
+  DZ_DATE = 'dzDate';
+  DZ_TIME = 'dzTime';
+  DZ_DATE_TIME = 'dzDateTime';
+  DZ_VERSION = 'dzVersion.';
+var
+  MyDoc: string;
+  Executor: TExecutor;
+  dt: TDateTime;
+begin
+  MyDoc := TWindowsShell.GetMyDocumentsDir();
+  Executor := TExecutor.Create;
+  try
+    Executor.ExeName := GetEnvironmentVariable('ComSpec');
+    Executor.Commandline := '/c ' + _Command;
+    Executor.Environment.Values[DZ_MY_DOCUMENTS] := MyDoc;
+
+    dt := Now;
+    Executor.Environment.Values[DZ_DATE] := DateTimeToString('yyyy-mm-dd', dt);
+    Executor.Environment.Values[DZ_TIME] := DateTimeToString('hh-nn-ss', dt);
+    Executor.Environment.Values[DZ_DATE_TIME] := DateTimeToString('yyyy-mm-dd_hh-nn-ss', dt);
+
+    if Assigned(_VersionInfo) then begin
+      Executor.Environment.Values[DZ_VERSION + 'MajorVer'] := IntToStr(_VersionInfo.MajorVer);
+      Executor.Environment.Values[DZ_VERSION + 'MinorVer'] := IntToStr(_VersionInfo.MinorVer);
+      Executor.Environment.Values[DZ_VERSION + 'Release'] := IntToStr(_VersionInfo.Release);
+      Executor.Environment.Values[DZ_VERSION + 'Build'] := IntToStr(_VersionInfo.Build);
+      Executor.Environment.Values[DZ_VERSION + 'FileDesc'] := _VersionInfo.FileDescription;
+      Executor.Environment.Values[DZ_VERSION + 'InternalName'] := _VersionInfo.InternalName;
+      Executor.Environment.Values[DZ_VERSION + 'OriginalName'] := _VersionInfo.OriginalFilename;
+      Executor.Environment.Values[DZ_VERSION + 'Product'] := _VersionInfo.ProductName;
+      Executor.Environment.Values[DZ_VERSION + 'ProductVersion'] := _VersionInfo.ProductVersion;
+      Executor.Environment.Values[DZ_VERSION + 'Company'] := _VersionInfo.CompanyName;
+      Executor.Environment.Values[DZ_VERSION + 'Copyright'] := _VersionInfo.LegalCopyright;
+      Executor.Environment.Values[DZ_VERSION + 'Trademark'] := _VersionInfo.LegalTrademarks;
+      Executor.Environment.Values[DZ_VERSION + 'Comments'] := _VersionInfo.Comments;
+    end;
+
+    Executor.Execute;
+    Executor.Wait(INFINITE);
+    Result := Executor.ExitCode;
+  finally
+    Executor.Free;
+  end;
+end;
+
 function TPrepBuildMain.doExecute: integer;
+var
+  Param: string;
+  ParamVersionInfo: IVersionInfo;
+  VersionInfo: IVersionInfo;
+  IntValue: integer;
+  IconFile: string;
 begin
-  Result := inherited doExecute;
+  if FGetOpt.OptionPassed('ReadDof', Param) then
+    ParamVersionInfo := TDofVersionInfo.Create(Param);
+
+  if FGetOpt.OptionPassed('ReadBdsProj', Param) then begin
+    if Assigned(ParamVersionInfo) then
+      raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
+    ParamVersionInfo := Tdm_BdsProjVersionInfo.Create(Param);
+  end;
+
+  if FGetOpt.OptionPassed('ReadIni', Param) then begin
+    if Assigned(ParamVersionInfo) then
+      raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
+    ParamVersionInfo := TCentralVersionInfo.Create(Param);
+  end;
+
+  VersionInfo := TDummyVersionInfo.Create;
+  if Assigned(ParamVersionInfo) then begin
+    VersionInfo.Assign(ParamVersionInfo);
+    ParamVersionInfo := nil;
+  end;
+
+  if FGetOpt.OptionPassed('MajorVer', Param) then begin
+    if not TryStrToInt(Param, IntValue) then
+      raise Exception.Create('Parameter to MajorVer must be a number');
+    VersionInfo.MajorVer := IntValue;
+  end;
+
+  if FGetOpt.OptionPassed('MinorVer', Param) then begin
+    if not TryStrToInt(Param, IntValue) then
+      raise Exception.Create('Parameter to MinorVer must be a number');
+    VersionInfo.MinorVer := IntValue;
+  end;
+
+  if FGetOpt.OptionPassed('Release', Param) then begin
+    if not TryStrToInt(Param, IntValue) then
+      raise Exception.Create('Parameter to Release must be a number');
+    VersionInfo.Release := IntValue;
+  end;
+
+  if FGetOpt.OptionPassed('Build', Param) then begin
+    if not TryStrToInt(Param, IntValue) then
+      raise Exception.Create('Parameter to MinorVer must be a number');
+    VersionInfo.MinorVer := IntValue;
+  end;
+
+  if FGetOpt.OptionPassed('FileDesc', Param) then
+    VersionInfo.FileDescription := Param;
+
+  if FGetOpt.OptionPassed('InternalName', Param) then
+    VersionInfo.InternalName := Param;
+
+  if FGetOpt.OptionPassed('OriginalName', Param) then
+    VersionInfo.OriginalFilename := Param;
+
+  if FGetOpt.OptionPassed('Product', Param) then
+    VersionInfo.ProductName := Param;
+
+  if FGetOpt.OptionPassed('ProductVersion', Param) then
+    VersionInfo.ProductVersion := Param;
+
+  if FGetOpt.OptionPassed('Company', Param) then
+    VersionInfo.CompanyName := Param;
+
+  if FGetOpt.OptionPassed('Copyright', Param) then
+    VersionInfo.LegalCopyright := Param;
+
+  if FGetOpt.OptionPassed('Trademark', Param) then
+    VersionInfo.LegalTrademarks := Param;
+
+  if FGetOpt.OptionPassed('Comments', Param) then
+    VersionInfo.Comments := Param;
+
+  if FGetOpt.OptionPassed('IncBuild') then
+    VersionInfo.Build := VersionInfo.Build + 1;
+
+  if FGetOpt.OptionPassed('UpdateDof', Param) then begin
+    ParamVersionInfo := TDofVersionInfo.Create(Param);
+    ParamVersionInfo.Assign(VersionInfo);
+    ParamVersionInfo.UpdateFile;
+  end;
+
+  if FGetOpt.OptionPassed('UpdateBdsproj', Param) then begin
+    ParamVersionInfo := Tdm_BdsProjVersionInfo.Create(Param);
+    ParamVersionInfo.Assign(VersionInfo);
+    ParamVersionInfo.UpdateFile;
+  end;
+
+  if FGetOpt.OptionPassed('UpdateIni', Param) then begin
+    ParamVersionInfo := TCentralVersionInfo.Create(Param);
+    ParamVersionInfo.Assign(VersionInfo);
+    ParamVersionInfo.UpdateFile;
+  end;
+
+  if not FGetOpt.OptionPassed('Icon', IconFile) then
+    IconFile := '';
+
+  if FGetOpt.OptionPassed('WriteRc', Param) then begin
+    //
+  end;
+
+  if FGetOpt.OptionPassed('Exec', Param) then
+    HandleExecOption(Param, VersionInfo);
+
+  Result := 0;
 end;
 
 procedure TPrepBuildMain.InitCmdLineParser;
@@ -35,10 +209,12 @@
   FGetOpt.RegisterOption('UpdateDof', 'update a .dof file with the version information', true);
   FGetOpt.RegisterOption('UpdateBdsproj', 'update a .bdsproj file with the version information', true);
   FGetOpt.RegisterOption('UpdateIni', 'update a .ini file with the version information', true);
+  FGetOpt.RegisterOption('WriteRc', 'write version info to a .rc file', true);
+  FGetOpt.RegisterOption('Icon', 'Assign an icon file to add to the .rc file', true);
   FGetOpt.RegisterOption('IncBuild', 'increment the build number', false);
   FGetOpt.RegisterOption('MajorVer', 'set the major version number', true);
   FGetOpt.RegisterOption('MinorVer', 'set the minor version number', true);
-  FGetOpt.RegisterOption('Revision', 'set the revision number', true);
+  FGetOpt.RegisterOption('Release', 'set the release number', true);
   FGetOpt.RegisterOption('Build', 'set the build number', true);
   FGetOpt.RegisterOption('FileDesc', 'set the file description', true);
   FGetOpt.RegisterOption('InternalName', 'set the internal name', true);

Added: utilities/dzPrepBuild/trunk/test.cmd
===================================================================
--- utilities/dzPrepBuild/trunk/test.cmd	2007-07-14 13:26:45 UTC (rev 175)
+++ utilities/dzPrepBuild/trunk/test.cmd	2007-07-14 14:48:54 UTC (rev 176)
@@ -0,0 +1,23 @@
+ at echo off
+echo %dzDate%
+echo %dzTime%
+echo %dzDateTime%
+echo %dzMyDocuments%
+
+echo NajorVer=%dzVersion.MajorVer%
+echo MinorVer=%dzVersion.MinorVer%
+echo Revision=%dzVersion.Release%
+echo Build=%dzVersion.Build%
+echo FileDesc=%dzVersion.FileDesc%
+echo InternalName=%dzVersion.InternalName%
+echo OriginalName=%dzVersion.OriginalName%
+echo Product=%dzVersion.Product%
+echo ProductVersion=%dzVersion.ProductVersion%
+echo Company=%dzVersion.Company%
+echo Copyright=%dzVersion.Copyright%
+echo Trademark=%dzVersion.Trademark%
+echo Comments=%dzVersion.Comments%
+
+ at echo on
+PrepBuild --NajorVer=%dzVersion.MajorVer% --MinorVer=%dzVersion.MinorVer% --Revision=%dzVersion.Release% --Build=%dzVersion.Build% --FileDesc="%dzVersion.FileDesc%" --InternalName="%dzVersion.InternalName%" --OriginalName="%dzVersion.OriginalName%" --Product="%dzVersion.Product%" --ProductVersion="%dzVersion.ProductVersion%" --Company="%dzVersion.Company%" --Copyright="%dzVersion.Copyright%" --Trademark="%dzVersion.Trademark%" --Comments="%dzVersion.Comments%"
+



From twm at mail.berlios.de  Sat Jul 14 19:26:09 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 19:26:09 +0200
Subject: [Dzchart-svncheckins] r177 - utilities/dzPrepBuild/trunk/testdata
Message-ID: <200707141726.l6EHQ9Iv028754@sheep.berlios.de>

Author: twm
Date: 2007-07-14 19:26:03 +0200 (Sat, 14 Jul 2007)
New Revision: 177

Modified:
   utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj
   utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.dof
   utilities/dzPrepBuild/trunk/testdata/Testproject.dof
Log:
removed references to iCD. It wasn't really a problem since this is only text and no source code at all, but ..

Modified: utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj	2007-07-14 14:48:54 UTC (rev 176)
+++ utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj	2007-07-14 17:26:03 UTC (rev 177)
@@ -1,4 +1,4 @@
-?<?xml version="1.0" encoding="utf-8"?>
+<?xml version="1.0" encoding="utf-8"?>
 <BorlandProject>
 	<PersonalityInfo>
 		<Option>
@@ -100,10 +100,11 @@
 			<Compiler Name="UnsafeCast">False</Compiler>
 			<Compiler Name="OptionTruncated">True</Compiler>
 			<Compiler Name="WideCharReduced">True</Compiler>
-			<Compiler Name="DuplicatesIgnored">True</Compiler>  <Compiler Name="UnitInitSeq">True</Compiler>
-      <Compiler Name="LocalPInvoke">True</Compiler>
-      <Compiler Name="CodePage"></Compiler>
-    </Compiler>
+			<Compiler Name="DuplicatesIgnored">True</Compiler>
+			<Compiler Name="UnitInitSeq">True</Compiler>
+			<Compiler Name="LocalPInvoke">True</Compiler>
+			<Compiler Name="CodePage"></Compiler>
+		</Compiler>
 		<Linker>
 			<Linker Name="MapFile">0</Linker>
 			<Linker Name="OutputObjs">0</Linker>
@@ -114,8 +115,9 @@
 			<Linker Name="MinStackSize">16384</Linker>
 			<Linker Name="MaxStackSize">1048576</Linker>
 			<Linker Name="ImageBase">4194304</Linker>
-			<Linker Name="ExeDescription"></Linker>  <Linker Name="GenerateHpps">False</Linker>
-    </Linker>
+			<Linker Name="ExeDescription"></Linker>
+			<Linker Name="GenerateHpps">False</Linker>
+		</Linker>
 		<Directories>
 			<Directories Name="OutputDir"></Directories>
 			<Directories Name="UnitOutputDir"></Directories>
@@ -137,17 +139,18 @@
 			<Parameters Name="RemotePath"></Parameters>
 			<Parameters Name="RemoteLauncher"></Parameters>
 			<Parameters Name="RemoteCWD"></Parameters>
-			<Parameters Name="RemoteDebug">False</Parameters>  <Parameters Name="Debug Symbols Search Path"></Parameters>
-      <Parameters Name="LoadAllSymbols">True</Parameters>
-      <Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
-    </Parameters>
+			<Parameters Name="RemoteDebug">False</Parameters>
+			<Parameters Name="Debug Symbols Search Path"></Parameters>
+			<Parameters Name="LoadAllSymbols">True</Parameters>
+			<Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
+		</Parameters>
 		<VersionInfo>
 			<VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-			<VersionInfo Name="AutoIncBuild">False</VersionInfo>
+			<VersionInfo Name="AutoIncBuild">True</VersionInfo>
 			<VersionInfo Name="MajorVer">1</VersionInfo>
-			<VersionInfo Name="MinorVer">1</VersionInfo>
+			<VersionInfo Name="MinorVer">0</VersionInfo>
 			<VersionInfo Name="Release">0</VersionInfo>
-			<VersionInfo Name="Build">0</VersionInfo>
+			<VersionInfo Name="Build">22</VersionInfo>
 			<VersionInfo Name="Debug">False</VersionInfo>
 			<VersionInfo Name="PreRelease">False</VersionInfo>
 			<VersionInfo Name="Special">False</VersionInfo>
@@ -157,20 +160,21 @@
 			<VersionInfo Name="CodePage">1252</VersionInfo>
 		</VersionInfo>
 		<VersionInfoKeys>
-			<VersionInfoKeys Name="FileVersion">1.0.0.0</VersionInfoKeys>
+			<VersionInfoKeys Name="FileVersion">1.0.0.21</VersionInfoKeys>
 			<VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys>
-			<VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys>
-			<VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalCopyright">copyright 2005 by Thomas Mueller</VersionInfoKeys>
+			<VersionInfoKeys Name="CompanyName">iCD. GmbH</VersionInfoKeys>
+			<VersionInfoKeys Name="FileDescription">Dof2Rc Tool</VersionInfoKeys>
+			<VersionInfoKeys Name="InternalName">dof2rc</VersionInfoKeys>
+			<VersionInfoKeys Name="LegalCopyright">Copyright 2002-2005 by iCD. GmbH</VersionInfoKeys>
 			<VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-			<VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys>
-			<VersionInfoKeys Name="Comments"></VersionInfoKeys>
-		</VersionInfoKeys>  <Language>
-      <Language Name="ActiveLang"></Language>
-      <Language Name="ProjectLang">$00000000</Language>
-      <Language Name="RootDir"></Language>
-    </Language>
-  </Delphi.Personality>
+			<VersionInfoKeys Name="OriginalFilename">dof2rc.exe</VersionInfoKeys>
+			<VersionInfoKeys Name="ProductName">Dof2Rc</VersionInfoKeys>
+			<VersionInfoKeys Name="Comments">internal use only</VersionInfoKeys>
+		</VersionInfoKeys>
+		<Language>
+			<Language Name="ActiveLang"></Language>
+			<Language Name="ProjectLang">$00000000</Language>
+			<Language Name="RootDir"></Language>
+		</Language>
+	</Delphi.Personality>
 </BorlandProject>

Modified: utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.dof
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.dof	2007-07-14 14:48:54 UTC (rev 176)
+++ utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.dof	2007-07-14 17:26:03 UTC (rev 177)
@@ -1,5 +1,6 @@
 [FileVersion]
 Version=7.0
+
 [Compiler]
 A=8
 B=0
@@ -79,6 +80,7 @@
 UnsafeType=0
 UnsafeCode=0
 UnsafeCast=0
+
 [Linker]
 MapFile=0
 OutputObjs=0
@@ -89,29 +91,32 @@
 MaxStackSize=1048576
 ImageBase=4194304
 ExeDescription=
+
 [Directories]
 OutputDir=q:\Dof2Rc
 UnitOutputDir=q:\Dof2Rc\dcu
 PackageDLLOutputDir=
 PackageDCPOutputDir=
-SearchPath=.\libs\headwork\units;.\libs\3rd\tregexpr\source
+SearchPath=.\libs\3rd\tregexpr\source
 Packages=vcl;rtl;vclx;vclshlctrls;visualclx;indy
 Conditionals=englisch;debug
 DebugSourceDirs=
 UsePackages=0
+
 [Parameters]
-RunParams=--comment="internal use only" --product="%s DEMO" --build s:\utils\dof2rc\Dof2Rc.dpr
+RunParams=
 HostApplication=
 Launcher=
 UseLauncher=0
 DebugCWD=
+
 [Version Info]
 IncludeVerInfo=1
 AutoIncBuild=1
 MajorVer=1
 MinorVer=0
 Release=0
-Build=21
+Build=22
 Debug=0
 PreRelease=0
 Special=0
@@ -119,73 +124,16 @@
 DLL=0
 Locale=1033
 CodePage=1252
+
 [Version Info Keys]
-CompanyName=iCD. GmbH
-FileDescription=Dof2Rc Tool
+CompanyName=www.dummzeuch.de
+FileDescription=Testproject
 FileVersion=1.0.0.21
-InternalName=dof2rc
-LegalCopyright=Copyright 2002-2005 by iCD. GmbH
+InternalName=testproject
+LegalCopyright=Copyright 2002-2007 by Thomas Mueller
 LegalTrademarks=
-OriginalFilename=dof2rc.exe
-ProductName=Dof2Rc
+OriginalFilename=testproject.exe
+ProductName=Testproduct
 ProductVersion=1.0.0.0
 Comments=internal use only
-[Excluded Packages]
-q:\bpl\UnicodeConvDelphi7.bpl=Unicode Converter Library (UCL)
-c:\program files\borland\delphi7\Bin\dclite70.bpl=Borland Integrated Translation Environment
-c:\program files\borland\delphi7\Bin\dclnet70.bpl=Borland Internet Components
-c:\program files\borland\delphi7\Bin\dclsoap70.bpl=Borland SOAP Components
-c:\program files\borland\delphi7\Bin\dclocx70.bpl=Borland Sample Imported ActiveX Controls
-c:\program files\borland\delphi7\Bin\dcldbx70.bpl=Borland dbExpress Components
-c:\program files\borland\delphi7\Bin\dcldbxcds70.bpl=Borland SimpleDataset Component (DBX)
-c:\program files\borland\delphi7\Bin\DBWEBXPRT.BPL=Borland Web Wizard Package
-c:\program files\borland\delphi7\Bin\dclie70.bpl=Internet Explorer Components
-c:\program files\borland\delphi7\Bin\dclbde70.bpl=Borland BDE DB Components
-c:\program files\borland\delphi7\Bin\dcltee70.bpl=TeeChart Components
-c:\program files\borland\delphi7\Bin\dclib70.bpl=InterBase Data Access Components
-c:\program files\borland\delphi7\Bin\dclclxdb70.bpl=Borland CLX Database Components
-c:\program files\borland\delphi7\Bin\dclclxstd70.bpl=Borland CLX Standard Components
-c:\program files\borland\delphi7\Bin\dclmid70.bpl=Borland MyBase DataAccess Components
-C:\WINNT\System32\ibevnt70.bpl=Borland Interbase Event Alerter Component
-c:\program files\borland\delphi7\Bin\dclIntraweb_50_70.bpl=Intraweb 5.0 Design Package for Delphi 7
-Q:\bpl\CompBAR7.bpl=Component Bar Expert 1.0.2
-Q:\bpl\dcldummzeuchchart.bpl=dummzeuch.de Charts - designtime package
-Q:\bpl\dclrxbd7.bpl=RX Library BDE Database Components
-Q:\bpl\olectra.bpl=Olectra Chart Components (Active X)
-Q:\bpl\dclRBC77.bpl=ReportBuilder TeeChart 4.04 Components
-c:\program files\borland\delphi7\bin\dclRave70.bpl=Rave Reports BE 5.0 Package
-c:\program files\borland\delphi7\Bin\dclaxserver70.bpl=Microsoft Office 97 Sample Automation Server Wrapper Components
-Q:\bpl\JclDebugIde70.bpl=JCL Debug IDE extension for Delphi 7
-C:\Program Files\Castalia Free for Delphi\JacobsLadder7.bpl=Castalia for Delphi 7
-C:\Program Files\CompDiff\Delphi7\CompDiff.bpl=Component Diff Tool for Delphi
-C:\Program Files\Castalia for Delphi Trial\LadderFlyout7.bpl=Castalia Flyout Bar for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderForms7.bpl=Castalia Form Designer for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderStat7.bpl=Castalia Statistics for Delphi 7
-[HistoryLists\hlConditionals]
-Count=2
-Item0=englisch;debug
-Item1=englisch
-[HistoryLists\hlUnitAliases]
-Count=1
-Item0=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
-[HistoryLists\hlSearchPath]
-Count=9
-Item0=.\libs\headwork\units;.\libs\3rd\tregexpr\source
-Item1=.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item2=S:\3rd\xml\ucl;.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item3=S:\3rd\xml\ucl;libs\headwork\units;.\libs\3rd\regexpr\source
-Item4=S:\3rd\xml\ucl;.\libs\headwork;.\libs\3rd\regexpr\source
-Item5=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork
-Item6=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork\components
-Item7=S:\3rd\regexpr;S:\3rd\xml\ucl
-Item8=S:\3rd\regexpr
-[HistoryLists\hlUnitOutputDirectory]
-Count=3
-Item0=q:\Dof2Rc\dcu
-Item1=Q:\test\dcu
-Item2=Q:\
-[HistoryLists\hlOutputDirectorry]
-Count=3
-Item0=q:\Dof2Rc
-Item1=Q:\test
-Item2=Q:\
+

Modified: utilities/dzPrepBuild/trunk/testdata/Testproject.dof
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/Testproject.dof	2007-07-14 14:48:54 UTC (rev 176)
+++ utilities/dzPrepBuild/trunk/testdata/Testproject.dof	2007-07-14 17:26:03 UTC (rev 177)
@@ -97,14 +97,14 @@
 UnitOutputDir=q:\Dof2Rc\dcu
 PackageDLLOutputDir=
 PackageDCPOutputDir=
-SearchPath=.\libs\headwork\units;.\libs\3rd\tregexpr\source
+SearchPath=.\libs\3rd\tregexpr\source
 Packages=vcl;rtl;vclx;vclshlctrls;visualclx;indy
 Conditionals=englisch;debug
 DebugSourceDirs=
 UsePackages=0
 
 [Parameters]
-RunParams=--comment="internal use only" --product="%s DEMO" --build s:\utils\dof2rc\Dof2Rc.dpr
+RunParams=
 HostApplication=
 Launcher=
 UseLauncher=0
@@ -126,79 +126,14 @@
 CodePage=1252
 
 [Version Info Keys]
-CompanyName=iCD. GmbH
-FileDescription=Dof2Rc Tool
+CompanyName=www.dummzeuch.de
+FileDescription=Testproject
 FileVersion=1.0.0.21
-InternalName=dof2rc
-LegalCopyright=Copyright 2002-2005 by iCD. GmbH
+InternalName=testproject
+LegalCopyright=Copyright 2002-2007 by Thomas Mueller
 LegalTrademarks=
-OriginalFilename=dof2rc.exe
-ProductName=Dof2Rc
+OriginalFilename=testproject.exe
+ProductName=Testproduct
 ProductVersion=1.0.0.0
 Comments=internal use only
 
-[Excluded Packages]
-q:\bpl\UnicodeConvDelphi7.bpl=Unicode Converter Library (UCL)
-c:\program files\borland\delphi7\Bin\dclite70.bpl=Borland Integrated Translation Environment
-c:\program files\borland\delphi7\Bin\dclnet70.bpl=Borland Internet Components
-c:\program files\borland\delphi7\Bin\dclsoap70.bpl=Borland SOAP Components
-c:\program files\borland\delphi7\Bin\dclocx70.bpl=Borland Sample Imported ActiveX Controls
-c:\program files\borland\delphi7\Bin\dcldbx70.bpl=Borland dbExpress Components
-c:\program files\borland\delphi7\Bin\dcldbxcds70.bpl=Borland SimpleDataset Component (DBX)
-c:\program files\borland\delphi7\Bin\DBWEBXPRT.BPL=Borland Web Wizard Package
-c:\program files\borland\delphi7\Bin\dclie70.bpl=Internet Explorer Components
-c:\program files\borland\delphi7\Bin\dclbde70.bpl=Borland BDE DB Components
-c:\program files\borland\delphi7\Bin\dcltee70.bpl=TeeChart Components
-c:\program files\borland\delphi7\Bin\dclib70.bpl=InterBase Data Access Components
-c:\program files\borland\delphi7\Bin\dclclxdb70.bpl=Borland CLX Database Components
-c:\program files\borland\delphi7\Bin\dclclxstd70.bpl=Borland CLX Standard Components
-c:\program files\borland\delphi7\Bin\dclmid70.bpl=Borland MyBase DataAccess Components
-C:\WINNT\System32\ibevnt70.bpl=Borland Interbase Event Alerter Component
-c:\program files\borland\delphi7\Bin\dclIntraweb_50_70.bpl=Intraweb 5.0 Design Package for Delphi 7
-Q:\bpl\CompBAR7.bpl=Component Bar Expert 1.0.2
-Q:\bpl\dcldummzeuchchart.bpl=dummzeuch.de Charts - designtime package
-Q:\bpl\dclrxbd7.bpl=RX Library BDE Database Components
-Q:\bpl\olectra.bpl=Olectra Chart Components (Active X)
-Q:\bpl\dclRBC77.bpl=ReportBuilder TeeChart 4.04 Components
-c:\program files\borland\delphi7\bin\dclRave70.bpl=Rave Reports BE 5.0 Package
-c:\program files\borland\delphi7\Bin\dclaxserver70.bpl=Microsoft Office 97 Sample Automation Server Wrapper Components
-Q:\bpl\JclDebugIde70.bpl=JCL Debug IDE extension for Delphi 7
-C:\Program Files\Castalia Free for Delphi\JacobsLadder7.bpl=Castalia for Delphi 7
-C:\Program Files\CompDiff\Delphi7\CompDiff.bpl=Component Diff Tool for Delphi
-C:\Program Files\Castalia for Delphi Trial\LadderFlyout7.bpl=Castalia Flyout Bar for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderForms7.bpl=Castalia Form Designer for Delphi 7
-C:\Program Files\Castalia for Delphi Trial\LadderStat7.bpl=Castalia Statistics for Delphi 7
-
-[HistoryLists\hlConditionals]
-Count=2
-Item0=englisch;debug
-Item1=englisch
-
-[HistoryLists\hlUnitAliases]
-Count=1
-Item0=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
-
-[HistoryLists\hlSearchPath]
-Count=9
-Item0=.\libs\headwork\units;.\libs\3rd\tregexpr\source
-Item1=.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item2=S:\3rd\xml\ucl;.\libs\headwork\units;.\libs\3rd\regexpr\source
-Item3=S:\3rd\xml\ucl;libs\headwork\units;.\libs\3rd\regexpr\source
-Item4=S:\3rd\xml\ucl;.\libs\headwork;.\libs\3rd\regexpr\source
-Item5=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork
-Item6=S:\3rd\regexpr;S:\3rd\xml\ucl;S:\headwork\components
-Item7=S:\3rd\regexpr;S:\3rd\xml\ucl
-Item8=S:\3rd\regexpr
-
-[HistoryLists\hlUnitOutputDirectory]
-Count=3
-Item0=q:\Dof2Rc\dcu
-Item1=Q:\test\dcu
-Item2=Q:\
-
-[HistoryLists\hlOutputDirectorry]
-Count=3
-Item0=q:\Dof2Rc
-Item1=Q:\test
-Item2=Q:\
-



From twm at mail.berlios.de  Sat Jul 14 19:28:09 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 19:28:09 +0200
Subject: [Dzchart-svncheckins] r178 - utilities/dzPrepBuild/trunk/testdata
Message-ID: <200707141728.l6EHS9SN028828@sheep.berlios.de>

Author: twm
Date: 2007-07-14 19:28:06 +0200 (Sat, 14 Jul 2007)
New Revision: 178

Modified:
   utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini
Log:
removed references to iCD. It wasn't really a problem since this is only text and no source code at all, but ..

Modified: utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini	2007-07-14 17:26:03 UTC (rev 177)
+++ utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini	2007-07-14 17:28:06 UTC (rev 178)
@@ -14,14 +14,13 @@
 CodePage=1252
 
 [Version Info Keys]
-CompanyName=iCD. GmbH
-FileDescription=Dof2Rc Tool
+CompanyName=www.dummzeuch.de
+FileDescription=Testproject
 FileVersion=1.0.0.21
-InternalName=dof2rc
-LegalCopyright=Copyright 2002-2005 by iCD. GmbH
+InternalName=testproject
+LegalCopyright=Copyright 2002-2007 by Thomas Mueller
 LegalTrademarks=
-OriginalFilename=dof2rc.exe
-ProductName=Dof2Rc
+OriginalFilename=testproject.exe
+ProductName=Testproduct
 ProductVersion=1.0.0.0
 Comments=internal use only
-



From twm at mail.berlios.de  Sat Jul 14 19:31:54 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 19:31:54 +0200
Subject: [Dzchart-svncheckins] r179 - utilities/dzCmdLineParser/trunk
Message-ID: <200707141731.l6EHVsaM029091@sheep.berlios.de>

Author: twm
Date: 2007-07-14 19:31:52 +0200 (Sat, 14 Jul 2007)
New Revision: 179

Modified:
   utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas
Log:
the lists of found parameters and options are now public

Modified: utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas
===================================================================
--- utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas	2007-07-14 17:28:06 UTC (rev 178)
+++ utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas	2007-07-14 17:31:52 UTC (rev 179)
@@ -102,6 +102,8 @@
     {: the program's name as either passed to the constructor or read from
        ParamStr(0). }
     property ProgName: string read FProgName;
+    property ParamsFoundList: TParamFoundList read FParamsFoundList;
+    property OptionsFoundList: TOptionFoundList read FOptionsFoundList;
   end;
 
 implementation



From twm at mail.berlios.de  Sat Jul 14 19:32:14 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 19:32:14 +0200
Subject: [Dzchart-svncheckins] r180 - in utilities/dzPrepBuild/trunk: . src
	testdata
Message-ID: <200707141732.l6EHWEHe029114@sheep.berlios.de>

Author: twm
Date: 2007-07-14 19:32:12 +0200 (Sat, 14 Jul 2007)
New Revision: 180

Modified:
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/test.cmd
   utilities/dzPrepBuild/trunk/testdata/Testproject.bdsproj
Log:
Bugfix: changing AutoIncBuildNo resulted in "Frue" being written to the .bdsproj file

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-14 17:31:52 UTC (rev 179)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-14 17:32:12 UTC (rev 180)
@@ -270,7 +270,7 @@
   if _AutoIncBuild then
     SetVersionInfo('AutoIncBuild', 'True')
   else
-    SetVersionInfo('AutoIncBuild', 'Frue')
+    SetVersionInfo('AutoIncBuild', 'False')
 end;
 
 procedure Tdm_BdsProjVersionInfo.SetBuild(_Build: integer);

Modified: utilities/dzPrepBuild/trunk/test.cmd
===================================================================
--- utilities/dzPrepBuild/trunk/test.cmd	2007-07-14 17:31:52 UTC (rev 179)
+++ utilities/dzPrepBuild/trunk/test.cmd	2007-07-14 17:32:12 UTC (rev 180)
@@ -6,7 +6,7 @@
 
 echo NajorVer=%dzVersion.MajorVer%
 echo MinorVer=%dzVersion.MinorVer%
-echo Revision=%dzVersion.Release%
+echo Release=%dzVersion.Release%
 echo Build=%dzVersion.Build%
 echo FileDesc=%dzVersion.FileDesc%
 echo InternalName=%dzVersion.InternalName%
@@ -19,5 +19,5 @@
 echo Comments=%dzVersion.Comments%
 
 @echo on
-PrepBuild --NajorVer=%dzVersion.MajorVer% --MinorVer=%dzVersion.MinorVer% --Revision=%dzVersion.Release% --Build=%dzVersion.Build% --FileDesc="%dzVersion.FileDesc%" --InternalName="%dzVersion.InternalName%" --OriginalName="%dzVersion.OriginalName%" --Product="%dzVersion.Product%" --ProductVersion="%dzVersion.ProductVersion%" --Company="%dzVersion.Company%" --Copyright="%dzVersion.Copyright%" --Trademark="%dzVersion.Trademark%" --Comments="%dzVersion.Comments%"
+PrepBuild --updatebdsproj=testdata\testproject --MajorVer=%dzVersion.MajorVer% --MinorVer=%dzVersion.MinorVer% --Release=%dzVersion.Release% --Build=%dzVersion.Build% --FileDesc="%dzVersion.FileDesc%" --InternalName="%dzVersion.InternalName%" --OriginalName="%dzVersion.OriginalName%" --Product="%dzVersion.Product%" --ProductVersion="%dzDate%" --Company="%dzVersion.Company%" --Copyright="%dzVersion.Copyright%" --Trademark="%dzVersion.Trademark%" --Comments="%dzVersion.Comments%"
 

Modified: utilities/dzPrepBuild/trunk/testdata/Testproject.bdsproj
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/Testproject.bdsproj	2007-07-14 17:31:52 UTC (rev 179)
+++ utilities/dzPrepBuild/trunk/testdata/Testproject.bdsproj	2007-07-14 17:32:12 UTC (rev 180)
@@ -146,11 +146,11 @@
 		</Parameters>
 		<VersionInfo>
 			<VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-			<VersionInfo Name="AutoIncBuild">True</VersionInfo>
+			<VersionInfo Name="AutoIncBuild">False</VersionInfo>
 			<VersionInfo Name="MajorVer">1</VersionInfo>
-			<VersionInfo Name="MinorVer">0</VersionInfo>
+			<VersionInfo Name="MinorVer">31</VersionInfo>
 			<VersionInfo Name="Release">0</VersionInfo>
-			<VersionInfo Name="Build">22</VersionInfo>
+			<VersionInfo Name="Build">0</VersionInfo>
 			<VersionInfo Name="Debug">False</VersionInfo>
 			<VersionInfo Name="PreRelease">False</VersionInfo>
 			<VersionInfo Name="Special">False</VersionInfo>
@@ -160,16 +160,16 @@
 			<VersionInfo Name="CodePage">1252</VersionInfo>
 		</VersionInfo>
 		<VersionInfoKeys>
-			<VersionInfoKeys Name="FileVersion">1.0.0.21</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="CompanyName">iCD. GmbH</VersionInfoKeys>
-			<VersionInfoKeys Name="FileDescription">Dof2Rc Tool</VersionInfoKeys>
-			<VersionInfoKeys Name="InternalName">dof2rc</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalCopyright">Copyright 2002-2005 by iCD. GmbH</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-			<VersionInfoKeys Name="OriginalFilename">dof2rc.exe</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductName">Dof2Rc</VersionInfoKeys>
-			<VersionInfoKeys Name="Comments">internal use only</VersionInfoKeys>
+			<VersionInfoKeys Name="FileVersion"></VersionInfoKeys>
+			<VersionInfoKeys Name="ProductVersion">"2007-07-14"</VersionInfoKeys>
+			<VersionInfoKeys Name="CompanyName">"www.dummzeuch.de"</VersionInfoKeys>
+			<VersionInfoKeys Name="FileDescription">"Testproject"</VersionInfoKeys>
+			<VersionInfoKeys Name="InternalName">"testproject"</VersionInfoKeys>
+			<VersionInfoKeys Name="LegalCopyright">"Copyright 2002-2007 by Thomas Mueller"</VersionInfoKeys>
+			<VersionInfoKeys Name="LegalTrademarks">""</VersionInfoKeys>
+			<VersionInfoKeys Name="OriginalFilename">"testproject.exe"</VersionInfoKeys>
+			<VersionInfoKeys Name="ProductName">"Testproduct"</VersionInfoKeys>
+			<VersionInfoKeys Name="Comments">"internal use only"</VersionInfoKeys>
 		</VersionInfoKeys>
 		<Language>
 			<Language Name="ActiveLang"></Language>



From twm at mail.berlios.de  Sat Jul 14 21:14:57 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 21:14:57 +0200
Subject: [Dzchart-svncheckins] r181 - utilities/dzPrepBuild/trunk/testdata
Message-ID: <200707141914.l6EJEv6B000517@sheep.berlios.de>

Author: twm
Date: 2007-07-14 21:14:55 +0200 (Sat, 14 Jul 2007)
New Revision: 181

Modified:
   utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj
Log:
removed quotes

Modified: utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj	2007-07-14 17:32:12 UTC (rev 180)
+++ utilities/dzPrepBuild/trunk/testdata/OriginalTestproject.bdsproj	2007-07-14 19:14:55 UTC (rev 181)
@@ -146,11 +146,11 @@
 		</Parameters>
 		<VersionInfo>
 			<VersionInfo Name="IncludeVerInfo">True</VersionInfo>
-			<VersionInfo Name="AutoIncBuild">True</VersionInfo>
+			<VersionInfo Name="AutoIncBuild">False</VersionInfo>
 			<VersionInfo Name="MajorVer">1</VersionInfo>
-			<VersionInfo Name="MinorVer">0</VersionInfo>
+			<VersionInfo Name="MinorVer">31</VersionInfo>
 			<VersionInfo Name="Release">0</VersionInfo>
-			<VersionInfo Name="Build">22</VersionInfo>
+			<VersionInfo Name="Build">0</VersionInfo>
 			<VersionInfo Name="Debug">False</VersionInfo>
 			<VersionInfo Name="PreRelease">False</VersionInfo>
 			<VersionInfo Name="Special">False</VersionInfo>
@@ -160,15 +160,15 @@
 			<VersionInfo Name="CodePage">1252</VersionInfo>
 		</VersionInfo>
 		<VersionInfoKeys>
-			<VersionInfoKeys Name="FileVersion">1.0.0.21</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-			<VersionInfoKeys Name="CompanyName">iCD. GmbH</VersionInfoKeys>
-			<VersionInfoKeys Name="FileDescription">Dof2Rc Tool</VersionInfoKeys>
-			<VersionInfoKeys Name="InternalName">dof2rc</VersionInfoKeys>
-			<VersionInfoKeys Name="LegalCopyright">Copyright 2002-2005 by iCD. GmbH</VersionInfoKeys>
+			<VersionInfoKeys Name="FileVersion"></VersionInfoKeys>
+			<VersionInfoKeys Name="ProductVersion">2007-07-14</VersionInfoKeys>
+			<VersionInfoKeys Name="CompanyName">www.dummzeuch.de</VersionInfoKeys>
+			<VersionInfoKeys Name="FileDescription">Testproject</VersionInfoKeys>
+			<VersionInfoKeys Name="InternalName">testproject</VersionInfoKeys>
+			<VersionInfoKeys Name="LegalCopyright">Copyright 2002-2007 by Thomas Mueller</VersionInfoKeys>
 			<VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-			<VersionInfoKeys Name="OriginalFilename">dof2rc.exe</VersionInfoKeys>
-			<VersionInfoKeys Name="ProductName">Dof2Rc</VersionInfoKeys>
+			<VersionInfoKeys Name="OriginalFilename">testproject.exe</VersionInfoKeys>
+			<VersionInfoKeys Name="ProductName">Testproduct</VersionInfoKeys>
 			<VersionInfoKeys Name="Comments">internal use only</VersionInfoKeys>
 		</VersionInfoKeys>
 		<Language>



From twm at mail.berlios.de  Sat Jul 14 21:19:45 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 14 Jul 2007 21:19:45 +0200
Subject: [Dzchart-svncheckins] r182 - in utilities/dzPrepBuild/trunk: . src
Message-ID: <200707141919.l6EJJjVP000690@sheep.berlios.de>

Author: twm
Date: 2007-07-14 21:19:43 +0200 (Sat, 14 Jul 2007)
New Revision: 182

Modified:
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
   utilities/dzPrepBuild/trunk/test.cmd
Log:
* removed quotes around parameters
* now creates an .rc file
* addes dzProject environment variable with the project's filename

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-14 19:14:55 UTC (rev 181)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-14 19:19:43 UTC (rev 182)
@@ -36,7 +36,7 @@
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">--Readini=testdata\testproject --exec=test.cmd</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">56</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVersion!
 ">1.1.0.56</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">--Readini=testdata\testproject --exec=test.cmd --writerc=testdata\testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">56</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><Ve!
 rsionInfoKeys Name="FileVersion">1.1.0.56</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
       
       
       
@@ -47,276 +47,6 @@
       
       
       
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
       <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
       <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-14 19:14:55 UTC (rev 181)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-14 19:19:43 UTC (rev 182)
@@ -5,6 +5,7 @@
 uses
   Windows,
   SysUtils,
+  StrUtils,
   u_dzDefaultMain,
   u_dzGetOpt,
   i_VersionInfo;
@@ -12,7 +13,8 @@
 type
   TPrepBuildMain = class(TDefaultMain)
   private
-    function HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo): integer;
+    function HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo; const _Project: string): integer;
+    procedure WriteRcFile(const _Project: string; _VersionInfo: IVersionInfo; const _Icon: string);
   protected
     procedure InitCmdLineParser; override;
     function doExecute: integer; override;
@@ -37,13 +39,61 @@
   SysUtils.DateTimeToString(Result, _Format, _dt);
 end;
 
-function TPrepBuildMain.HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo): integer;
+procedure TPrepBuildMain.WriteRcFile(const _Project: string; _VersionInfo: IVersionInfo; const _Icon: string);
+var
+  t: TextFile;
+begin
+  Assignfile(t, ChangeFileExt(_Project, '.rc'));
+  Rewrite(t);
+  try
+    WriteLn(t, {    } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
+    WriteLn(t);
+    WriteLn(t, {    } '1 VERSIONINFO LOADONCALL MOVEABLE DISCARDABLE IMPURE');
+    WriteLn(t, Format('FILEVERSION %d, %d, %d, %d', [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
+    WriteLn(t, Format('PRODUCTVERSION %d, %d, %d, %d',
+      [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
+    WriteLn(t, {    } 'FILEFLAGSMASK VS_FFI_FILEFLAGSMASK');
+    WriteLn(t, {    } 'FILEOS VOS__WINDOWS32');
+    WriteLn(t, {    } 'FILETYPE VFT_APP');
+    WriteLn(t, {    } '{');
+    WriteLn(t, {    } ' BLOCK "StringFileInfo"');
+    WriteLn(t, {    } ' {');
+    WriteLn(t, {    } '  BLOCK "040904E4"');
+    WriteLn(t, {    } '  {');
+    WriteLn(t, Format('   VALUE "CompanyName", "%s\000"', [_VersionInfo.CompanyName]));
+    WriteLn(t, Format('   VALUE "FileDescription", "%s\000"', [_VersionInfo.FileDescription]));
+    WriteLn(t, Format('   VALUE "FileVersion", "%s\000"', [_VersionInfo.FileVersion]));
+    WriteLn(t, Format('   VALUE "InternalName", "%s\000"', [_VersionInfo.InternalName]));
+    WriteLn(t, Format('   VALUE "LegalCopyright", "%s\000"', [_VersionInfo.LegalCopyright]));
+    WriteLn(t, Format('   VALUE "LegalTrademarks", "%s\000"', [_VersionInfo.LegalTrademarks]));
+    WriteLn(t, Format('   VALUE "OriginalFilename", "%s\000"', [_VersionInfo.OriginalFilename]));
+    WriteLn(t, Format('   VALUE "ProductName", "%s\000"', [_VersionInfo.ProductName]));
+    WriteLn(t, Format('   VALUE "ProductVersion", "%s\000"', [_VersionInfo.ProductVersion]));
+    WriteLn(t, Format('   VALUE "Comments", "%s\000"', [_VersionInfo.Comments]));
+    WriteLn(t, {    } '  }');
+    WriteLn(t, {    } ' }');
+    WriteLn(t, {    } ' BLOCK "VarFileInfo"');
+    WriteLn(t, {    } ' {');
+    WriteLn(t, {    } '  VALUE "Translation", 1033, 1252');
+    WriteLn(t, {    } ' }');
+    WriteLn(t, {    } '}');
+    if _Icon <> '' then begin
+      WriteLn(t);
+      WriteLn(t, Format('MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico', [_Icon]));
+    end;
+  finally
+    Close(t);
+  end;
+end;
+
+function TPrepBuildMain.HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo; const _Project: string): integer;
 const
   DZ_MY_DOCUMENTS = 'dzMyDocuments';
   DZ_DATE = 'dzDate';
   DZ_TIME = 'dzTime';
   DZ_DATE_TIME = 'dzDateTime';
   DZ_VERSION = 'dzVersion.';
+  DZ_PROJECT = 'dzProject';
 var
   MyDoc: string;
   Executor: TExecutor;
@@ -61,6 +111,9 @@
     Executor.Environment.Values[DZ_TIME] := DateTimeToString('hh-nn-ss', dt);
     Executor.Environment.Values[DZ_DATE_TIME] := DateTimeToString('yyyy-mm-dd_hh-nn-ss', dt);
 
+    if _Project <> '' then
+      Executor.Environment.Values[DZ_PROJECT] := _Project;
+
     if Assigned(_VersionInfo) then begin
       Executor.Environment.Values[DZ_VERSION + 'MajorVer'] := IntToStr(_VersionInfo.MajorVer);
       Executor.Environment.Values[DZ_VERSION + 'MinorVer'] := IntToStr(_VersionInfo.MinorVer);
@@ -85,6 +138,17 @@
   end;
 end;
 
+function UnquoteStr(const _s: string): string;
+var
+  s: PChar;
+  p: PChar;
+begin
+  s := StrNew(PChar(_s));
+  p := s;
+  Result := AnsiExtractQuotedStr(p, '"');
+  StrDispose(s);
+end;
+
 function TPrepBuildMain.doExecute: integer;
 var
   Param: string;
@@ -92,20 +156,22 @@
   VersionInfo: IVersionInfo;
   IntValue: integer;
   IconFile: string;
+  Project: string;
 begin
-  if FGetOpt.OptionPassed('ReadDof', Param) then
-    ParamVersionInfo := TDofVersionInfo.Create(Param);
+  Project := '';
+  if FGetOpt.OptionPassed('ReadDof', Project) then
+    ParamVersionInfo := TDofVersionInfo.Create(Project);
 
-  if FGetOpt.OptionPassed('ReadBdsProj', Param) then begin
+  if FGetOpt.OptionPassed('ReadBdsProj', Project) then begin
     if Assigned(ParamVersionInfo) then
       raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
-    ParamVersionInfo := Tdm_BdsProjVersionInfo.Create(Param);
+    ParamVersionInfo := Tdm_BdsProjVersionInfo.Create(Project);
   end;
 
-  if FGetOpt.OptionPassed('ReadIni', Param) then begin
+  if FGetOpt.OptionPassed('ReadIni', Project) then begin
     if Assigned(ParamVersionInfo) then
       raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
-    ParamVersionInfo := TCentralVersionInfo.Create(Param);
+    ParamVersionInfo := TCentralVersionInfo.Create(Project);
   end;
 
   VersionInfo := TDummyVersionInfo.Create;
@@ -139,31 +205,31 @@
   end;
 
   if FGetOpt.OptionPassed('FileDesc', Param) then
-    VersionInfo.FileDescription := Param;
+    VersionInfo.FileDescription := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('InternalName', Param) then
-    VersionInfo.InternalName := Param;
+    VersionInfo.InternalName := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('OriginalName', Param) then
-    VersionInfo.OriginalFilename := Param;
+    VersionInfo.OriginalFilename := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('Product', Param) then
-    VersionInfo.ProductName := Param;
+    VersionInfo.ProductName := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('ProductVersion', Param) then
-    VersionInfo.ProductVersion := Param;
+    VersionInfo.ProductVersion := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('Company', Param) then
-    VersionInfo.CompanyName := Param;
+    VersionInfo.CompanyName := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('Copyright', Param) then
-    VersionInfo.LegalCopyright := Param;
+    VersionInfo.LegalCopyright := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('Trademark', Param) then
-    VersionInfo.LegalTrademarks := Param;
+    VersionInfo.LegalTrademarks := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('Comments', Param) then
-    VersionInfo.Comments := Param;
+    VersionInfo.Comments := UnquoteStr(Param);
 
   if FGetOpt.OptionPassed('IncBuild') then
     VersionInfo.Build := VersionInfo.Build + 1;
@@ -189,12 +255,11 @@
   if not FGetOpt.OptionPassed('Icon', IconFile) then
     IconFile := '';
 
-  if FGetOpt.OptionPassed('WriteRc', Param) then begin
-    //
-  end;
+  if FGetOpt.OptionPassed('WriteRc', Param) then
+    WriteRcFile(Param, VersionInfo, IconFile);
 
   if FGetOpt.OptionPassed('Exec', Param) then
-    HandleExecOption(Param, VersionInfo);
+    HandleExecOption(Param, VersionInfo, Project);
 
   Result := 0;
 end;

Modified: utilities/dzPrepBuild/trunk/test.cmd
===================================================================
--- utilities/dzPrepBuild/trunk/test.cmd	2007-07-14 19:14:55 UTC (rev 181)
+++ utilities/dzPrepBuild/trunk/test.cmd	2007-07-14 19:19:43 UTC (rev 182)
@@ -1,9 +1,11 @@
 @echo off
-echo %dzDate%
-echo %dzTime%
-echo %dzDateTime%
-echo %dzMyDocuments%
+echo dzDate=%dzDate%
+echo dzTime=%dzTime%
+echo dzDateTime=%dzDateTime%
+echo dzMyDocuments=%dzMyDocuments%
 
+echo dzProject=%dzProject%
+
 echo NajorVer=%dzVersion.MajorVer%
 echo MinorVer=%dzVersion.MinorVer%
 echo Release=%dzVersion.Release%



From twm at mail.berlios.de  Tue Jul 17 11:00:49 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Tue, 17 Jul 2007 11:00:49 +0200
Subject: [Dzchart-svncheckins] r183 - utilities/dzLib/trunk/src
Message-ID: <200707170900.l6H90nK9027599@sheep.berlios.de>

Author: twm
Date: 2007-07-17 10:59:58 +0200 (Tue, 17 Jul 2007)
New Revision: 183

Modified:
   utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas
Log:
removed resource string, unit tests aren't translated

Modified: utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas	2007-07-14 19:19:43 UTC (rev 182)
+++ utilities/dzLib/trunk/src/u_dzUnitTestUtils.pas	2007-07-17 08:59:58 UTC (rev 183)
@@ -52,9 +52,6 @@
   DateUtils,
   u_dzVariantUtils;
 
-resourcestring
-  StrSexpectedVariantT = '%sexpected variant type: <%s> but was: <%s>';
-
   { TdzTestCase }
 
 procedure TdzTestCase.CheckVariantIsInt64(_Value: variant; _Msg: string);
@@ -179,7 +176,7 @@
 begin
   if (_Msg <> '') then
     _Msg := _Msg + ', ';
-  Result := Format(StrSexpectedVariantT, [_Msg, _Expected, _Actual])
+  Result := Format('%sexpected variant type: <%s> but was: <%s>', [_Msg, _Expected, _Actual])
 end;
 
 end.



From twm at mail.berlios.de  Tue Jul 17 11:05:45 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Tue, 17 Jul 2007 11:05:45 +0200
Subject: [Dzchart-svncheckins] r184 - utilities/dzCmdLineParser/trunk
Message-ID: <200707170905.l6H95jbJ027902@sheep.berlios.de>

Author: twm
Date: 2007-07-17 11:05:43 +0200 (Tue, 17 Jul 2007)
New Revision: 184

Modified:
   utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas
Log:
adapted to changes in dzTemplates

Modified: utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas
===================================================================
--- utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas	2007-07-17 08:59:58 UTC (rev 183)
+++ utilities/dzCmdLineParser/trunk/u_dzGetOpt.pas	2007-07-17 09:05:43 UTC (rev 184)
@@ -203,12 +203,12 @@
   Option: TOptionFound;
   PrimaryName: string;
 begin
-  if not FOptionNameList.Search(PChar(_Name), Idx) then
+  if not FOptionNameList.Find(PChar(_Name), Idx) then
     raise EUnknownOption.CreateFmt('%s is not a registered option.', [_Name]);
 
   Result := 0;
   PrimaryName := FOptionNameList[Idx].GetPrimaryName;
-  if FOptionsFoundList.Search(PrimaryName, Idx) then begin
+  if FOptionsFoundList.Find(PrimaryName, Idx) then begin
     Option := FOptionsFoundList[Idx];
     while Assigned(Option) and (Option.GetPrimaryName = PrimaryName) do begin
       Inc(Result);
@@ -303,7 +303,7 @@
 
   FoundIdx := 0;
   while FoundIdx < _Options.Count do begin
-    if not FOptionNameList.Search(_Options.Names[FoundIdx], OptName) then
+    if not FOptionNameList.Find(_Options.Names[FoundIdx], OptName) then
       raise EUnknownOption.CreateFmt('Option %s is unknown', [_Options.Names[Foundidx]]);
     s := _Options.ValueFromIndex[FoundIdx];
     OptDesc := OptName.OptionDesc;



From twm at mail.berlios.de  Sun Jul 22 15:39:06 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sun, 22 Jul 2007 15:39:06 +0200
Subject: [Dzchart-svncheckins] r185 - utilities/dzLib/trunk/src
Message-ID: <200707221339.l6MDd6oE021928@sheep.berlios.de>

Author: twm
Date: 2007-07-22 15:39:05 +0200 (Sun, 22 Jul 2007)
New Revision: 185

Modified:
   utilities/dzLib/trunk/src/u_dzExecutor.pas
Log:
removed routine_id constants, there must be a better way...

Modified: utilities/dzLib/trunk/src/u_dzExecutor.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzExecutor.pas	2007-07-17 09:05:43 UTC (rev 184)
+++ utilities/dzLib/trunk/src/u_dzExecutor.pas	2007-07-22 13:39:05 UTC (rev 185)
@@ -111,7 +111,7 @@
        This method is called by various other methods to assert that their
        functions are allowed in the current Status.
        @param ValidStatusSet is a set of valid Status values for the check. }
-    procedure AssertStatus(_ValidStatusSet: TExecutorStatusSet; const _Method: string);
+    procedure AssertStatus(_ValidStatusSet: TExecutorStatusSet; const _Method: string = '');
     {: Get method for property GetRedirectStdIn
        @returns true if StdIn is not an empty string }
     function GetRedirectStdIn: boolean;
@@ -264,8 +264,6 @@
 end;
 
 function TExecutor.GetStatus: TExecutorStatus;
-const
-  ROUTINE_ID = '[function TExecutor.GetStatus]';
 begin
   if fStatus = esRunning then begin
     Win32Check(GetExitCodeProcess(fProcessInfo.hProcess, fExitCode));
@@ -278,27 +276,21 @@
 end;
 
 function TExecutor.GetExitCode: DWORD;
-const
-  ROUTINE_ID = '[function TExecutor.GetExitCode]';
 begin
-  AssertStatus([esRunning, esTerminated], ROUTINE_ID);
+  AssertStatus([esRunning, esTerminated]);
   Result := fExitCode;
 end;
 
 function TExecutor.Wait(_Timeout: DWORD): DWORD;
-const
-  ROUTINE_ID = '[function TExecutor.Wait]';
 begin
-  AssertStatus([esRunning, esTerminated], ROUTINE_ID);
+  AssertStatus([esRunning, esTerminated]);
   Result := WaitforSingleObject(ProcessHandle, _Timeout);
 end;
 
 function TExecutor.Kill: boolean;
-const
-  ROUTINE_ID = '[function TExecutor.Kill]';
 begin
   case GetStatus of
-    esInvalid: raise ENoProcess.CreateFmt('Process has not yet been started'#13#10'%s', [ROUTINE_ID]);
+    esInvalid: raise ENoProcess.CreateFmt('Process has not yet been started'#13#10'%s', ['']);
     esRunning: Result := TerminateProcess(fProcessInfo.hProcess, $FFFFFFFF);
   else
     Result := true;
@@ -306,31 +298,23 @@
 end;
 
 function TExecutor.GetProcessHandle: THandle;
-const
-  ROUTINE_ID = '[function TExecutor.GetProcessHandle]';
 begin
-  AssertStatus([esRunning, esTerminated], ROUTINE_ID);
+  AssertStatus([esRunning, esTerminated]);
   Result := fProcessInfo.hProcess;
 end;
 
 function TExecutor.GetThreadHandle: THandle;
-const
-  ROUTINE_ID = '[function TExecutor.GetThreadHandle]';
 begin
-  AssertStatus([esRunning, esTerminated], ROUTINE_ID);
+  AssertStatus([esRunning, esTerminated]);
   Result := fProcessInfo.hThread;
 end;
 
 function TExecutor.GetRedirectStdIn: boolean;
-const
-  ROUTINE_ID = '[function TExecutor.GetRedirectStdIn]';
 begin
   Result := fStdIn <> '';
 end;
 
 function TExecutor.Execute: boolean;
-const
-  ROUTINE_ID = '[function TExecutor.Execute]';
 var
   StartupInfo: TStartupInfo;
   SecurityAttributes: TSecurityAttributes;
@@ -428,12 +412,10 @@
 end;
 
 function TExecutor.GetStdErr: string;
-const
-  ROUTINE_ID = '[function TExecutor.GetStdErr]';
 var
   Size: integer;
 begin
-  AssertStatus([esTerminated], ROUTINE_ID);
+  AssertStatus([esTerminated]);
   if RedirectStdErr then begin
     fErrorFile.Seek(0, soFromBeginning);
     Size := fErrorFile.Size;
@@ -442,16 +424,14 @@
       fErrorFile.Read(Result[1], Size);
     end;
   end else
-    raise ENotRedirected.CreateFmt('StdErr was not redirected'#13#10'%s', [ROUTINE_ID]);
+    raise ENotRedirected.Create('StdErr was not redirected');
 end;
 
 function TExecutor.GetStdOut: string;
-const
-  ROUTINE_ID = '[function TExecutor.GetStdErr]';
 var
   Size: integer;
 begin
-  AssertStatus([esTerminated], ROUTINE_ID);
+  AssertStatus([esTerminated]);
   if RedirectStdOut then begin
     fOutputFile.Seek(0, soFromBeginning);
     Size := fOutputFile.Size;
@@ -460,7 +440,7 @@
       fOutputFile.Read(Result[1], Size);
     end;
   end else
-    raise ENotRedirected.CreateFmt('StdOut was not redirected'#13#10'%s', [ROUTINE_ID]);
+    raise ENotRedirected.Create('StdOut was not redirected');
 end;
 
 end.



From twm at mail.berlios.de  Sun Jul 22 16:56:04 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sun, 22 Jul 2007 16:56:04 +0200
Subject: [Dzchart-svncheckins] r186 - utilities/dzPrepBuild/trunk/src
Message-ID: <200707221456.l6MEu4wA025333@sheep.berlios.de>

Author: twm
Date: 2007-07-22 16:56:00 +0200 (Sun, 22 Jul 2007)
New Revision: 186

Removed:
   utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
Modified:
   utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Log:
* added _( ) for all translatable strings
* TCentralVersionInfo.Create now removes the project file extension before adding _Version.ini
* removed u_IncBuildNoMain, replaced by u_PrepBuildMain

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-22 14:56:00 UTC (rev 186)
@@ -6,7 +6,6 @@
   SysUtils,
   Forms,
   oxmldom,
-  u_IncBuildNoMain in 'u_IncBuildNoMain.pas',
   d_BdsProjVersionInfo in 'd_BdsProjVersionInfo.pas' {dm_BdsProjVersionInfo: TDataModule},
   i_VersionInfo in 'i_VersionInfo.pas',
   u_DofVersionInfo in 'u_DofVersionInfo.pas',

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-22 14:56:00 UTC (rev 186)
@@ -36,7 +36,7 @@
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">--Readini=testdata\testproject --exec=test.cmd --writerc=testdata\testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">56</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><Ve!
 rsionInfoKeys Name="FileVersion">1.1.0.56</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">--Readini=testdata\testproject --exec=test.cmd --writerc=testdata\testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">57</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><Ve!
 rsionInfoKeys Name="FileVersion">1.1.0.57</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
       
       
       
@@ -73,7 +73,6 @@
     <DCCReference Include="u_CentralIniVersionInfo.pas" />
     <DCCReference Include="u_DofVersionInfo.pas" />
     <DCCReference Include="u_DummyVersionInfo.pas" />
-    <DCCReference Include="u_IncBuildNoMain.pas" />
     <DCCReference Include="u_IniVersionInfo.pas" />
     <DCCReference Include="u_PrepBuildMain.pas" />
   </ItemGroup>

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -95,6 +95,10 @@
 
 {$R *.dfm}
 
+uses
+  StrUtils,
+  u_dzTranslator;
+
 { Tdm_BdsProjVersionInfo }
 
 procedure Tdm_BdsProjVersionInfo.Assign(const _VersionInfo: IVersionInfo);
@@ -176,7 +180,7 @@
   FVersionInfoKeys := DelphiPersonality.childNodes['VersionInfoKeys'];
 
   if not SameText(GetChildNodeContent(FVersionInfo, 'VersionInfo', 'IncludeVerInfo'), 'True') then
-    raise ENoVersionInfo.Create('.bdsproj file does not contain version information');
+    raise ENoVersionInfo.Create(_('.bdsproj file does not contain version information'));
 end;
 
 destructor Tdm_BdsProjVersionInfo.Destroy;
@@ -267,10 +271,7 @@
 
 procedure Tdm_BdsProjVersionInfo.SetAutoIncBuild(_AutoIncBuild: boolean);
 begin
-  if _AutoIncBuild then
-    SetVersionInfo('AutoIncBuild', 'True')
-  else
-    SetVersionInfo('AutoIncBuild', 'False')
+  SetVersionInfo('AutoIncBuild', IfThen(_AutoIncBuild, 'True', 'False'));
 end;
 
 procedure Tdm_BdsProjVersionInfo.SetBuild(_Build: integer);

Modified: utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -38,6 +38,7 @@
 implementation
 
 uses
+  SysUtils,
   IniFiles,
   u_dzStringUtils;
 
@@ -55,7 +56,7 @@
 
 class function TCentralVersionInfo.FilenameFor(const _ProjectName: string): string;
 begin
-  Result := _ProjectName + '_Version.ini';
+  Result := ChangeFileExt(_ProjectName, '') + '_Version.ini';
 end;
 
 function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;

Modified: utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_DofVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -28,6 +28,9 @@
 
 implementation
 
+uses
+  u_dzTranslator;
+
 const
   VERSION_INFO_SECTION = 'Version Info';
   VERSION_INFO_KEYS_SECTION = 'Version Info Keys';
@@ -39,7 +42,7 @@
   FProjectName := _ProjectName;
   inherited Create(VerInfoFilename, VERSION_INFO_SECTION, VERSION_INFO_KEYS_SECTION);
   if FIniFile.ReadInteger(VERSION_INFO_SECTION, 'IncludeVerInfo', 0) <> 1 then
-    raise ENoVersionInfo.Create('.dof file does not contain version info');
+    raise ENoVersionInfo.Create(_('.dof file does not contain version info'));
 end;
 
 class function TDofVersionInfo.FilenameFor(const _ProjectName: string): string;

Deleted: utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_IncBuildNoMain.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -1,226 +0,0 @@
-unit u_IncBuildNoMain;
-
-interface
-
-procedure Main;
-
-implementation
-
-uses
-  SysUtils,
-  IniFiles,
-  oxmldom,
-  XMLIntf,
-  XmlDoc,
-  Classes,
-  ActiveX,
-  i_VersionInfo,
-  u_DofVersionInfo,
-  d_BdsProjVersionInfo,
-  u_CentralIniVersionInfo;
-
-type
-  EHalt = class(EAbort)
-  public
-    ResultCode: integer;
-    constructor Create(_ResultCode: integer);
-  end;
-
-{ EHalt }
-
-constructor EHalt.Create(_ResultCode: integer);
-begin
-  inherited CreateFmt('Halt with result code %d', [_ResultCode]);
-  ResultCode := _ResultCode;
-end;
-
-procedure WriteRcFile(const _Project: string; _VersionInfo: IVersionInfo);
-var
-  t: TextFile;
-begin
-  Assignfile(t, _Project + '.rc');
-  Rewrite(t);
-
-  WriteLn(t, {    } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
-  WriteLn(t);
-  WriteLn(t, {    } '1 VERSIONINFO LOADONCALL MOVEABLE DISCARDABLE IMPURE');
-  WriteLn(t, Format('FILEVERSION %d, %d, %d, %d', [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, Format('PRODUCTVERSION %d, %d, %d, %d',
-    [_VersionInfo.MajorVer, _VersionInfo.MinorVer, _VersionInfo.Release, _VersionInfo.Build]));
-  WriteLn(t, {    } 'FILEFLAGSMASK VS_FFI_FILEFLAGSMASK');
-  WriteLn(t, {    } 'FILEOS VOS__WINDOWS32');
-  WriteLn(t, {    } 'FILETYPE VFT_APP');
-  WriteLn(t, {    } '{');
-  WriteLn(t, {    } ' BLOCK "StringFileInfo"');
-  WriteLn(t, {    } ' {');
-  WriteLn(t, {    } '  BLOCK "040904E4"');
-  WriteLn(t, {    } '  {');
-  WriteLn(t, Format('   VALUE "CompanyName", "%s\000"', [_VersionInfo.CompanyName]));
-  WriteLn(t, Format('   VALUE "FileDescription", "%s\000"', [_VersionInfo.FileDescription]));
-  WriteLn(t, Format('   VALUE "FileVersion", "%s\000"', [_VersionInfo.FileVersion]));
-  WriteLn(t, Format('   VALUE "InternalName", "%s\000"', [_VersionInfo.InternalName]));
-  WriteLn(t, Format('   VALUE "LegalCopyright", "%s\000"', [_VersionInfo.LegalCopyright]));
-  WriteLn(t, Format('   VALUE "LegalTrademarks", "%s\000"', [_VersionInfo.LegalTrademarks]));
-  WriteLn(t, Format('   VALUE "OriginalFilename", "%s\000"', [_VersionInfo.OriginalFilename]));
-  WriteLn(t, Format('   VALUE "ProductName", "%s\000"', [_VersionInfo.ProductName]));
-  WriteLn(t, Format('   VALUE "ProductVersion", "%s\000"', [_VersionInfo.ProductVersion]));
-  WriteLn(t, Format('   VALUE "Comments", "%s\000"', [_VersionInfo.Comments]));
-  WriteLn(t, {    } '  }');
-  WriteLn(t, {    } ' }');
-  WriteLn(t, {    } ' BLOCK "VarFileInfo"');
-  WriteLn(t, {    } ' {');
-  WriteLn(t, {    } '  VALUE "Translation", 1033, 1252');
-  WriteLn(t, {    } ' }');
-  WriteLn(t, {    } '}');
-  if FileExists(_Project + '.ico') then begin
-    WriteLn(t);
-    WriteLn(t, {  } 'MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico');
-  end;
-  Close(t);
-end;
-
-procedure Usage;
-begin
-  WriteLn;
-  WriteLn('Usage: dzPrepBuild <projectname>');
-  WriteLn;
-  WriteLn('This Program tries to read version information from <projectname>.bdsproj');
-  WriteLn('and if that fails from <projectname>.dof');
-  WriteLn;
-  WriteLn('If AutoIncBuild = true, it will increment the build number and write it back.');
-  WriteLn('The information is then written to <projectname>.rc to be compiled with');
-  WriteLn('the brcc32 tool.');
-  WriteLn;
-  WriteLn('If <projectname>.ico exists, this file will be included as an icon resource.');
-  WriteLn;
-  WriteLn('If both, a .bdsproj and a .dof file exist, the .dof file will be updated');
-  WriteLn('with the information from the .bdsproj file.');
-  WriteLn;
-  WriteLn('Example:');
-  WriteLn('c:\myproject> dzPrepBuild MyProject');
-  WriteLn('c:\myproject> brcc32 MyProject.rc');
-  raise EHalt.Create(1);
-end;
-
-procedure Main;
-var
-  Projectname: string;
-  ResultCode: integer;
-  CentralVerInfo: IVersionInfo;
-  BdsVerInfo: IVersionInfo;
-  DelphiVerInfo: IVersionInfo;
-  OtherVerinfo: IVersionInfo;
-  VersionInfo: IVersionInfo;
-  AdditionalVersionInfos: TInterfaceList;
-  BuildNo: integer;
-  i: integer;
-begin
-  Resultcode := 0;
-  try
-    try
-      WriteLn('dzPrepBuild (c) 2007 by Thomas Mueller (www.dummzeuch.de)');
-      WriteLn('(previously called IncBuildNo)');
-      if ParamCount <> 1 then
-        Usage;
-      CoInitializeEx(nil, COINIT_APARTMENTTHREADED);
-      Projectname := ParamStr(1);
-
-      AdditionalVersionInfos := TInterfaceList.Create;
-      try
-        try
-          Write('Reading ', TCentralVersionInfo.FilenameFor(Projectname), ' ');
-          CentralVerInfo := TCentralVersionInfo.Create(Projectname);
-          WriteLn('OK');
-        except
-          WriteLn('FAIL');
-          CentralVerInfo := nil;
-        end;
-        try
-          Write('Reading ', Tdm_BdsProjVersionInfo.FilenameFor(Projectname), ' ');
-          BdsVerInfo := Tdm_BdsProjVersionInfo.Create(Projectname);
-          WriteLn('OK');
-        except
-          WriteLn('FAIL');
-          BdsVerInfo := nil;
-        end;
-
-        try
-          Write('Reading ', TDofVersionInfo.FilenameFor(Projectname), ' ');
-          DelphiVerInfo := TDofVersionInfo.Create(Projectname);
-          WriteLn('OK');
-        except
-          WriteLn('FAIL');
-          DelphiVerInfo := nil;
-        end;
-
-        if Assigned(CentralVerInfo) then begin
-          VersionInfo := CentralVerInfo;
-          if Assigned(BdsVerInfo) then
-            AdditionalVersionInfos.Add(BdsVerInfo);
-          if Assigned(DelphiVerInfo) then
-            AdditionalVersionInfos.Add(DelphiVerInfo);
-        end else if Assigned(BdsVerInfo) then begin
-          VersionInfo := BdsVerInfo;
-          if Assigned(DelphiVerInfo) then
-            AdditionalVersionInfos.Add(DelphiVerInfo);
-        end else if Assigned(DelphiVerInfo) then
-          VersionInfo := DelphiVerInfo
-        else begin
-          WriteLn('Error: Could not read either of the version info files.');
-          raise EHalt.Create(1);
-        end;
-
-        BuildNo := VersionInfo.Build;
-        WriteLn('BuildNo from ', VersionInfo.VerInfoFilename, ' is ', BuildNo);
-        for i := 0 to AdditionalVersionInfos.Count - 1 do begin
-          OtherVerinfo := AdditionalVersionInfos[i] as IVersionInfo;
-          if OtherVerinfo.Build > BuildNo then begin
-            BuildNo := OtherVerinfo.Build;
-            Writeln('BuildNo from ', OtherVerinfo.VerInfoFilename, ' is higher, using ', BuildNo);
-          end;
-        end;
-
-        if VersionInfo.AutoIncBuild then begin
-          Write('Incrementing build number ');
-          VersionInfo.Build := BuildNo + 1;
-          VersionInfo.UpdateFile;
-          WriteLn('OK');
-          WriteLn('New version number is ', VersionInfo.MajorVer, '.', VersionInfo.MinorVer,
-            '.', VersionInfo.Release, ' build ', VersionInfo.Build);
-        end;
-
-        Write('Writing ', Projectname, '.rc file ');
-        WriteRcFile(Projectname, VersionInfo);
-        WriteLn('OK');
-
-        for i := 0 to AdditionalVersionInfos.Count - 1 do begin
-          OtherVerinfo := AdditionalVersionInfos[i] as IVersionInfo;
-          Write('Updating ', OtherVerinfo.VerInfoFilename, ' ');
-          OtherVerinfo.Assign(VersionInfo);
-          OtherVerinfo.UpdateFile;
-          WriteLn('OK');
-        end;
-      finally
-        AdditionalVersionInfos.Free;
-      end;
-    except
-      on e: EHalt do
-        ResultCode := e.ResultCode;
-      on e: Exception do begin
-        ResultCode := 1;
-        WriteLn(e.ClassName, ': ', e.Message);
-      end;
-    end;
-  finally
-{$IFOPT D+}
-    WriteLn;
-    WriteLn('press <enter>');
-    readln;
-{$ENDIF}
-  end;
-  if ResultCode <> 0 then
-    Halt(ResultCode);
-end;
-
-end.
-

Modified: utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_IniVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -45,6 +45,9 @@
 
 implementation
 
+uses
+  u_dzTranslator;
+
 { TIniVersionInfo }
 
 constructor TIniVersionInfo.Create(const _FullFilename: string; const _InfoSection: string;
@@ -52,7 +55,7 @@
 begin
   inherited Create;
   if not FileExists(_FullFilename) then
-    raise ENoVersionInfo.CreateFmt('File %s does not exist.', [_FullFilename]);
+    raise ENoVersionInfo.CreateFmt(_('File %s does not exist.'), [_FullFilename]);
   FInfoSection := _InfoSection;
   FInfoKeysSection := _InfoKeysSection;
   FIniFile := TMemIniFile.Create(_FullFilename);

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-22 13:39:05 UTC (rev 185)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-22 14:56:00 UTC (rev 186)
@@ -25,6 +25,7 @@
 implementation
 
 uses
+  u_dzTranslator,
   u_dzExecutor,
   u_dzShellApiUtils,
   u_DofVersionInfo,
@@ -164,13 +165,13 @@
 
   if FGetOpt.OptionPassed('ReadBdsProj', Project) then begin
     if Assigned(ParamVersionInfo) then
-      raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
+      raise Exception.Create(_('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni'));
     ParamVersionInfo := Tdm_BdsProjVersionInfo.Create(Project);
   end;
 
   if FGetOpt.OptionPassed('ReadIni', Project) then begin
     if Assigned(ParamVersionInfo) then
-      raise Exception.Create('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni');
+      raise Exception.Create(_('You can only pass one of --ReadDof, --ReadBdsproj or --ReadIni'));
     ParamVersionInfo := TCentralVersionInfo.Create(Project);
   end;
 
@@ -182,25 +183,25 @@
 
   if FGetOpt.OptionPassed('MajorVer', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to MajorVer must be a number');
+      raise Exception.Create(_('Parameter to MajorVer must be a number'));
     VersionInfo.MajorVer := IntValue;
   end;
 
   if FGetOpt.OptionPassed('MinorVer', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to MinorVer must be a number');
+      raise Exception.Create(_('Parameter to MinorVer must be a number'));
     VersionInfo.MinorVer := IntValue;
   end;
 
   if FGetOpt.OptionPassed('Release', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to Release must be a number');
+      raise Exception.Create(_('Parameter to Release must be a number'));
     VersionInfo.Release := IntValue;
   end;
 
   if FGetOpt.OptionPassed('Build', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create('Parameter to MinorVer must be a number');
+      raise Exception.Create(_('Parameter to MinorVer must be a number'));
     VersionInfo.MinorVer := IntValue;
   end;
 
@@ -267,29 +268,29 @@
 procedure TPrepBuildMain.InitCmdLineParser;
 begin
   inherited;
-  FGetOpt.RegisterOption('ReadDof', 'read a .dof file to get the version information', true);
-  FGetOpt.RegisterOption('ReadBdsproj', 'read a .bdsproj file to get the version information', true);
-  FGetOpt.RegisterOption('ReadIni', 'read a .ini file to get the version information', true);
-  FGetOpt.RegisterOption('Exec', 'execute the given program or script with extended environment', true);
-  FGetOpt.RegisterOption('UpdateDof', 'update a .dof file with the version information', true);
-  FGetOpt.RegisterOption('UpdateBdsproj', 'update a .bdsproj file with the version information', true);
-  FGetOpt.RegisterOption('UpdateIni', 'update a .ini file with the version information', true);
-  FGetOpt.RegisterOption('WriteRc', 'write version info to a .rc file', true);
-  FGetOpt.RegisterOption('Icon', 'Assign an icon file to add to the .rc file', true);
-  FGetOpt.RegisterOption('IncBuild', 'increment the build number', false);
-  FGetOpt.RegisterOption('MajorVer', 'set the major version number', true);
-  FGetOpt.RegisterOption('MinorVer', 'set the minor version number', true);
-  FGetOpt.RegisterOption('Release', 'set the release number', true);
-  FGetOpt.RegisterOption('Build', 'set the build number', true);
-  FGetOpt.RegisterOption('FileDesc', 'set the file description', true);
-  FGetOpt.RegisterOption('InternalName', 'set the internal name', true);
-  FGetOpt.RegisterOption('OriginalName', 'set the original file name', true);
-  FGetOpt.RegisterOption('Product', 'set the product name', true);
-  FGetOpt.RegisterOption('ProductVersion', 'set the product version', true);
-  FGetOpt.RegisterOption('Company', 'set the company name', true);
-  FGetOpt.RegisterOption('Copyright', 'set the legal copyright', true);
-  FGetOpt.RegisterOption('Trademark', 'set the legal trademark', true);
-  FGetOpt.RegisterOption('Comments', 'set the comments', true);
+  FGetOpt.RegisterOption('ReadDof', _('read a .dof file to get the version information'), true);
+  FGetOpt.RegisterOption('ReadBdsproj', _('read a .bdsproj file to get the version information'), true);
+  FGetOpt.RegisterOption('ReadIni', _('read a .ini file to get the version information'), true);
+  FGetOpt.RegisterOption('Exec', _('execute the given program or script with extended environment'), true);
+  FGetOpt.RegisterOption('UpdateDof', _('update a .dof file with the version information'), true);
+  FGetOpt.RegisterOption('UpdateBdsproj', _('update a .bdsproj file with the version information'), true);
+  FGetOpt.RegisterOption('UpdateIni', _('update a .ini file with the version information'), true);
+  FGetOpt.RegisterOption('WriteRc', _('write version info to a .rc file'), true);
+  FGetOpt.RegisterOption('Icon', _('Assign an icon file to add to the .rc file'), true);
+  FGetOpt.RegisterOption('IncBuild', _('increment the build number'), false);
+  FGetOpt.RegisterOption('MajorVer', _('set the major version number'), true);
+  FGetOpt.RegisterOption('MinorVer', _('set the minor version number'), true);
+  FGetOpt.RegisterOption('Release', _('set the release number'), true);
+  FGetOpt.RegisterOption('Build', _('set the build number'), true);
+  FGetOpt.RegisterOption('FileDesc', _('set the file description'), true);
+  FGetOpt.RegisterOption('InternalName', _('set the internal name'), true);
+  FGetOpt.RegisterOption('OriginalName', _('set the original file name'), true);
+  FGetOpt.RegisterOption('Product', _('set the product name'), true);
+  FGetOpt.RegisterOption('ProductVersion', _('set the product version'), true);
+  FGetOpt.RegisterOption('Company', _('set the company name'), true);
+  FGetOpt.RegisterOption('Copyright', _('set the legal copyright'), true);
+  FGetOpt.RegisterOption('Trademark', _('set the legal trademark'), true);
+  FGetOpt.RegisterOption('Comments', _('set the comments'), true);
 end;
 
 initialization



From twm at mail.berlios.de  Sun Jul 22 20:59:52 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sun, 22 Jul 2007 20:59:52 +0200
Subject: [Dzchart-svncheckins] r187 - utilities/dzPrepBuild/trunk/src
Message-ID: <200707221859.l6MIxq7F019454@sheep.berlios.de>

Author: twm
Date: 2007-07-22 20:59:40 +0200 (Sun, 22 Jul 2007)
New Revision: 187

Added:
   utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini
   utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.RES
   utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.rc
   utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini
   utilities/dzPrepBuild/trunk/src/dz.ico
Modified:
   utilities/dzPrepBuild/trunk/src/
   utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Log:
* Bugfix: Build option was assigned to MinorVer
* Bugfix: Writing to redirected ini file was not committed to file
* New UpdateFileVersion method which creates the FileVersion string from the version information
* added an icon as a separate resource
* added version info as .ini file with a separate file for the build number (eating my own dog food)



Property changes on: utilities/dzPrepBuild/trunk/src
___________________________________________________________________
Name: svn:ignore
   - PrepBuild.dsk
PrepBuild.res

   + PrepBuild.dsk
PrepBuild.res
PrepBuild_Version.rc
PrepBuild_Version.RES


Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-22 18:59:40 UTC (rev 187)
@@ -1,5 +1,9 @@
 program PrepBuild;
 
+{$R *_icon.res}
+{$R *_version.res}
+
+
 {$APPTYPE CONSOLE}
 
 uses
@@ -16,8 +20,6 @@
   u_DummyVersionInfo in 'u_DummyVersionInfo.pas',
   u_AbstractVersionInfo in 'u_AbstractVersionInfo.pas';
 
-{$R *.res}
-
 begin
   Application.Initialize;
   Application.Title := 'PrepBuild';

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-22 18:59:40 UTC (rev 187)
@@ -25,41 +25,27 @@
     <DCC_HppOutput>..\dcu</DCC_HppOutput>
     <DCC_Define>DEBUG;no_translation</DCC_Define>
     <DCC_ExeOutput>..</DCC_ExeOutput>
-    <DCC_UnitSearchPath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_UnitSearchPath>
-    <DCC_ResourcePath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ResourcePath>
-    <DCC_ObjPath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ObjPath>
-    <DCC_IncludePath>..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_IncludePath>
+    <DCC_UnitSearchPath>$(BDS)\lib\Debug;$(BDS)\Lib\Debug\Indy10;..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_UnitSearchPath>
+    <DCC_ResourcePath>$(BDS)\lib\Debug;$(BDS)\Lib\Debug\Indy10;..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ResourcePath>
+    <DCC_ObjPath>$(BDS)\lib\Debug;$(BDS)\Lib\Debug\Indy10;..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ObjPath>
+    <DCC_IncludePath>$(BDS)\lib\Debug;$(BDS)\Lib\Debug\Indy10;..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_IncludePath>
     <DCC_SYMBOL_PLATFORM>False</DCC_SYMBOL_PLATFORM>
     <DCC_UNIT_PLATFORM>False</DCC_UNIT_PLATFORM>
+    <DCC_Optimize>False</DCC_Optimize>
   </PropertyGroup>
   <ProjectExtensions>
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="RunParams">--Readini=testdata\testproject --exec=test.cmd --writerc=testdata\testproject</Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">True</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">57</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><Ve!
 rsionInfoKeys Name="FileVersion">1.1.0.57</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2006 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">IncBuildNo.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">IncBuildNo</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclnet100.bpl">Borland Internet Components</Excluded_Packages>
-      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dclbde100.bpl">Borland BDE DB Components</Excluded_Packages>
-      <Excluded_Packages Name="C:\Program Files\Borland\BDS\4.0\Bin\dbx100.bpl">Borland SQL Explorer UI Package</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclIntraweb_80_100.bpl">Intraweb 8.0 Design Package for Borland Development Studio 2006</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclsoap100.bpl">Borland SOAP Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\bcbie100.bpl">Borland C++Builder Internet Explorer 5 Components Package</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcltee100.bpl">TeeChart Components</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dcldbxcds100.bpl">Borland SimpleDataset Component (DBX)</Excluded_Packages>
-      <Excluded_Packages Name="c:\program files\borland\bds\4.0\Bin\dclie100.bpl">Internet Explorer Components</Excluded_Packages>
-    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source></Delphi.Personality></BorlandProject></BorlandProject>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters><Parameters Name="RunParams">--incbuild --readini=src\prepbuild --exec=prep.cmd</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">False</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">62</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVe!
 rsion">1.1.0.62</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">&lt;build data goes here&gt;</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">PrepBuild</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2007 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">PrepBuild.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">PrepBuild</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+      <Excluded_Packages Name="$(BDS)\bin\dclofficexp100.bpl">Microsoft Office XP Sample Automation Server Wrapper Components</Excluded_Packages>
+      <Excluded_Packages Name="$(BDS)\bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
+    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source></Delphi.Personality><ModelSupport>False</ModelSupport></BorlandProject></BorlandProject>
   </ProjectExtensions>
   <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
+  <PropertyGroup>
+    <PreBuildEvent>prepbuild.exe --incbuild --readini=$(PROJECTPATH) --exec=..\prep.cmd</PreBuildEvent>
+  </PropertyGroup>
   <ItemGroup>
     <DelphiCompile Include="PrepBuild.dpr">
       <MainSource>MainSource</MainSource>

Added: utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini	2007-07-22 18:59:40 UTC (rev 187)
@@ -0,0 +1,3 @@
+[Version Info]
+Build=86
+

Added: utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.RES
===================================================================
(Binary files differ)


Property changes on: utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.RES
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.rc
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.rc	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild_Icon.rc	2007-07-22 18:59:40 UTC (rev 187)
@@ -0,0 +1 @@
+MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE dz.ico

Added: utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini	2007-07-22 18:59:40 UTC (rev 187)
@@ -0,0 +1,27 @@
+[Version Info]
+IncludeVerInfo=1
+AutoIncBuild=0
+MajorVer=1
+MinorVer=1
+Release=0
+Build=redirect:PrepBuild_BuildNo.ini,Version Info,Build
+Debug=0
+PreRelease=0
+Special=0
+Private=0
+DLL=0
+Locale=1033
+CodePage=1252
+
+[Version Info Keys]
+CompanyName=dummzeuch.de
+FileDescription=increment build number and create rc file
+FileVersion=1.1.0.86
+InternalName=PrepBuild
+LegalCopyright=Copyright 2002-2007 by Thomas Mueller
+LegalTrademarks=
+OriginalFilename=PrepBuild.exe
+ProductName=PrepBuild
+ProductVersion=2007-07-22
+Comments=Use at your own risk
+

Modified: utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/d_BdsProjVersionInfo.pas	2007-07-22 18:59:40 UTC (rev 187)
@@ -63,6 +63,7 @@
   //
     procedure Assign(const _VersionInfo: IVersionInfo); reintroduce;
     procedure UpdateFile;
+    procedure UpdateFileVersion;
     function VerInfoFilename: string;
   //
     property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
@@ -359,6 +360,11 @@
   ProjDoc.SaveToFile(FBdsProjFile);
 end;
 
+procedure Tdm_BdsProjVersionInfo.UpdateFileVersion;
+begin
+  FileVersion := Format('%d.%d.%d.%d', [MajorVer, MinorVer, Release, Build]);
+end;
+
 function Tdm_BdsProjVersionInfo.VerInfoFilename: string;
 begin
   Result := FilenameFor(FProjectName);

Added: utilities/dzPrepBuild/trunk/src/dz.ico
===================================================================
(Binary files differ)


Property changes on: utilities/dzPrepBuild/trunk/src/dz.ico
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/i_VersionInfo.pas	2007-07-22 18:59:40 UTC (rev 187)
@@ -42,6 +42,7 @@
     procedure SetComments(const _Comments: string);
   //
     procedure Assign(const _VersionInfo: IVersionInfo);
+    procedure UpdateFileVersion;
     procedure UpdateFile;
   //
     function VerInfoFilename: string;

Modified: utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/u_AbstractVersionInfo.pas	2007-07-22 18:59:40 UTC (rev 187)
@@ -3,6 +3,7 @@
 interface
 
 uses
+  SysUtils,
   i_VersionInfo;
 
 type
@@ -55,8 +56,10 @@
     procedure SetProductName(_ProductName: string); virtual;
     procedure SetProductVersion(_ProductVersion: string); virtual;
     procedure SetRelease(_Release: Integer); virtual;
+    //
     procedure UpdateFile; virtual; abstract;
     function VerInfoFilename: string; virtual; abstract;
+    procedure UpdateFileVersion;
     //
     property AutoIncBuild: boolean read GetAutoIncBuild write SetAutoIncBuild;
     property Build: integer read GetBuild write SetBuild;
@@ -246,5 +249,10 @@
   FRelease := _Release;
 end;
 
+procedure TAbstractVersionInfo.UpdateFileVersion;
+begin
+  FileVersion := Format('%d.%d.%d.%d', [MajorVer, MinorVer, Release, Build]);
+end;
+
 end.
 

Modified: utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/u_CentralIniVersionInfo.pas	2007-07-22 18:59:40 UTC (rev 187)
@@ -21,6 +21,9 @@
   TCentralVersionInfo = class(TIniVersionInfo, IVersionInfo)
   private
     FProjectName: string;
+    procedure GetRedirIdentInfo(const _RedirString: string; out _Filename, _Section, _Ident: string);
+    procedure GetRedirSectionInfo(_Redir: string; out _Filename, _Section: string);
+    procedure AdjustFilename(var _Filename: string);
   protected
     function VerInfoFilename: string; override;
     //
@@ -59,30 +62,58 @@
   Result := ChangeFileExt(_ProjectName, '') + '_Version.ini';
 end;
 
+procedure TCentralVersionInfo.AdjustFilename(var _Filename: string);
+var
+  Path: string;
+begin
+  Path := ExtractFilePath(_Filename);
+  if (Path = '') or ((Path[1] <> '\') and (Copy(Path, 2, 1) <> ':')) then begin
+      // Path is relative, so make it relative to the main .ini file
+    _Filename := ExtractFilePath(FProjectName) + _Filename;
+  end;
+end;
+
+procedure TCentralVersionInfo.GetRedirSectionInfo(_Redir: string; out _Filename, _Section: string);
+begin
+  _Filename := GetDelStr(_Redir, ',');
+  _Section := _Redir;
+  AdjustFilename(_Filename);
+end;
+
+procedure TCentralVersionInfo.GetRedirIdentInfo(const _RedirString: string;
+  out _Filename, _Section, _Ident: string);
+var
+  Redir: string;
+begin
+  Redir := Copy(_RedirString, Length('redirect:') + 1);
+  _Filename := GetDelStr(Redir, ',');
+  _Section := GetDelStr(Redir, ',');
+  _Ident := Redir;
+  AdjustFilename(_Filename);
+end;
+
 function TCentralVersionInfo.ReadString(const _Section, _Ident: string; _Default: string): string;
 var
   Redir: string;
   IniFile: TMemIniFile;
   Filename: string;
   Section: string;
+  Ident: string;
 begin
   Redir := FIniFile.ReadString(_Section, 'redirect', '');
   if Redir = '' then begin
     Result := FIniFile.ReadString(_Section, _Ident, _Default);
     if UStartsWith('redirect:', Result) then begin
-      Redir := Result;
-      Filename := GetDelStr(Redir, ',');
-      Section := GetDelStr(Redir, ',');
+      GetRedirIdentInfo(Result, Filename, Section, Ident);
       IniFile := TMemIniFile.Create(Filename);
       try
-        Result := IniFile.ReadString(Section, Redir, _Default);
+        Result := IniFile.ReadString(Section, Ident, _Default);
       finally
         IniFile.Free;
       end;
     end;
   end else begin
-    Filename := GetDelStr(Redir, ',');
-    Section := Redir;
+    GetRedirSectionInfo(Redir, Filename, Section);
     IniFile := TMemIniFile.Create(Filename);
     try
       Result := IniFile.ReadString(Section, _Ident, _Default);
@@ -103,27 +134,28 @@
   IniFile: TMemIniFile;
   Filename: string;
   Section: string;
+  Ident: string;
 begin
   Redir := FIniFile.ReadString(_Section, 'redirect', '');
   if Redir = '' then begin
     Redir := FIniFile.ReadString(_Section, _Ident, '');
     if UStartsWith('redirect:', Redir) then begin
-      Filename := GetDelStr(Redir, ',');
-      Section := GetDelStr(Redir, ',');
+      GetRedirIdentInfo(Redir, Filename, Section, Ident);
       IniFile := TMemIniFile.Create(Filename);
       try
-        IniFile.WriteString(Section, Redir, _Value);
+        IniFile.WriteString(Section, Ident, _Value);
+        IniFile.UpdateFile;
       finally
         IniFile.Free;
       end;
     end else
       FIniFile.WriteString(_Section, _Ident, _Value);
   end else begin
-    Filename := GetDelStr(Redir, ',');
-    Section := Redir;
+    GetRedirSectionInfo(Redir, Filename, Section);
     IniFile := TMemIniFile.Create(Filename);
     try
       IniFile.WriteString(Section, _Ident, _Value);
+      IniFile.UpdateFile;
     finally
       IniFile.Free;
     end;

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-22 18:59:40 UTC (rev 187)
@@ -15,6 +15,7 @@
   private
     function HandleExecOption(const _Command: string; _VersionInfo: IVersionInfo; const _Project: string): integer;
     procedure WriteRcFile(const _Project: string; _VersionInfo: IVersionInfo; const _Icon: string);
+    procedure DumpCmd;
   protected
     procedure InitCmdLineParser; override;
     function doExecute: integer; override;
@@ -31,7 +32,8 @@
   u_DofVersionInfo,
   d_BdsProjVersionInfo,
   u_CentralIniVersionInfo,
-  u_DummyVersionInfo;
+  u_DummyVersionInfo,
+  Dialogs;
 
 { TPrepBuildMain }
 
@@ -80,7 +82,7 @@
     WriteLn(t, {    } '}');
     if _Icon <> '' then begin
       WriteLn(t);
-      WriteLn(t, Format('MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s.ico', [_Icon]));
+      WriteLn(t, Format('MAINICON ICON LOADONCALL MOVEABLE DISCARDABLE IMPURE %s', [ChangeFileExt(_Icon, '.ico')]));
     end;
   finally
     Close(t);
@@ -113,7 +115,7 @@
     Executor.Environment.Values[DZ_DATE_TIME] := DateTimeToString('yyyy-mm-dd_hh-nn-ss', dt);
 
     if _Project <> '' then
-      Executor.Environment.Values[DZ_PROJECT] := _Project;
+      Executor.Environment.Values[DZ_PROJECT] := ChangeFileExt(_Project, '');
 
     if Assigned(_VersionInfo) then begin
       Executor.Environment.Values[DZ_VERSION + 'MajorVer'] := IntToStr(_VersionInfo.MajorVer);
@@ -139,6 +141,19 @@
   end;
 end;
 
+procedure TPrepBuildMain.DumpCmd;
+var
+  i: Integer;
+  s: string;
+begin
+  s := GetCurrentDir + #13#10 + ParamStr(0) + #13#10;
+  for i := 0 to FGetOpt.OptionsFoundList.Count - 1 do begin
+    s := s + FGetOpt.OptionsFoundList.Items[i].Name + '=' + FGetOpt.OptionsFoundList.Items[i].Value + #13#10;
+  end;
+  MessageDlg(s, mtInformation, [mbOK], 0);
+  SysUtils.Abort;
+end;
+
 function UnquoteStr(const _s: string): string;
 var
   s: PChar;
@@ -159,6 +174,12 @@
   IconFile: string;
   Project: string;
 begin
+  if FGetOpt.OptionsFoundList.Count = 0 then
+    Usage(_('You must supply some options.'));
+
+  if FGetOpt.OptionPassed('dumpcmd') then
+    DumpCmd;
+
   Project := '';
   if FGetOpt.OptionPassed('ReadDof', Project) then
     ParamVersionInfo := TDofVersionInfo.Create(Project);
@@ -201,8 +222,8 @@
 
   if FGetOpt.OptionPassed('Build', Param) then begin
     if not TryStrToInt(Param, IntValue) then
-      raise Exception.Create(_('Parameter to MinorVer must be a number'));
-    VersionInfo.MinorVer := IntValue;
+      raise Exception.Create(_('Parameter to Build must be a number'));
+    VersionInfo.Build := IntValue;
   end;
 
   if FGetOpt.OptionPassed('FileDesc', Param) then
@@ -235,6 +256,8 @@
   if FGetOpt.OptionPassed('IncBuild') then
     VersionInfo.Build := VersionInfo.Build + 1;
 
+  VersionInfo.UpdateFileVersion;
+
   if FGetOpt.OptionPassed('UpdateDof', Param) then begin
     ParamVersionInfo := TDofVersionInfo.Create(Param);
     ParamVersionInfo.Assign(VersionInfo);
@@ -268,6 +291,7 @@
 procedure TPrepBuildMain.InitCmdLineParser;
 begin
   inherited;
+  FGetOpt.RegisterOption('dumpcmd', _('dump the commandline and exit (for debug purposes)'), false);
   FGetOpt.RegisterOption('ReadDof', _('read a .dof file to get the version information'), true);
   FGetOpt.RegisterOption('ReadBdsproj', _('read a .bdsproj file to get the version information'), true);
   FGetOpt.RegisterOption('ReadIni', _('read a .ini file to get the version information'), true);



From twm at mail.berlios.de  Sun Jul 22 21:04:50 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sun, 22 Jul 2007 21:04:50 +0200
Subject: [Dzchart-svncheckins] r188 - in utilities/dzPrepBuild/trunk: .
	testdata
Message-ID: <200707221904.l6MJ4oOn019780@sheep.berlios.de>

Author: twm
Date: 2007-07-22 21:04:42 +0200 (Sun, 22 Jul 2007)
New Revision: 188

Added:
   utilities/dzPrepBuild/trunk/ReadMe.txt
   utilities/dzPrepBuild/trunk/prep.cmd
Removed:
   utilities/dzPrepBuild/trunk/test.cmd
Modified:
   utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini
Log:
* renamed test.cmd to prep.cmd and made it do something sensible
* added readme

Added: utilities/dzPrepBuild/trunk/ReadMe.txt
===================================================================
--- utilities/dzPrepBuild/trunk/ReadMe.txt	2007-07-22 18:59:40 UTC (rev 187)
+++ utilities/dzPrepBuild/trunk/ReadMe.txt	2007-07-22 19:04:42 UTC (rev 188)
@@ -0,0 +1,193 @@
+PrepBuild is a commandline tool for handling the version information
+for Delphi projects when compiling using the dcc32.exe commandline
+compiler. It can also be used as a Pre-Build tool in Delphi 2007.
+
+I can read and update three different kinds of sources for the
+version information:
+* <projectname>.dof files (used up to Delphi 7)
+* <projectname>.bdsproj files (used in BDS 2005 and 2006)
+* <projectname>_version.ini files (uses the same format as .dof)
+
+It cannot read the .dproj file format of Delphi/Rad Studio 2007,
+in this case I suggest using an .ini file instead.
+
+If you call the programm with the --help or -? option, it will display
+usage information.
+
+EXample 1:
+
+Let's assume you are using Delphi 7, so you probably store the version
+in the <projectname>.dof file and let the IDE autoincrement the build
+number. Now, for release builds you don't want to use the IDE because
+you want to make sure that the process is 100% repeatable without
+relying on a particular IDE setup. So you use the commandline compiler
+dcc32.exe rather than the IDE which is called from a script called
+build.cmd:
+
+-------------
+
+[... other stuff, e.g. checkout the current sourcecode ...]
+
+del <projectname>.cfg
+dcc32 [... options ...] <projectname>.dpr
+
+[... other stuff, e.g. create a tag in the sCM ...]
+
+-------------
+
+dcc32, in contrast to the IDE, does not use the .dof file and does not
+automatically increment the build number. Instead it reads a .cfg file,
+if one exists. The Delphi IDE creates this .cfg file every time it saves,
+the project, so it always contains the settings of the IDE, which is
+usually not what you want, hence the delete in the example above.
+
+If you are like me you don't check your .res file into the sourcecode
+repository because it is binary, so you can't easily check what changed,
+and it changes with every build. Instead you rely on the .dof file for
+tracking the version information and let the IDE create the .res file
+whenever needed.
+
+This has got the drawback that you lose the application's icon because
+it is only stored in the .res file. Which is quite annoying. Also, the
+commandline compiler does not create the .res file but fails if it does
+not exist.
+
+PrepBuild to the rescue. It does any of the following for you:
+1. Read the .dof file
+2. increment the build number
+3. call a batch file that again call prepbuild to
+  3.1 change the .dof file
+  3.2 create a .rc file containing the version info
+  3.3 add a .ico file to the .rc file so the icon is back
+  3.4 call brcc32 to create .res file for the project
+
+Your build script then looks like this:
+
+-------------
+
+[... other stuff, e.g. checkout the current sourcecode ...]
+
+prepbuild --ReadDof=<projectname> --IncBuild --exec=prep.cmd
+
+del <projectname>.cfg
+dcc32 [... options ...] <projectname>.dpr
+
+[... other stuff, e.g. create a tag in the sCM ...]
+
+-------------
+
+Which means that it reads the .dof file of your project, increments the
+build number and calls another script prep.cmd. This script will get
+all the version information as well as the current date and time as
+environment variables. It can use these to call PrepBuild once again to
+
+1. update the .dof file
+2. write the build date / time e.g. to the comment entry of the
+   version information
+3. write a .rc file
+
+To do this, you create a prep.cmd script containing this call:
+
+PrepBuild --updatedof=%dzProject%
+          --icon=%dzProject%
+          --writerc=%dzProject%
+          --MajorVer=%dzVersion.MajorVer%
+          --MinorVer=%dzVersion.MinorVer%
+          --Release=%dzVersion.Release%
+          --Build=%dzVersion.Build% 
+          --FileDesc="%dzVersion.FileDesc%"
+          --InternalName="%dzVersion.InternalName%"
+          --OriginalName="%dzVersion.OriginalName%"
+          --Product="%dzVersion.Product%"
+          --ProductVersion="%dzVersion.ProductVersion%"
+          --Company="%dzVersion.Company%"
+          --Copyright="%dzVersion.Copyright%"
+          --Trademark="%dzVersion.Trademark%"
+          --Comments="build on %dzDateTime%"
+
+(all this goes into one line, I just wrapped it to improve readability)
+
+The following environment variables can be used (in addition to the ones
+that are usually set):
+
+%dzDate% - the current date in ISO format (yyyy-mm-dd)
+%dzTime% - the current time in 24 hour format (hh:mm:ss)
+%dzDateTime% - both, date and time as yyyy-mm-dd hh:mm:ss
+%dzMyDocuments% - the My Documents folder of the current user
+
+%dzProject% - the project name passed by the --ReadDof / --ReadBdsProj
+              or --ReadIni option without extension
+
+The following values are read from the .dof / .bdsproj / .ini file and
+also passed as environment variables:
+
+%dzVersion.MajorVer% - the major version number
+%dzVersion.MinorVer% - the minor version number
+%dzVersion.Release% - the release number
+%dzVersion.Build% - the build number (optionally incremented by one)
+%dzVersion.FileDesc% - the file description
+%dzVersion.InternalName% - the internal name
+%dzVersion.OriginalName% - the original filename
+%dzVersion.Product% - the product name
+%dzVersion.ProductVersion% - the product version
+%dzVersion.Company% - the company name
+%dzVersion.Copyright% - the copyright string
+%dzVersion.Trademark% - the trademark string
+%dzVersion.Comments% - the comments string
+
+In the above example these environment variables are used to call
+PrepBuild again passing all values as commandline options to update
+the project's .dof file and also create a .rc file.
+
+In addition an icon file is also added to the .rc file.
+
+You may ask why I am using a second script instead of doing everything
+in PrepBuild itself. The answer is that I didn't want to add too
+much functionality to the tool but also wanted the maximu on flexibility.
+Using this second script, I can use the version info and also the
+build timestamp to modify the version information. Others may want to
+add the user name to the version info, so they can just use the
+standard environment variable %USERNAME% to add it. You might even want
+to move creating a tag in your SCM to this script because there you
+can use the current version number and build date/time for generating
+the tag's name.
+
+Example 2:
+
+Let's assume your company is using Delphi 2007 and there are
+multiple Developers working on the same project. You want to make
+sure that the build number of a project always increases no matter
+which developer does a build. This cannot be done with the options
+of the Delphi IDE because it - worse than Delphi 7 - takes the
+version information from the .res file (and only from the .dproj file
+if no .res file exists). .res files are binary and there is no easy
+way to modify them. So, what do you do?
+
+The first thing is disabling the version information in the project
+options. Since the IDE doesn't do it right, there is no point in
+letting it manage the version info. Instead you use a .ini file
+to store it. This .ini file goes into your source code repository
+together with the code. In addtion you have got another .ini file
+in a central location (on the network) that stores the build number.
+You refer to this .ini file in the entry of your version .ini file
+like this:
+
+[Version Info]
+// other stuff
+Build=redirect:\\server\share\Testproject_Buildno.ini,Version Info,Build
+
+This will make PrepBuild read and write the build number to the
+central .ini file rather than the local one (*1).
+
+Now, you add PrepBuild as a prebuild event like this:
+
+prepbuild 
+
+
+(*1: Of course there is the small chance of two developers doing
+a build at the same time. This will result in a duplicate build
+number, but this shouldn't happen very often and I was too lazy
+to try and implement some kind of locking mechanism to prevent
+this rare case. If you need it, you have got the source code....)
+
+to be continued ....

Copied: utilities/dzPrepBuild/trunk/prep.cmd (from rev 186, utilities/dzPrepBuild/trunk/test.cmd)
===================================================================
--- utilities/dzPrepBuild/trunk/test.cmd	2007-07-22 14:56:00 UTC (rev 186)
+++ utilities/dzPrepBuild/trunk/prep.cmd	2007-07-22 19:04:42 UTC (rev 188)
@@ -0,0 +1,25 @@
+ at echo off
+echo dzDate=%dzDate%
+echo dzTime=%dzTime%
+echo dzDateTime=%dzDateTime%
+echo dzMyDocuments=%dzMyDocuments%
+
+echo dzProject=%dzProject%
+
+echo NajorVer=%dzVersion.MajorVer%
+echo MinorVer=%dzVersion.MinorVer%
+echo Release=%dzVersion.Release%
+echo Build=%dzVersion.Build%
+echo FileDesc=%dzVersion.FileDesc%
+echo InternalName=%dzVersion.InternalName%
+echo OriginalName=%dzVersion.OriginalName%
+echo Product=%dzVersion.Product%
+echo ProductVersion=%dzVersion.ProductVersion%
+echo Company=%dzVersion.Company%
+echo Copyright=%dzVersion.Copyright%
+echo Trademark=%dzVersion.Trademark%
+echo Comments=%dzVersion.Comments%
+
+ at echo on
+PrepBuild --writerc=%dzProject%_Version.rc --updateini=%dzProject% --MajorVer=%dzVersion.MajorVer% --MinorVer=%dzVersion.MinorVer% --Release=%dzVersion.Release% --Build=%dzVersion.Build% --FileDesc="%dzVersion.FileDesc%" --InternalName="%dzVersion.InternalName%" --OriginalName="%dzVersion.OriginalName%" --Product="%dzVersion.Product%" --ProductVersion="%dzDate%" --Company="%dzVersion.Company%" --Copyright="%dzVersion.Copyright%" --Trademark="%dzVersion.Trademark%" --Comments="%dzVersion.Comments%"
+brcc32 %dzProject%_Version.rc

Deleted: utilities/dzPrepBuild/trunk/test.cmd
===================================================================
--- utilities/dzPrepBuild/trunk/test.cmd	2007-07-22 18:59:40 UTC (rev 187)
+++ utilities/dzPrepBuild/trunk/test.cmd	2007-07-22 19:04:42 UTC (rev 188)
@@ -1,25 +0,0 @@
- at echo off
-echo dzDate=%dzDate%
-echo dzTime=%dzTime%
-echo dzDateTime=%dzDateTime%
-echo dzMyDocuments=%dzMyDocuments%
-
-echo dzProject=%dzProject%
-
-echo NajorVer=%dzVersion.MajorVer%
-echo MinorVer=%dzVersion.MinorVer%
-echo Release=%dzVersion.Release%
-echo Build=%dzVersion.Build%
-echo FileDesc=%dzVersion.FileDesc%
-echo InternalName=%dzVersion.InternalName%
-echo OriginalName=%dzVersion.OriginalName%
-echo Product=%dzVersion.Product%
-echo ProductVersion=%dzVersion.ProductVersion%
-echo Company=%dzVersion.Company%
-echo Copyright=%dzVersion.Copyright%
-echo Trademark=%dzVersion.Trademark%
-echo Comments=%dzVersion.Comments%
-
- at echo on
-PrepBuild --updatebdsproj=testdata\testproject --MajorVer=%dzVersion.MajorVer% --MinorVer=%dzVersion.MinorVer% --Release=%dzVersion.Release% --Build=%dzVersion.Build% --FileDesc="%dzVersion.FileDesc%" --InternalName="%dzVersion.InternalName%" --OriginalName="%dzVersion.OriginalName%" --Product="%dzVersion.Product%" --ProductVersion="%dzDate%" --Company="%dzVersion.Company%" --Copyright="%dzVersion.Copyright%" --Trademark="%dzVersion.Trademark%" --Comments="%dzVersion.Comments%"
-

Modified: utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini
===================================================================
--- utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini	2007-07-22 18:59:40 UTC (rev 187)
+++ utilities/dzPrepBuild/trunk/testdata/Testproject_Version.ini	2007-07-22 19:04:42 UTC (rev 188)
@@ -1,10 +1,10 @@
 [Version Info]
 IncludeVerInfo=1
-AutoIncBuild=1
+AutoIncBuild=0
 MajorVer=1
 MinorVer=0
 Release=0
-Build=31
+Build=redirect:Testproject_Build.ini,Version Info,Build
 Debug=0
 PreRelease=0
 Special=0
@@ -16,11 +16,12 @@
 [Version Info Keys]
 CompanyName=www.dummzeuch.de
 FileDescription=Testproject
-FileVersion=1.0.0.21
+FileVersion=
 InternalName=testproject
 LegalCopyright=Copyright 2002-2007 by Thomas Mueller
 LegalTrademarks=
 OriginalFilename=testproject.exe
 ProductName=Testproduct
-ProductVersion=1.0.0.0
+ProductVersion=2007-07-22
 Comments=internal use only
+



From twm at mail.berlios.de  Fri Jul 27 10:51:05 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:51:05 +0200
Subject: [Dzchart-svncheckins] r189 - utilities/dzLib/trunk/src
Message-ID: <200707270851.l6R8p5ll003250@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:51:04 +0200 (Fri, 27 Jul 2007)
New Revision: 189

Modified:
   utilities/dzLib/trunk/src/u_dzConvertUtils.pas
Log:
new function FileSizeToHumanReadableString

Modified: utilities/dzLib/trunk/src/u_dzConvertUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzConvertUtils.pas	2007-07-22 19:04:42 UTC (rev 188)
+++ utilities/dzLib/trunk/src/u_dzConvertUtils.pas	2007-07-27 08:51:04 UTC (rev 189)
@@ -185,6 +185,31 @@
    @returns a string representation of the floating point value }
 function Float2Str(_flt: extended; _Decimals: integer): string; overload;
 
+// these contants refer to the "Xx binary byte" units as defined by the
+// International Electronical Commission (IEC) and endorsed by the
+// IEE and CiPM
+const
+  OneKibiByte = Int64(1024);
+  OneMebiByte = Int64(1024) * OneKibiByte;
+  OneGibiByte = Int64(1024) * OneMebiByte;
+  OneTebiByte = Int64(1024) * OneGibiByte;
+  OnePebiByte = Int64(1024) * OneTebiByte;
+  OneExbiByte = Int64(1024) * OnePebiByte;
+
+{: Converts a file size to a human readable string, e.g. 536870912000 = 5.00 GiB (gibibyte) }
+function FileSizeToHumanReadableString(_FileSize: Int64): string;
+
+const
+  SecondsPerMinute = 60;
+  MinutesPerHour = 60;
+  SecondsPerHour = SecondsPerMinute * MinutesPerHour;
+  HoursPerDay = 24;
+  MinutesPerDay = HoursPerDay * MinutesPerHour;
+  SecondsPerDay = MinutesPerDay * SecondsPerMinute;
+
+{: returns a human readable string of the form '5d 23h' or '25h 15m' or '20m 21s' }
+function SecondsToHumanReadableString(_Seconds: Int64): string;
+
 implementation
 
 uses
@@ -522,6 +547,36 @@
     raise EStringConvertError.CreateFmt(STR_X_IS_NOT_A_VALID_FLOAT_VALUE_SS, [_s, _Source]);
 end;
 
+function FileSizeToHumanReadableString(_FileSize: Int64): string;
+begin
+  if _FileSize > 5 * OneExbiByte then
+    Result := Format(_('%.2f EiB'), [_FileSize / OneExbiByte])
+  else if _FileSize > 5 * OnePebiByte then
+    Result := Format(_('%.2f PiB'), [_FileSize / OnePebiByte])
+  else if _FileSize > 5 * OneTebiByte then
+    Result := Format(_('%.2f TiB'), [_FileSize / OneTebiByte])
+  else if _FileSize > 5 * OneGibiByte then
+    Result := Format(_('%.2f GiB'), [_FileSize / OneGibiByte])
+  else if _FileSize > 5 * OneMebiByte then
+    Result := Format(_('%.2f MiB'), [_FileSize / OneMebiByte])
+  else if _FileSize > 5 * OneKibiByte then
+    Result := Format(_('%.2f KiB'), [_FileSize / OneKibiByte])
+  else
+    Result := Format(_('%d Bytes'), [_FileSize]);
+end;
+
+function SecondsToHumanReadableString(_Seconds: Int64): string;
+begin
+  if _Seconds > SecondsPerDay then
+    Result := Format('%dd %dh', [_Seconds div SecondsPerDay, (_Seconds div SecondsPerHour) mod HoursPerDay])
+  else if _Seconds > Round(1.5 * SecondsPerHour) then
+    Result := Format('%dh %dm', [_Seconds div SecondsPerHour, (_Seconds div SecondsPerMinute) mod MinutesPerHour])
+  else if _Seconds > Round(1.5 * SecondsPerMinute) then
+    Result := Format('%dm %ds', [_Seconds div SecondsPerMinute, _Seconds mod SecondsPerMinute])
+  else
+    Result := Format('%ds', [_Seconds]);
+end;
+
 initialization
   DZ_FORMAT_DECIMAL_POINT := GetUserDefaultLocaleSettings;
   DZ_FORMAT_DECIMAL_POINT.DecimalSeparator := '.';



From twm at mail.berlios.de  Fri Jul 27 10:51:48 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:51:48 +0200
Subject: [Dzchart-svncheckins] r190 - utilities/dzLib/trunk/src
Message-ID: <200707270851.l6R8pmNX003334@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:51:47 +0200 (Fri, 27 Jul 2007)
New Revision: 190

Modified:
   utilities/dzLib/trunk/src/u_dzVclUtils.pas
Log:
three new overloaded functions TListBox_DeleteSelected

Modified: utilities/dzLib/trunk/src/u_dzVclUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzVclUtils.pas	2007-07-27 08:51:04 UTC (rev 189)
+++ utilities/dzLib/trunk/src/u_dzVclUtils.pas	2007-07-27 08:51:47 UTC (rev 190)
@@ -242,13 +242,22 @@
 function TComboBox_Select(_cmb: TCustomComboBox; const _Item: string; _DefaultIdx: integer = -1): integer;
 
 {: Gets the object pointer of the selected listbox item
-   @param cmb is the TCustomListbox (descendant) to read from
+   @param lst is the TCustomListbox (descendant) to read from
    @param Idx is the listbox's ItemIndex, only valid if the function returns true
    @param Obj is the value of the object pointer of the selected item, only valid
           if the function returns true
    @returns true, if these values are valid }
 function TListBox_GetSelectedObject(_lst: TCustomListbox; out _Idx: integer; out _Obj: pointer): boolean;
 
+{: Deletes the selected listbox item
+   @param lst is the TCustomListbox (descendant) to read from
+   @param Idx is the listbox's ItemIndex, only valid if the function returns true
+          if the function returns true
+   @returns true, if these values are valid }
+function TListBox_DeleteSelected(_lst: TCustomListbox; out _Idx: integer): boolean; overload;
+function TListBox_DeleteSelected(_lst: TCustomListbox): boolean; overload;
+function TListBox_DeleteSelected(_lst: TCustomListBox; out _s: string): boolean; overload;
+
 {: Gets the caption of the given or selected item in the RadioGroup
    @param rg is the TCustomRadioGroup descendant to read
    @param Caption returns a string with the requested caption with
@@ -839,6 +848,33 @@
     _Obj := _lst.Items.Objects[_Idx];
 end;
 
+function TListBox_DeleteSelected(_lst: TCustomListbox; out _Idx: integer): boolean;
+begin
+  _Idx := _lst.ItemIndex;
+  Result := _Idx <> -1;
+  if Result then
+    _lst.Items.Delete(_Idx);
+end;
+
+function TListBox_DeleteSelected(_lst: TCustomListBox; out _s: string): boolean; overload;
+var
+  Idx: Integer;
+begin
+  Idx := _lst.ItemIndex;
+  Result := Idx <> -1;
+  if Result then begin
+    _s := _lst.Items[Idx];
+    _lst.Items.Delete(Idx);
+  end;
+end;
+
+function TListBox_DeleteSelected(_lst: TCustomListbox): boolean;
+var
+  Idx: integer;
+begin
+  Result := TListBox_DeleteSelected(_lst, Idx);
+end;
+
 function TComboBox_Select(_cmb: TCustomComboBox; const _Item: string; _DefaultIdx: integer = -1): integer;
 begin
   Result := _Cmb.Items.IndexOf(_Item);



From twm at mail.berlios.de  Fri Jul 27 10:55:51 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:55:51 +0200
Subject: [Dzchart-svncheckins] r191 - utilities/dzLib/trunk/src
Message-ID: <200707270855.l6R8tpTP003590@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:55:48 +0200 (Fri, 27 Jul 2007)
New Revision: 191

Modified:
   utilities/dzLib/trunk/src/u_dzFileUtils.pas
Log:
* TDirectorySync.SyncOneWay now uses TFileSystem.CopyFileWithProgress so it will no longer freeze the application while copying huge files
* New option FlattenHierarchy for TDirectorySync
* OnSyncingFile callback has now a different signature which also passes the total and done file size
* CheckOneWay now also descends into directories that do not exist in the destination tree


Modified: utilities/dzLib/trunk/src/u_dzFileUtils.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzFileUtils.pas	2007-07-27 08:51:47 UTC (rev 190)
+++ utilities/dzLib/trunk/src/u_dzFileUtils.pas	2007-07-27 08:55:48 UTC (rev 191)
@@ -154,21 +154,25 @@
   {: defines the action to take if a file already exists but has a different content }
   TFileExistsAction = (feaIgnore, feaOverwrite);
   TOnSyncing = procedure(_Sender: TObject; const _SrcDir, _DstDir: string) of object;
+  TOnSyncingFile = procedure(_Sender: TObject; const _SrcDir, _DstDir: string; _Total, _Done: Int64) of object;
   {: called if a destination file already exists
      @param Action is the action to take, default is feaIgnore }
   TOnFileExists = procedure(_Sender: TObject; const _SrcFile, _DstFile: TFileInfoRec; var _Action: TFileExistsAction) of object;
   {: Synchronizes two directories }
   TDirectorySync = class
   private
+    FCurrentSource: string;
+    FCurrentDest: string;
     FOnSyncingDir: TOnSyncing;
-    FOnSyncingFile: TOnSyncing;
+    FOnSyncingFile: TOnSyncingFile;
     FOnFileExists: TOnFileExists;
 //    FOnDifferentFileExists: TOnDifferentFileExists;
 //    FCheckContent: boolean;
 //    procedure doOnDifferentFileExists(const _Filename: string; var _Action: TFileExistsAction);
     procedure doOnSyncingDir(const _SrcDir, _DstDir: string);
-    procedure doOnSyncingFile(const _SrcFile, _DstFile: string);
+    procedure doOnSyncingFile(const _SrcFile, _DstFile: string; _Total, _Done: Int64);
     function doOnFileExists(const _SrcDir, _DstDir, _Filename: string): TFileExistsAction;
+    procedure ProgressStatusCallback(_Status: TCopyProgressStatus; var _Continue: TCopyProgressStatus.TProgressResult);
   public
     {: Checks if there are files in the source directory that are already in
        the destination directory, for each file that exists, the OnFileExists
@@ -176,8 +180,11 @@
     procedure CheckOneWay(const _SrcDir, _DstDir: string);
     {: copies all files from DirA to DirB if they don't already exists
        (not implemented: if CheckContent=true, the content existing files will be checked and if
-                         it doesn't match, OnDifferentFileExists is called ) }
-    procedure SyncOneWay(const _SrcDir, _DstDir: string);
+                         it doesn't match, OnDifferentFileExists is called )
+       @param FlattenDirHierarchy determines whether all files should be copied
+                                  directly DstDir or if subdirectories should
+                                  be created, default is false }
+    procedure SyncOneWay(const _SrcDir, _DstDir: string; _FlattenDirHierarchy: boolean = false);
     {: calls SyncOneWay(DirA, DirB) and SyncOneWay(DirB, DirA)
        (not implemented: if CheckContent=true, the content existing files will be checked and if
                          it doesn't match, OnDifferentFileExists is called ) }
@@ -191,7 +198,7 @@
     property OnSyncingDir: TOnSyncing read FOnSyncingDir write FOnSyncingDir;
     {: called when a file is being copied, to abort synchronization,
       raise an exception (e.g. SysUtils.Abort), and catch it in the calling method }
-    property OnSyncingFile: TOnSyncing read FOnSyncingFile write FOnSyncingFile;
+    property OnSyncingFile: TOnSyncingFile read FOnSyncingFile write FOnSyncingFile;
     {: called from CheckOneWay if a destination file already exists }
     property OnFileExists: TOnFileExists read FOnFileExists write FOnFileExists;
   end;
@@ -1305,12 +1312,23 @@
     FOnSyncingDir(Self, _SrcDir, _DstDir);
 end;
 
-procedure TDirectorySync.doOnSyncingFile(const _SrcFile, _DstFile: string);
+procedure TDirectorySync.doOnSyncingFile(const _SrcFile, _DstFile: string; _Total, _Done: Int64);
 begin
   if Assigned(FOnSyncingFile) then
-    FOnSyncingFile(self, _SrcFile, _DstFile);
+    FOnSyncingFile(self, _SrcFile, _DstFile, _Total, _Done);
 end;
 
+procedure TDirectorySync.ProgressStatusCallback(_Status: TCopyProgressStatus;
+  var _Continue: TCopyProgressStatus.TProgressResult);
+begin
+  try
+    doOnSyncingFile(FCurrentSource, FCurrentDest, _Status.TotalFileSize.QuadPart, _Status.TotalBytesTransferred.QuadPart);
+  except
+    on e: EAbort do
+      _Continue := prCancel;
+  end;
+end;
+
 procedure TDirectorySync.CheckOneWay(const _SrcDir, _DstDir: string);
 var
   Filename: string;
@@ -1325,12 +1343,11 @@
   try
     while EnumA.FindNext(Filename) do begin
       if (EnumA.Sr.Attr and SysUtils.faDirectory) <> 0 then begin
-        if DirectoryExists(DstDirBS + Filename) then
-          CheckOneWay(SrcDirBS + Filename, DstDirBS + Filename);
+        CheckOneWay(SrcDirBS + Filename, DstDirBS + Filename);
       end else if FileExists(DstDirBS + Filename) then begin
         doOnFileExists(SrcDirBS, DstDirBS, Filename);
       end else begin
-        doOnSyncingFile(SrcDirBS + Filename, DstDirBS + Filename);
+        doOnSyncingFile(SrcDirBS + Filename, DstDirBS + Filename, EnumA.Sr.Size, 0);
       end;
     end;
   finally
@@ -1338,7 +1355,7 @@
   end;
 end;
 
-procedure TDirectorySync.SyncOneWay(const _SrcDir, _DstDir: string);
+procedure TDirectorySync.SyncOneWay(const _SrcDir, _DstDir: string; _FlattenDirHierarchy: boolean = false);
 var
   Filename: string;
   EnumA: TSimpleDirEnumerator;
@@ -1351,18 +1368,27 @@
   EnumA := TSimpleDirEnumerator.Create(SrcDirBS + '*.*');
   try
     while EnumA.FindNext(Filename) do begin
+      FCurrentSource := SrcDirBS + Filename;
       if (EnumA.Sr.Attr and SysUtils.faDirectory) <> 0 then begin
-        if not DirectoryExists(DstDirBS + Filename) then
-          TFileSystem.CreateDir(DstDirBS + Filename);
-        SyncOneWay(SrcDirBS + Filename, DstDirBS + Filename);
-      end else if FileExists(DstDirBS + Filename) then begin
-        if doOnFileExists(SrcDirBS, DstDirBS, Filename) = feaOverwrite then begin
-          doOnSyncingFile(SrcDirBS + Filename, DstDirBS + Filename);
-          TFileSystem.CopyFile(SrcDirBS + Filename, DstDirBS + Filename, false, true);
+        if _FlattenDirHierarchy then
+          FCurrentDest := _DstDir
+        else begin
+          FCurrentDest := DstDirBS + Filename;
+          if not DirectoryExists(FCurrentDest) then
+            TFileSystem.CreateDir(FCurrentDest);
         end;
+        SyncOneWay(FCurrentSource, FCurrentDest, _FlattenDirHierarchy);
       end else begin
-        doOnSyncingFile(SrcDirBS + Filename, DstDirBS + Filename);
-        TFileSystem.CopyFile(SrcDirBS + Filename, DstDirBS + Filename, true, true);
+        FCurrentDest := DstDirBS + Filename;
+        if FileExists(FCurrentDest) then begin
+          if doOnFileExists(SrcDirBS, DstDirBS, Filename) = feaOverwrite then begin
+            if cfwOK <> TFileSystem.CopyFileWithProgress(FCurrentSource, FCurrentDest, ProgressStatusCallback, [cfwRaiseException]) then
+              SysUtils.Abort;
+          end;
+        end else begin
+          if cfwOK <> TFileSystem.CopyFileWithProgress(FCurrentSource, FCurrentDest, ProgressStatusCallback, [cfwRaiseException, cfwFailIfExists]) then
+            SysUtils.Abort;
+        end;
       end;
     end;
   finally



From twm at mail.berlios.de  Fri Jul 27 10:56:49 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:56:49 +0200
Subject: [Dzchart-svncheckins] r192 - utilities/dzLib/trunk/src
Message-ID: <200707270856.l6R8unjV003643@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:56:48 +0200 (Fri, 27 Jul 2007)
New Revision: 192

Modified:
   utilities/dzLib/trunk/src/u_dzTranslator.pas
Log:
now takes different Delphi versions into account

Modified: utilities/dzLib/trunk/src/u_dzTranslator.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzTranslator.pas	2007-07-27 08:55:48 UTC (rev 191)
+++ utilities/dzLib/trunk/src/u_dzTranslator.pas	2007-07-27 08:56:48 UTC (rev 192)
@@ -139,7 +139,21 @@
 {$IFDEF gnugettext}
 initialization
   // translate runtime library
-  AddDomainForResourceString('delphi');
+{$IFDEF DELPHI6}
+  AddDomainForResourceString('delphi6');
+{$ELSE}{$IFDEF DELPHI7}
+  AddDomainForResourceString('delphi7');
+{$ELSE}{$IFDEF DELPHI10}
+  AddDomainForResourceString('delphi2006');
+{$ELSE}{$IFDEF DELPHI11}
+  // currently we don't have translations for Delphi2007, so we use the ones from Delphi2006 and pray... ;-)
+  AddDomainForResourceString('delphi2006');
+{$ELSE}
+  'unknown Delphi version!'
+{$ENDIF}
+{$ENDIF}
+{$ENDIF}
+{$ENDIF}
 
   // ignore these VCL properties / classes
   TP_GlobalIgnoreClassProperty(TControl, 'ImeName');



From twm at mail.berlios.de  Fri Jul 27 10:57:21 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:57:21 +0200
Subject: [Dzchart-svncheckins] r193 - in utilities/dzLib/trunk: . forms
Message-ID: <200707270857.l6R8vLGq003667@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:57:17 +0200 (Fri, 27 Jul 2007)
New Revision: 193

Added:
   utilities/dzLib/trunk/forms/
   utilities/dzLib/trunk/forms/w_dzDialog.dfm
   utilities/dzLib/trunk/forms/w_dzDialog.pas
Log:
new form for displaying various kinds of dialogs

Added: utilities/dzLib/trunk/forms/w_dzDialog.dfm
===================================================================
--- utilities/dzLib/trunk/forms/w_dzDialog.dfm	2007-07-27 08:56:48 UTC (rev 192)
+++ utilities/dzLib/trunk/forms/w_dzDialog.dfm	2007-07-27 08:57:17 UTC (rev 193)
@@ -0,0 +1,88 @@
+object f_dzDialog: Tf_dzDialog
+  Left = 460
+  Top = 203
+  BorderIcons = [biSystemMenu]
+  Caption = 'f_dzDialog'
+  ClientHeight = 420
+  ClientWidth = 423
+  Color = clBtnFace
+  Font.Charset = DEFAULT_CHARSET
+  Font.Color = clWindowText
+  Font.Height = -11
+  Font.Name = 'MS Sans Serif'
+  Font.Style = []
+  OldCreateOrder = False
+  Position = poOwnerFormCenter
+  OnCreate = FormCreate
+  PixelsPerInch = 96
+  TextHeight = 13
+  object p_Top: TPanel
+    Left = 0
+    Top = 0
+    Width = 423
+    Height = 217
+    Align = alTop
+    BevelOuter = bvNone
+    TabOrder = 0
+    object l_Message: TLabel
+      Left = 64
+      Top = 8
+      Width = 329
+      Height = 81
+      AutoSize = False
+      Caption = 
+        'Mitteilung an den Benutzer, dies ist eine sehr lange Mitteilung ' +
+        'und sie wird ein paar mal wiederholt, damit auch ein Umbruch sta' +
+        'ttfindet. (do not translate)'
+      WordWrap = True
+    end
+    object l_Options: TLabel
+      Left = 8
+      Top = 96
+      Width = 385
+      Height = 73
+      AutoSize = False
+      Caption = 'Beschreibung der Optionen (do not translate)'
+      WordWrap = True
+    end
+    object im_Icon: TImage
+      Left = 8
+      Top = 8
+      Width = 49
+      Height = 49
+    end
+  end
+  object p_Details: TPanel
+    Left = 0
+    Top = 217
+    Width = 423
+    Height = 200
+    BevelOuter = bvNone
+    TabOrder = 1
+    Visible = False
+    DesignSize = (
+      423
+      200)
+    object m_Details: TMemo
+      Left = 8
+      Top = 0
+      Width = 409
+      Height = 193
+      Anchors = [akLeft, akTop, akRight, akBottom]
+      Color = clBtnFace
+      Font.Charset = ANSI_CHARSET
+      Font.Color = clWindowText
+      Font.Height = -11
+      Font.Name = 'Courier New'
+      Font.Style = []
+      Lines.Strings = (
+        'ExcectionClass: (do not translate)'
+        'Message der Exception (do not translate)')
+      ParentFont = False
+      ReadOnly = True
+      ScrollBars = ssVertical
+      TabOrder = 0
+      WordWrap = False
+    end
+  end
+end

Added: utilities/dzLib/trunk/forms/w_dzDialog.pas
===================================================================
--- utilities/dzLib/trunk/forms/w_dzDialog.pas	2007-07-27 08:56:48 UTC (rev 192)
+++ utilities/dzLib/trunk/forms/w_dzDialog.pas	2007-07-27 08:57:17 UTC (rev 193)
@@ -0,0 +1,800 @@
+{GXFormatter.config=twm}
+{: Generic exception and message dialog.
+   This unit implements a generic Dialog to display exceptions and messages.
+   For exceptions, it only displays the exception's class name and a
+   Details button to get the message.
+   Most times all you need is calling one of the overloaded dzShowException
+   functions.
+   @author twm
+}
+unit w_dzDialog;
+
+interface
+
+uses
+  Windows,
+  Messages,
+  SysUtils,
+  Classes,
+  Graphics,
+  Controls,
+  Forms,
+  Dialogs,
+  StdCtrls,
+  ExtCtrls,
+  Jcldebug;
+
+type
+  EInvalidModalResult = class(Exception);
+
+type
+  TDialogButtonEnum = (dbeYes, dbeNo, dbeOK, dbeCancel, dbeAbort, dbeRetry, dbeIgnore,
+    dbeAll, dbeNoToAll, dbeYesToAll, dbeHelp, dbeCustom);
+  TDialogButtonArr = array of TDialogButtonEnum;
+  TIntegerArray = array of integer;
+  TStringArray = array of string;
+
+const
+  ExceptionDialogModalResults: array[TDialogButtonEnum] of Integer = (
+    mrYes, mrNo, mrOk, mrCancel, mrAbort, mrRetry, mrIgnore, mrAll, mrNoToAll,
+    mrYesToAll, 0, -1);
+
+  {: converts the modal result returned by dzShowMessage to the button pressed }
+function ModalResultToButton(_Result: integer): TDialogButtonEnum;
+
+type
+  {: whether to show the maximze button
+     <ul>
+       <li>smSmart - show only when details are visible</li>
+       <li>smShow - show always</li>
+       <li>smHide - don't show at all</li>
+     </ul>}
+  TShowMaximizeOption = (smSmart, smShow, smHide);
+
+type
+  { used for the property OnButtonClick in asyncronous mode
+    @param(Sender is the Exceptiondialog)
+    @param(Button is the ModalResult value of the button pressed)
+    @param(Action is a TCloseAction indicating whether the dialog can be closed,
+           it is initialized to caNone and can be set to caHide, caFree or caMinimize)}
+  TOnButtonClick = procedure(Sender: TObject; _Button: TModalResult; var _Action: TCloseAction);
+
+type
+  {: defines the exception and messsage dialog.
+     This dialog is used by the various dzShowException and the dzShowMessage
+     functions. It can of course also be created independently. The minimum
+     properties to set are
+     <ul>
+       <li>ExcecptionClass</li>
+       <li>ExceptionMessage</li>
+       <li>VisibleButtons</li>
+     </ul>
+     for showing an exception and
+     <ul>
+       <li>UserMessage</li>
+       <li>VisibleButtons</li>
+       <li>ShowDetailButton (to false)</li>
+     </ul>
+     for showing a message.}
+  Tf_dzDialog = class(TForm)
+    p_Top: TPanel;
+    l_Message: TLabel;
+    l_Options: TLabel;
+    p_Details: TPanel;
+    m_Details: TMemo;
+    im_Icon: TImage;
+    procedure FormCreate(Sender: TObject);
+  private
+    {: used to display it pseudo modally,
+       see dzShowNonModalMessage function and MakeModal/MakeNonmodal methods }
+    FWindowList: pointer;
+    FOnButtonClick: TOnButtonClick;
+  private
+    FExceptionClass: string;
+    FExceptionMessage: string;
+    FExceptionExtendedMessage: string;
+    FExceptionAddress: pointer;
+    FOptionDescription: string;
+    FExceptionProcedure: string;
+    FVisibleButtons: TDialogButtonArr;
+    FUserMessage: string;
+    FDetails: string;
+    FDialogType: TMsgDlgType;
+    FShowDetailButton: boolean;
+    FDontShowAgainText: string;
+    FShowDontShowAgain: boolean;
+    b_Details: TButton;
+    chk_DontAskAgain: TCheckBox;
+    FCallStack: TStrings;
+    FShowMaximize: TShowMaximizeOption;
+    FCustomModalResults: TIntegerArray;
+    FCustomButtonCaptions: TStringArray;
+    procedure SetDontShowAgainText(const _Value: string);
+    procedure HideDetails;
+    procedure ShowDetails;
+    procedure SetCallStack(const _CallStack: TStrings);
+    procedure MakeModal;
+    procedure MakeNonModal;
+    procedure ButtonClick(_Sender: TObject);
+    procedure SetVisibleButtons(const _Buttons: array of TDialogButtonEnum);
+  protected
+    procedure b_DetailsClick(Sender: TObject);
+    procedure DoShow; override;
+    procedure CreateParams(var Params: TCreateParams); override;
+  public
+    constructor Create(_Owner: TComponent); override;
+    destructor Destroy; override;
+
+    procedure Hide;
+    {: class name of the exception }
+    property ExceptionClass: string read FExceptionClass write FExceptionClass;
+    {: message of the exception }
+    property ExceptionMessage: string read FExceptionMessage write FExceptionMessage;
+    //    {: address of the exception }
+    //    property ExcptionAddress: pointer read fExceptionAddress write fExceptionAddress;
+        {: extended exception messsage, only available from EHeadworkException }
+    property ExceptionExtendedMessage: string read FExceptionExtendedMessage write FExceptionExtendedMessage;
+    {: exception procedure, only available from EHeadworkException }
+    property ExceptionProcedure: string read FExceptionProcedure write FExceptionProcedure;
+    property CallStack: TStrings read FCallStack write SetCallStack;
+    {: array of buttons to show, note that this is an array, not a set, so the
+       order matters }
+    property VisibleButtons: TDialogButtonArr read FVisibleButtons;
+    {: array of modal results for the custom buttons. Note: The length of this
+       array is set when VisibleButtons is updated (using SetVisibleButtons) }
+    property CustomModalResults: TIntegerArray read FCustomModalResults;
+    {: array of captions for the custom buttons Note: The length of this
+       array is set when VisibleButtons is updated (using SetVisibleButtons) }
+    property CustomButtonCaptions: TStringArray read FCustomButtonCaptions;
+    {: user message to show instead of 'An error <i>exceptionclass</i> occured.'
+       Can contain up to two %s wildcards, the first will be replaced with
+       the exception's class name the second with the exception's message
+       (not implemented) }
+    property UserMessage: string read FUserMessage write FUserMessage;
+    {: description of the buttons (or some other text to be displayed) }
+    property OptionDescription: string read FOptionDescription write FOptionDescription;
+    {: text to display instead of '<i>exceptionclass</i>'#13#10'<i>exceptionmessage</i>'#13#10 }
+    property Details: string read FDetails write FDetails;
+    {: determines the icon of the dialog }
+    property DialogType: TMsgDlgType read FDialogType write FDialogType;
+    {: if true the 'Details' button is shown }
+    property ShowDetailButton: boolean read FShowDetailButton write FShowDetailButton;
+    {: if true, the 'Do not show again' checkbox is shown.
+       Automatically set true, when DontShowAgainText is set to a nonempty string. }
+    property ShowDontShowAgain: boolean read FShowDontShowAgain write FShowDontShowAgain;
+    {: checkbox caption to show instead of 'Do not ask again.' }
+    property DontShowAgainText: string read FDontShowAgainText write SetDontShowAgainText;
+    {: whether to show the maximze button
+       <ul>
+         <li>smSmart - show only when details are visible</li>
+         <li>smShow - show always</li>
+         <li>smHide - don't show at all</li>
+       </ul>}
+    property ShowMaximize: TShowMaximizeOption read FShowMaximize write FShowMaximize;
+  public
+    {: Simple function to show an exception.
+       This will display a dialog with the exclamation mark (!) icon, an OK button,
+       the text 'An error <i>exceptionclass</i> occured.' and a Details button.
+       Pressing the details button will display<br>
+       <i>exceptionclass</i><br>
+       <i>exceptionmessage</i><br>
+       <i>call stack, if available</i><br>
+       @param e is the exception to display
+       @param Parent is the parent component to be used in the constructor, defaults
+                     to nil
+       @returns one of the mrXxxx values }
+    class function ShowException(_e: Exception; _Parent: TComponent = nil): integer; overload;
+    {: Moderately complex function to show an exception.
+       This will display a dialog with the exclamation mark (!) icon, the Buttons
+       and OptionDesc specified,
+       the text 'An error <i>exceptionclass</i> occured.' and a Details button.
+       Pressing the details button will display<br>
+       <i>exceptionclass</i><br>
+       <i>exceptionmessage</i><br>
+       <i>call stack, if available</i><br>
+       @param e is the exception to display
+       @param Buttons is an array of buttons to show (Note: This is an array of
+                      buttons, not a set, so the order is important!)
+       @param OptionDesc gives the description for the Buttons, if not given,
+              defaults to an empty string
+       @param Parent is the parent component to be used in the constructor, defaults
+                     to nil
+       @returns one of the mrXxxx values }
+    class function ShowException(_e: Exception; const _Buttons: array of TDialogButtonEnum;
+      const _OptionDesc: string = ''; _Parent: TComponent = nil): integer; overload;
+    {: Complex function to show an exception.
+       This will display a dialog with the exclamation mark (!) icon, the Buttons
+       and OptionDesc specified, the Message passed and a Details button.
+       Pressing the details button will display<br>
+       <i>exceptionclass</i><br>
+       <i>exceptionmessage</i><br>
+       <i>call stack, if available</i><br>
+       @param e is the exception to display
+       @param Message is the message to display
+       @param Buttons is an array of buttons to show (Note: This is an array of
+                      buttons, not a set, so the order is important!)
+       @param OptionDesc gives the description for the Buttons, if not given,
+                         defaults to an empty string
+       @param Parent is the parent component to be used in the constructor, defaults
+                     to nil
+       @returns one of the mrXxxx values }
+    class function ShowException(_e: Exception; const _Message: string;
+      const _Buttons: array of TDialogButtonEnum; const _OptionDesc: string = '';
+      _Parent: TComponent = nil): integer; overload;
+    {: Simple function to display a message.
+       This will display a dialog with the icon indicated by DialogType, the
+       Message given, containing the Buttons specified and optionally an
+       OptionDesc. In contrast to MessageDlg the dialog is centered on the owner.
+       @param DialogType gives the icon to display
+       @param Message is the message text to display
+       @param Buttons is an array of buttons to show (Note: This is an array of
+                      buttons, not a set, so the order is important!)
+       @param OptionDesc gives the description for the Buttons, if not given,
+                         defaults to an empty string
+       @param Parent is the parent component to be used in the constructor, defaults
+                     to nil
+       @returns one of the mrXxxx values }
+    class function ShowMessage(_DialogType: TMsgDlgType; const _Message: string;
+      const _Buttons: array of TDialogButtonEnum; const _OptionDesc: string = '';
+      _Parent: TComponent = nil): integer; overload;
+    {: Complex function to display a message.
+       This will display a dialog with the icon indicated by DialogType, the
+       Message given, containing the Buttons specified and optionally an
+       OptionDesc. In contrast to MessageDlg the dialog is centered on the owner.
+       @param DialogType gives the icon to display
+       @param Message is the message text to display
+       @param Buttons is an array of buttons to show (Note: This is an array of
+                      buttons, not a set, so the order is important!)
+       @param CustomButtons is an array of strings for the custom button captions,
+                            the number of entries must correspond to the number
+                            of dbeCustom entries in the Buttons array
+       param CustomResults is an array of integers with the modal results for
+                           the custom buttons, the number of entries must
+                           correspond to the number of dbeCustom entries in the
+                           Buttons array
+       @param OptionDesc gives the description for the Buttons, if not given,
+                         defaults to an empty string
+       @param Parent is the parent component to be used in the constructor, defaults
+                     to nil
+       @returns one of the mrXxxx values }
+    class function ShowMessage(_DialogType: TMsgDlgType; const _Message: string;
+      const _Buttons: array of TDialogButtonEnum; const _CustomButtons: array of string;
+      const _CustomResults: array of integer;
+      const _OptionDesc: string = ''; _Parent: TComponent = nil): integer; overload;
+    {: Creates a Tf_dzDialog instance, shows it and returns it. The created
+       dialog instance must be freed by the caller
+       @param DialogType gives the icon to display
+       @param Message is the message text to display
+       @param Buttons is an array of buttons to show (Note: This is an array of
+                      buttons, not a set, so the order is important!)
+       @param OnButtonClick is an event handler that will be called if one of the
+                            buttons is clicked
+       @param OptionDesc gives the description for the Buttons, if not given,
+                         defaults to an empty string
+       @param Parent is the parent component to be used in the constructor, defaults
+                     to nil
+       @returns the created Tf_dzDialog instance, the caller is responsible
+                for closing and freeing this instance. }
+    class function ShowNonModalMessage(_DialogType: TMsgDlgType; const _Message: string;
+      const _Buttons: array of TDialogButtonEnum; _OnButtonClick: TOnButtonClick;
+      const _OptionDesc: string = ''; _Parent: TComponent = nil): Tf_dzDialog;
+
+  end;
+
+implementation
+
+{$R *.DFM}
+
+uses
+  Consts,
+  Math,
+  ShellApi,
+  u_dzTranslator;
+
+const
+  CHECKBOX_WIDTH = 24;
+
+resourcestring
+  STR_SHOW_DETAILS = '&Details >>';
+  STR_HIDE_DETAILS = '&Details <<';
+
+function ModalResultToButton(_Result: integer): TDialogButtonEnum;
+var
+  btn: TDialogButtonEnum;
+begin
+  for btn := low(TDialogButtonEnum) to high(TDialogButtonEnum) do
+    if ExceptionDialogModalResults[btn] = _Result then begin
+      Result := btn;
+      exit;
+    end;
+  raise EInvalidModalResult.CreateFmt(_('Invalid modal result %d.'), [_Result]);
+end;
+
+class function Tf_dzDialog.ShowMessage(_DialogType: TMsgDlgType;
+  const _Message: string; const _Buttons: array of TDialogButtonEnum;
+  const _CustomButtons: array of string; const _CustomResults: array of integer;
+  const _OptionDesc: string; _Parent: TComponent): integer;
+var
+  frm: Tf_dzDialog;
+  i: Integer;
+begin
+  frm := Tf_dzDialog.Create(_Parent);
+  try
+    frm.ShowDetailButton := false;
+    frm.SetVisibleButtons(_Buttons);
+    Assert(Length(_CustomButtons) = Length(frm.CustomButtonCaptions));
+    for i := Low(_CustomButtons) to High(_CustomButtons) do
+      frm.CustomButtonCaptions[i] := _CustomButtons[i];
+    Assert(Length(_CustomResults) = Length(frm.CustomModalResults));
+    for i := Low(_CustomResults) to High(_CustomResults) do
+      frm.CustomModalResults[i] := _CustomResults[i];
+    frm.UserMessage := _Message;
+    frm.OptionDescription := _OptionDesc;
+    frm.DialogType := _DialogType;
+    Result := frm.ShowModal;
+  finally
+    frm.Free;
+  end;
+end;
+
+class function Tf_dzDialog.ShowMessage(_DialogType: TMsgDlgType; const _Message: string;
+  const _Buttons: array of TDialogButtonEnum; const _OptionDesc: string = ''; _Parent: TComponent = nil): integer;
+var
+  frm: Tf_dzDialog;
+begin
+  frm := Tf_dzDialog.Create(_Parent);
+  try
+    frm.ShowDetailButton := false;
+    frm.SetVisibleButtons(_Buttons);
+    frm.UserMessage := _Message;
+    frm.OptionDescription := _OptionDesc;
+    frm.DialogType := _DialogType;
+    Result := frm.ShowModal;
+  finally
+    frm.Free;
+  end;
+end;
+
+class function Tf_dzDialog.ShowNonModalMessage(_DialogType: TMsgDlgType; const _Message: string;
+  const _Buttons: array of TDialogButtonEnum; _OnButtonClick: TOnButtonClick;
+  const _OptionDesc: string = ''; _Parent: TComponent = nil): Tf_dzDialog;
+begin
+  Result := Tf_dzDialog.Create(_Parent);
+  Result.ShowDetailButton := false;
+  Result.SetVisibleButtons(_Buttons);
+  Result.UserMessage := _Message;
+  Result.OptionDescription := _OptionDesc;
+  Result.DialogType := _DialogType;
+  Result.MakeModal;
+  Result.Show;
+end;
+
+class function Tf_dzDialog.ShowException(_e: Exception; const _Message: string;
+  const _Buttons: array of TDialogButtonEnum; const _OptionDesc: string = ''; _Parent: TComponent = nil): integer;
+var
+  frm: Tf_dzDialog;
+  sl: TStringList;
+  StackList: TJclStackInfoList;
+begin
+  frm := Tf_dzDialog.Create(_Parent);
+  try
+    if Assigned(_e) then begin
+      frm.ExceptionClass := _e.ClassName;
+      // frm.ExcptionAddress := ExceptAddr;
+      frm.ExceptionMessage := _e.Message;
+      frm.ExceptionExtendedMessage := _e.Message;
+      frm.ExceptionProcedure := format('[%p]', [ExceptAddr]);
+      frm.ExceptionProcedure := GetLocationInfoStr(ExceptAddr);
+      sl := TStringList.Create;
+      try
+        StackList := JclLastExceptStackList;
+        if Assigned(StackList) then begin
+          StackList.AddToStrings(sl, False, True, True);
+          frm.CallStack := sl;
+        end;
+      finally
+        sl.Free;
+      end;
+    end else
+      frm.ShowDetailButton := false;
+    frm.SetVisibleButtons(_Buttons);
+    frm.UserMessage := _Message;
+    frm.OptionDescription := _OptionDesc;
+    Result := frm.ShowModal;
+  finally
+    frm.Free;
+  end;
+end;
+
+class function Tf_dzDialog.ShowException(_e: Exception; const _Buttons: array of TDialogButtonEnum;
+  const _OptionDesc: string = ''; _Parent: TComponent = nil): integer;
+begin
+  Result := ShowException(_e, '', _Buttons, _OptionDesc, _Parent);
+end;
+
+class function Tf_dzDialog.ShowException(_e: Exception; _Parent: TComponent = nil): integer;
+begin
+  Result := ShowException(_e, '', [dbeOk], '', _Parent);
+end;
+
+{ Copied from Dialogs.pas }
+
+function GetAveCharSize(Canvas: TCanvas): TPoint;
+var
+  I: Integer;
+  Buffer: array[0..51] of Char;
+begin
+  for I := 0 to 25 do
+    Buffer[I] := Chr(I + Ord('A'));
+  for I := 0 to 25 do
+    Buffer[I + 26] := Chr(I + Ord('a'));
+  GetTextExtentPoint(Canvas.Handle, Buffer, 52, TSize(Result));
+  Result.X := Result.X div 52;
+end;
+
+const
+  IconIDs: array[TMsgDlgType] of PChar = (IDI_EXCLAMATION, IDI_HAND,
+    IDI_ASTERISK, IDI_QUESTION, nil);
+  ButtonNames: array[TDialogButtonEnum] of string = (// do not translate
+    'Yes', 'No', 'OK', 'Cancel', 'Abort', 'Retry', 'Ignore', 'All', 'NoToAll',
+    'YesToAll', 'Help', 'Custom');
+  ButtonCaptions: array[TDialogButtonEnum] of string = (
+    SMsgDlgYes, SMsgDlgNo, SMsgDlgOK, SMsgDlgCancel, SMsgDlgAbort,
+    SMsgDlgRetry, SMsgDlgIgnore, SMsgDlgAll, SMsgDlgNoToAll, SMsgDlgYesToAll,
+    SMsgDlgHelp, 'Custom');
+
+  { Tf_dzDialog }
+
+constructor Tf_dzDialog.Create(_Owner: TComponent);
+begin
+  inherited;
+  FDialogType := mtError;
+  FShowDetailButton := true;
+  FDontShowAgainText := _('Do not show again.');
+  FCallStack := TStringList.Create;
+  try
+    Icon.Handle := ExtractIcon(hInstance, PChar(Application.ExeName), 0);
+  except
+    // ignore any errors
+  end;
+
+  TranslateComponent(Self);
+end;
+
+destructor Tf_dzDialog.Destroy;
+begin
+  FCallStack.Free;
+  inherited;
+end;
+
+procedure Tf_dzDialog.SetCallStack(const _CallStack: TStrings);
+begin
+  FCallStack.Assign(_CallStack);
+end;
+
+procedure Tf_dzDialog.MakeModal;
+begin
+  FWindowList := DisableTaskWindows(0);
+end;
+
+procedure Tf_dzDialog.MakeNonModal;
+begin
+  EnableTaskWindows(FWindowList);
+end;
+
+procedure Tf_dzDialog.DoShow;
+const
+  mcHorzMargin = 8;
+  mcVertMargin = 8;
+  mcHorzSpacing = 10;
+  mcVertSpacing = 10;
+  mcButtonWidth = 50;
+  mcButtonHeight = 14;
+  mcButtonSpacing = 4;
+
+  function CalcTextSize(_Handle: HDC; const _Caption: string; _Format: integer): TPoint;
+  var
+    TextRect: TRect;
+  begin
+    TextRect := Rect(0, 0, 0, 0);
+    Windows.DrawText(_Handle, PChar(_Caption), -1, TextRect,
+      DT_CALCRECT or _Format);
+    Result := TextRect.BottomRight;
+  end;
+
+  function CalcMinButtonWidth(_Handle: HDC; const _Caption: string): integer;
+  begin
+    Result := CalcTextSize(_Handle, _Caption, DT_LEFT or DT_SINGLELINE or
+      DrawTextBiDiModeFlagsReadingOnly).x + 8;
+  end;
+
+var
+  DialogUnits: TPoint;
+  CurButtonWidth,
+    ButtonTop,
+    ButtonWidth,
+    ButtonHeight,
+    ButtonSpacing,
+    ButtonCount,
+    ButtonGroupWidth,
+    MinHeight,
+    MinWidth: integer;
+  i: integer;
+  X: Integer;
+  B,
+    DefaultButton,
+    CancelButton: TDialogButtonEnum;
+  IconID: PChar;
+  btn: TButton;
+  CustomCount: integer;
+begin
+  inherited;
+  EnableMenuItem(GetSystemMenu(Handle, LongBool(false)), SC_MAXIMIZE, MF_BYCOMMAND or MF_GRAYED);
+  if FUserMessage = '' then
+    FUserMessage := Format(_('An error occurred:'#13#10'%s'), [FExceptionMessage]);
+  l_Message.Caption := FUserMessage;
+  l_Message.AutoSize := true;
+  if l_Message.Height > im_Icon.Height then
+    MinHeight := l_Message.Top + l_Message.Height
+  else
+    MinHeight := im_Icon.Top + im_Icon.Height;
+  Inc(MinHeight, 8);
+  MinWidth := 250; // 400;
+  MinWidth := Max(MinWidth, l_Message.Left + l_Message.Width + 8);
+  if FOptionDescription = '' then
+    l_Options.Visible := false
+  else begin
+    l_Options.Top := MinHeight;
+    l_Options.Caption := FOptionDescription;
+    l_Options.AutoSize := true;
+    MinHeight := MinHeight + l_Options.Height + 8;
+    MinWidth := Max(MinWidth, l_Options.Left + l_Options.Width + 8);
+  end;
+  if FShowDetailButton then
+    if FShowDetailButton and (FDetails = '') then begin
+      m_Details.Lines.Text := FUserMessage;
+      m_Details.Lines.Add('');
+      m_Details.Lines.Add('');
+      m_Details.Lines.Add(_('Additional information:'));
+      if FExceptionProcedure = '' then
+        m_Details.Lines.Add(Format('%s at %p:', [FExceptionClass, FExceptionAddress]))
+      else
+        m_Details.Lines.Add(Format('%s at %s:', [FExceptionClass, FExceptionProcedure]));
+      m_Details.Lines.Add(FExceptionExtendedMessage);
+
+      if CallStack.Count = 0 then
+        m_Details.Lines.Add('<call stack not available>')
+      else begin
+        m_Details.Lines.Add('<begin call stack>');
+        m_Details.Lines.AddStrings(CallStack);
+        m_Details.Lines.Add('<end call stack>');
+      end;
+    end else
+      m_Details.Lines.Text := FDetails;
+  BiDiMode := Application.BiDiMode;
+  DialogUnits := GetAveCharSize(Canvas);
+  ButtonWidth := MulDiv(mcButtonWidth, DialogUnits.X, 4);
+  if FShowDetailButton then
+    ButtonWidth := CalcMinButtonWidth(Canvas.Handle, STR_SHOW_DETAILS);
+  CustomCount := 0;
+  for i := Low(FVisibleButtons) to High(FVisibleButtons) do begin
+    b := FVisibleButtons[i];
+    if b = dbeCustom then begin
+      CurButtonWidth := CalcMinButtonWidth(Canvas.Handle, FCustomButtonCaptions[CustomCount]);
+      Inc(CustomCount);
+    end else
+      CurButtonWidth := CalcMinButtonWidth(Canvas.Handle, ButtonCaptions[B]);
+    if CurButtonWidth > ButtonWidth then
+      ButtonWidth := CurButtonWidth;
+  end;
+  ButtonHeight := MulDiv(mcButtonHeight, DialogUnits.Y, 8);
+  ButtonSpacing := MulDiv(mcButtonSpacing, DialogUnits.X, 4);
+  IconID := IconIDs[FDialogType];
+  im_Icon.Picture.Icon.Handle := LoadIcon(0, IconID);
+  ButtonCount := Length(FVisibleButtons);
+  if FShowDetailButton then
+    ButtonGroupWidth := ButtonWidth + ButtonSpacing
+  else
+    ButtonGroupWidth := 0;
+  if ButtonCount <> 0 then
+    ButtonGroupWidth := ButtonGroupWidth + ButtonWidth * ButtonCount
+      + ButtonSpacing * (ButtonCount - 1);
+  ButtonTop := MinHeight + 8;
+
+  if FShowDontShowAgain then begin
+    MinWidth := Max(MinWidth, ButtonGroupWidth + 2 * ButtonSpacing
+      + CalcTextSize(Canvas.Handle, FDontShowAgainText,
+      DT_LEFT or DT_SINGLELINE or
+      DrawTextBiDiModeFlagsReadingOnly).x + CHECKBOX_WIDTH + 8);
+  end else
+    MinWidth := Max(MinWidth, ButtonGroupWidth + 2 * ButtonSpacing);
+
+  p_Top.Height := MinHeight + ButtonHeight + 16;
+  if Self.ClientWidth < MinWidth then
+    Self.ClientWidth := MinWidth;
+  Self.ClientHeight := p_Top.Height;
+  Constraints.MinWidth := Self.Width;
+  Constraints.MinHeight := Self.Height;
+  Constraints.MaxHeight := Self.Height;
+  Caption := Application.Title;
+  DefaultButton := dbeRetry;
+  CancelButton := dbeOK;
+  for i := Low(FVisibleButtons) to High(FVisibleButtons) do begin
+    b := FVisibleButtons[i];
+    case b of
+      dbeOK:
+        if DefaultButton in [dbeRetry, dbeYes] then
+          DefaultButton := dbeOK;
+      dbeYes:
+        if DefaultButton = dbeRetry then
+          DefaultButton := dbeYes;
+      dbeNo:
+        if CancelButton = dbeOK then
+          CancelButton := dbeNo;
+      dbeCancel:
+        if CancelButton in [dbeOK, dbeNo] then
+          CancelButton := dbeCancel;
+    end;
+  end;
+  X := (ClientWidth - ButtonGroupWidth - ButtonSpacing) {div 2};
+  CustomCount := 0;
+  for i := Low(FVisibleButtons) to High(FVisibleButtons) do begin
+    b := FVisibleButtons[i];
+    btn := TButton.Create(self);
+    btn.Name := ButtonNames[B];
+    if b = dbeCustom then
+      btn.Name := btn.Name + IntToStr(CustomCount);
+    btn.Parent := p_Top;
+    if b = dbeCustom then begin
+      btn.Caption := FCustomButtonCaptions[CustomCount];
+      btn.ModalResult := FCustomModalResults[CustomCount];
+      Inc(CustomCount);
+    end else begin
+      btn.Caption := ButtonCaptions[B];
+      btn.ModalResult := ExceptionDialogModalResults[B];
+    end;
+    if B = DefaultButton then begin
+      btn.Default := True;
+      btn.SetFocus;
+    end;
+    if B = CancelButton then
+      btn.Cancel := True;
+    btn.SetBounds(X, ButtonTop, ButtonWidth, ButtonHeight);
+    btn.Anchors := [akTop, akRight];
+    btn.OnClick := ButtonClick;
+    Inc(X, ButtonWidth + ButtonSpacing);
+  end;
+
+  if FShowDontShowAgain then begin
+    chk_DontAskAgain := TCheckBox.Create(self);
+    chk_DontAskAgain.Name := 'chk_DontAskAgain';
+    chk_DontAskAgain.Parent := p_Top;
+    chk_DontAskAgain.Width := CalcTextSize(Canvas.Handle, FDontShowAgainText,
+      DT_LEFT or DT_SINGLELINE or DrawTextBiDiModeFlagsReadingOnly).x + CHECKBOX_WIDTH;
+    chk_DontAskAgain.Left := 8;
+    chk_DontAskAgain.Top := ButtonTop + ButtonHeight - chk_DontAskAgain.Height;
+    chk_DontAskAgain.Caption := FDontShowAgainText;
+  end;
+
+  if FShowDetailButton then begin
+    b_Details := TButton.Create(self);
+    b_Details.Name := 'b_Details';
+    b_Details.Parent := p_Top;
+    b_Details.Caption := STR_SHOW_DETAILS;
+    b_Details.SetBounds(X, ButtonTop, ButtonWidth, ButtonHeight);
+    b_Details.Anchors := [akTop, akRight];
+    b_Details.OnClick := b_DetailsClick;
+  end;
+end;
+
+procedure Tf_dzDialog.ShowDetails;
+var
+  SavedStyle: integer;
+begin
+  if FShowMaximize = smSmart then begin
+    SavedStyle := GetWindowLong(handle, GWL_STYLE);
+    SetWindowLong(handle, GWL_STYLE, SavedStyle or WS_MAXIMIZEBOX);
+  end;
+  Constraints.MaxHeight := 0;
+  ClientHeight := p_Top.Height + p_Details.Height;
+  Constraints.MinHeight := p_Top.Height + 100 + Height - ClientHeight;
+  p_Details.Visible := true;
+  p_Details.Align := alClient;
+  //  EnableMenuItem(GetSystemMenu(Handle, LongBool(false)), SC_MAXIMIZE, MF_BYCOMMAND or MF_ENABLED);
+  //  BorderIcons := BorderIcons - [biMaximize];
+end;
+
+procedure Tf_dzDialog.HideDetails;
+var
+  SavedStyle: integer;
+begin
+  if FShowMaximize = smSmart then begin
+    SavedStyle := GetWindowLong(handle, GWL_STYLE);
+    SetWindowLong(handle, GWL_STYLE, SavedStyle and not WS_MAXIMIZEBOX);
+    if WindowState = wsMaximized then
+      WindowState := wsNormal;
+  end;
+  p_Details.Align := alNone;
+  p_Details.Visible := false;
+  Constraints.MinHeight := p_Top.Height + Height - ClientHeight;
+  Constraints.MaxHeight := Self.Height;
+  ClientHeight := p_Top.Height;
+  EnableMenuItem(GetSystemMenu(Handle, LongBool(false)), SC_MAXIMIZE, MF_BYCOMMAND or MF_GRAYED);
+  //  BorderIcons := BorderIcons - [biMaximize];
+end;
+
+procedure Tf_dzDialog.b_DetailsClick(Sender: TObject);
+begin
+  if p_Details.Visible then begin
+    HideDetails;
+    b_Details.Caption := STR_SHOW_DETAILS;
+  end else begin
+    ShowDetails;
+    b_Details.Caption := STR_HIDE_DETAILS;
+  end;
+end;
+
+procedure Tf_dzDialog.SetDontShowAgainText(const _Value: string);
+begin
+  FDontShowAgainText := _Value;
+  FShowDontShowAgain := FDontShowAgainText <> '';
+end;
+
+procedure Tf_dzDialog.SetVisibleButtons(const _Buttons: array of TDialogButtonEnum);
+var
+  i: integer;
+  CustomCount: integer;
+begin
+  CustomCount := 0;
+  SetLength(FVisibleButtons, Length(_Buttons));
+  for i := Low(_Buttons) to High(_Buttons) do begin
+    FVisibleButtons[i] := _Buttons[i];
+    if _Buttons[i] = dbeCustom then
+      Inc(CustomCount);
+  end;
+  SetLength(FCustomModalResults, CustomCount);
+  SetLength(FCustomButtonCaptions, CustomCount);
+end;
+
+procedure Tf_dzDialog.CreateParams(var Params: TCreateParams);
+begin
+  inherited;
+  if Assigned(Owner) and (Owner is TWinControl) then
+    Params.WndParent := (Owner as TWinControl).Handle;
+  if FShowMaximize = smshow then
+    Params.Style := Params.Style or WS_MAXIMIZEBOX;
+end;
+
+procedure Tf_dzDialog.FormCreate(Sender: TObject);
+begin
+  TranslateComponent(self);
+end;
+
+procedure Tf_dzDialog.Hide;
+begin
+  MakeNonmodal;
+  inherited Hide;
+end;
+
+procedure Tf_dzDialog.ButtonClick(_Sender: TObject);
+var
+  Action: TCloseAction;
+begin
+  Action := caNone;
+  if Assigned(FOnButtonClick) then
+    FOnButtonClick(Self, (_Sender as TButton).ModalResult, Action);
+  case Action of
+    caHide:
+      Hide;
+    caFree:
+      Free;
+    caMinimize:
+      WindowState := wsMinimized;
+  end;
+end;
+
+initialization
+  JclStartExceptionTracking;
+  Include(JclStackTrackingOptions, stRawMode);
+end.
+



From twm at mail.berlios.de  Fri Jul 27 10:57:58 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:57:58 +0200
Subject: [Dzchart-svncheckins] r194 - utilities/dzLib/trunk/tests/dzfileutils
Message-ID: <200707270857.l6R8vwwV003714@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:57:52 +0200 (Fri, 27 Jul 2007)
New Revision: 194

Modified:
   utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dpr
   utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dproj
   utilities/dzLib/trunk/tests/dzfileutils/Testu_dzFileUtils.pas
Log:
additional unit tests

Modified: utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dpr
===================================================================
--- utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dpr	2007-07-27 08:57:17 UTC (rev 193)
+++ utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dpr	2007-07-27 08:57:52 UTC (rev 194)
@@ -25,7 +25,9 @@
   u_dzStringUtils in '..\..\src\u_dzStringUtils.pas',
   u_dzConvertUtils in '..\..\src\u_dzConvertUtils.pas',
   u_dzTranslator in '..\..\src\u_dzTranslator.pas',
-  u_dzDateUtils in '..\..\src\u_dzDateUtils.pas';
+  u_dzDateUtils in '..\..\src\u_dzDateUtils.pas',
+  u_dzUnitTestUtils in '..\..\src\u_dzUnitTestUtils.pas',
+  u_dzVariantUtils in '..\..\src\u_dzVariantUtils.pas';
 
 {$R *.RES}
 

Modified: utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dproj
===================================================================
--- utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dproj	2007-07-27 08:57:17 UTC (rev 193)
+++ utilities/dzLib/trunk/tests/dzfileutils/DUnitTest_dzFileUtils.dproj	2007-07-27 08:57:52 UTC (rev 194)
@@ -34,45 +34,7 @@
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject xmlns=""> <Delphi.Personality>   <Parameters>
-      <Parameters Name="UseLauncher">False</Parameters>
-      <Parameters Name="LoadAllSymbols">True</Parameters>
-      <Parameters Name="LoadUnspecifiedSymbols">False</Parameters>
-    </Parameters>
-    <VersionInfo>
-      <VersionInfo Name="IncludeVerInfo">False</VersionInfo>
-      <VersionInfo Name="AutoIncBuild">False</VersionInfo>
-      <VersionInfo Name="MajorVer">1</VersionInfo>
-      <VersionInfo Name="MinorVer">0</VersionInfo>
-      <VersionInfo Name="Release">0</VersionInfo>
-      <VersionInfo Name="Build">0</VersionInfo>
-      <VersionInfo Name="Debug">False</VersionInfo>
-      <VersionInfo Name="PreRelease">False</VersionInfo>
-      <VersionInfo Name="Special">False</VersionInfo>
-      <VersionInfo Name="Private">False</VersionInfo>
-      <VersionInfo Name="DLL">False</VersionInfo>
-      <VersionInfo Name="Locale">1033</VersionInfo>
-      <VersionInfo Name="CodePage">1252</VersionInfo>
-    </VersionInfo>
-    <VersionInfoKeys>
-      <VersionInfoKeys Name="CompanyName"></VersionInfoKeys>
-      <VersionInfoKeys Name="FileDescription"></VersionInfoKeys>
-      <VersionInfoKeys Name="FileVersion">1.0.0.0</VersionInfoKeys>
-      <VersionInfoKeys Name="InternalName"></VersionInfoKeys>
-      <VersionInfoKeys Name="LegalCopyright"></VersionInfoKeys>
-      <VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
-      <VersionInfoKeys Name="OriginalFilename"></VersionInfoKeys>
-      <VersionInfoKeys Name="ProductName"></VersionInfoKeys>
-      <VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
-      <VersionInfoKeys Name="Comments"></VersionInfoKeys>
-    </VersionInfoKeys>
-    <Source>
-      <Source Name="MainSource">DUnitTest_dzFileUtils.dpr</Source>
-    </Source>
-  </Delphi.Personality>   <UnitTesting>   <TestFramework>DUnit / Delphi Win32</TestFramework>
-    <TestRunner>GUI</TestRunner>
-  </UnitTesting>
-</BorlandProject></BorlandProject>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">False</VersionInfo><VersionInfo Name="AutoIncBuild">False</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">0</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">0</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="CompanyName"></VersionInfoKeys><VersionInfoKeys Name="FileDescription"></VersionInfoKeys><VersionI!
 nfoKeys Name="FileVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="InternalName"></VersionInfoKeys><VersionInfoKeys Name="LegalCopyright"></VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename"></VersionInfoKeys><VersionInfoKeys Name="ProductName"></VersionInfoKeys><VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys><VersionInfoKeys Name="Comments"></VersionInfoKeys></VersionInfoKeys><Source><Source Name="MainSource">DUnitTest_dzFileUtils.dpr</Source></Source></Delphi.Personality><UnitTesting><TestFramework>DUnit / Delphi Win32</TestFramework><TestRunner>GUI</TestRunner></UnitTesting></BorlandProject></BorlandProject>
   </ProjectExtensions>
   <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
   <ItemGroup>
@@ -80,10 +42,13 @@
       <MainSource>MainSource</MainSource>
     </DelphiCompile>
     <DCCReference Include="..\..\src\u_dzConvertUtils.pas" />
+    <DCCReference Include="..\..\src\u_dzDateUtils.pas" />
     <DCCReference Include="..\..\src\u_dzFileUtils.pas" />
     <DCCReference Include="..\..\src\u_dzMiscUtils.pas" />
     <DCCReference Include="..\..\src\u_dzStringUtils.pas" />
     <DCCReference Include="..\..\src\u_dzTranslator.pas" />
+    <DCCReference Include="..\..\src\u_dzUnitTestUtils.pas" />
+    <DCCReference Include="..\..\src\u_dzVariantUtils.pas" />
     <DCCReference Include="Testu_dzFileUtils.pas" />
   </ItemGroup>
 </Project>
\ No newline at end of file

Modified: utilities/dzLib/trunk/tests/dzfileutils/Testu_dzFileUtils.pas
===================================================================
--- utilities/dzLib/trunk/tests/dzfileutils/Testu_dzFileUtils.pas	2007-07-27 08:57:17 UTC (rev 193)
+++ utilities/dzLib/trunk/tests/dzfileutils/Testu_dzFileUtils.pas	2007-07-27 08:57:52 UTC (rev 194)
@@ -7,10 +7,11 @@
   Classes,
   SysUtils,
   TestFramework,
-  u_dzFileUtils;
+  u_dzFileUtils,
+  u_dzUnitTestUtils;
 
 type
-  TFileSystemTestCase = class(TTestCase)
+  TFileSystemTestCase = class(TdzTestCase)
   protected
     FTestDir: string;
     procedure SetUp; override;
@@ -41,6 +42,7 @@
 
   TestTDirectorySync = class(TFileSystemTestCase)
   private
+    FLargeContent: string;
     FDirA: string;
     FDirB: string;
     FSync: TDirectorySync;
@@ -55,8 +57,9 @@
     FCallbacks: TStringList;
     FExistingFiles: TStringList;
     procedure OnSyncDirAbort(_Sender: TObject; const _Src, _Dst: string);
-    procedure OnSyncCallback(_Sender: TObject; const _Src, _Dst: string);
-    procedure OnFileExistsCallback(_Sender: TObject; const _Src, _Dst: TFileInfoRec);
+    procedure OnDirSyncCallback(_Sender: TObject; const _Src, _Dst: string);
+    procedure OnFileSyncCallback(_Sender: TObject; const _Src, _Dst: string; _Total, _Done: Int64);
+    procedure OnFileExistsCallback(_Sender: TObject; const _SrcFile, _DstFile: TFileInfoRec; var _Action: TFileExistsAction);
     procedure CheckSameText(const _Expected, _Actual, _Msg: string);
   protected
     procedure SetUp; override;
@@ -572,9 +575,11 @@
   TFileSystem.CreateDir(FDirA);
   TFileSystem.CreateDir(FDirB);
 
+  FLargeContent := StringOfChar('a', 5 * 1024 * 1024);
+
   FFile1 := CreateTestfile('a\file1.txt', 'File1');
   FFile2 := CreateTestfile('a\.txt', 'File2');
-  FFile3 := CreateTestfile('a\file3', 'File3');
+  FFile3 := CreateTestfile('a\file3', FLargeContent);
   TFileSystem.CreateDir(FDirA + '\Sub1');
   TFileSystem.CreateDir(FDirA + '\Sub2');
   FFile4 := CreateTestfile('a\Sub2\file4.txt', 'File4');
@@ -622,7 +627,7 @@
   CheckEquals(10, cnt, 'number of files and subdirs');
   CheckTestfile('b\' + ExtractFileName(FFile1), 'File1');
   CheckTestfile('b\' + ExtractFileName(FFile2), 'File2');
-  CheckTestfile('b\' + ExtractFileName(FFile3), 'File3');
+  CheckTestfile('b\' + ExtractFileName(FFile3), FLargeContent);
   CheckSubdirExists('b\Sub1');
   CheckSubdirExists('b\Sub2');
   CheckTestfile('b\Sub2\' + ExtractFileName(FFile4), 'File4');
@@ -637,27 +642,46 @@
 end;
 
 procedure TestTDirectorySync.TestSyncOneWayCallback;
+var
+  Expected: TStringList;
+  i: Integer;
 begin
-  FSync.OnSyncingDir := OnSyncCallback;
-  FSync.OnSyncingFile := OnSyncCallback;
+  FSync.OnSyncingDir := OnDirSyncCallback;
+  FSync.OnSyncingFile := OnFileSyncCallback;
   FSync.SyncOneWay(FDirA, FDirB);
-  CheckEquals(9, FCallbacks.Count, 'callback count');
-  CheckEquals(FDirA + ' -> ' + FDirB, FCallbacks[0], 'callback 0');
-  CheckEquals(FDirA + '.txt -> ' + FDirB + '.txt', FCallbacks[1], 'callback 1');
-  CheckEquals(FDirA + 'file1.txt -> ' + FDirB + 'file1.txt', FCallbacks[2], 'callback 2');
-  CheckEquals(FDirA + 'file3 -> ' + FDirB + 'file3', FCallbacks[3], 'callback 3');
-  CheckEquals(FDirA + 'Sub1 -> ' + FDirB + 'Sub1', FCallbacks[4], 'callback 4');
-  CheckEquals(FDirA + 'Sub2 -> ' + FDirB + 'Sub2', FCallbacks[5], 'callback 5');
-  CheckEquals(FDirA + 'Sub2\file4.txt -> ' + FDirB + 'Sub2\file4.txt', FCallbacks[6], 'callback 6');
-  CheckEquals(FDirA + 'Sub5 -> ' + FDirB + 'Sub5', FCallbacks[7], 'callback 7');
-  CheckEquals(FDirA + 'Sub6 -> ' + FDirB + 'Sub6', FCallbacks[8], 'callback 8');
+
+  Expected := TStringList.Create;
+  try
+    Expected.Add(FDirA + ' -> ' + FDirB);
+    Expected.Add(FDirA + '.txt -> ' + FDirB + '.txt (0 of 7)');
+    Expected.Add(FDirA + '.txt -> ' + FDirB + '.txt (7 of 7)');
+    Expected.Add(FDirA + 'file1.txt -> ' + FDirB + 'file1.txt (0 of 7)');
+    Expected.Add(FDirA + 'file1.txt -> ' + FDirB + 'file1.txt (7 of 7)');
+    for i := 0 to 80 do
+      Expected.Add(FDirA + 'file3 -> ' + FDirB + Format('file3 (%d of 5242882)', [i * 65536]));
+    Expected.Add(FDirA + 'file3 -> ' + FDirB + 'file3 (5242882 of 5242882)');
+    Expected.Add(FDirA + 'Sub1 -> ' + FDirB + 'Sub1');
+    Expected.Add(FDirA + 'Sub2 -> ' + FDirB + 'Sub2');
+    Expected.Add(FDirA + 'Sub2\file4.txt -> ' + FDirB + 'Sub2\file4.txt (0 of 7)');
+    Expected.Add(FDirA + 'Sub2\file4.txt -> ' + FDirB + 'Sub2\file4.txt (7 of 7)');
+    Expected.Add(FDirA + 'Sub5 -> ' + FDirB + 'Sub5');
+    Expected.Add(FDirA + 'Sub6 -> ' + FDirB + 'Sub6');
+    CheckEqualsMultiline(Expected.Text, FCallbacks.Text);
+  finally
+    Expected.Free;
+  end;
 end;
 
-procedure TestTDirectorySync.OnSyncCallback(_Sender: TObject; const _Src, _Dst: string);
+procedure TestTDirectorySync.OnDirSyncCallback(_Sender: TObject; const _Src, _Dst: string);
 begin
   FCallbacks.Add(_Src + ' -> ' + _Dst);
 end;
 
+procedure TestTDirectorySync.OnFileSyncCallback(_Sender: TObject; const _Src, _Dst: string; _Total, _Done: Int64);
+begin
+  FCallbacks.Add(_Src + ' -> ' + _Dst + ' (' + IntToStr(_Done) + ' of ' + IntToStr(_Total) + ')');
+end;
+
 procedure TestTDirectorySync.OnSyncDirAbort(_Sender: TObject; const _Src, _Dst: string);
 begin
   SysUtils.Abort;
@@ -669,11 +693,11 @@
     FailNotEquals(_Expected, _Actual, _Msg);
 end;
 
-procedure TestTDirectorySync.OnFileExistsCallback(_Sender: TObject; const _Src, _Dst: TFileInfoRec);
+procedure TestTDirectorySync.OnFileExistsCallback(_Sender: TObject; const _SrcFile, _DstFile: TFileInfoRec; var _Action: TFileExistsAction);
 begin
-  FExistingFiles.Add(_Src.Filename + ' <> ' + _Dst.Filename);
-  CheckEquals(_Src.Size, _Dst.Size, 'Size');
-  CheckEquals(_Src.Timestamp, _Dst.Timestamp, 'Timestamp');
+  FExistingFiles.Add(_SrcFile.Filename + ' <> ' + _DstFile.Filename);
+  CheckEquals(_SrcFile.Size, _DstFile.Size, 'Size');
+  CheckEquals(_SrcFile.Timestamp, _DstFile.Timestamp, 'Timestamp');
 end;
 
 procedure TestTDirectorySync.TestCheckOneWay;
@@ -731,7 +755,7 @@
   CheckEquals(10, cnt, 'number of files and subdirs');
   CheckTestfile('b\' + ExtractFileName(FFile1), 'File1');
   CheckTestfile('b\' + ExtractFileName(FFile2), 'File2');
-  CheckTestfile('b\' + ExtractFileName(FFile3), 'File3');
+  CheckTestfile('b\' + ExtractFileName(FFile3), FLargeContent);
   CheckSubdirExists('b\Sub1');
   CheckSubdirExists('b\Sub2');
   CheckTestfile('b\Sub2\' + ExtractFileName(FFile4), 'File4');
@@ -755,7 +779,7 @@
   CheckEquals(10, cnt, 'number of files and subdirs');
   CheckTestfile('a\' + ExtractFileName(FFile1), 'File1');
   CheckTestfile('a\' + ExtractFileName(FFile2), 'File2');
-  CheckTestfile('a\' + ExtractFileName(FFile3), 'File3');
+  CheckTestfile('a\' + ExtractFileName(FFile3), FLargeContent);
   CheckSubdirExists('a\Sub1');
   CheckSubdirExists('a\Sub2');
   CheckTestfile('a\Sub2\' + ExtractFileName(FFile4), 'File4');



From twm at mail.berlios.de  Fri Jul 27 10:58:36 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Fri, 27 Jul 2007 10:58:36 +0200
Subject: [Dzchart-svncheckins] r195 - utilities/dzLib/trunk
Message-ID: <200707270858.l6R8waQE003753@sheep.berlios.de>

Author: twm
Date: 2007-07-27 10:58:32 +0200 (Fri, 27 Jul 2007)
New Revision: 195

Added:
   utilities/dzLib/trunk/UpdateTranslations.cmd
Modified:
   utilities/dzLib/trunk/default_de.po
   utilities/dzLib/trunk/ignore.po
Log:
updated German translation and batch file to update them

Added: utilities/dzLib/trunk/UpdateTranslations.cmd
===================================================================
--- utilities/dzLib/trunk/UpdateTranslations.cmd	2007-07-27 08:57:52 UTC (rev 194)
+++ utilities/dzLib/trunk/UpdateTranslations.cmd	2007-07-27 08:58:32 UTC (rev 195)
@@ -0,0 +1,16 @@
+ at rem This batch will
+ at rem * call dxgettext to extract all strings to translate
+ at rem * call msgremove remove any strings stored in the ignore.po file
+
+set BASE=.
+
+ at rem extract from subdirectories src and forms
+dxgettext --delphi -r -b %BASE%\src -b %BASE%\forms -o %BASE%
+
+ at rem remove strings given in ignore.po
+msgremove %BASE%\default.po -i %BASE%\ignore.po -o %BASE%\filtered.po
+
+ at rem merge German translations
+msgmerge --no-wrap --update %BASE%\default_de.po %BASE%\filtered.po
+
+pause

Modified: utilities/dzLib/trunk/default_de.po
===================================================================
--- utilities/dzLib/trunk/default_de.po	2007-07-27 08:57:52 UTC (rev 194)
+++ utilities/dzLib/trunk/default_de.po	2007-07-27 08:58:32 UTC (rev 195)
@@ -6,8 +6,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: dzLib 1.0\n"
-"POT-Creation-Date: 2007-05-23 17:05\n"
-"PO-Revision-Date: 2007-05-23 17:10+0100\n"
+"POT-Creation-Date: 2007-07-18 15:13\n"
+"PO-Revision-Date: 2007-07-18 15:14+0100\n"
 "Last-Translator: Schniering Ingenieursgesellschaft <info at schniering.com>\n"
 "Language-Team: Thomas Mueller <dzlib at dummzeuch.de>\n"
 "MIME-Version: 1.0\n"
@@ -19,96 +19,136 @@
 
 #. "%s" ist kein g??ltiger Flie??komma Wert: %s
 #. Programmer's name for it: STR_X_IS_NOT_A_VALID_FLOAT_VALUE_SS
-#: u_dzConvertUtils.pas:182
+#: u_dzConvertUtils.pas:223
 msgid "\"%s\" is not a valid floating point value: %s"
 msgstr "\"%s\" ist kein g??ltiger Flie??kommawert: %s"
 
 #. "%s" ist kein g??ltiger %s Wert: %s
 #. Programmer's name for it: STR_X_IS_NOT_A_VALID_Y_VALUE_SSS
-#: u_dzConvertUtils.pas:184
+#: u_dzConvertUtils.pas:225
 msgid "\"%s\" is not a valid %s value: %s"
 msgstr "\"%s\" ist kein g??ltiger %s Wert: %s"
 
-#: u_dzConvertUtils.pas:215
+#: u_dzConvertUtils.pas:256
 msgid "Digit out of range %s"
 msgstr "ung??ltige Ziffer %s"
 
-#: u_dzConvertUtils.pas:228
+#: u_dzConvertUtils.pas:269
 msgid "Digit #%d (%s) out of range"
 msgstr "Ung??ltige Ziffer #%d (%s)"
 
-#: u_dzDefaultMain.pas:114
+#: u_dzConvertUtils.pas:553
+msgid "%.2f EiB"
+msgstr "%.2f EiB"
+
+#: u_dzConvertUtils.pas:555
+msgid "%.2f PiB"
+msgstr "%.2f PiB"
+
+#: u_dzConvertUtils.pas:557
+msgid "%.2f TiB"
+msgstr "%.2f TiB"
+
+#: u_dzConvertUtils.pas:559
+msgid "%.2f GiB"
+msgstr "%.2f GiB"
+
+#: u_dzConvertUtils.pas:561
+msgid "%.2f MiB"
+msgstr "%.2f MiB"
+
+#: u_dzConvertUtils.pas:563
+msgid "%.2f KiB"
+msgstr "%.2f KiB"
+
+#: u_dzConvertUtils.pas:565
+msgid "%d Bytes"
+msgstr "%d Bytes"
+
+#: u_dzDefaultMain.pas:115
 msgid "Error: %s"
 msgstr "Fehler: %s"
 
+#: u_dzDefaultMain.pas:119
+msgid "Synopsis: %s %s"
+msgstr "Aufruf: %s %s"
+
+#: u_dzDefaultMain.pas:120
+msgid "Parameters:"
+msgstr "Parameter:"
+
+#: u_dzDefaultMain.pas:122
+msgid "Options:"
+msgstr "Optionen:"
+
 #. Programmer's name for it: STR_GETTEMPPATH_ERROR_DS
-#: u_dzFileUtils.pas:450
+#: u_dzFileUtils.pas:458
 msgid "u_dzFileUtils.GetTempPath: %1:s (code: %0:d) calling Windows.GetTempPath"
 msgstr "u_dzFileUtils.GetTempPath: %1:s (code: %0:d) beim Aufruf von Windows.GetTempPath"
 
 #. Programmer's name for it: STR_GETTEMPPATH_ERROR2_DS
-#: u_dzFileUtils.pas:451
+#: u_dzFileUtils.pas:459
 msgid "u_dzFileUtils.GetTempPath: %1:s (code: %0:d) calling Windows.GetTempPath (2nd)"
 msgstr "u_dzFileUtils.GetTempPath: %1:s (code: %0:d) beim Aufruf von Windows.GetTempPath (zweiter)"
 
 #. Programmer's name for it: STR_CREATEUNIQUEDIR_ERROR_S
-#: u_dzFileUtils.pas:452
+#: u_dzFileUtils.pas:460
 msgid "could not find a unique directory name based on \"%s\""
 msgstr "Konnte keinen eindeutigen Verzeichnisnamen basierend auf \"%s\" finden."
 
 #. Programmer's name for it: STR_GETTEMPFILENAME_ERROR_DS
-#: u_dzFileUtils.pas:453
+#: u_dzFileUtils.pas:461
 msgid "u_dzFileUtils.GetTempFilename: %1:s (Code: %0:d) calling Windows.GetTempFileName"
 msgstr "u_dzFileUtils.GetTempFilename: %1:s (Code: %0:d) beim Aufruf von Windows.GetTempFileName"
 
 #. Programmer's name for it: STR_GETSHORTPATHNAME_ERROR_DS
-#: u_dzFileUtils.pas:454
+#: u_dzFileUtils.pas:462
 msgid "u_dzFileUtils.GetShortPathname: %1:s (Code: %0:d) calling Windows.GetShortPathname"
 msgstr "u_dzFileUtils.GetShortPathname: %1:s (Code: %0:d) beim Aufruf von Windows.GetShortPathname"
 
 #. Programmer's name for it: STR_GETSHORTPATHNAME_TOO_LONG_D
-#: u_dzFileUtils.pas:455
+#: u_dzFileUtils.pas:463
 msgid "Short pathname is longer than MAX_PATH (%d) characters"
 msgstr "Kurzer Pfad ist l??nger als MAX_PATH (%d) Zeichen"
 
 #. doppelte % zum Durchreichen in Prozedur
 #. Programmer's name for it: STR_MOVEFILE_ERROR_SS
-#: u_dzFileUtils.pas:457
+#: u_dzFileUtils.pas:465
 msgid "Error %%1:s (%%0:d) while trying to move \"%s\" to \"%s\"."
 msgstr "Fehler %%1:s (%%0:d) beim Verschieben von \"%s\" nach \"%s\"."
 
 #. doppelte % zum Durchreichen in Prozedur
 #. Programmer's name for it: STR_SETREADONLY_ERROR_S
-#: u_dzFileUtils.pas:459
+#: u_dzFileUtils.pas:467
 msgid "Error %%1:s (%%0:d) while changing the readonly flag of \"%s\""
 msgstr "Fehler %%1:s (%%0:d) beim ??ndern des Schreibschutz-Flags von \"%s\""
 
 #. doppelte % zum Durchreichen in Prozedur
 #. Programmer's name for it: STR_COPYFILE_ERROR_SS
-#: u_dzFileUtils.pas:461
+#: u_dzFileUtils.pas:469
 msgid "Error %%1:s (%%0:d) while trying to copy \"%s\" to \"%s\"."
 msgstr "Fehler %%1:s (%%0:d) beim Kopieren von \"%s\" nach \"%s\"."
 
 #. doppelte % zum Durchreichen in Prozedur
 #. Programmer's name for it: STR_DELETEFILE_ERROR_S
-#: u_dzFileUtils.pas:463
+#: u_dzFileUtils.pas:471
 msgid "Error %%1:s (%%0:d) deleting file \"%s\""
 msgstr "Fehler %%1:s (%%0:d) beim L??schen der Datei \"%s\""
 
 #. doppelte % zum Durchreichen in Prozedur
 #. Programmer's name for it: STR_REMOVEDIR_ERROR_S
-#: u_dzFileUtils.pas:465
+#: u_dzFileUtils.pas:473
 msgid "Error %%1:s (%%0:d) deleting directory \"%s\""
 msgstr "Fehler %%1:s (%%0:d) beim L??schen des Verzeichnisses \"%s\""
 
 #. Programmer's name for it: STR_DELTREE_ERROR_S
-#: u_dzFileUtils.pas:466
+#: u_dzFileUtils.pas:474
 msgid "\"%s\" does not exist or is not a directory"
 msgstr "\"%s\" existiert nicht oder ist kein Verzeichnis"
 
 #. doppelte % zum Durchreichen in Prozedur
 #. Programmer's name for it: STR_CREATEDIR_ERROR_S
-#: u_dzFileUtils.pas:468
+#: u_dzFileUtils.pas:476
 msgid "Error %%1:s (%%0:d) creating directory \"%s\""
 msgstr "Fehler %%1:s (%%0:d) beim Erstellen des Verzeichnisses \"%s\""
 
@@ -149,33 +189,64 @@
 
 #. nthWord: Nulltes Wort nicht verf??gbar
 #. Programmer's name for it: STR_NO_0TH_WORD
-#: u_dzStringUtils.pas:262
+#: u_dzStringUtils.pas:265
 msgid "nthWord: 0th word not available"
 msgstr "nthWord: 0tes Wort ist nicht verf??gbar"
 
 #. Zu zentrierender String ist l??nger als die Maximall??nge und kann nicht zentriert werden.
 #. Programmer's name for it: STR_STRING_TOO_LONG_TO_CENTER
-#: u_dzStringUtils.pas:265
+#: u_dzStringUtils.pas:268
 msgid "Cannot center string that is larger than the maximum length."
 msgstr "Kann keinen String zentrieren, der l??nger als die maximale L??nge ist."
 
 #. Strings haben kein nulltes Zeichen.
 #. Programmer's name for it: STR_CHAR_INDEX_OUT_OF_RANGE
-#: u_dzStringUtils.pas:268
+#: u_dzStringUtils.pas:271
 msgid "Strings do not have a 0th character."
 msgstr "Strings haben kein 0tes Zeichen."
 
 #. Variant kann nicht nach %s konvertiert werden: %s
 #. Programmer's name for it: STR_VARIANT_CAN_NOT_BE_CONVERTED_TO_S
-#: u_dzVariantUtils.pas:159
+#: u_dzVariantUtils.pas:165
 msgid "Variant can not be converted to %s"
 msgstr "Variant kann nicht nach %s konvertiert werden"
 
-#: u_dzVclUtils.pas:491
+#: u_dzVclUtils.pas:465
 msgid "\"%s\" is not a valid floating point value."
 msgstr "\"%s\" ist kein g??ltiger Flie??kommawert."
 
-#: u_dzVclUtils.pas:511
+#: u_dzVclUtils.pas:480
 msgid "\"%s\" is not a valid integer value."
 msgstr "\"%s\" ist kein g??ltiger Integerwert."
 
+#. Programmer's name for it: STR_SHOW_DETAILS
+#: w_dzDialog.pas:298
+msgid "&Details >>"
+msgstr "&Details >>"
+
+#. Programmer's name for it: STR_HIDE_DETAILS
+#: w_dzDialog.pas:299
+msgid "&Details <<"
+msgstr "&Details <<"
+
+#: w_dzDialog.pas:310
+msgid "Invalid modal result %d."
+msgstr "Ung??ltiger modaler R??ckgabewert %d."
+
+#: w_dzDialog.pas:453
+msgid "Do not show again."
+msgstr "Nicht nochmal anzeigen."
+
+#: w_dzDialog.pas:534
+msgid ""
+"An error occurred:\n"
+"%s"
+msgstr ""
+"Es ist ein Fehler aufgetreten:\n"
+"%s"
+
+#. 400;
+#: w_dzDialog.pas:558
+msgid "Additional information:"
+msgstr "Erweiterte Informationen:"
+

Modified: utilities/dzLib/trunk/ignore.po
===================================================================
--- utilities/dzLib/trunk/ignore.po	2007-07-27 08:57:52 UTC (rev 194)
+++ utilities/dzLib/trunk/ignore.po	2007-07-27 08:58:32 UTC (rev 195)
@@ -0,0 +1,39 @@
+#  Ignorierliste. Entfernen Sie die, die Sie ?bersetzt haben wollen.
+
+#  Seems like a Font.Name extract
+#. f_dzDialog..Font.Name
+#: w_dzDialog.dfm:12
+msgid "MS Sans Serif"
+msgstr ""
+
+#  Seems like a Font.Name extract
+#. f_dzDialog..p_Details..m_Details..Font.Name
+#: w_dzDialog.dfm:76
+msgid "Courier New"
+msgstr ""
+
+#. f_dzDialog..Caption
+#: w_dzDialog.dfm:5 
+msgid "f_dzDialog"
+msgstr ""
+
+#. f_dzDialog..p_Top..l_Message....Caption
+#: w_dzDialog.dfm:36 
+msgid "Mitteilung an den Benutzer, dies ist eine sehr lange Mitteilung und sie wird ein paar mal wiederholt, damit auch ein Umbruch stattfindet. (do not translate)"
+msgstr ""
+
+#. f_dzDialog..p_Top..l_Options..Caption
+#: w_dzDialog.dfm:45 
+msgid "Beschreibung der Optionen (do not translate)"
+msgstr ""
+
+#. f_dzDialog..p_Details..m_Details....Lines.Strings
+#: w_dzDialog.dfm:79 
+msgid "ExcectionClass: (do not translate)"
+msgstr ""
+
+#. f_dzDialog..p_Details..m_Details....Lines.Strings
+#: w_dzDialog.dfm:80 
+msgid "Message der Exception (do not translate)"
+msgstr ""
+



From twm at mail.berlios.de  Sat Jul 28 13:51:35 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 28 Jul 2007 13:51:35 +0200
Subject: [Dzchart-svncheckins] r196 - utilities/dzLib/trunk/src
Message-ID: <200707281151.l6SBpZwE000511@sheep.berlios.de>

Author: twm
Date: 2007-07-28 13:51:34 +0200 (Sat, 28 Jul 2007)
New Revision: 196

Modified:
   utilities/dzLib/trunk/src/u_dzTranslator.pas
Log:
added cond. define to also remove the no translation hint

Modified: utilities/dzLib/trunk/src/u_dzTranslator.pas
===================================================================
--- utilities/dzLib/trunk/src/u_dzTranslator.pas	2007-07-27 08:58:32 UTC (rev 195)
+++ utilities/dzLib/trunk/src/u_dzTranslator.pas	2007-07-28 11:51:34 UTC (rev 196)
@@ -7,8 +7,10 @@
 // for now uses gnugettext
 {$DEFINE gnugettext}
 {$ELSE}
+{$IFNDEF NO_TRANSLATION_HINT}
 {$MESSAGE HINT 'translation is turned off, remove NO_TRANSLATION define to turn it on'}
 {$ENDIF}
+{$ENDIF}
 
 interface
 



From twm at mail.berlios.de  Sat Jul 28 14:01:58 2007
From: twm at mail.berlios.de (twm at mail.berlios.de)
Date: Sat, 28 Jul 2007 14:01:58 +0200
Subject: [Dzchart-svncheckins] r197 - utilities/dzPrepBuild/trunk/src
Message-ID: <200707281201.l6SC1wvO001284@sheep.berlios.de>

Author: twm
Date: 2007-07-28 14:01:53 +0200 (Sat, 28 Jul 2007)
New Revision: 197

Modified:
   utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini
   utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Log:
* removed versioninfo from .dproj file since it isn't used anyway
* turned off no_translation warning, I won't translate this tool
* changed file description
* added "(overwrites value from -ReadXxx option)" to all options it applies to

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dpr
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-28 11:51:34 UTC (rev 196)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dpr	2007-07-28 12:01:53 UTC (rev 197)
@@ -1,9 +1,8 @@
 program PrepBuild;
 
-{$R *_icon.res}
-{$R *_version.res}
 
 
+
 {$APPTYPE CONSOLE}
 
 uses
@@ -20,6 +19,9 @@
   u_DummyVersionInfo in 'u_DummyVersionInfo.pas',
   u_AbstractVersionInfo in 'u_AbstractVersionInfo.pas';
 
+{$R *_icon.res}
+{$R *_version.res}
+
 begin
   Application.Initialize;
   Application.Title := 'PrepBuild';

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-28 11:51:34 UTC (rev 196)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2007-07-28 12:01:53 UTC (rev 197)
@@ -23,7 +23,7 @@
     <DCC_DcuOutput>..\dcu</DCC_DcuOutput>
     <DCC_ObjOutput>..\dcu</DCC_ObjOutput>
     <DCC_HppOutput>..\dcu</DCC_HppOutput>
-    <DCC_Define>DEBUG;no_translation</DCC_Define>
+    <DCC_Define>DEBUG;no_translation;NO_TRANSLATION_HINT</DCC_Define>
     <DCC_ExeOutput>..</DCC_ExeOutput>
     <DCC_UnitSearchPath>$(BDS)\lib\Debug;$(BDS)\Lib\Debug\Indy10;..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_UnitSearchPath>
     <DCC_ResourcePath>$(BDS)\lib\Debug;$(BDS)\Lib\Debug\Indy10;..\libs\dzlib\src;..\libs\dzCmdLineParser;..\libs\dztemplates\templates;..\libs\dztemplates\units;..\libs\jcl\source;..\libs\jcl\source\common;..\libs\jcl\source\windows;..\libs\jcl\source\vcl</DCC_ResourcePath>
@@ -37,10 +37,35 @@
     <Borland.Personality>Delphi.Personality</Borland.Personality>
     <Borland.ProjectType />
     <BorlandProject>
-<BorlandProject><Delphi.Personality><Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters><Parameters Name="RunParams">--incbuild --readini=src\prepbuild --exec=prep.cmd</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">False</VersionInfo><VersionInfo Name="AutoIncBuild">True</VersionInfo><VersionInfo Name="MajorVer">1</VersionInfo><VersionInfo Name="MinorVer">1</VersionInfo><VersionInfo Name="Release">0</VersionInfo><VersionInfo Name="Build">62</VersionInfo><VersionInfo Name="Debug">False</VersionInfo><VersionInfo Name="PreRelease">False</VersionInfo><VersionInfo Name="Special">False</VersionInfo><VersionInfo Name="Private">False</VersionInfo><VersionInfo Name="DLL">False</VersionInfo><VersionInfo Name="Locale">1033</VersionInfo><VersionInfo Name="CodePage">1252</VersionInfo></VersionInfo><VersionInfoKeys><VersionInfoKeys Name="FileVe!
 rsion">1.1.0.62</VersionInfoKeys><VersionInfoKeys Name="ProductVersion">&lt;build data goes here&gt;</VersionInfoKeys><VersionInfoKeys Name="CompanyName">dummzeuch.de</VersionInfoKeys><VersionInfoKeys Name="FileDescription">increment build number and create rc file</VersionInfoKeys><VersionInfoKeys Name="InternalName">PrepBuild</VersionInfoKeys><VersionInfoKeys Name="LegalCopyright">copyright 2005-2007 by Thomas Mueller</VersionInfoKeys><VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys><VersionInfoKeys Name="OriginalFilename">PrepBuild.exe</VersionInfoKeys><VersionInfoKeys Name="ProductName">PrepBuild</VersionInfoKeys><VersionInfoKeys Name="Comments">this is the comment</VersionInfoKeys></VersionInfoKeys><Excluded_Packages>
+<BorlandProject><Delphi.Personality><Parameters><Parameters Name="UseLauncher">False</Parameters><Parameters Name="LoadAllSymbols">True</Parameters><Parameters Name="LoadUnspecifiedSymbols">False</Parameters><Parameters Name="RunParams">--incbuild --readini=src\prepbuild --exec=prep.cmd</Parameters></Parameters><VersionInfo><VersionInfo Name="IncludeVerInfo">False</VersionInfo><VersionInfo Name="AutoIncBuild">False</VersionInfo>  <VersionInfo Name="MajorVer">1</VersionInfo>
+      <VersionInfo Name="MinorVer">0</VersionInfo>
+      <VersionInfo Name="Release">0</VersionInfo>
+      <VersionInfo Name="Build">0</VersionInfo>
+      <VersionInfo Name="Debug">False</VersionInfo>
+      <VersionInfo Name="PreRelease">False</VersionInfo>
+      <VersionInfo Name="Special">False</VersionInfo>
+      <VersionInfo Name="Private">False</VersionInfo>
+      <VersionInfo Name="DLL">False</VersionInfo>
+      <VersionInfo Name="Locale">2057</VersionInfo>
+      <VersionInfo Name="CodePage">1252</VersionInfo>
+    </VersionInfo><Excluded_Packages>
+      
+      
       <Excluded_Packages Name="$(BDS)\bin\dclofficexp100.bpl">Microsoft Office XP Sample Automation Server Wrapper Components</Excluded_Packages>
       <Excluded_Packages Name="$(BDS)\bin\dcloffice2k100.bpl">Microsoft Office 2000 Sample Automation Server Wrapper Components</Excluded_Packages>
-    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source></Delphi.Personality><ModelSupport>False</ModelSupport></BorlandProject></BorlandProject>
+    </Excluded_Packages><Source><Source Name="MainSource">PrepBuild.dpr</Source></Source>  <VersionInfoKeys>
+      <VersionInfoKeys Name="CompanyName"></VersionInfoKeys>
+      <VersionInfoKeys Name="FileDescription"></VersionInfoKeys>
+      <VersionInfoKeys Name="FileVersion">1.0.0.0</VersionInfoKeys>
+      <VersionInfoKeys Name="InternalName"></VersionInfoKeys>
+      <VersionInfoKeys Name="LegalCopyright"></VersionInfoKeys>
+      <VersionInfoKeys Name="LegalTrademarks"></VersionInfoKeys>
+      <VersionInfoKeys Name="OriginalFilename"></VersionInfoKeys>
+      <VersionInfoKeys Name="ProductName"></VersionInfoKeys>
+      <VersionInfoKeys Name="ProductVersion">1.0.0.0</VersionInfoKeys>
+      <VersionInfoKeys Name="Comments"></VersionInfoKeys>
+    </VersionInfoKeys>
+  </Delphi.Personality><ModelSupport>False</ModelSupport></BorlandProject></BorlandProject>
   </ProjectExtensions>
   <Import Project="$(MSBuildBinPath)\Borland.Delphi.Targets" />
   <PropertyGroup>

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini	2007-07-28 11:51:34 UTC (rev 196)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini	2007-07-28 12:01:53 UTC (rev 197)
@@ -1,3 +1,3 @@
 [Version Info]
-Build=86
+Build=101
 

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini	2007-07-28 11:51:34 UTC (rev 196)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild_Version.ini	2007-07-28 12:01:53 UTC (rev 197)
@@ -15,13 +15,13 @@
 
 [Version Info Keys]
 CompanyName=dummzeuch.de
-FileDescription=increment build number and create rc file
-FileVersion=1.1.0.86
+FileDescription=commandline and IDE prebuild tool
+FileVersion=1.1.0.101
 InternalName=PrepBuild
 LegalCopyright=Copyright 2002-2007 by Thomas Mueller
 LegalTrademarks=
 OriginalFilename=PrepBuild.exe
 ProductName=PrepBuild
-ProductVersion=2007-07-22
+ProductVersion=2007-07-28
 Comments=Use at your own risk
 

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-28 11:51:34 UTC (rev 196)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2007-07-28 12:01:53 UTC (rev 197)
@@ -302,19 +302,19 @@
   FGetOpt.RegisterOption('WriteRc', _('write version info to a .rc file'), true);
   FGetOpt.RegisterOption('Icon', _('Assign an icon file to add to the .rc file'), true);
   FGetOpt.RegisterOption('IncBuild', _('increment the build number'), false);
-  FGetOpt.RegisterOption('MajorVer', _('set the major version number'), true);
-  FGetOpt.RegisterOption('MinorVer', _('set the minor version number'), true);
-  FGetOpt.RegisterOption('Release', _('set the release number'), true);
-  FGetOpt.RegisterOption('Build', _('set the build number'), true);
-  FGetOpt.RegisterOption('FileDesc', _('set the file description'), true);
-  FGetOpt.RegisterOption('InternalName', _('set the internal name'), true);
-  FGetOpt.RegisterOption('OriginalName', _('set the original file name'), true);
-  FGetOpt.RegisterOption('Product', _('set the product name'), true);
-  FGetOpt.RegisterOption('ProductVersion', _('set the product version'), true);
-  FGetOpt.RegisterOption('Company', _('set the company name'), true);
-  FGetOpt.RegisterOption('Copyright', _('set the legal copyright'), true);
-  FGetOpt.RegisterOption('Trademark', _('set the legal trademark'), true);
-  FGetOpt.RegisterOption('Comments', _('set the comments'), true);
+  FGetOpt.RegisterOption('MajorVer', _('set the major version number (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('MinorVer', _('set the minor version number (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Release', _('set the release number (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Build', _('set the build number (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('FileDesc', _('set the file description (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('InternalName', _('set the internal name (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('OriginalName', _('set the original file name (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Product', _('set the product name (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('ProductVersion', _('set the product version (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Company', _('set the company name (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Copyright', _('set the legal copyright (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Trademark', _('set the legal trademark (overwrites value from -ReadXxx option)'), true);
+  FGetOpt.RegisterOption('Comments', _('set the comments (overwrites value from -ReadXxx option)'), true);
 end;
 
 initialization



