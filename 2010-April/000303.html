<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dzchart-svncheckins] r442 - in utilities/dzPrepBuild/trunk:	buildtools src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dzchart-svncheckins/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:dzchart-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BDzchart-svncheckins%5D%20r442%20-%20in%20utilities/dzPrepBuild/trunk%3A%0A%09buildtools%20src&In-Reply-To=%3C201004111628.o3BGShjR030958%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000302.html">
   <LINK REL="Next"  HREF="000304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dzchart-svncheckins] r442 - in utilities/dzPrepBuild/trunk:	buildtools src</H1>
    <B>twm at mail.berlios.de</B> 
    <A HREF="mailto:dzchart-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BDzchart-svncheckins%5D%20r442%20-%20in%20utilities/dzPrepBuild/trunk%3A%0A%09buildtools%20src&In-Reply-To=%3C201004111628.o3BGShjR030958%40sheep.berlios.de%3E"
       TITLE="[Dzchart-svncheckins] r442 - in utilities/dzPrepBuild/trunk:	buildtools src">twm at mail.berlios.de
       </A><BR>
    <I>Sun Apr 11 18:28:43 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000302.html">[Dzchart-svncheckins] r441 - utilities/dzLib/trunk/src
</A></li>
        <LI>Next message: <A HREF="000304.html">[Dzchart-svncheckins] r444 - 3rd/jcl/0.952
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#303">[ date ]</a>
              <a href="thread.html#303">[ thread ]</a>
              <a href="subject.html#303">[ subject ]</a>
              <a href="author.html#303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: twm
Date: 2010-04-11 18:28:38 +0200 (Sun, 11 Apr 2010)
New Revision: 442

Modified:
   utilities/dzPrepBuild/trunk/buildtools/PrepBuild.exe
   utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
   utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini
   utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
Log:
* Bugfix: forgot to create the .rc file in the pre-build event
* automatically add '_Version.rc' to the output filename (without extension)


Modified: utilities/dzPrepBuild/trunk/buildtools/PrepBuild.exe
===================================================================
(Binary files differ)

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild.dproj
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2010-04-11 16:24:39 UTC (rev 441)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild.dproj	2010-04-11 16:28:38 UTC (rev 442)
@@ -37,7 +37,7 @@
     &lt;Borland.Personality&gt;Delphi.Personality&lt;/Borland.Personality&gt;
     &lt;Borland.ProjectType /&gt;
     &lt;BorlandProject&gt;
-&lt;BorlandProject&gt;&lt;Delphi.Personality&gt;&lt;Parameters&gt;&lt;Parameters Name=&quot;UseLauncher&quot;&gt;False&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadAllSymbols&quot;&gt;True&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadUnspecifiedSymbols&quot;&gt;False&lt;/Parameters&gt;&lt;Parameters Name=&quot;RunParams&quot;&gt;--incbuild --readdproj=testdata\testproject --updatedproj=testdata\testproject&lt;/Parameters&gt;&lt;/Parameters&gt;&lt;VersionInfo&gt;&lt;VersionInfo Name=&quot;IncludeVerInfo&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;AutoIncBuild&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MajorVer&quot;&gt;1&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MinorVer&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Release&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Build&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Debug&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;PreRelease&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Special&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Private&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;DLL&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Locale&quot;&gt;2057&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;CodePage&quot;&gt;1252&lt;/VersionInfo&gt;&lt;/VersionInfo&gt;&lt;Excluded_Packages&gt;
+&lt;BorlandProject&gt;&lt;Delphi.Personality&gt;&lt;Parameters&gt;&lt;Parameters Name=&quot;UseLauncher&quot;&gt;False&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadAllSymbols&quot;&gt;True&lt;/Parameters&gt;&lt;Parameters Name=&quot;LoadUnspecifiedSymbols&quot;&gt;False&lt;/Parameters&gt;&lt;Parameters Name=&quot;RunParams&quot;&gt;--incbuild --readini=testdata\testproject --updateini=testdata\testproject --writerc=testdata\testproject&lt;/Parameters&gt;&lt;/Parameters&gt;&lt;VersionInfo&gt;&lt;VersionInfo Name=&quot;IncludeVerInfo&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;AutoIncBuild&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MajorVer&quot;&gt;1&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;MinorVer&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Release&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Build&quot;&gt;0&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Debug&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;PreRelease&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Special&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Private&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;DLL&quot;&gt;False&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;Locale&quot;&gt;2057&lt;/VersionInfo&gt;&lt;VersionInfo Name=&quot;CodePage&quot;&gt;1252&lt;/VersionInfo&gt;&lt;/Ver!
 sionInfo&gt;&lt;Excluded_Packages&gt;
       &lt;Excluded_Packages Name=&quot;$(BDS)\bin\dclofficexp100.bpl&quot;&gt;Microsoft Office XP Sample Automation Server Wrapper Components&lt;/Excluded_Packages&gt;
       &lt;Excluded_Packages Name=&quot;$(BDS)\bin\dcloffice2k100.bpl&quot;&gt;Microsoft Office 2000 Sample Automation Server Wrapper Components&lt;/Excluded_Packages&gt;
     &lt;/Excluded_Packages&gt;&lt;Source&gt;&lt;Source Name=&quot;MainSource&quot;&gt;PrepBuild.dpr&lt;/Source&gt;&lt;/Source&gt;&lt;VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;CompanyName&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;FileDescription&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;FileVersion&quot;&gt;1.0.0.0&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;InternalName&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;LegalCopyright&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;LegalTrademarks&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;OriginalFilename&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;ProductName&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;ProductVersion&quot;&gt;1.0.0.0&lt;/VersionInfoKeys&gt;&lt;VersionInfoKeys Name=&quot;Comments&quot;&gt;&lt;/VersionInfoKeys&gt;&lt;/VersionInfoKeys&gt;&lt;/Delphi.Personality&gt;&lt;ModelSupport&gt;False&lt;/ModelSupport&gt;&lt;/BorlandProject&gt;&lt;/BorlandProject&gt;
@@ -45,7 +45,7 @@
   &lt;Import Project=&quot;$(MSBuildBinPath)\Borland.Delphi.Targets&quot; /&gt;
   &lt;PropertyGroup&gt;
     &lt;PreBuildEvent&gt;subwcrev .. SVN_Version_template.ini SVN_Version.ini
-..\buildtools\prepbuild.exe --incbuild --readini=$(PROJECTPATH) --updateini=$(PROJECTPATH)  --productversiontodate --exec=..\buildtools\prep.cmd $(SAVE)&lt;/PreBuildEvent&gt;
+..\buildtools\prepbuild.exe --incbuild --readini=$(PROJECTPATH) --updateini=$(PROJECTPATH)  --productversiontodate --WriteRc=$(PROJECTPATH) --exec=..\buildtools\prep.cmd $(SAVE)&lt;/PreBuildEvent&gt;
   &lt;/PropertyGroup&gt;
   &lt;ItemGroup&gt;
     &lt;DelphiCompile Include=&quot;PrepBuild.dpr&quot;&gt;

Modified: utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini
===================================================================
--- utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini	2010-04-11 16:24:39 UTC (rev 441)
+++ utilities/dzPrepBuild/trunk/src/PrepBuild_BuildNo.ini	2010-04-11 16:28:38 UTC (rev 442)
@@ -1,4 +1,4 @@
 [Version Info]
-Build=253
-FileVersion=1.2.0.253
+Build=270
+FileVersion=1.2.0.270
 

Modified: utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas
===================================================================
--- utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2010-04-11 16:24:39 UTC (rev 441)
+++ utilities/dzPrepBuild/trunk/src/u_PrepBuildMain.pas	2010-04-11 16:28:38 UTC (rev 442)
@@ -46,9 +46,12 @@
 
 procedure TPrepBuildMain.WriteRcFile(const _Project: string; _VersionInfo: TVersionInfo; const _Icon: string);
 var
+  fn: string;
   t: TextFile;
 begin
-  Assignfile(t, ChangeFileExt(_Project, '.rc'));
+  fn := ChangeFileExt(_Project, '_Version.rc');
+  WriteLn('Writing rc file ', fn);
+  Assignfile(t, fn);
   Rewrite(t);
   try
     WriteLn(t, {    } 'LANGUAGE LANG_ENGLISH,SUBLANG_ENGLISH_US');
@@ -342,7 +345,6 @@
       IconFile := '';
 
     if FGetOpt.OptionPassed('WriteRc', Param) then begin
-      WriteLn('Writing rc file ', Param);
       WriteRcFile(Param, VersionInfo, IconFile);
     end;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000302.html">[Dzchart-svncheckins] r441 - utilities/dzLib/trunk/src
</A></li>
	<LI>Next message: <A HREF="000304.html">[Dzchart-svncheckins] r444 - 3rd/jcl/0.952
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#303">[ date ]</a>
              <a href="thread.html#303">[ thread ]</a>
              <a href="subject.html#303">[ subject ]</a>
              <a href="author.html#303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dzchart-svncheckins">More information about the dzchart-svncheckins
mailing list</a><br>
</body></html>
